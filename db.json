{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/concise/source/404.html","path":"404.html","modified":0,"renderable":1},{"_id":"themes/concise/source/bg-grey.png","path":"bg-grey.png","modified":0,"renderable":1},{"_id":"themes/concise/source/bg-prettify.png","path":"bg-prettify.png","modified":0,"renderable":1},{"_id":"themes/concise/source/defimg.png","path":"defimg.png","modified":0,"renderable":1},{"_id":"themes/concise/source/favicon.ico","path":"favicon.ico","modified":0,"renderable":1},{"_id":"themes/concise/source/logo.png","path":"logo.png","modified":0,"renderable":1},{"_id":"themes/concise/source/css/categories.scss","path":"css/categories.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/concise.scss","path":"css/concise.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/page.scss","path":"css/page.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/timeline.css","path":"css/timeline.css","modified":0,"renderable":1},{"_id":"themes/concise/source/js/concise.js","path":"js/concise.js","modified":0,"renderable":1},{"_id":"themes/concise/source/js/fancybox.js","path":"js/fancybox.js","modified":0,"renderable":1},{"_id":"themes/concise/source/js/script.js","path":"js/script.js","modified":0,"renderable":1},{"_id":"themes/concise/source/js/modernizr.js","path":"js/modernizr.js","modified":0,"renderable":1},{"_id":"themes/concise/source/js/test.js","path":"js/test.js","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/footer.scss","path":"css/partials/footer.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/category.scss","path":"css/partials/category.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/header.scss","path":"css/partials/header.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/m.scss","path":"css/partials/m.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/logo.scss","path":"css/partials/logo.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/main.scss","path":"css/partials/main.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/my.scss","path":"css/partials/my.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/post.scss","path":"css/partials/post.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/public/base.scss","path":"css/public/base.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/public/public.scss","path":"css/public/public.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/thirdparty/algolia.scss","path":"css/thirdparty/algolia.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/js/thirdparty/algolia.js","path":"js/thirdparty/algolia.js","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/post/nav.scss","path":"css/partials/post/nav.scss","modified":0,"renderable":1},{"_id":"themes/concise/source/css/partials/post/paging.scss","path":"css/partials/post/paging.scss","modified":0,"renderable":1}],"Cache":[{"_id":"themes/concise/_config.yml","hash":"dfab57ae1eb1d20be096595cb902061eb948fcc0","modified":1496385050363},{"_id":"themes/concise/npm-debug.log","hash":"16e05bc03231362882dbd1553388475225effee0","modified":1496369978551},{"_id":"source/_posts/Git-Push-出现错误处理.md","hash":"614260f3c455156f81af7c79b6c8e332fb037c30","modified":1484275108023},{"_id":"source/_posts/Git-分支（branch）的使用整理.md","hash":"fb7eb1087ef4fd7f156c28d99fb5e0a1f9c87fd2","modified":1471337749911},{"_id":"source/_posts/15个PHP开发者常用的正则表达式及实例.md","hash":"7bcca7bd1cc139dcdfc118ea5cea6f87791f766c","modified":1469937927363},{"_id":"source/_posts/Linux-alias-永久生效.md","hash":"3bd2916a854728a2deef13bab9ee76f343bafb5a","modified":1483085893167},{"_id":"source/_posts/Linux-安装supervisor-CentOs-or-RedHat.md","hash":"a37e88013d10f3b5be140c13bb8e414687fd3dbc","modified":1489545269648},{"_id":"source/_posts/Linux-将用户加入用户组.md","hash":"3bdd1750e939ac28e88fa3822b915a83bc3bb765","modified":1496308050561},{"_id":"source/_posts/MySQL事务隔离级别详解.md","hash":"b326b181d5b5b90826f74499d8137d82444600f2","modified":1496384418776},{"_id":"source/_posts/Nginx配置虚拟主机.md","hash":"42d1a49fdebb9170b0d8103b5d2e9f8b5417ae88","modified":1471337249771},{"_id":"source/_posts/NodeJs-Error-Can-t-set-headers-after-they-are-sent-怎么解决？.md","hash":"5e95e5105da072906dba610cd2e7865a0766290a","modified":1471337292426},{"_id":"source/_posts/NodeJs-多语言包.md","hash":"17b051b4975fa6d9411c2158dea261a8cbc0be74","modified":1469776696452},{"_id":"source/_posts/Nodejs-使用pm2实现开机自启.md","hash":"a27f3ec9269fad90b645526d297b08794e467b54","modified":1472210087292},{"_id":"source/_posts/PHP-7-拓展编写-从hello-world开始.md","hash":"74c001a7e2168b31f4268270d39a727e580db39b","modified":1495458312235},{"_id":"source/_posts/PHP-7-拓展编写-在拓展中调用函数.md","hash":"1c4b75f48dae47b7976021354b81c1d34c4c8b78","modified":1495888836193},{"_id":"source/_posts/PHP-UTC转GMT时区.md","hash":"012b5dd460f72885bed0fec4b2ce9dd176500a6e","modified":1471951948263},{"_id":"source/_posts/PHP-curl传送json数据.md","hash":"74156005e6a8d4f19a5fdb867aba6bb5042333e5","modified":1469618724757},{"_id":"source/_posts/PHP-底层：PHP的生命周期.md","hash":"c03e915a8ac7bc209c73ebd26ab97ff5d53d9420","modified":1492257009655},{"_id":"source/_posts/PHP7拓展开发-函数的传参和返回值.md","hash":"96a3d408e047223e09bd734882980aa7f26f90ee","modified":1496233643402},{"_id":"source/_posts/PHP-零散函数（一）.md","hash":"e1d615d558edb54a8036a8c217ed83319e28d308","modified":1474618447688},{"_id":"source/_posts/PHP使用fastcgi-finish-request-提高响应.md","hash":"de65068cddebaba221fc5e95e92c20540009ae29","modified":1476705676457},{"_id":"source/_posts/PHP实现RSA加密、解密操作.md","hash":"3d2cd15f8c4ad5479d179a26ae5b58d3dd2a0a49","modified":1473418291673},{"_id":"source/_posts/PHP拓展开发-函数的传参和返回值.md","hash":"d87e2853ece2b0d1195b4092910c7cbbe1a35610","modified":1496233543082},{"_id":"source/_posts/Team-building.md","hash":"c91aa402f72fa1a8f4947ba1e5d3786566dd6c2d","modified":1469798153531},{"_id":"source/_posts/SSH和HTTPS互相切换.md","hash":"d0344a97eb2995dddea97c6a93bccbf10a41c1ff","modified":1471337291506},{"_id":"source/_posts/Ubuntu搭建lnmp环境.md","hash":"3c654a7231e5d81c5c7dfe7a7dcab71337ccc1eb","modified":1489544481608},{"_id":"source/_posts/Ubuntu查看版本.md","hash":"c1e0410147c9375536dd28655190149e7d3aaab6","modified":1480313278037},{"_id":"source/_posts/bash基础学习一.md","hash":"a3bd8e52a4c75674b79f760f1b8daeb74f1f2bcb","modified":1492155723929},{"_id":"source/_posts/linux后台运行脚本.md","hash":"f619a219d1a5925e9986ed53c8d7b7fd1e521056","modified":1489642241715},{"_id":"source/_posts/php-创建xml的几种方式.md","hash":"dee630ad27772cace809bc0f6541ca008fd2af63","modified":1479190807837},{"_id":"source/_posts/sphinx-生成索引时出现WARNING-attribute-id-not-found-IGNORING.md","hash":"41691190bb1dbee62d331244732d326fada7dcc0","modified":1491119183023},{"_id":"source/_posts/一些杂谈琐事—-—-———-自我反思.md","hash":"17616c3a4648b35c270bc80b06c918b11b308482","modified":1471337463499},{"_id":"source/_posts/关于多个chatbot的调研结果.md","hash":"5966a48b0b2be5260bd97a3775bbb2374d5b41b8","modified":1472210490252},{"_id":"source/_posts/读《代码整洁之道》.md","hash":"d7701726593fbf37767831ba6552d51e8c72e99a","modified":1472817810286},{"_id":"source/_posts/阿里云消息队列和消息服务的使用.md","hash":"5aeebbde12d3db964b686a6991337dd36a6a8e2c","modified":1479463220611},{"_id":"source/about/index.md","hash":"23125628f97358ca78994d5d3adf1d8bd590e348","modified":1469756787374},{"_id":"source/categories/index.md","hash":"837f964ec19e629fd781262d15fccafe2d0902c6","modified":1470564565685},{"_id":"source/tags/index.md","hash":"0081f6236acecd224e0ef178db724ef6dc0578e0","modified":1470564548218},{"_id":"themes/concise/.idea/concise.iml","hash":"c7c4a216364e1a90dc9ebf19e4c967f26c4f8e52","modified":1496369978520},{"_id":"themes/concise/.idea/vcs.xml","hash":"d222c1e95ba289f2814d142867f8b3c8b656bcc6","modified":1496369978522},{"_id":"themes/concise/.idea/modules.xml","hash":"85f1a9d801e199040eb674041624790688f4387b","modified":1496369978522},{"_id":"themes/concise/.idea/workspace.xml","hash":"28f3044c4f073a7dffac5b535373f7aab0ee6397","modified":1496369978523},{"_id":"themes/concise/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1496369978506},{"_id":"themes/concise/.git/config","hash":"a1a5cb82d3527fad726346cba577290f0bc09447","modified":1496369978512},{"_id":"themes/concise/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1496369975058},{"_id":"themes/concise/.git/index","hash":"1a7d5a4ff6a085fea147101c61fca62f4f347a74","modified":1496369978574},{"_id":"themes/concise/.git/packed-refs","hash":"8c2d2a281b7956ccb07bcdef14f65c5867ed9d2d","modified":1496369978500},{"_id":"themes/concise/layout/archive.ejs","hash":"7c5ada51c177df141503cef16d5cabe8b8f8bda9","modified":1496369978526},{"_id":"themes/concise/layout/categories.ejs","hash":"48869002910ab05848d80e4b730f50c57de39c89","modified":1496369978527},{"_id":"themes/concise/layout/category.ejs","hash":"ed66ad9351fefb3573998b39954be55b08b521b2","modified":1496369978528},{"_id":"themes/concise/layout/index.ejs","hash":"fdaddfe90d55741ea174171cf0508d4f904aa17f","modified":1496369978529},{"_id":"themes/concise/layout/page.ejs","hash":"5b181013732f6f984cc792736adda3be56f8f2fd","modified":1496369978531},{"_id":"themes/concise/layout/layout.ejs","hash":"f17a6aa15cbc368e1a6206b9273c7705e1897440","modified":1496369978529},{"_id":"themes/concise/layout/post.ejs","hash":"5b181013732f6f984cc792736adda3be56f8f2fd","modified":1496369978539},{"_id":"themes/concise/layout/tag.ejs","hash":"baa2285b4d5c05ae1d8052c18bb2dc507b5d5da6","modified":1496369978539},{"_id":"themes/concise/layout/tags.ejs","hash":"6cbdeb0c2e4eedb1c6db40e109f757725e7ee163","modified":1496369978540},{"_id":"themes/concise/source/404.html","hash":"52ae25a6412682216ab06049a4ab9ad04c33e1b1","modified":1496369978551},{"_id":"themes/concise/source/bg-grey.png","hash":"9417318e69b0244d9e8efd519d68b933ddf71edb","modified":1496369978552},{"_id":"themes/concise/source/bg-prettify.png","hash":"5853b923a1d210519c4520b21c5c80d0594c0aec","modified":1496369978554},{"_id":"themes/concise/source/defimg.png","hash":"f8bcc200758729fef4e95b5cab15cf52f336e013","modified":1496369978566},{"_id":"themes/concise/source/favicon.ico","hash":"7f9dd239cd4b8b98a4e8f82d921d11cb06a7895c","modified":1496369978566},{"_id":"themes/concise/source/logo.png","hash":"6574357362ece5ce3c13db1ad89497e6728184df","modified":1496369978573},{"_id":"themes/concise/.idea/dictionaries/Administrator.xml","hash":"daa9629c75330fbe0ca8fff78580435c4f8fd6ce","modified":1496369978522},{"_id":"themes/concise/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1496369975060},{"_id":"themes/concise/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1496369975060},{"_id":"themes/concise/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1496369975061},{"_id":"themes/concise/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1496369975061},{"_id":"themes/concise/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1496369975062},{"_id":"themes/concise/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1496369975062},{"_id":"themes/concise/.git/hooks/pre-rebase.sample","hash":"5885a56ab4fca8075a05a562d005e922cde9853b","modified":1496369975063},{"_id":"themes/concise/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1496369975064},{"_id":"themes/concise/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1496369975064},{"_id":"themes/concise/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1496369975065},{"_id":"themes/concise/.git/logs/HEAD","hash":"5bc2752480dbb758ba2a348965cdf5f6092484e5","modified":1496369978508},{"_id":"themes/concise/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1496369975066},{"_id":"themes/concise/layout/additional/exceptional.ejs","hash":"99d40289bc662d023f0981463fa947ff88d91912","modified":1496369978526},{"_id":"themes/concise/layout/partials/archive.ejs","hash":"9c02f398091b73971bf3005a95f64dca1beec9e6","modified":1496369978532},{"_id":"themes/concise/layout/partials/article.ejs","hash":"e73f8dfc969f5f1066ab5b674c5a250c6753ce71","modified":1496369978532},{"_id":"themes/concise/layout/partials/footer.ejs","hash":"c0f96aa79652cd722057bea91bee23310fb36db2","modified":1496369978533},{"_id":"themes/concise/layout/partials/head.ejs","hash":"ccd4afe2ee194d0e6cb1c7ef3bc44cad6c6d1ecf","modified":1496369978534},{"_id":"themes/concise/layout/partials/my.ejs","hash":"83e8654a68d35a8c40198de3703bd6946333483c","modified":1496369978536},{"_id":"themes/concise/layout/partials/header.ejs","hash":"ff1620ca96e117e0fd8d1a0ee9097ed0f20d0f34","modified":1496369978535},{"_id":"themes/concise/layout/partials/logo.ejs","hash":"c1e9d4d1fde37706fe309c58ca06fdfae6ef5515","modified":1496369978535},{"_id":"themes/concise/layout/partials/page.ejs","hash":"09fc59e3a4ea81f19596f668303c60f0da04a546","modified":1496369978536},{"_id":"themes/concise/source/css/categories.scss","hash":"3f4d4613f877a9f6a93b0ffaa006573cdaef3c96","modified":1496369978554},{"_id":"themes/concise/source/css/concise.scss","hash":"295fcfc14e912eb8b305d888c98cc4266c6d3f5d","modified":1496369978555},{"_id":"themes/concise/source/css/page.scss","hash":"a5a41fa84ae1493bcfbc376c36beea8d1ead0a55","modified":1496369978555},{"_id":"themes/concise/source/css/timeline.css","hash":"be5bb37243916004fcce5b93ed66c43cb6dda970","modified":1496369978566},{"_id":"themes/concise/source/js/concise.js","hash":"1f840ee63935f1ebbe337a1904c1b71a57057bb3","modified":1496369978567},{"_id":"themes/concise/source/js/fancybox.js","hash":"4c130fc242cf9b59b5df6ca5eae3b14302311e8c","modified":1496369978569},{"_id":"themes/concise/source/js/script.js","hash":"28ade6e4b1979a67bc79224cef6687a6a44ccd09","modified":1496369978570},{"_id":"themes/concise/source/js/modernizr.js","hash":"9394fa6daf396348c5b0aa20787025aa706e3afb","modified":1496369978569},{"_id":"themes/concise/source/js/test.js","hash":"08bbf0e933b852788f5626c5200374796f598373","modified":1496369978570},{"_id":"themes/concise/.git/objects/pack/pack-827165b9081c1230f36be8fb31c30e8775fa98e8.idx","hash":"c9b7989baa97a495cfdc6d5ffbe0dbf25c2198cb","modified":1496369978413},{"_id":"themes/concise/.git/refs/heads/master","hash":"706042e7d34635a616a528232bfb5274b6957fd5","modified":1496369978508},{"_id":"themes/concise/layout/partials/post/nav.ejs","hash":"9f077b2c61963079cb86f231d1636d1dd3ff166a","modified":1496369978537},{"_id":"themes/concise/layout/partials/post/paging.ejs","hash":"c958fdcc9b657c7d2ebf8d8b49955ae446c265ff","modified":1496369978537},{"_id":"themes/concise/layout/thirdparty/search/algolia.ejs","hash":"1735d6815eff06de376673af9277b65b0478705f","modified":1496369978544},{"_id":"themes/concise/layout/thirdparty/comment/netEaseCloudComment.ejs","hash":"29e1be5f1d3fb52f5c99a4dac62ad75c5064e319","modified":1496369978542},{"_id":"themes/concise/layout/thirdparty/comment/uYan.ejs","hash":"6dafef02e1cf00c31468c088dc4eac8099b1920c","modified":1496369978543},{"_id":"themes/concise/layout/thirdparty/share/baiduShare.ejs","hash":"d35d8ce2b600f5e4912d9437328cc96e0f992e5e","modified":1496369978547},{"_id":"themes/concise/layout/thirdparty/seo/baidu.ejs","hash":"2b3e09adf3e46848f3dadd051dd767f8d354b8dd","modified":1496369978544},{"_id":"themes/concise/layout/thirdparty/statistical/umen.ejs","hash":"cf791ff1df2367d4443f86830d1b135a735c12bd","modified":1496369978548},{"_id":"themes/concise/layout/thirdparty/view/leanCloud.ejs","hash":"2bad5fb2a0dfcf7f1963ca6091636708d9aea917","modified":1496369978548},{"_id":"themes/concise/source/css/partials/footer.scss","hash":"03ca8f4872232b9dcbff24a86dbb6d342124a132","modified":1496369978560},{"_id":"themes/concise/source/css/partials/category.scss","hash":"b0fb75afcbadf5967903daa4dca8a5454f6caddd","modified":1496369978558},{"_id":"themes/concise/source/css/partials/header.scss","hash":"2acb5d6fcc0eaa91cdf5647264cbb70c2f74f0bb","modified":1496369978560},{"_id":"themes/concise/source/css/partials/m.scss","hash":"7719e9546cda5436d636c1a573cb584f2788cde2","modified":1496369978561},{"_id":"themes/concise/source/css/partials/logo.scss","hash":"58175dad976a6b1e6d7a85230a58042d4d653261","modified":1496369978561},{"_id":"themes/concise/source/css/partials/main.scss","hash":"7a93a3b3ce2673d748a38ec3138b66bb3eae23dd","modified":1496369978561},{"_id":"themes/concise/source/css/partials/my.scss","hash":"f238add4dab2f7494328e212efde8a80e450936b","modified":1496369978561},{"_id":"themes/concise/source/css/partials/post.scss","hash":"ee32fa77f69c24ecd419b4fb3fff2415266c31e2","modified":1496369978562},{"_id":"themes/concise/source/css/public/base.scss","hash":"33d527d43ee433e95269dfdf668ce62942ea43e6","modified":1496369978565},{"_id":"themes/concise/source/css/public/public.scss","hash":"304ad59ef00016bdea519de3d616b3126c2ca272","modified":1496369978565},{"_id":"themes/concise/source/css/thirdparty/algolia.scss","hash":"9c03adb8e3b1876dfbc231830eafae87a029abfa","modified":1496369978565},{"_id":"themes/concise/source/js/thirdparty/algolia.js","hash":"bd87f206a1f1583a2927edbfee0134390f211396","modified":1496369978571},{"_id":"themes/concise/.git/logs/refs/heads/master","hash":"5bc2752480dbb758ba2a348965cdf5f6092484e5","modified":1496369978510},{"_id":"themes/concise/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1496369978505},{"_id":"themes/concise/source/css/partials/post/nav.scss","hash":"b36911f63b980093e2f02822d517a43ad195d5e2","modified":1496369978562},{"_id":"themes/concise/source/css/partials/post/paging.scss","hash":"11841cafdcf5ddda97f299546629ea360fd9565f","modified":1496369978562},{"_id":"themes/concise/.git/logs/refs/remotes/origin/HEAD","hash":"5bc2752480dbb758ba2a348965cdf5f6092484e5","modified":1496369978505},{"_id":"themes/concise/.git/objects/pack/pack-827165b9081c1230f36be8fb31c30e8775fa98e8.pack","hash":"116b5f210b86e37a8d6003879e6c00e9a30553b5","modified":1496369978420}],"Category":[{"name":"Git","_id":"cj3fgv31700050oqm7kne9sqw"},{"name":"PHP","_id":"cj3fgv31j000b0oqmr64uv9za"},{"name":"Linux","_id":"cj3fgv31m000h0oqmv12djnlw"},{"name":"NodeJs","_id":"cj3fgv31z000z0oqmii5oqznx"},{"name":"Life","_id":"cj3fgv32j001t0oqmcy5j57gq"},{"name":"Bash Linux","_id":"cj3fgv32v00260oqm46klvb9a"},{"name":"自我反思","_id":"cj3fgv335002j0oqmaq21vdou"},{"name":"随笔","_id":"cj3fgv338002q0oqmg2erqaaa"}],"Data":[],"Page":[{"title":"About","date":"2016-07-28T12:52:37.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: About\ndate: 2016-07-28 20:52:37\n---\n","updated":"2016-07-29T01:46:27.374Z","path":"about/index.html","comments":1,"layout":"page","_id":"cj3fgv31000010oqm0awtt279","content":"","excerpt":"","more":""},{"title":"categories","date":"2016-08-07T10:09:25.000Z","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2016-08-07 18:09:25\n---\n","updated":"2016-08-07T10:09:25.685Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cj3fgv31300030oqm0hk38g1j","content":"","excerpt":"","more":""},{"title":"tags","date":"2016-08-07T10:09:08.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2016-08-07 18:09:08\n---\n","updated":"2016-08-07T10:09:08.218Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cj3fgv31a00070oqmtoi41abb","content":"","excerpt":"","more":""}],"Post":[{"title":"Git Push 出现错误处理","date":"2016-09-02T06:44:54.000Z","_content":"\n\n#### 这几次一直使用`git push`出现如下错误，百度一直没有找到好的解决办法\n```bash\nremote: error: insufficient permission for adding an object to repository database ./objects\nremote: fatal: failed to write object\nerror: unpack failed: unpack-objects abnormal exit\nTo git@GIT-ADDRESS\n ! [remote rejected] develop -> develop (unpacker error)\nerror: failed to push some refs to 'git@GIT-ADDRESS'\n```\n#### 基本上每次都是绕开：\n```bash\n$ git remote set-url origin HTTPS\n#HTTPS 为https的项目地址\n$ git push\n#输入用户名\n#输入密码\n```\n\n#### 今天终于找到了解决办法：\n```bash\n#切换为ssh\n$ git config --global push.default matching\n$ git push\n```\n\n#### 拓展：\n\n```bash\n$ git push origin master\n```\n上面命令表示，将本地的master分支推送到origin主机的master分支。如果后者不存在，则会被新建。\n\n```bash\n$ git push origin\n# git push\n```\n上面命令表示，将当前分支推送到origin主机的对应分支。\n\n不带任何参数的git push，默认只推送当前分支，这叫做simple方式。此外，还有一种matching方式，会推送所有有对应的远程分支的本地分支。Git 2.0版本之前，默认采用matching方法，现在改为默认采用simple方式。如果要修改这个设置，可以采用git config命令。\n\n```bash\n$ git config --global push.default matching\n# 或者\n$ git config --global push.default simple\n```\n\n```bash\n$ git push --force origin\n```\n\n上面命令使用–force选项，结果导致在远程主机产生一个”非直进式”的合并(non-fast-forward merge)。除非你很确定要这样做，否则应该尽量避免使用–force选项。","source":"_posts/Git-Push-出现错误处理.md","raw":"---\ntitle: Git Push 出现错误处理\ndate: 2016-09-02 14:44:54\ntags: Git Push\ncategories: Git\n---\n\n\n#### 这几次一直使用`git push`出现如下错误，百度一直没有找到好的解决办法\n```bash\nremote: error: insufficient permission for adding an object to repository database ./objects\nremote: fatal: failed to write object\nerror: unpack failed: unpack-objects abnormal exit\nTo git@GIT-ADDRESS\n ! [remote rejected] develop -> develop (unpacker error)\nerror: failed to push some refs to 'git@GIT-ADDRESS'\n```\n#### 基本上每次都是绕开：\n```bash\n$ git remote set-url origin HTTPS\n#HTTPS 为https的项目地址\n$ git push\n#输入用户名\n#输入密码\n```\n\n#### 今天终于找到了解决办法：\n```bash\n#切换为ssh\n$ git config --global push.default matching\n$ git push\n```\n\n#### 拓展：\n\n```bash\n$ git push origin master\n```\n上面命令表示，将本地的master分支推送到origin主机的master分支。如果后者不存在，则会被新建。\n\n```bash\n$ git push origin\n# git push\n```\n上面命令表示，将当前分支推送到origin主机的对应分支。\n\n不带任何参数的git push，默认只推送当前分支，这叫做simple方式。此外，还有一种matching方式，会推送所有有对应的远程分支的本地分支。Git 2.0版本之前，默认采用matching方法，现在改为默认采用simple方式。如果要修改这个设置，可以采用git config命令。\n\n```bash\n$ git config --global push.default matching\n# 或者\n$ git config --global push.default simple\n```\n\n```bash\n$ git push --force origin\n```\n\n上面命令使用–force选项，结果导致在远程主机产生一个”非直进式”的合并(non-fast-forward merge)。除非你很确定要这样做，否则应该尽量避免使用–force选项。","slug":"Git-Push-出现错误处理","published":1,"updated":"2017-01-13T02:38:28.023Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv30v00000oqmgk0gsklu","content":"<h4 id=\"这几次一直使用git-push出现如下错误，百度一直没有找到好的解决办法\"><a href=\"#这几次一直使用git-push出现如下错误，百度一直没有找到好的解决办法\" class=\"headerlink\" title=\"这几次一直使用git push出现如下错误，百度一直没有找到好的解决办法\"></a>这几次一直使用<code>git push</code>出现如下错误，百度一直没有找到好的解决办法</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">remote: error: insufficient permission <span class=\"keyword\">for</span> adding an object to repository database ./objects</div><div class=\"line\">remote: fatal: failed to write object</div><div class=\"line\">error: unpack failed: unpack-objects abnormal <span class=\"built_in\">exit</span></div><div class=\"line\">To git@GIT-ADDRESS</div><div class=\"line\"> ! [remote rejected] develop -&gt; develop (unpacker error)</div><div class=\"line\">error: failed to push some refs to <span class=\"string\">'git@GIT-ADDRESS'</span></div></pre></td></tr></table></figure>\n<h4 id=\"基本上每次都是绕开：\"><a href=\"#基本上每次都是绕开：\" class=\"headerlink\" title=\"基本上每次都是绕开：\"></a>基本上每次都是绕开：</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git remote <span class=\"built_in\">set</span>-url origin HTTPS</div><div class=\"line\"><span class=\"comment\">#HTTPS 为https的项目地址</span></div><div class=\"line\">$ git push</div><div class=\"line\"><span class=\"comment\">#输入用户名</span></div><div class=\"line\"><span class=\"comment\">#输入密码</span></div></pre></td></tr></table></figure>\n<h4 id=\"今天终于找到了解决办法：\"><a href=\"#今天终于找到了解决办法：\" class=\"headerlink\" title=\"今天终于找到了解决办法：\"></a>今天终于找到了解决办法：</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">#切换为ssh</span></div><div class=\"line\">$ git config --global push.default matching</div><div class=\"line\">$ git push</div></pre></td></tr></table></figure>\n<h4 id=\"拓展：\"><a href=\"#拓展：\" class=\"headerlink\" title=\"拓展：\"></a>拓展：</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push origin master</div></pre></td></tr></table></figure>\n<p>上面命令表示，将本地的master分支推送到origin主机的master分支。如果后者不存在，则会被新建。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push origin</div><div class=\"line\"><span class=\"comment\"># git push</span></div></pre></td></tr></table></figure>\n<p>上面命令表示，将当前分支推送到origin主机的对应分支。</p>\n<p>不带任何参数的git push，默认只推送当前分支，这叫做simple方式。此外，还有一种matching方式，会推送所有有对应的远程分支的本地分支。Git 2.0版本之前，默认采用matching方法，现在改为默认采用simple方式。如果要修改这个设置，可以采用git config命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git config --global push.default matching</div><div class=\"line\"><span class=\"comment\"># 或者</span></div><div class=\"line\">$ git config --global push.default simple</div></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push --force origin</div></pre></td></tr></table></figure>\n<p>上面命令使用–force选项，结果导致在远程主机产生一个”非直进式”的合并(non-fast-forward merge)。除非你很确定要这样做，否则应该尽量避免使用–force选项。</p>\n","excerpt":"","more":"<h4 id=\"这几次一直使用git-push出现如下错误，百度一直没有找到好的解决办法\"><a href=\"#这几次一直使用git-push出现如下错误，百度一直没有找到好的解决办法\" class=\"headerlink\" title=\"这几次一直使用git push出现如下错误，百度一直没有找到好的解决办法\"></a>这几次一直使用<code>git push</code>出现如下错误，百度一直没有找到好的解决办法</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">remote: error: insufficient permission <span class=\"keyword\">for</span> adding an object to repository database ./objects</div><div class=\"line\">remote: fatal: failed to write object</div><div class=\"line\">error: unpack failed: unpack-objects abnormal <span class=\"built_in\">exit</span></div><div class=\"line\">To git@GIT-ADDRESS</div><div class=\"line\"> ! [remote rejected] develop -&gt; develop (unpacker error)</div><div class=\"line\">error: failed to push some refs to <span class=\"string\">'git@GIT-ADDRESS'</span></div></pre></td></tr></table></figure>\n<h4 id=\"基本上每次都是绕开：\"><a href=\"#基本上每次都是绕开：\" class=\"headerlink\" title=\"基本上每次都是绕开：\"></a>基本上每次都是绕开：</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git remote <span class=\"built_in\">set</span>-url origin HTTPS</div><div class=\"line\"><span class=\"comment\">#HTTPS 为https的项目地址</span></div><div class=\"line\">$ git push</div><div class=\"line\"><span class=\"comment\">#输入用户名</span></div><div class=\"line\"><span class=\"comment\">#输入密码</span></div></pre></td></tr></table></figure>\n<h4 id=\"今天终于找到了解决办法：\"><a href=\"#今天终于找到了解决办法：\" class=\"headerlink\" title=\"今天终于找到了解决办法：\"></a>今天终于找到了解决办法：</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">#切换为ssh</span></div><div class=\"line\">$ git config --global push.default matching</div><div class=\"line\">$ git push</div></pre></td></tr></table></figure>\n<h4 id=\"拓展：\"><a href=\"#拓展：\" class=\"headerlink\" title=\"拓展：\"></a>拓展：</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push origin master</div></pre></td></tr></table></figure>\n<p>上面命令表示，将本地的master分支推送到origin主机的master分支。如果后者不存在，则会被新建。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push origin</div><div class=\"line\"><span class=\"comment\"># git push</span></div></pre></td></tr></table></figure>\n<p>上面命令表示，将当前分支推送到origin主机的对应分支。</p>\n<p>不带任何参数的git push，默认只推送当前分支，这叫做simple方式。此外，还有一种matching方式，会推送所有有对应的远程分支的本地分支。Git 2.0版本之前，默认采用matching方法，现在改为默认采用simple方式。如果要修改这个设置，可以采用git config命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git config --global push.default matching</div><div class=\"line\"><span class=\"comment\"># 或者</span></div><div class=\"line\">$ git config --global push.default simple</div></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push --force origin</div></pre></td></tr></table></figure>\n<p>上面命令使用–force选项，结果导致在远程主机产生一个”非直进式”的合并(non-fast-forward merge)。除非你很确定要这样做，否则应该尽量避免使用–force选项。</p>\n"},{"title":"15个PHP开发者常用的正则表达式及实例","date":"2016-07-29T07:17:42.000Z","_content":"\n> 从字符串中删除特定字符\n> 本段代码实现删除字符串中除所有大小写字母及数字以外的字符\n\n```php\n<?php\n$value = \"wWw.UncleToo.Com - 【UncleToo中文网】 - 12345\";\n$value = preg_replace(\"/[^A-Za-z0-9]/\",\"\",$value);\necho $value;\n//输出：wWwUncleTooComUncleToo12345\n?>\n```\n\n> 验证用户名\n> 以下代码验证用户名是否由字母、数字及下划线组成。\n\n```php\n<?php\n$username = \"uncletoo_COM123\";\nif (preg_match('/^[a-z\\d_]{5,20}$/i', $username)) {\n    echo \"用户名可用\";\n} else {\n    echo \"用户名存在特殊字符\";\n}\n?>\n```\n\n> 添加信息到图片alt属性\n> 使用下面函数，可以实现将文章标题添加到图片的alt属性中。\n\n```php\n<?php\nfunction add_alt_tags($content) {\n\tglobal $post;\n\tpreg_match_all('/<img (.*?)\\/ >/', $content, $images);\n\tif(!is_null($images)) {\n\t\tforeach($images[1] as $index => $value) {\n\t\t\tif(!preg_match('/alt=/', $value)) {\n\t\t\t\t$new_img = str_replace('<img', '<img alt=\"'.get_the_title().'\"', $images[0][$index]);\n\t\t\t\t$content = str_replace($images[0][$index], $new_img, $content);\n\t\t\t}\n\t\t}\n\t}\n\treturn $content;\n}\n?>\n```\n\n\n> 将EMail文本自动添加Mailto链接\n\n```php\n<?php\n$text = \"demo@abc.com\";\n$string = eregi_replace('([_\\.0-9a-z-]+@([0-9a-z][0-9a-z-]+\\.)+[a-z]{2,3})','<a href=\"mailto:\\\\1\">\\\\1</ a>', $text);\necho $string;\n?>\n```\n\n> 过滤限制级词语\n\n```php\n<?php\nfunction filtrado($texto, $reemplazo = false) {\n\t$filtradas = 'admin,uncletoo,中文网'; //这里定义需要过滤的词语\n\t$f = explode(',', $filtradas);\n\t$f = array_map('trim', $f);\n\t$filtro = implode('|', $f);\n\treturn ($reemplazo) ? preg_replace(\"#$filtro#i\", $reemplazo, $texto) : preg_match(\"#$filtro#i\", $texto) ;\n}\n?>\n```\n\n> 验证电话号码\n> 这是一个很常见的功能\n\n```php\n<?php\n$string = \"(010) 555-5555\";\nif (preg_match('/^\\(?[0-9]{3}\\)?|[0-9]{3}[-. ]? [0-9]{3}[-. ]?[0-9]{4}$/', $string)) {\n   echo \"successful.\";\n}\n?>\n```\n\n> 替换超链接href属性的内容\n> 在页面上查看源文件，显示为：&lt; a href=\"yes\" &gt;UncleToo中文网&lt; /a&gt;\n\n```php\n<?php\n$html = '<a href=\"http://www.uncletoo.com\">UncleToo中文网</a>';\n$replacement = \"yes\";\n$pattern = '/(?<=href\\=\")[^]]+?(?=\")/';\n$replacedHrefHtml = preg_replace($pattern, $replacement, $html);\necho $replacedHrefHtml ;\n?>\n```\n\n> 验证邮箱正则表达式\n> 此功能在用户注册是经常使用\n\n```php\n<?php\n$regex = \"([a-z0-9_.-]+)\". # name\n\"@\". # at\n\"([a-z0-9.-]+){2,255}\". # domain & possibly subdomains\n\".\". # period\n\"([a-z]+){2,10}\"; # domain extension\n$eregi = eregi_replace($regex, '', $email);\n$valid_email = empty($eregi) ? true : false;\n?>\n```\n\n> IP地址验证\n \n```php\n<?php\n$string = \"255.255.255.255\";\nif (preg_match(\n'/^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:[.](?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$/', $string)) {\n\techo \"IP address is good.\";\n}\n?>\n```\n\n> 邮政编码验证\n\n```php\n<?php\n$string = \"12345-1234\";\nif (preg_match('/^[0-9]{5}([- ]?[0-9]{4})?$/', $string)) {\n\techo \"zip code checks out\";\n}\n?>\n```\n\n> 高亮显示文本\n\n```php\n<?php\n$text = \"UncleToo（www.uncletoo.com）中文网\";\n$text = preg_replace(\"/\\b(www)\\b/i\", '<span style=\"background:#5fc9f6\">\\1</ span>',$text);\necho $text;\n?>\n```\n\n> 从特定的URL中提取域名\n\n```php\n<?php\n$url = \"http://www.uncletoo.com/plug/tags/?tag=PHP\";\npreg_match('@^(?:http://)?([^/]+)@i', $url, $matches);\n$host = $matches[1];\necho $host;\n//输出：www.uncletoo.com\n?>\n```\n\n> 验证域名格式是否正确\n\n```php\n<?php\n$url = \"http://www.uncletoo.com/\";\nif (preg_match('/^(http|https|ftp):\\/\\/([A-Z0-9][A-Z0-9_-]*(?:\\.[A-Z0-9][A-Z0-9_-]*)+):?(\\d+)?\\/?/i', $url)) {\n    echo \"域名格式正确.\";\n} else {\n    echo \"域名格式错误.\";\n}\n?>\n```\n\n> 使用文章标题生成URL\n\n```php\n<?php\nfunction create_slug($string){\n   $slug=preg_replace('/[^A-Za-z0-9-]+/', '-', $string);\n   return $slug;\n}\necho create_slug('my name is uncletoo');\n//输出：my-name-is-uncletoo\n?>\n```\n\n> 添加http://到URL地址\n> 当我们需要用户填写网址时，很多用户往往不填写http://直接输入域名，使用下面代码可将http://添加到网址的前面。\n\n```php\n<?php\nif (!preg_match(\"/^(http|https|ftp):/\", $_POST['url'])) {\n   $_POST['url'] = 'http://'.$_POST['url'];\n}\n?>\n```\n\n> 将URL转换为超链接\n> 这时一个很有用的功能，他可以将url地址或email地址转换为可点击的超链接文本。\n\n```php\n<?php\nfunction makeLinks($text) {\n\t$text = eregi_replace('(((f|ht){1}tp://)[-a-zA-Z0-9@:%_+.~#?&//=]+)','\\1', $text);\n\t$text = eregi_replace('([[:space:]()[{}])(www.[-a-zA-Z0-9@:%_+.~#?&//=]+)','\\1\\2',$text);\n\t$text = eregi_replace('([_.0-9a-z-]+@([0-9a-z][0-9a-z-]+.)+[a-z]{2,3})','\\1', $text);\n\treturn $text;\n}\n?>\n```\n","source":"_posts/15个PHP开发者常用的正则表达式及实例.md","raw":"---\ntitle: 15个PHP开发者常用的正则表达式及实例\ndate: 2016-07-29 15:17:42\ntags: 正则表达式\ncategories: PHP\n---\n\n> 从字符串中删除特定字符\n> 本段代码实现删除字符串中除所有大小写字母及数字以外的字符\n\n```php\n<?php\n$value = \"wWw.UncleToo.Com - 【UncleToo中文网】 - 12345\";\n$value = preg_replace(\"/[^A-Za-z0-9]/\",\"\",$value);\necho $value;\n//输出：wWwUncleTooComUncleToo12345\n?>\n```\n\n> 验证用户名\n> 以下代码验证用户名是否由字母、数字及下划线组成。\n\n```php\n<?php\n$username = \"uncletoo_COM123\";\nif (preg_match('/^[a-z\\d_]{5,20}$/i', $username)) {\n    echo \"用户名可用\";\n} else {\n    echo \"用户名存在特殊字符\";\n}\n?>\n```\n\n> 添加信息到图片alt属性\n> 使用下面函数，可以实现将文章标题添加到图片的alt属性中。\n\n```php\n<?php\nfunction add_alt_tags($content) {\n\tglobal $post;\n\tpreg_match_all('/<img (.*?)\\/ >/', $content, $images);\n\tif(!is_null($images)) {\n\t\tforeach($images[1] as $index => $value) {\n\t\t\tif(!preg_match('/alt=/', $value)) {\n\t\t\t\t$new_img = str_replace('<img', '<img alt=\"'.get_the_title().'\"', $images[0][$index]);\n\t\t\t\t$content = str_replace($images[0][$index], $new_img, $content);\n\t\t\t}\n\t\t}\n\t}\n\treturn $content;\n}\n?>\n```\n\n\n> 将EMail文本自动添加Mailto链接\n\n```php\n<?php\n$text = \"demo@abc.com\";\n$string = eregi_replace('([_\\.0-9a-z-]+@([0-9a-z][0-9a-z-]+\\.)+[a-z]{2,3})','<a href=\"mailto:\\\\1\">\\\\1</ a>', $text);\necho $string;\n?>\n```\n\n> 过滤限制级词语\n\n```php\n<?php\nfunction filtrado($texto, $reemplazo = false) {\n\t$filtradas = 'admin,uncletoo,中文网'; //这里定义需要过滤的词语\n\t$f = explode(',', $filtradas);\n\t$f = array_map('trim', $f);\n\t$filtro = implode('|', $f);\n\treturn ($reemplazo) ? preg_replace(\"#$filtro#i\", $reemplazo, $texto) : preg_match(\"#$filtro#i\", $texto) ;\n}\n?>\n```\n\n> 验证电话号码\n> 这是一个很常见的功能\n\n```php\n<?php\n$string = \"(010) 555-5555\";\nif (preg_match('/^\\(?[0-9]{3}\\)?|[0-9]{3}[-. ]? [0-9]{3}[-. ]?[0-9]{4}$/', $string)) {\n   echo \"successful.\";\n}\n?>\n```\n\n> 替换超链接href属性的内容\n> 在页面上查看源文件，显示为：&lt; a href=\"yes\" &gt;UncleToo中文网&lt; /a&gt;\n\n```php\n<?php\n$html = '<a href=\"http://www.uncletoo.com\">UncleToo中文网</a>';\n$replacement = \"yes\";\n$pattern = '/(?<=href\\=\")[^]]+?(?=\")/';\n$replacedHrefHtml = preg_replace($pattern, $replacement, $html);\necho $replacedHrefHtml ;\n?>\n```\n\n> 验证邮箱正则表达式\n> 此功能在用户注册是经常使用\n\n```php\n<?php\n$regex = \"([a-z0-9_.-]+)\". # name\n\"@\". # at\n\"([a-z0-9.-]+){2,255}\". # domain & possibly subdomains\n\".\". # period\n\"([a-z]+){2,10}\"; # domain extension\n$eregi = eregi_replace($regex, '', $email);\n$valid_email = empty($eregi) ? true : false;\n?>\n```\n\n> IP地址验证\n \n```php\n<?php\n$string = \"255.255.255.255\";\nif (preg_match(\n'/^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:[.](?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$/', $string)) {\n\techo \"IP address is good.\";\n}\n?>\n```\n\n> 邮政编码验证\n\n```php\n<?php\n$string = \"12345-1234\";\nif (preg_match('/^[0-9]{5}([- ]?[0-9]{4})?$/', $string)) {\n\techo \"zip code checks out\";\n}\n?>\n```\n\n> 高亮显示文本\n\n```php\n<?php\n$text = \"UncleToo（www.uncletoo.com）中文网\";\n$text = preg_replace(\"/\\b(www)\\b/i\", '<span style=\"background:#5fc9f6\">\\1</ span>',$text);\necho $text;\n?>\n```\n\n> 从特定的URL中提取域名\n\n```php\n<?php\n$url = \"http://www.uncletoo.com/plug/tags/?tag=PHP\";\npreg_match('@^(?:http://)?([^/]+)@i', $url, $matches);\n$host = $matches[1];\necho $host;\n//输出：www.uncletoo.com\n?>\n```\n\n> 验证域名格式是否正确\n\n```php\n<?php\n$url = \"http://www.uncletoo.com/\";\nif (preg_match('/^(http|https|ftp):\\/\\/([A-Z0-9][A-Z0-9_-]*(?:\\.[A-Z0-9][A-Z0-9_-]*)+):?(\\d+)?\\/?/i', $url)) {\n    echo \"域名格式正确.\";\n} else {\n    echo \"域名格式错误.\";\n}\n?>\n```\n\n> 使用文章标题生成URL\n\n```php\n<?php\nfunction create_slug($string){\n   $slug=preg_replace('/[^A-Za-z0-9-]+/', '-', $string);\n   return $slug;\n}\necho create_slug('my name is uncletoo');\n//输出：my-name-is-uncletoo\n?>\n```\n\n> 添加http://到URL地址\n> 当我们需要用户填写网址时，很多用户往往不填写http://直接输入域名，使用下面代码可将http://添加到网址的前面。\n\n```php\n<?php\nif (!preg_match(\"/^(http|https|ftp):/\", $_POST['url'])) {\n   $_POST['url'] = 'http://'.$_POST['url'];\n}\n?>\n```\n\n> 将URL转换为超链接\n> 这时一个很有用的功能，他可以将url地址或email地址转换为可点击的超链接文本。\n\n```php\n<?php\nfunction makeLinks($text) {\n\t$text = eregi_replace('(((f|ht){1}tp://)[-a-zA-Z0-9@:%_+.~#?&//=]+)','\\1', $text);\n\t$text = eregi_replace('([[:space:]()[{}])(www.[-a-zA-Z0-9@:%_+.~#?&//=]+)','\\1\\2',$text);\n\t$text = eregi_replace('([_.0-9a-z-]+@([0-9a-z][0-9a-z-]+.)+[a-z]{2,3})','\\1', $text);\n\treturn $text;\n}\n?>\n```\n","slug":"15个PHP开发者常用的正则表达式及实例","published":1,"updated":"2016-07-31T04:05:27.363Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31000020oqmqjp9r1tz","content":"<blockquote>\n<p>从字符串中删除特定字符<br>本段代码实现删除字符串中除所有大小写字母及数字以外的字符</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$value = <span class=\"string\">\"wWw.UncleToo.Com - 【UncleToo中文网】 - 12345\"</span>;</div><div class=\"line\">$value = preg_replace(<span class=\"string\">\"/[^A-Za-z0-9]/\"</span>,<span class=\"string\">\"\"</span>,$value);</div><div class=\"line\"><span class=\"keyword\">echo</span> $value;</div><div class=\"line\"><span class=\"comment\">//输出：wWwUncleTooComUncleToo12345</span></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>验证用户名<br>以下代码验证用户名是否由字母、数字及下划线组成。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$username = <span class=\"string\">\"uncletoo_COM123\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/^[a-z\\d_]&#123;5,20&#125;$/i'</span>, $username)) &#123;</div><div class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"用户名可用\"</span>;</div><div class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"用户名存在特殊字符\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>添加信息到图片alt属性<br>使用下面函数，可以实现将文章标题添加到图片的alt属性中。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add_alt_tags</span><span class=\"params\">($content)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">global</span> $post;</div><div class=\"line\">\tpreg_match_all(<span class=\"string\">'/&lt;img (.*?)\\/ &gt;/'</span>, $content, $images);</div><div class=\"line\">\t<span class=\"keyword\">if</span>(!is_null($images)) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">foreach</span>($images[<span class=\"number\">1</span>] <span class=\"keyword\">as</span> $index =&gt; $value) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/alt=/'</span>, $value)) &#123;</div><div class=\"line\">\t\t\t\t$new_img = str_replace(<span class=\"string\">'&lt;img'</span>, <span class=\"string\">'&lt;img alt=\"'</span>.get_the_title().<span class=\"string\">'\"'</span>, $images[<span class=\"number\">0</span>][$index]);</div><div class=\"line\">\t\t\t\t$content = str_replace($images[<span class=\"number\">0</span>][$index], $new_img, $content);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> $content;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>将EMail文本自动添加Mailto链接</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$text = <span class=\"string\">\"demo@abc.com\"</span>;</div><div class=\"line\">$string = eregi_replace(<span class=\"string\">'([_\\.0-9a-z-]+@([0-9a-z][0-9a-z-]+\\.)+[a-z]&#123;2,3&#125;)'</span>,<span class=\"string\">'&lt;a href=\"mailto:\\\\1\"&gt;\\\\1&lt;/ a&gt;'</span>, $text);</div><div class=\"line\"><span class=\"keyword\">echo</span> $string;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>过滤限制级词语</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filtrado</span><span class=\"params\">($texto, $reemplazo = false)</span> </span>&#123;</div><div class=\"line\">\t$filtradas = <span class=\"string\">'admin,uncletoo,中文网'</span>; <span class=\"comment\">//这里定义需要过滤的词语</span></div><div class=\"line\">\t$f = explode(<span class=\"string\">','</span>, $filtradas);</div><div class=\"line\">\t$f = array_map(<span class=\"string\">'trim'</span>, $f);</div><div class=\"line\">\t$filtro = implode(<span class=\"string\">'|'</span>, $f);</div><div class=\"line\">\t<span class=\"keyword\">return</span> ($reemplazo) ? preg_replace(<span class=\"string\">\"#$filtro#i\"</span>, $reemplazo, $texto) : preg_match(<span class=\"string\">\"#$filtro#i\"</span>, $texto) ;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>验证电话号码<br>这是一个很常见的功能</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$string = <span class=\"string\">\"(010) 555-5555\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/^\\(?[0-9]&#123;3&#125;\\)?|[0-9]&#123;3&#125;[-. ]? [0-9]&#123;3&#125;[-. ]?[0-9]&#123;4&#125;$/'</span>, $string)) &#123;</div><div class=\"line\">   <span class=\"keyword\">echo</span> <span class=\"string\">\"successful.\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>替换超链接href属性的内容<br>在页面上查看源文件，显示为：&lt; a href=”yes” &gt;UncleToo中文网&lt; /a&gt;</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$html = <span class=\"string\">'&lt;a href=\"http://www.uncletoo.com\"&gt;UncleToo中文网&lt;/a&gt;'</span>;</div><div class=\"line\">$replacement = <span class=\"string\">\"yes\"</span>;</div><div class=\"line\">$pattern = <span class=\"string\">'/(?&lt;=href\\=\")[^]]+?(?=\")/'</span>;</div><div class=\"line\">$replacedHrefHtml = preg_replace($pattern, $replacement, $html);</div><div class=\"line\"><span class=\"keyword\">echo</span> $replacedHrefHtml ;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>验证邮箱正则表达式<br>此功能在用户注册是经常使用</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$regex = <span class=\"string\">\"([a-z0-9_.-]+)\"</span>. <span class=\"comment\"># name</span></div><div class=\"line\"><span class=\"string\">\"@\"</span>. <span class=\"comment\"># at</span></div><div class=\"line\"><span class=\"string\">\"([a-z0-9.-]+)&#123;2,255&#125;\"</span>. <span class=\"comment\"># domain &amp; possibly subdomains</span></div><div class=\"line\"><span class=\"string\">\".\"</span>. <span class=\"comment\"># period</span></div><div class=\"line\"><span class=\"string\">\"([a-z]+)&#123;2,10&#125;\"</span>; <span class=\"comment\"># domain extension</span></div><div class=\"line\">$eregi = eregi_replace($regex, <span class=\"string\">''</span>, $email);</div><div class=\"line\">$valid_email = <span class=\"keyword\">empty</span>($eregi) ? <span class=\"keyword\">true</span> : <span class=\"keyword\">false</span>;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>IP地址验证</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$string = <span class=\"string\">\"255.255.255.255\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(</div><div class=\"line\"><span class=\"string\">'/^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:[.](?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d))&#123;3&#125;$/'</span>, $string)) &#123;</div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">\"IP address is good.\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>邮政编码验证</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$string = <span class=\"string\">\"12345-1234\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/^[0-9]&#123;5&#125;([- ]?[0-9]&#123;4&#125;)?$/'</span>, $string)) &#123;</div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">\"zip code checks out\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>高亮显示文本</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$text = <span class=\"string\">\"UncleToo（www.uncletoo.com）中文网\"</span>;</div><div class=\"line\">$text = preg_replace(<span class=\"string\">\"/\\b(www)\\b/i\"</span>, <span class=\"string\">'&lt;span style=\"background:#5fc9f6\"&gt;\\1&lt;/ span&gt;'</span>,$text);</div><div class=\"line\"><span class=\"keyword\">echo</span> $text;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>从特定的URL中提取域名</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$url = <span class=\"string\">\"http://www.uncletoo.com/plug/tags/?tag=PHP\"</span>;</div><div class=\"line\">preg_match(<span class=\"string\">'@^(?:http://)?([^/]+)@i'</span>, $url, $matches);</div><div class=\"line\">$host = $matches[<span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">echo</span> $host;</div><div class=\"line\"><span class=\"comment\">//输出：www.uncletoo.com</span></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>验证域名格式是否正确</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$url = <span class=\"string\">\"http://www.uncletoo.com/\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/^(http|https|ftp):\\/\\/([A-Z0-9][A-Z0-9_-]*(?:\\.[A-Z0-9][A-Z0-9_-]*)+):?(\\d+)?\\/?/i'</span>, $url)) &#123;</div><div class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"域名格式正确.\"</span>;</div><div class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"域名格式错误.\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>使用文章标题生成URL</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create_slug</span><span class=\"params\">($string)</span></span>&#123;</div><div class=\"line\">   $slug=preg_replace(<span class=\"string\">'/[^A-Za-z0-9-]+/'</span>, <span class=\"string\">'-'</span>, $string);</div><div class=\"line\">   <span class=\"keyword\">return</span> $slug;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">echo</span> create_slug(<span class=\"string\">'my name is uncletoo'</span>);</div><div class=\"line\"><span class=\"comment\">//输出：my-name-is-uncletoo</span></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>添加<a href=\"http://到URL地址\" target=\"_blank\" rel=\"external\">http://到URL地址</a><br>当我们需要用户填写网址时，很多用户往往不填写<a href=\"http://直接输入域名，使用下面代码可将http://添加到网址的前面。\" target=\"_blank\" rel=\"external\">http://直接输入域名，使用下面代码可将http://添加到网址的前面。</a></p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"keyword\">if</span> (!preg_match(<span class=\"string\">\"/^(http|https|ftp):/\"</span>, $_POST[<span class=\"string\">'url'</span>])) &#123;</div><div class=\"line\">   $_POST[<span class=\"string\">'url'</span>] = <span class=\"string\">'http://'</span>.$_POST[<span class=\"string\">'url'</span>];</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>将URL转换为超链接<br>这时一个很有用的功能，他可以将url地址或email地址转换为可点击的超链接文本。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeLinks</span><span class=\"params\">($text)</span> </span>&#123;</div><div class=\"line\">\t$text = eregi_replace(<span class=\"string\">'(((f|ht)&#123;1&#125;tp://)[-a-zA-Z0-9@:%_+.~#?&amp;//=]+)'</span>,<span class=\"string\">'\\1'</span>, $text);</div><div class=\"line\">\t$text = eregi_replace(<span class=\"string\">'([[:space:]()[&#123;&#125;])(www.[-a-zA-Z0-9@:%_+.~#?&amp;//=]+)'</span>,<span class=\"string\">'\\1\\2'</span>,$text);</div><div class=\"line\">\t$text = eregi_replace(<span class=\"string\">'([_.0-9a-z-]+@([0-9a-z][0-9a-z-]+.)+[a-z]&#123;2,3&#125;)'</span>,<span class=\"string\">'\\1'</span>, $text);</div><div class=\"line\">\t<span class=\"keyword\">return</span> $text;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n","excerpt":"","more":"<blockquote>\n<p>从字符串中删除特定字符<br>本段代码实现删除字符串中除所有大小写字母及数字以外的字符</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$value = <span class=\"string\">\"wWw.UncleToo.Com - 【UncleToo中文网】 - 12345\"</span>;</div><div class=\"line\">$value = preg_replace(<span class=\"string\">\"/[^A-Za-z0-9]/\"</span>,<span class=\"string\">\"\"</span>,$value);</div><div class=\"line\"><span class=\"keyword\">echo</span> $value;</div><div class=\"line\"><span class=\"comment\">//输出：wWwUncleTooComUncleToo12345</span></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>验证用户名<br>以下代码验证用户名是否由字母、数字及下划线组成。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$username = <span class=\"string\">\"uncletoo_COM123\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/^[a-z\\d_]&#123;5,20&#125;$/i'</span>, $username)) &#123;</div><div class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"用户名可用\"</span>;</div><div class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"用户名存在特殊字符\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>添加信息到图片alt属性<br>使用下面函数，可以实现将文章标题添加到图片的alt属性中。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add_alt_tags</span><span class=\"params\">($content)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">global</span> $post;</div><div class=\"line\">\tpreg_match_all(<span class=\"string\">'/&lt;img (.*?)\\/ &gt;/'</span>, $content, $images);</div><div class=\"line\">\t<span class=\"keyword\">if</span>(!is_null($images)) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">foreach</span>($images[<span class=\"number\">1</span>] <span class=\"keyword\">as</span> $index =&gt; $value) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">if</span>(!preg_match(<span class=\"string\">'/alt=/'</span>, $value)) &#123;</div><div class=\"line\">\t\t\t\t$new_img = str_replace(<span class=\"string\">'&lt;img'</span>, <span class=\"string\">'&lt;img alt=\"'</span>.get_the_title().<span class=\"string\">'\"'</span>, $images[<span class=\"number\">0</span>][$index]);</div><div class=\"line\">\t\t\t\t$content = str_replace($images[<span class=\"number\">0</span>][$index], $new_img, $content);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> $content;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>将EMail文本自动添加Mailto链接</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$text = <span class=\"string\">\"demo@abc.com\"</span>;</div><div class=\"line\">$string = eregi_replace(<span class=\"string\">'([_\\.0-9a-z-]+@([0-9a-z][0-9a-z-]+\\.)+[a-z]&#123;2,3&#125;)'</span>,<span class=\"string\">'&lt;a href=\"mailto:\\\\1\"&gt;\\\\1&lt;/ a&gt;'</span>, $text);</div><div class=\"line\"><span class=\"keyword\">echo</span> $string;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>过滤限制级词语</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filtrado</span><span class=\"params\">($texto, $reemplazo = false)</span> </span>&#123;</div><div class=\"line\">\t$filtradas = <span class=\"string\">'admin,uncletoo,中文网'</span>; <span class=\"comment\">//这里定义需要过滤的词语</span></div><div class=\"line\">\t$f = explode(<span class=\"string\">','</span>, $filtradas);</div><div class=\"line\">\t$f = array_map(<span class=\"string\">'trim'</span>, $f);</div><div class=\"line\">\t$filtro = implode(<span class=\"string\">'|'</span>, $f);</div><div class=\"line\">\t<span class=\"keyword\">return</span> ($reemplazo) ? preg_replace(<span class=\"string\">\"#$filtro#i\"</span>, $reemplazo, $texto) : preg_match(<span class=\"string\">\"#$filtro#i\"</span>, $texto) ;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>验证电话号码<br>这是一个很常见的功能</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$string = <span class=\"string\">\"(010) 555-5555\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/^\\(?[0-9]&#123;3&#125;\\)?|[0-9]&#123;3&#125;[-. ]? [0-9]&#123;3&#125;[-. ]?[0-9]&#123;4&#125;$/'</span>, $string)) &#123;</div><div class=\"line\">   <span class=\"keyword\">echo</span> <span class=\"string\">\"successful.\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>替换超链接href属性的内容<br>在页面上查看源文件，显示为：&lt; a href=”yes” &gt;UncleToo中文网&lt; /a&gt;</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$html = <span class=\"string\">'&lt;a href=\"http://www.uncletoo.com\"&gt;UncleToo中文网&lt;/a&gt;'</span>;</div><div class=\"line\">$replacement = <span class=\"string\">\"yes\"</span>;</div><div class=\"line\">$pattern = <span class=\"string\">'/(?&lt;=href\\=\")[^]]+?(?=\")/'</span>;</div><div class=\"line\">$replacedHrefHtml = preg_replace($pattern, $replacement, $html);</div><div class=\"line\"><span class=\"keyword\">echo</span> $replacedHrefHtml ;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>验证邮箱正则表达式<br>此功能在用户注册是经常使用</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$regex = <span class=\"string\">\"([a-z0-9_.-]+)\"</span>. <span class=\"comment\"># name</span></div><div class=\"line\"><span class=\"string\">\"@\"</span>. <span class=\"comment\"># at</span></div><div class=\"line\"><span class=\"string\">\"([a-z0-9.-]+)&#123;2,255&#125;\"</span>. <span class=\"comment\"># domain &amp; possibly subdomains</span></div><div class=\"line\"><span class=\"string\">\".\"</span>. <span class=\"comment\"># period</span></div><div class=\"line\"><span class=\"string\">\"([a-z]+)&#123;2,10&#125;\"</span>; <span class=\"comment\"># domain extension</span></div><div class=\"line\">$eregi = eregi_replace($regex, <span class=\"string\">''</span>, $email);</div><div class=\"line\">$valid_email = <span class=\"keyword\">empty</span>($eregi) ? <span class=\"keyword\">true</span> : <span class=\"keyword\">false</span>;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>IP地址验证</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$string = <span class=\"string\">\"255.255.255.255\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(</div><div class=\"line\"><span class=\"string\">'/^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:[.](?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d))&#123;3&#125;$/'</span>, $string)) &#123;</div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">\"IP address is good.\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>邮政编码验证</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$string = <span class=\"string\">\"12345-1234\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/^[0-9]&#123;5&#125;([- ]?[0-9]&#123;4&#125;)?$/'</span>, $string)) &#123;</div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">\"zip code checks out\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>高亮显示文本</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$text = <span class=\"string\">\"UncleToo（www.uncletoo.com）中文网\"</span>;</div><div class=\"line\">$text = preg_replace(<span class=\"string\">\"/\\b(www)\\b/i\"</span>, <span class=\"string\">'&lt;span style=\"background:#5fc9f6\"&gt;\\1&lt;/ span&gt;'</span>,$text);</div><div class=\"line\"><span class=\"keyword\">echo</span> $text;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>从特定的URL中提取域名</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$url = <span class=\"string\">\"http://www.uncletoo.com/plug/tags/?tag=PHP\"</span>;</div><div class=\"line\">preg_match(<span class=\"string\">'@^(?:http://)?([^/]+)@i'</span>, $url, $matches);</div><div class=\"line\">$host = $matches[<span class=\"number\">1</span>];</div><div class=\"line\"><span class=\"keyword\">echo</span> $host;</div><div class=\"line\"><span class=\"comment\">//输出：www.uncletoo.com</span></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>验证域名格式是否正确</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">$url = <span class=\"string\">\"http://www.uncletoo.com/\"</span>;</div><div class=\"line\"><span class=\"keyword\">if</span> (preg_match(<span class=\"string\">'/^(http|https|ftp):\\/\\/([A-Z0-9][A-Z0-9_-]*(?:\\.[A-Z0-9][A-Z0-9_-]*)+):?(\\d+)?\\/?/i'</span>, $url)) &#123;</div><div class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"域名格式正确.\"</span>;</div><div class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"域名格式错误.\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>使用文章标题生成URL</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create_slug</span><span class=\"params\">($string)</span></span>&#123;</div><div class=\"line\">   $slug=preg_replace(<span class=\"string\">'/[^A-Za-z0-9-]+/'</span>, <span class=\"string\">'-'</span>, $string);</div><div class=\"line\">   <span class=\"keyword\">return</span> $slug;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">echo</span> create_slug(<span class=\"string\">'my name is uncletoo'</span>);</div><div class=\"line\"><span class=\"comment\">//输出：my-name-is-uncletoo</span></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>添加<a href=\"http://到URL地址\">http://到URL地址</a><br>当我们需要用户填写网址时，很多用户往往不填写<a href=\"http://直接输入域名，使用下面代码可将http://添加到网址的前面。\">http://直接输入域名，使用下面代码可将http://添加到网址的前面。</a></p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"keyword\">if</span> (!preg_match(<span class=\"string\">\"/^(http|https|ftp):/\"</span>, $_POST[<span class=\"string\">'url'</span>])) &#123;</div><div class=\"line\">   $_POST[<span class=\"string\">'url'</span>] = <span class=\"string\">'http://'</span>.$_POST[<span class=\"string\">'url'</span>];</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<blockquote>\n<p>将URL转换为超链接<br>这时一个很有用的功能，他可以将url地址或email地址转换为可点击的超链接文本。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeLinks</span><span class=\"params\">($text)</span> </span>&#123;</div><div class=\"line\">\t$text = eregi_replace(<span class=\"string\">'(((f|ht)&#123;1&#125;tp://)[-a-zA-Z0-9@:%_+.~#?&amp;//=]+)'</span>,<span class=\"string\">'\\1'</span>, $text);</div><div class=\"line\">\t$text = eregi_replace(<span class=\"string\">'([[:space:]()[&#123;&#125;])(www.[-a-zA-Z0-9@:%_+.~#?&amp;//=]+)'</span>,<span class=\"string\">'\\1\\2'</span>,$text);</div><div class=\"line\">\t$text = eregi_replace(<span class=\"string\">'([_.0-9a-z-]+@([0-9a-z][0-9a-z-]+.)+[a-z]&#123;2,3&#125;)'</span>,<span class=\"string\">'\\1'</span>, $text);</div><div class=\"line\">\t<span class=\"keyword\">return</span> $text;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n"},{"title":"Linux alias 永久生效","date":"2016-12-30T08:09:45.000Z","_content":"\n#### alias 是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间\n\n#### 比如设置 `alias db='mysql -uroot -proot'`,设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。\n\n#### alias永久生效\n\n#### 在`/home`用户目录下面有个隐藏文件*`.bashrc`*, 使用vim打开，然后在文档后面追加alias命令即可\n\n```bash\n$ vim /home/ubuntu/.bashrc\n\n##在结尾追加alias命令，如alias db = 'mysql -uroot -proot'\n\n$ source ~/.bashrc ##使alias生效\n\n```\n\n","source":"_posts/Linux-alias-永久生效.md","raw":"---\ntitle: Linux alias 永久生效\ndate: 2016-12-30 16:09:45\ntags:\ncategories: Linux\n---\n\n#### alias 是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间\n\n#### 比如设置 `alias db='mysql -uroot -proot'`,设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。\n\n#### alias永久生效\n\n#### 在`/home`用户目录下面有个隐藏文件*`.bashrc`*, 使用vim打开，然后在文档后面追加alias命令即可\n\n```bash\n$ vim /home/ubuntu/.bashrc\n\n##在结尾追加alias命令，如alias db = 'mysql -uroot -proot'\n\n$ source ~/.bashrc ##使alias生效\n\n```\n\n","slug":"Linux-alias-永久生效","published":1,"updated":"2016-12-30T08:18:13.167Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31800060oqmaul2w1vl","content":"<h4 id=\"alias-是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间\"><a href=\"#alias-是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间\" class=\"headerlink\" title=\"alias 是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间\"></a>alias 是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间</h4><h4 id=\"比如设置-alias-db-39-mysql-uroot-proot-39-设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。\"><a href=\"#比如设置-alias-db-39-mysql-uroot-proot-39-设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。\" class=\"headerlink\" title=\"比如设置 alias db=&#39;mysql -uroot -proot&#39;,设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。\"></a>比如设置 <code>alias db=&#39;mysql -uroot -proot&#39;</code>,设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。</h4><h4 id=\"alias永久生效\"><a href=\"#alias永久生效\" class=\"headerlink\" title=\"alias永久生效\"></a>alias永久生效</h4><h4 id=\"在-home用户目录下面有个隐藏文件-bashrc-使用vim打开，然后在文档后面追加alias命令即可\"><a href=\"#在-home用户目录下面有个隐藏文件-bashrc-使用vim打开，然后在文档后面追加alias命令即可\" class=\"headerlink\" title=\"在/home用户目录下面有个隐藏文件.bashrc, 使用vim打开，然后在文档后面追加alias命令即可\"></a>在<code>/home</code>用户目录下面有个隐藏文件<em><code>.bashrc</code></em>, 使用vim打开，然后在文档后面追加alias命令即可</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ vim /home/ubuntu/.bashrc</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">##在结尾追加alias命令，如alias db = 'mysql -uroot -proot'</span></div><div class=\"line\"></div><div class=\"line\">$ <span class=\"built_in\">source</span> ~/.bashrc <span class=\"comment\">##使alias生效</span></div></pre></td></tr></table></figure>\n","excerpt":"","more":"<h4 id=\"alias-是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间\"><a href=\"#alias-是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间\" class=\"headerlink\" title=\"alias 是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间\"></a>alias 是用来设置命令别名的，使用这个命令，可以极大的节省我们的时间</h4><h4 id=\"比如设置-alias-db-39-mysql-uroot-proot-39-设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。\"><a href=\"#比如设置-alias-db-39-mysql-uroot-proot-39-设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。\" class=\"headerlink\" title=\"比如设置 alias db=&#39;mysql -uroot -proot&#39;,设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。\"></a>比如设置 <code>alias db=&#39;mysql -uroot -proot&#39;</code>,设置之后，可以直接使用db命令登录mysql了，但是当关闭控制台的时候，alias就会失效。</h4><h4 id=\"alias永久生效\"><a href=\"#alias永久生效\" class=\"headerlink\" title=\"alias永久生效\"></a>alias永久生效</h4><h4 id=\"在-home用户目录下面有个隐藏文件-bashrc-使用vim打开，然后在文档后面追加alias命令即可\"><a href=\"#在-home用户目录下面有个隐藏文件-bashrc-使用vim打开，然后在文档后面追加alias命令即可\" class=\"headerlink\" title=\"在/home用户目录下面有个隐藏文件.bashrc, 使用vim打开，然后在文档后面追加alias命令即可\"></a>在<code>/home</code>用户目录下面有个隐藏文件<em><code>.bashrc</code></em>, 使用vim打开，然后在文档后面追加alias命令即可</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ vim /home/ubuntu/.bashrc</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">##在结尾追加alias命令，如alias db = 'mysql -uroot -proot'</span></div><div class=\"line\"></div><div class=\"line\">$ <span class=\"built_in\">source</span> ~/.bashrc <span class=\"comment\">##使alias生效</span></div></pre></td></tr></table></figure>\n"},{"title":"Git 分支（branch）的使用整理","date":"2016-07-31T08:18:37.000Z","_content":"\n> 平时git branch用的比较少，大多数用的git add/commit/pull/push用的比较多，不过也特意找了一些资料\n> 完整资料请点击[这里](http://blog.jobbole.com/78960/)或者[这里](http://www.open-open.com/lib/view/open1328069889514.html)\n\n> 每次提交版本的时候，git会形成一个时间线，上面会有各种操作，git管这个“时间线”叫做分支，也就是我们常见的master，我们也可以根据需要创建各种分支，但是git只是识别master分支，所以每次创建分支后，需要合并才行。\n\n#### 1）我们在github创建一个test的项目，创建过程自行操作\n\n![Alt text](/img/1469950279275.png)\n\n#### 2）我们把项目``git clone``到本地\n\n```bash\n $ git clone https://github.com/tyl569/test.git ./\n Cloning into '.'...\n warning: You appear to have cloned an empty repository.\n Checking connectivity... done.\n```\n\n#### 3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test.txt，然后在里面写句：hello ,world.  当做项目好了。\n\n```tex\nhello ,world.\n```\n\n#### 4）ok，接下来就是套路操作了。\n\n```bash\n$ git status\nOn branch master\n\nInitial commit\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\n        test.txt\n\nnothing added to commit but untracked files present (use \"git add\" to track)\n\n$ git add .\n$ git commit -m 初次提交项目\n[master (root-commit) 97b26e5] 初次提交项目\n 1 file changed, 1 insertion(+)\n create mode 100644 test.txt\n\n$ git push\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nUsername for 'https://github.com': tyl569\nPassword for 'https://tyl569@github.com':\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nCounting objects: 3, done.\nWriting objects: 100% (3/3), 240 bytes | 0 bytes/s, done.\nTotal 3 (delta 0), reused 0 (delta 0)\nTo https://github.com/tyl569/test.git\n * [new branch]      master -> master\n```\n\n#### 5）可以从``git push``结果看到，这是一个新的分支。\n\n#### 6）创建一个新的分支，并且切换到新的分支上面。\n\n```bash\n$ git branch new\n$ git checkout new\nSwitched to branch 'new'\n## 提示已经切换到new分支\n```\n\n#### 7）此时在本地项目做一些改动，然后提交到github上面。\n\n```bash\n# git add/commit等操作省略\n$ git push\nfatal: The current branch new has no upstream branch.\nTo push the current branch and set the remote as upstream, use\n\n    git push --set-upstream origin new\n```\n\n####  在``git push``的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。\n\n```bash\n$ git push --set-upstream origin new\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nUsername for 'https://github.com': tyl569\nPassword for 'https://tyl569@github.com':\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nCounting objects: 3, done.\nWriting objects: 100% (3/3), 283 bytes | 0 bytes/s, done.\nTotal 3 (delta 0), reused 0 (delta 0)\nTo https://github.com/tyl569/test.git\n * [new branch]      new -> new\nBranch new set up to track remote branch new from origin.\n```\n\n#### 8）查看github，会看到合并分支的请求\n![Alt text](/img/1469951539710.png)\n\n#### 查看一下test.txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户``pull``或者``clone``的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。\n\n![Alt text](/img/1469951597308.png)\n![Alt text](/img/1469951611981.png)\n\n#### 9）如果功能在new分支上面开发完之后，合并分支。\n\n```bash\n$  git checkout master\n$ git merge new\nUpdating 97b26e5..96d3fe8\nFast-forward\n test.txt | 5 ++++-\n 1 file changed, 4 insertions(+), 1 deletion(-)\n```\n\n#### 10）这个时候，就会把new分支的改动，合并到master分支了，然后``push``\n\n```bash\ngit push\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nUsername for 'https://github.com': tyl569\nPassword for 'https://tyl569@github.com':\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nTotal 0 (delta 0), reused 0 (delta 0)\nTo https://github.com/tyl569/test.git\n   97b26e5..96d3fe8  master -> master\n```\n\n![Alt text](/img/1469952187908.png)\n![Alt text](/img/1469952201409.png)\n\n-------\n\n### 分支合并的作用：\n\n> * 可以独立开发某个功能或者模块\n> * 如果功能没有搞完，也可以``push``，对项目没有影响\n\n\n","source":"_posts/Git-分支（branch）的使用整理.md","raw":"---\ntitle: Git 分支（branch）的使用整理\ndate: 2016-07-31 16:18:37\ntags: git branch\ncategories: Git\n---\n\n> 平时git branch用的比较少，大多数用的git add/commit/pull/push用的比较多，不过也特意找了一些资料\n> 完整资料请点击[这里](http://blog.jobbole.com/78960/)或者[这里](http://www.open-open.com/lib/view/open1328069889514.html)\n\n> 每次提交版本的时候，git会形成一个时间线，上面会有各种操作，git管这个“时间线”叫做分支，也就是我们常见的master，我们也可以根据需要创建各种分支，但是git只是识别master分支，所以每次创建分支后，需要合并才行。\n\n#### 1）我们在github创建一个test的项目，创建过程自行操作\n\n![Alt text](/img/1469950279275.png)\n\n#### 2）我们把项目``git clone``到本地\n\n```bash\n $ git clone https://github.com/tyl569/test.git ./\n Cloning into '.'...\n warning: You appear to have cloned an empty repository.\n Checking connectivity... done.\n```\n\n#### 3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test.txt，然后在里面写句：hello ,world.  当做项目好了。\n\n```tex\nhello ,world.\n```\n\n#### 4）ok，接下来就是套路操作了。\n\n```bash\n$ git status\nOn branch master\n\nInitial commit\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\n        test.txt\n\nnothing added to commit but untracked files present (use \"git add\" to track)\n\n$ git add .\n$ git commit -m 初次提交项目\n[master (root-commit) 97b26e5] 初次提交项目\n 1 file changed, 1 insertion(+)\n create mode 100644 test.txt\n\n$ git push\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nUsername for 'https://github.com': tyl569\nPassword for 'https://tyl569@github.com':\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nCounting objects: 3, done.\nWriting objects: 100% (3/3), 240 bytes | 0 bytes/s, done.\nTotal 3 (delta 0), reused 0 (delta 0)\nTo https://github.com/tyl569/test.git\n * [new branch]      master -> master\n```\n\n#### 5）可以从``git push``结果看到，这是一个新的分支。\n\n#### 6）创建一个新的分支，并且切换到新的分支上面。\n\n```bash\n$ git branch new\n$ git checkout new\nSwitched to branch 'new'\n## 提示已经切换到new分支\n```\n\n#### 7）此时在本地项目做一些改动，然后提交到github上面。\n\n```bash\n# git add/commit等操作省略\n$ git push\nfatal: The current branch new has no upstream branch.\nTo push the current branch and set the remote as upstream, use\n\n    git push --set-upstream origin new\n```\n\n####  在``git push``的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。\n\n```bash\n$ git push --set-upstream origin new\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nUsername for 'https://github.com': tyl569\nPassword for 'https://tyl569@github.com':\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nCounting objects: 3, done.\nWriting objects: 100% (3/3), 283 bytes | 0 bytes/s, done.\nTotal 3 (delta 0), reused 0 (delta 0)\nTo https://github.com/tyl569/test.git\n * [new branch]      new -> new\nBranch new set up to track remote branch new from origin.\n```\n\n#### 8）查看github，会看到合并分支的请求\n![Alt text](/img/1469951539710.png)\n\n#### 查看一下test.txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户``pull``或者``clone``的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。\n\n![Alt text](/img/1469951597308.png)\n![Alt text](/img/1469951611981.png)\n\n#### 9）如果功能在new分支上面开发完之后，合并分支。\n\n```bash\n$  git checkout master\n$ git merge new\nUpdating 97b26e5..96d3fe8\nFast-forward\n test.txt | 5 ++++-\n 1 file changed, 4 insertions(+), 1 deletion(-)\n```\n\n#### 10）这个时候，就会把new分支的改动，合并到master分支了，然后``push``\n\n```bash\ngit push\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nUsername for 'https://github.com': tyl569\nPassword for 'https://tyl569@github.com':\ngit: 'credential-osxkeychain' is not a git command. See 'git --help'.\nTotal 0 (delta 0), reused 0 (delta 0)\nTo https://github.com/tyl569/test.git\n   97b26e5..96d3fe8  master -> master\n```\n\n![Alt text](/img/1469952187908.png)\n![Alt text](/img/1469952201409.png)\n\n-------\n\n### 分支合并的作用：\n\n> * 可以独立开发某个功能或者模块\n> * 如果功能没有搞完，也可以``push``，对项目没有影响\n\n\n","slug":"Git-分支（branch）的使用整理","published":1,"updated":"2016-08-16T08:55:49.911Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31b00080oqmjqr6yatz","content":"<blockquote>\n<p>平时git branch用的比较少，大多数用的git add/commit/pull/push用的比较多，不过也特意找了一些资料<br>完整资料请点击<a href=\"http://blog.jobbole.com/78960/\" target=\"_blank\" rel=\"external\">这里</a>或者<a href=\"http://www.open-open.com/lib/view/open1328069889514.html\" target=\"_blank\" rel=\"external\">这里</a></p>\n<p>每次提交版本的时候，git会形成一个时间线，上面会有各种操作，git管这个“时间线”叫做分支，也就是我们常见的master，我们也可以根据需要创建各种分支，但是git只是识别master分支，所以每次创建分支后，需要合并才行。</p>\n</blockquote>\n<h4 id=\"1）我们在github创建一个test的项目，创建过程自行操作\"><a href=\"#1）我们在github创建一个test的项目，创建过程自行操作\" class=\"headerlink\" title=\"1）我们在github创建一个test的项目，创建过程自行操作\"></a>1）我们在github创建一个test的项目，创建过程自行操作</h4><p><img src=\"/img/1469950279275.png\" alt=\"Alt text\"></p>\n<h4 id=\"2）我们把项目git-clone到本地\"><a href=\"#2）我们把项目git-clone到本地\" class=\"headerlink\" title=\"2）我们把项目git clone到本地\"></a>2）我们把项目<code>git clone</code>到本地</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/tyl569/test.git ./</div><div class=\"line\">Cloning into <span class=\"string\">'.'</span>...</div><div class=\"line\">warning: You appear to have cloned an empty repository.</div><div class=\"line\">Checking connectivity... done.</div></pre></td></tr></table></figure>\n<h4 id=\"3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test-txt，然后在里面写句：hello-world-当做项目好了。\"><a href=\"#3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test-txt，然后在里面写句：hello-world-当做项目好了。\" class=\"headerlink\" title=\"3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test.txt，然后在里面写句：hello ,world.  当做项目好了。\"></a>3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test.txt，然后在里面写句：hello ,world.  当做项目好了。</h4><figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><div class=\"line\">hello ,world.</div></pre></td></tr></table></figure>\n<h4 id=\"4）ok，接下来就是套路操作了。\"><a href=\"#4）ok，接下来就是套路操作了。\" class=\"headerlink\" title=\"4）ok，接下来就是套路操作了。\"></a>4）ok，接下来就是套路操作了。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git status</div><div class=\"line\">On branch master</div><div class=\"line\"></div><div class=\"line\">Initial commit</div><div class=\"line\"></div><div class=\"line\">Untracked files:</div><div class=\"line\">  (use <span class=\"string\">\"git add &lt;file&gt;...\"</span> to include <span class=\"keyword\">in</span> what will be committed)</div><div class=\"line\"></div><div class=\"line\">        test.txt</div><div class=\"line\"></div><div class=\"line\">nothing added to commit but untracked files present (use <span class=\"string\">\"git add\"</span> to track)</div><div class=\"line\"></div><div class=\"line\">$ git add .</div><div class=\"line\">$ git commit -m 初次提交项目</div><div class=\"line\">[master (root-commit) 97b26e5] 初次提交项目</div><div class=\"line\"> 1 file changed, 1 insertion(+)</div><div class=\"line\"> create mode 100644 test.txt</div><div class=\"line\"></div><div class=\"line\">$ git push</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Username <span class=\"keyword\">for</span> <span class=\"string\">'https://github.com'</span>: tyl569</div><div class=\"line\">Password <span class=\"keyword\">for</span> <span class=\"string\">'https://tyl569@github.com'</span>:</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Counting objects: 3, done.</div><div class=\"line\">Writing objects: 100% (3/3), 240 bytes | 0 bytes/s, done.</div><div class=\"line\">Total 3 (delta 0), reused 0 (delta 0)</div><div class=\"line\">To https://github.com/tyl569/test.git</div><div class=\"line\"> * [new branch]      master -&gt; master</div></pre></td></tr></table></figure>\n<h4 id=\"5）可以从git-push结果看到，这是一个新的分支。\"><a href=\"#5）可以从git-push结果看到，这是一个新的分支。\" class=\"headerlink\" title=\"5）可以从git push结果看到，这是一个新的分支。\"></a>5）可以从<code>git push</code>结果看到，这是一个新的分支。</h4><h4 id=\"6）创建一个新的分支，并且切换到新的分支上面。\"><a href=\"#6）创建一个新的分支，并且切换到新的分支上面。\" class=\"headerlink\" title=\"6）创建一个新的分支，并且切换到新的分支上面。\"></a>6）创建一个新的分支，并且切换到新的分支上面。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git branch new</div><div class=\"line\">$ git checkout new</div><div class=\"line\">Switched to branch <span class=\"string\">'new'</span></div><div class=\"line\"><span class=\"comment\">## 提示已经切换到new分支</span></div></pre></td></tr></table></figure>\n<h4 id=\"7）此时在本地项目做一些改动，然后提交到github上面。\"><a href=\"#7）此时在本地项目做一些改动，然后提交到github上面。\" class=\"headerlink\" title=\"7）此时在本地项目做一些改动，然后提交到github上面。\"></a>7）此时在本地项目做一些改动，然后提交到github上面。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># git add/commit等操作省略</span></div><div class=\"line\">$ git push</div><div class=\"line\">fatal: The current branch new has no upstream branch.</div><div class=\"line\">To push the current branch and <span class=\"built_in\">set</span> the remote as upstream, use</div><div class=\"line\"></div><div class=\"line\">    git push --set-upstream origin new</div></pre></td></tr></table></figure>\n<h4 id=\"在git-push的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。\"><a href=\"#在git-push的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。\" class=\"headerlink\" title=\"在git push的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。\"></a>在<code>git push</code>的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push --set-upstream origin new</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Username <span class=\"keyword\">for</span> <span class=\"string\">'https://github.com'</span>: tyl569</div><div class=\"line\">Password <span class=\"keyword\">for</span> <span class=\"string\">'https://tyl569@github.com'</span>:</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Counting objects: 3, done.</div><div class=\"line\">Writing objects: 100% (3/3), 283 bytes | 0 bytes/s, done.</div><div class=\"line\">Total 3 (delta 0), reused 0 (delta 0)</div><div class=\"line\">To https://github.com/tyl569/test.git</div><div class=\"line\"> * [new branch]      new -&gt; new</div><div class=\"line\">Branch new <span class=\"built_in\">set</span> up to track remote branch new from origin.</div></pre></td></tr></table></figure>\n<h4 id=\"8）查看github，会看到合并分支的请求\"><a href=\"#8）查看github，会看到合并分支的请求\" class=\"headerlink\" title=\"8）查看github，会看到合并分支的请求\"></a>8）查看github，会看到合并分支的请求</h4><p><img src=\"/img/1469951539710.png\" alt=\"Alt text\"></p>\n<h4 id=\"查看一下test-txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户pull或者clone的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。\"><a href=\"#查看一下test-txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户pull或者clone的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。\" class=\"headerlink\" title=\"查看一下test.txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户pull或者clone的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。\"></a>查看一下test.txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户<code>pull</code>或者<code>clone</code>的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。</h4><p><img src=\"/img/1469951597308.png\" alt=\"Alt text\"><br><img src=\"/img/1469951611981.png\" alt=\"Alt text\"></p>\n<h4 id=\"9）如果功能在new分支上面开发完之后，合并分支。\"><a href=\"#9）如果功能在new分支上面开发完之后，合并分支。\" class=\"headerlink\" title=\"9）如果功能在new分支上面开发完之后，合并分支。\"></a>9）如果功能在new分支上面开发完之后，合并分支。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$  git checkout master</div><div class=\"line\">$ git merge new</div><div class=\"line\">Updating 97b26e5..96d3fe8</div><div class=\"line\">Fast-forward</div><div class=\"line\"> test.txt | 5 ++++-</div><div class=\"line\"> 1 file changed, 4 insertions(+), 1 deletion(-)</div></pre></td></tr></table></figure>\n<h4 id=\"10）这个时候，就会把new分支的改动，合并到master分支了，然后push\"><a href=\"#10）这个时候，就会把new分支的改动，合并到master分支了，然后push\" class=\"headerlink\" title=\"10）这个时候，就会把new分支的改动，合并到master分支了，然后push\"></a>10）这个时候，就会把new分支的改动，合并到master分支了，然后<code>push</code></h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">git push</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Username <span class=\"keyword\">for</span> <span class=\"string\">'https://github.com'</span>: tyl569</div><div class=\"line\">Password <span class=\"keyword\">for</span> <span class=\"string\">'https://tyl569@github.com'</span>:</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Total 0 (delta 0), reused 0 (delta 0)</div><div class=\"line\">To https://github.com/tyl569/test.git</div><div class=\"line\">   97b26e5..96d3fe8  master -&gt; master</div></pre></td></tr></table></figure>\n<p><img src=\"/img/1469952187908.png\" alt=\"Alt text\"><br><img src=\"/img/1469952201409.png\" alt=\"Alt text\"></p>\n<hr>\n<h3 id=\"分支合并的作用：\"><a href=\"#分支合并的作用：\" class=\"headerlink\" title=\"分支合并的作用：\"></a>分支合并的作用：</h3><blockquote>\n<ul>\n<li>可以独立开发某个功能或者模块</li>\n<li>如果功能没有搞完，也可以<code>push</code>，对项目没有影响</li>\n</ul>\n</blockquote>\n","excerpt":"","more":"<blockquote>\n<p>平时git branch用的比较少，大多数用的git add/commit/pull/push用的比较多，不过也特意找了一些资料<br>完整资料请点击<a href=\"http://blog.jobbole.com/78960/\">这里</a>或者<a href=\"http://www.open-open.com/lib/view/open1328069889514.html\">这里</a></p>\n<p>每次提交版本的时候，git会形成一个时间线，上面会有各种操作，git管这个“时间线”叫做分支，也就是我们常见的master，我们也可以根据需要创建各种分支，但是git只是识别master分支，所以每次创建分支后，需要合并才行。</p>\n</blockquote>\n<h4 id=\"1）我们在github创建一个test的项目，创建过程自行操作\"><a href=\"#1）我们在github创建一个test的项目，创建过程自行操作\" class=\"headerlink\" title=\"1）我们在github创建一个test的项目，创建过程自行操作\"></a>1）我们在github创建一个test的项目，创建过程自行操作</h4><p><img src=\"/img/1469950279275.png\" alt=\"Alt text\"></p>\n<h4 id=\"2）我们把项目git-clone到本地\"><a href=\"#2）我们把项目git-clone到本地\" class=\"headerlink\" title=\"2）我们把项目git clone到本地\"></a>2）我们把项目<code>git clone</code>到本地</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git <span class=\"built_in\">clone</span> https://github.com/tyl569/test.git ./</div><div class=\"line\">Cloning into <span class=\"string\">'.'</span>...</div><div class=\"line\">warning: You appear to have cloned an empty repository.</div><div class=\"line\">Checking connectivity... done.</div></pre></td></tr></table></figure>\n<h4 id=\"3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test-txt，然后在里面写句：hello-world-当做项目好了。\"><a href=\"#3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test-txt，然后在里面写句：hello-world-当做项目好了。\" class=\"headerlink\" title=\"3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test.txt，然后在里面写句：hello ,world.  当做项目好了。\"></a>3）yes，这里肯定是个empty的库，按照常理操作，我们会把项目放在版本库，咱们就姑且创建一个test.txt，然后在里面写句：hello ,world.  当做项目好了。</h4><figure class=\"highlight tex\"><table><tr><td class=\"code\"><pre><div class=\"line\">hello ,world.</div></pre></td></tr></table></figure>\n<h4 id=\"4）ok，接下来就是套路操作了。\"><a href=\"#4）ok，接下来就是套路操作了。\" class=\"headerlink\" title=\"4）ok，接下来就是套路操作了。\"></a>4）ok，接下来就是套路操作了。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git status</div><div class=\"line\">On branch master</div><div class=\"line\"></div><div class=\"line\">Initial commit</div><div class=\"line\"></div><div class=\"line\">Untracked files:</div><div class=\"line\">  (use <span class=\"string\">\"git add &lt;file&gt;...\"</span> to include <span class=\"keyword\">in</span> what will be committed)</div><div class=\"line\"></div><div class=\"line\">        test.txt</div><div class=\"line\"></div><div class=\"line\">nothing added to commit but untracked files present (use <span class=\"string\">\"git add\"</span> to track)</div><div class=\"line\"></div><div class=\"line\">$ git add .</div><div class=\"line\">$ git commit -m 初次提交项目</div><div class=\"line\">[master (root-commit) 97b26e5] 初次提交项目</div><div class=\"line\"> 1 file changed, 1 insertion(+)</div><div class=\"line\"> create mode 100644 test.txt</div><div class=\"line\"></div><div class=\"line\">$ git push</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Username <span class=\"keyword\">for</span> <span class=\"string\">'https://github.com'</span>: tyl569</div><div class=\"line\">Password <span class=\"keyword\">for</span> <span class=\"string\">'https://tyl569@github.com'</span>:</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Counting objects: 3, done.</div><div class=\"line\">Writing objects: 100% (3/3), 240 bytes | 0 bytes/s, done.</div><div class=\"line\">Total 3 (delta 0), reused 0 (delta 0)</div><div class=\"line\">To https://github.com/tyl569/test.git</div><div class=\"line\"> * [new branch]      master -&gt; master</div></pre></td></tr></table></figure>\n<h4 id=\"5）可以从git-push结果看到，这是一个新的分支。\"><a href=\"#5）可以从git-push结果看到，这是一个新的分支。\" class=\"headerlink\" title=\"5）可以从git push结果看到，这是一个新的分支。\"></a>5）可以从<code>git push</code>结果看到，这是一个新的分支。</h4><h4 id=\"6）创建一个新的分支，并且切换到新的分支上面。\"><a href=\"#6）创建一个新的分支，并且切换到新的分支上面。\" class=\"headerlink\" title=\"6）创建一个新的分支，并且切换到新的分支上面。\"></a>6）创建一个新的分支，并且切换到新的分支上面。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git branch new</div><div class=\"line\">$ git checkout new</div><div class=\"line\">Switched to branch <span class=\"string\">'new'</span></div><div class=\"line\"><span class=\"comment\">## 提示已经切换到new分支</span></div></pre></td></tr></table></figure>\n<h4 id=\"7）此时在本地项目做一些改动，然后提交到github上面。\"><a href=\"#7）此时在本地项目做一些改动，然后提交到github上面。\" class=\"headerlink\" title=\"7）此时在本地项目做一些改动，然后提交到github上面。\"></a>7）此时在本地项目做一些改动，然后提交到github上面。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\"># git add/commit等操作省略</span></div><div class=\"line\">$ git push</div><div class=\"line\">fatal: The current branch new has no upstream branch.</div><div class=\"line\">To push the current branch and <span class=\"built_in\">set</span> the remote as upstream, use</div><div class=\"line\"></div><div class=\"line\">    git push --set-upstream origin new</div></pre></td></tr></table></figure>\n<h4 id=\"在git-push的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。\"><a href=\"#在git-push的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。\" class=\"headerlink\" title=\"在git push的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。\"></a>在<code>git push</code>的时候会提示新的分支没有添加到分支流中，然后使用提示的命令push一下。然后输入用户名和密码。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push --set-upstream origin new</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Username <span class=\"keyword\">for</span> <span class=\"string\">'https://github.com'</span>: tyl569</div><div class=\"line\">Password <span class=\"keyword\">for</span> <span class=\"string\">'https://tyl569@github.com'</span>:</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Counting objects: 3, done.</div><div class=\"line\">Writing objects: 100% (3/3), 283 bytes | 0 bytes/s, done.</div><div class=\"line\">Total 3 (delta 0), reused 0 (delta 0)</div><div class=\"line\">To https://github.com/tyl569/test.git</div><div class=\"line\"> * [new branch]      new -&gt; new</div><div class=\"line\">Branch new <span class=\"built_in\">set</span> up to track remote branch new from origin.</div></pre></td></tr></table></figure>\n<h4 id=\"8）查看github，会看到合并分支的请求\"><a href=\"#8）查看github，会看到合并分支的请求\" class=\"headerlink\" title=\"8）查看github，会看到合并分支的请求\"></a>8）查看github，会看到合并分支的请求</h4><p><img src=\"/img/1469951539710.png\" alt=\"Alt text\"></p>\n<h4 id=\"查看一下test-txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户pull或者clone的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。\"><a href=\"#查看一下test-txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户pull或者clone的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。\" class=\"headerlink\" title=\"查看一下test.txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户pull或者clone的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。\"></a>查看一下test.txt文件，发现内容并没有改变，这是因为github把master作为主分支，如果两个分支不合并的话，另外的用户<code>pull</code>或者<code>clone</code>的时候，只会得到master分支的项目，这样如果用户随意搞new分支的内容，都不会影响master分支。</h4><p><img src=\"/img/1469951597308.png\" alt=\"Alt text\"><br><img src=\"/img/1469951611981.png\" alt=\"Alt text\"></p>\n<h4 id=\"9）如果功能在new分支上面开发完之后，合并分支。\"><a href=\"#9）如果功能在new分支上面开发完之后，合并分支。\" class=\"headerlink\" title=\"9）如果功能在new分支上面开发完之后，合并分支。\"></a>9）如果功能在new分支上面开发完之后，合并分支。</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$  git checkout master</div><div class=\"line\">$ git merge new</div><div class=\"line\">Updating 97b26e5..96d3fe8</div><div class=\"line\">Fast-forward</div><div class=\"line\"> test.txt | 5 ++++-</div><div class=\"line\"> 1 file changed, 4 insertions(+), 1 deletion(-)</div></pre></td></tr></table></figure>\n<h4 id=\"10）这个时候，就会把new分支的改动，合并到master分支了，然后push\"><a href=\"#10）这个时候，就会把new分支的改动，合并到master分支了，然后push\" class=\"headerlink\" title=\"10）这个时候，就会把new分支的改动，合并到master分支了，然后push\"></a>10）这个时候，就会把new分支的改动，合并到master分支了，然后<code>push</code></h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">git push</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Username <span class=\"keyword\">for</span> <span class=\"string\">'https://github.com'</span>: tyl569</div><div class=\"line\">Password <span class=\"keyword\">for</span> <span class=\"string\">'https://tyl569@github.com'</span>:</div><div class=\"line\">git: <span class=\"string\">'credential-osxkeychain'</span> is not a git command. See <span class=\"string\">'git --help'</span>.</div><div class=\"line\">Total 0 (delta 0), reused 0 (delta 0)</div><div class=\"line\">To https://github.com/tyl569/test.git</div><div class=\"line\">   97b26e5..96d3fe8  master -&gt; master</div></pre></td></tr></table></figure>\n<p><img src=\"/img/1469952187908.png\" alt=\"Alt text\"><br><img src=\"/img/1469952201409.png\" alt=\"Alt text\"></p>\n<hr>\n<h3 id=\"分支合并的作用：\"><a href=\"#分支合并的作用：\" class=\"headerlink\" title=\"分支合并的作用：\"></a>分支合并的作用：</h3><blockquote>\n<ul>\n<li>可以独立开发某个功能或者模块</li>\n<li>如果功能没有搞完，也可以<code>push</code>，对项目没有影响</li>\n</ul>\n</blockquote>\n"},{"title":"Linux 安装supervisor (CentOs or RedHat)","date":"2016-11-09T10:38:07.000Z","_content":"\n-----------------------\n\n#### supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。\n\n#### supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。\n\n#### 安装supervisor\n\n```bash\n$ yum install python-setuptools\n```\n![Alt text](/img/QQ截图20161108151312.png)\n\n```bash\n$ easy_install supervisor\n```\n![Alt text](/img/QQ截图20161108151521.png)\n\n#### 测试是否安装成功\n\n```bash\n$ echo_supervisord_conf\n```\n![Alt text](/img/QQ截图20161108151708.png)\n\n#### 创建配置文件\n\n##### 创建主配置文件\n\n```bash\n$ mkdir -m 755 -p /etc/supervisor/\n$ echo_supervisord_conf > /etc/supervisor/supervisord.conf\n```\n\n##### 创建项目配置目录\n\n```bash\n$ mkdir -m 755 conf.d\n```\n\n![Alt text](/img/QQ截图20161108152106.png)\n\n#### 创建测试\n\n##### 在/home/tengyunlong/supervisor_simple目录下创建test.c\n\n```cpp\n#include<stdio.h>\n#include<string.h>\n#include <unistd.h>\nint main() {\n\tFILE *fp = fopen(\"/home/slightech/supervisor_simple/a.txt\", \"a+\");\n\tif (fp == 0) {\n\t\tprintf(\"Can not open file \\n\");\n\t\treturn 0;\n\t}\n\tint ix = 0;\n\tfor (;; ix++) {\n\t\tfseek(fp, 0, SEEK_END);\n\t\tchar s_add_arr[10];\n\t\tmemset(s_add_arr, '\\0', 10);\n\t\tsprintf(s_add_arr, \"%i\\n\", ix);\n\t\tfwrite(s_add_arr, strlen(s_add_arr), 1, fp);\n\t\tsleep(1);\n\t}\n\tfclose(fp);\n\treturn 0;\n}\n```\n\n##### 编译为test\n\n```bash\n$ gcc -o test test.c\n```\n\n#### 更改主配置文件，去掉最后两行的分号(;)，我习惯设置项目配置文件为.conf 格式\n\n![Alt text](/img/QQ图片20161108153215.png)\n\n#### 在/etc/supervisor/conf.d 创建test.conf文件\n\n```bash\n[program:test]\ncommand=/home/slightech/supervisor_simple/test\n;directory= ;directory to cwd to before exec (def no cwd)\nautostart=true ; start at supervisord start (default: true)\nautorestart=unexpected ; whether/when to restart (default: unexpected)\nstartsecs=1 ; number of secs prog must stay running (def. 1)\nredirect_stderr=true ; redirect proc stderr to stdout (default false) 错误重定向\nstdout_logfile=/var/log/supervisor/test.log ; stout log path, NONE of none ;default AUTO,log输出\n```\n\n#### 启动supervisor服务\n\n```bash\n$ supervisord -c /etc/supervisor/supervisord.conf\n```\n\n#### 使用pstree查看进程\n\n```bash\n$ pstree | grep supervisor\n```\n![Alt text](/img/QQ截图20161108153954.png)\n\n#### 查看监控的进程，发现test running\n\n```bash\n$ supervisorctl -c /etc/supervisor/supervisord.conf\n```\n\n![Alt text](/img/QQ截图20161108154215.png)\n\n#### 命令\n\n```bash\n$ supervisorctl [-c /etc/supervisor/supervisor.conf ] stop|start|restart all #停止|启动|重启 所有进程\n$ supervisorctl [-c /etc/supervisor/supervisor.conf ] #登录控制台\n```\n\n#### 参见[supervisor初体验](http://www.jianshu.com/p/9abffc905645)\n","source":"_posts/Linux-安装supervisor-CentOs-or-RedHat.md","raw":"---\ntitle: Linux 安装supervisor (CentOs or RedHat)\ndate: 2016-11-09 18:38:07\ntags: Linux\ncategories: Linux\n---\n\n-----------------------\n\n#### supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。\n\n#### supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。\n\n#### 安装supervisor\n\n```bash\n$ yum install python-setuptools\n```\n![Alt text](/img/QQ截图20161108151312.png)\n\n```bash\n$ easy_install supervisor\n```\n![Alt text](/img/QQ截图20161108151521.png)\n\n#### 测试是否安装成功\n\n```bash\n$ echo_supervisord_conf\n```\n![Alt text](/img/QQ截图20161108151708.png)\n\n#### 创建配置文件\n\n##### 创建主配置文件\n\n```bash\n$ mkdir -m 755 -p /etc/supervisor/\n$ echo_supervisord_conf > /etc/supervisor/supervisord.conf\n```\n\n##### 创建项目配置目录\n\n```bash\n$ mkdir -m 755 conf.d\n```\n\n![Alt text](/img/QQ截图20161108152106.png)\n\n#### 创建测试\n\n##### 在/home/tengyunlong/supervisor_simple目录下创建test.c\n\n```cpp\n#include<stdio.h>\n#include<string.h>\n#include <unistd.h>\nint main() {\n\tFILE *fp = fopen(\"/home/slightech/supervisor_simple/a.txt\", \"a+\");\n\tif (fp == 0) {\n\t\tprintf(\"Can not open file \\n\");\n\t\treturn 0;\n\t}\n\tint ix = 0;\n\tfor (;; ix++) {\n\t\tfseek(fp, 0, SEEK_END);\n\t\tchar s_add_arr[10];\n\t\tmemset(s_add_arr, '\\0', 10);\n\t\tsprintf(s_add_arr, \"%i\\n\", ix);\n\t\tfwrite(s_add_arr, strlen(s_add_arr), 1, fp);\n\t\tsleep(1);\n\t}\n\tfclose(fp);\n\treturn 0;\n}\n```\n\n##### 编译为test\n\n```bash\n$ gcc -o test test.c\n```\n\n#### 更改主配置文件，去掉最后两行的分号(;)，我习惯设置项目配置文件为.conf 格式\n\n![Alt text](/img/QQ图片20161108153215.png)\n\n#### 在/etc/supervisor/conf.d 创建test.conf文件\n\n```bash\n[program:test]\ncommand=/home/slightech/supervisor_simple/test\n;directory= ;directory to cwd to before exec (def no cwd)\nautostart=true ; start at supervisord start (default: true)\nautorestart=unexpected ; whether/when to restart (default: unexpected)\nstartsecs=1 ; number of secs prog must stay running (def. 1)\nredirect_stderr=true ; redirect proc stderr to stdout (default false) 错误重定向\nstdout_logfile=/var/log/supervisor/test.log ; stout log path, NONE of none ;default AUTO,log输出\n```\n\n#### 启动supervisor服务\n\n```bash\n$ supervisord -c /etc/supervisor/supervisord.conf\n```\n\n#### 使用pstree查看进程\n\n```bash\n$ pstree | grep supervisor\n```\n![Alt text](/img/QQ截图20161108153954.png)\n\n#### 查看监控的进程，发现test running\n\n```bash\n$ supervisorctl -c /etc/supervisor/supervisord.conf\n```\n\n![Alt text](/img/QQ截图20161108154215.png)\n\n#### 命令\n\n```bash\n$ supervisorctl [-c /etc/supervisor/supervisor.conf ] stop|start|restart all #停止|启动|重启 所有进程\n$ supervisorctl [-c /etc/supervisor/supervisor.conf ] #登录控制台\n```\n\n#### 参见[supervisor初体验](http://www.jianshu.com/p/9abffc905645)\n","slug":"Linux-安装supervisor-CentOs-or-RedHat","published":1,"updated":"2017-03-15T02:34:29.648Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31i000a0oqmvhphaucm","content":"<hr>\n<h4 id=\"supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。\"><a href=\"#supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。\" class=\"headerlink\" title=\"supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。\"></a>supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。</h4><h4 id=\"supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。\"><a href=\"#supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。\" class=\"headerlink\" title=\"supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。\"></a>supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。</h4><h4 id=\"安装supervisor\"><a href=\"#安装supervisor\" class=\"headerlink\" title=\"安装supervisor\"></a>安装supervisor</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ yum install python-setuptools</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108151312.png\" alt=\"Alt text\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ easy_install supervisor</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108151521.png\" alt=\"Alt text\"></p>\n<h4 id=\"测试是否安装成功\"><a href=\"#测试是否安装成功\" class=\"headerlink\" title=\"测试是否安装成功\"></a>测试是否安装成功</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">echo</span>_supervisord_conf</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108151708.png\" alt=\"Alt text\"></p>\n<h4 id=\"创建配置文件\"><a href=\"#创建配置文件\" class=\"headerlink\" title=\"创建配置文件\"></a>创建配置文件</h4><h5 id=\"创建主配置文件\"><a href=\"#创建主配置文件\" class=\"headerlink\" title=\"创建主配置文件\"></a>创建主配置文件</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ mkdir -m 755 -p /etc/supervisor/</div><div class=\"line\">$ <span class=\"built_in\">echo</span>_supervisord_conf &gt; /etc/supervisor/supervisord.conf</div></pre></td></tr></table></figure>\n<h5 id=\"创建项目配置目录\"><a href=\"#创建项目配置目录\" class=\"headerlink\" title=\"创建项目配置目录\"></a>创建项目配置目录</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ mkdir -m 755 conf.d</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108152106.png\" alt=\"Alt text\"></p>\n<h4 id=\"创建测试\"><a href=\"#创建测试\" class=\"headerlink\" title=\"创建测试\"></a>创建测试</h4><h5 id=\"在-home-tengyunlong-supervisor-simple目录下创建test-c\"><a href=\"#在-home-tengyunlong-supervisor-simple目录下创建test-c\" class=\"headerlink\" title=\"在/home/tengyunlong/supervisor_simple目录下创建test.c\"></a>在/home/tengyunlong/supervisor_simple目录下创建test.c</h5><figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdio.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;string.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tFILE *fp = fopen(<span class=\"string\">\"/home/slightech/supervisor_simple/a.txt\"</span>, <span class=\"string\">\"a+\"</span>);</div><div class=\"line\">\t<span class=\"keyword\">if</span> (fp == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Can not open file \\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">int</span> ix = <span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (;; ix++) &#123;</div><div class=\"line\">\t\tfseek(fp, <span class=\"number\">0</span>, SEEK_END);</div><div class=\"line\">\t\t<span class=\"keyword\">char</span> s_add_arr[<span class=\"number\">10</span>];</div><div class=\"line\">\t\t<span class=\"built_in\">memset</span>(s_add_arr, <span class=\"string\">'\\0'</span>, <span class=\"number\">10</span>);</div><div class=\"line\">\t\t<span class=\"built_in\">sprintf</span>(s_add_arr, <span class=\"string\">\"%i\\n\"</span>, ix);</div><div class=\"line\">\t\tfwrite(s_add_arr, <span class=\"built_in\">strlen</span>(s_add_arr), <span class=\"number\">1</span>, fp);</div><div class=\"line\">\t\tsleep(<span class=\"number\">1</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tfclose(fp);</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h5 id=\"编译为test\"><a href=\"#编译为test\" class=\"headerlink\" title=\"编译为test\"></a>编译为test</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ gcc -o <span class=\"built_in\">test</span> test.c</div></pre></td></tr></table></figure>\n<h4 id=\"更改主配置文件，去掉最后两行的分号-，我习惯设置项目配置文件为-conf-格式\"><a href=\"#更改主配置文件，去掉最后两行的分号-，我习惯设置项目配置文件为-conf-格式\" class=\"headerlink\" title=\"更改主配置文件，去掉最后两行的分号(;)，我习惯设置项目配置文件为.conf 格式\"></a>更改主配置文件，去掉最后两行的分号(;)，我习惯设置项目配置文件为.conf 格式</h4><p><img src=\"/img/QQ图片20161108153215.png\" alt=\"Alt text\"></p>\n<h4 id=\"在-etc-supervisor-conf-d-创建test-conf文件\"><a href=\"#在-etc-supervisor-conf-d-创建test-conf文件\" class=\"headerlink\" title=\"在/etc/supervisor/conf.d 创建test.conf文件\"></a>在/etc/supervisor/conf.d 创建test.conf文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">[program:<span class=\"built_in\">test</span>]</div><div class=\"line\"><span class=\"built_in\">command</span>=/home/slightech/supervisor_simple/<span class=\"built_in\">test</span></div><div class=\"line\">;directory= ;directory to cwd to before <span class=\"built_in\">exec</span> (def no cwd)</div><div class=\"line\">autostart=<span class=\"literal\">true</span> ; start at supervisord start (default: <span class=\"literal\">true</span>)</div><div class=\"line\">autorestart=unexpected ; whether/when to restart (default: unexpected)</div><div class=\"line\">startsecs=1 ; number of secs prog must stay running (def. 1)</div><div class=\"line\">redirect_stderr=<span class=\"literal\">true</span> ; redirect proc stderr to stdout (default <span class=\"literal\">false</span>) 错误重定向</div><div class=\"line\">stdout_logfile=/var/<span class=\"built_in\">log</span>/supervisor/test.log ; stout <span class=\"built_in\">log</span> path, NONE of none ;default AUTO,<span class=\"built_in\">log</span>输出</div></pre></td></tr></table></figure>\n<h4 id=\"启动supervisor服务\"><a href=\"#启动supervisor服务\" class=\"headerlink\" title=\"启动supervisor服务\"></a>启动supervisor服务</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ supervisord -c /etc/supervisor/supervisord.conf</div></pre></td></tr></table></figure>\n<h4 id=\"使用pstree查看进程\"><a href=\"#使用pstree查看进程\" class=\"headerlink\" title=\"使用pstree查看进程\"></a>使用pstree查看进程</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ pstree | grep supervisor</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108153954.png\" alt=\"Alt text\"></p>\n<h4 id=\"查看监控的进程，发现test-running\"><a href=\"#查看监控的进程，发现test-running\" class=\"headerlink\" title=\"查看监控的进程，发现test running\"></a>查看监控的进程，发现test running</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ supervisorctl -c /etc/supervisor/supervisord.conf</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108154215.png\" alt=\"Alt text\"></p>\n<h4 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ supervisorctl [-c /etc/supervisor/supervisor.conf ] stop|start|restart all <span class=\"comment\">#停止|启动|重启 所有进程</span></div><div class=\"line\">$ supervisorctl [-c /etc/supervisor/supervisor.conf ] <span class=\"comment\">#登录控制台</span></div></pre></td></tr></table></figure>\n<h4 id=\"参见supervisor初体验\"><a href=\"#参见supervisor初体验\" class=\"headerlink\" title=\"参见supervisor初体验\"></a>参见<a href=\"http://www.jianshu.com/p/9abffc905645\" target=\"_blank\" rel=\"external\">supervisor初体验</a></h4>","excerpt":"","more":"<hr>\n<h4 id=\"supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。\"><a href=\"#supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。\" class=\"headerlink\" title=\"supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。\"></a>supervisor是linux进程管理利器。如果是一个服务程序，要可靠地在后台运行，我们就需要把它做成daemon，最好还能监控进程状态，在意外结束时能自动重启。</h4><h4 id=\"supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。\"><a href=\"#supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。\" class=\"headerlink\" title=\"supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。\"></a>supervisor就是用Python开发的一套通用的进程管理程序，能将一个普通的命令行进程变为后台daemon，并监控进程状态，异常退出时能自动重启。</h4><h4 id=\"安装supervisor\"><a href=\"#安装supervisor\" class=\"headerlink\" title=\"安装supervisor\"></a>安装supervisor</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ yum install python-setuptools</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108151312.png\" alt=\"Alt text\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ easy_install supervisor</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108151521.png\" alt=\"Alt text\"></p>\n<h4 id=\"测试是否安装成功\"><a href=\"#测试是否安装成功\" class=\"headerlink\" title=\"测试是否安装成功\"></a>测试是否安装成功</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">echo</span>_supervisord_conf</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108151708.png\" alt=\"Alt text\"></p>\n<h4 id=\"创建配置文件\"><a href=\"#创建配置文件\" class=\"headerlink\" title=\"创建配置文件\"></a>创建配置文件</h4><h5 id=\"创建主配置文件\"><a href=\"#创建主配置文件\" class=\"headerlink\" title=\"创建主配置文件\"></a>创建主配置文件</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ mkdir -m 755 -p /etc/supervisor/</div><div class=\"line\">$ <span class=\"built_in\">echo</span>_supervisord_conf &gt; /etc/supervisor/supervisord.conf</div></pre></td></tr></table></figure>\n<h5 id=\"创建项目配置目录\"><a href=\"#创建项目配置目录\" class=\"headerlink\" title=\"创建项目配置目录\"></a>创建项目配置目录</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ mkdir -m 755 conf.d</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108152106.png\" alt=\"Alt text\"></p>\n<h4 id=\"创建测试\"><a href=\"#创建测试\" class=\"headerlink\" title=\"创建测试\"></a>创建测试</h4><h5 id=\"在-home-tengyunlong-supervisor-simple目录下创建test-c\"><a href=\"#在-home-tengyunlong-supervisor-simple目录下创建test-c\" class=\"headerlink\" title=\"在/home/tengyunlong/supervisor_simple目录下创建test.c\"></a>在/home/tengyunlong/supervisor_simple目录下创建test.c</h5><figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdio.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;string.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tFILE *fp = fopen(<span class=\"string\">\"/home/slightech/supervisor_simple/a.txt\"</span>, <span class=\"string\">\"a+\"</span>);</div><div class=\"line\">\t<span class=\"keyword\">if</span> (fp == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">\"Can not open file \\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">int</span> ix = <span class=\"number\">0</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span> (;; ix++) &#123;</div><div class=\"line\">\t\tfseek(fp, <span class=\"number\">0</span>, SEEK_END);</div><div class=\"line\">\t\t<span class=\"keyword\">char</span> s_add_arr[<span class=\"number\">10</span>];</div><div class=\"line\">\t\t<span class=\"built_in\">memset</span>(s_add_arr, <span class=\"string\">'\\0'</span>, <span class=\"number\">10</span>);</div><div class=\"line\">\t\t<span class=\"built_in\">sprintf</span>(s_add_arr, <span class=\"string\">\"%i\\n\"</span>, ix);</div><div class=\"line\">\t\tfwrite(s_add_arr, <span class=\"built_in\">strlen</span>(s_add_arr), <span class=\"number\">1</span>, fp);</div><div class=\"line\">\t\tsleep(<span class=\"number\">1</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tfclose(fp);</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h5 id=\"编译为test\"><a href=\"#编译为test\" class=\"headerlink\" title=\"编译为test\"></a>编译为test</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ gcc -o <span class=\"built_in\">test</span> test.c</div></pre></td></tr></table></figure>\n<h4 id=\"更改主配置文件，去掉最后两行的分号-，我习惯设置项目配置文件为-conf-格式\"><a href=\"#更改主配置文件，去掉最后两行的分号-，我习惯设置项目配置文件为-conf-格式\" class=\"headerlink\" title=\"更改主配置文件，去掉最后两行的分号(;)，我习惯设置项目配置文件为.conf 格式\"></a>更改主配置文件，去掉最后两行的分号(;)，我习惯设置项目配置文件为.conf 格式</h4><p><img src=\"/img/QQ图片20161108153215.png\" alt=\"Alt text\"></p>\n<h4 id=\"在-etc-supervisor-conf-d-创建test-conf文件\"><a href=\"#在-etc-supervisor-conf-d-创建test-conf文件\" class=\"headerlink\" title=\"在/etc/supervisor/conf.d 创建test.conf文件\"></a>在/etc/supervisor/conf.d 创建test.conf文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">[program:<span class=\"built_in\">test</span>]</div><div class=\"line\"><span class=\"built_in\">command</span>=/home/slightech/supervisor_simple/<span class=\"built_in\">test</span></div><div class=\"line\">;directory= ;directory to cwd to before <span class=\"built_in\">exec</span> (def no cwd)</div><div class=\"line\">autostart=<span class=\"literal\">true</span> ; start at supervisord start (default: <span class=\"literal\">true</span>)</div><div class=\"line\">autorestart=unexpected ; whether/when to restart (default: unexpected)</div><div class=\"line\">startsecs=1 ; number of secs prog must stay running (def. 1)</div><div class=\"line\">redirect_stderr=<span class=\"literal\">true</span> ; redirect proc stderr to stdout (default <span class=\"literal\">false</span>) 错误重定向</div><div class=\"line\">stdout_logfile=/var/<span class=\"built_in\">log</span>/supervisor/test.log ; stout <span class=\"built_in\">log</span> path, NONE of none ;default AUTO,<span class=\"built_in\">log</span>输出</div></pre></td></tr></table></figure>\n<h4 id=\"启动supervisor服务\"><a href=\"#启动supervisor服务\" class=\"headerlink\" title=\"启动supervisor服务\"></a>启动supervisor服务</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ supervisord -c /etc/supervisor/supervisord.conf</div></pre></td></tr></table></figure>\n<h4 id=\"使用pstree查看进程\"><a href=\"#使用pstree查看进程\" class=\"headerlink\" title=\"使用pstree查看进程\"></a>使用pstree查看进程</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ pstree | grep supervisor</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108153954.png\" alt=\"Alt text\"></p>\n<h4 id=\"查看监控的进程，发现test-running\"><a href=\"#查看监控的进程，发现test-running\" class=\"headerlink\" title=\"查看监控的进程，发现test running\"></a>查看监控的进程，发现test running</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ supervisorctl -c /etc/supervisor/supervisord.conf</div></pre></td></tr></table></figure>\n<p><img src=\"/img/QQ截图20161108154215.png\" alt=\"Alt text\"></p>\n<h4 id=\"命令\"><a href=\"#命令\" class=\"headerlink\" title=\"命令\"></a>命令</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ supervisorctl [-c /etc/supervisor/supervisor.conf ] stop|start|restart all <span class=\"comment\">#停止|启动|重启 所有进程</span></div><div class=\"line\">$ supervisorctl [-c /etc/supervisor/supervisor.conf ] <span class=\"comment\">#登录控制台</span></div></pre></td></tr></table></figure>\n<h4 id=\"参见supervisor初体验\"><a href=\"#参见supervisor初体验\" class=\"headerlink\" title=\"参见supervisor初体验\"></a>参见<a href=\"http://www.jianshu.com/p/9abffc905645\">supervisor初体验</a></h4>"},{"title":"Linux 将用户加入用户组","date":"2017-06-01T09:06:43.000Z","_content":"\n#### 准备工作\n两个账户：tengyunlong test\n如果没有账户使用 adduser进行创建\n```bash\n$ adduser test\n$ usermod -a -G test test # 将test用户加入到test用户组\n$ groups test #查看test的所有分组\n$ test : test \n```\n使用test用户在/home/test/路径下新建test.txt使此文件允许test分组和test用户读写\n```bash\ntotal 36\ndrwxr-xr-x 2 test test 4096 Jun  1 15:51 ./\ndrwxr-xr-x 4 root root 4096 Jun  1 15:49 ../\n-rw-r--r-- 1 test test  220 Jun  1 15:49 .bash_logout\n-rw-r--r-- 1 test test 3637 Jun  1 15:49 .bashrc\n-rw-r--r-- 1 test test 8980 Jun  1 15:49 examples.desktop\n-rw-r--r-- 1 test test  675 Jun  1 15:49 .profile\n-rw-rw-r-- 1 test test    8 Jun  1 15:53 test.txt\n```\n#### 添加分组\n使用root账户将 tengyunlong加到test分组\n```bash\n$ usermod -a -G test tengyunlong\n$ groups tengyunlong\ntengyunlong : tengyunlong adm cdrom sudo dip plugdev lpadmin sambashare test #可以看到tengyunlong加到test分组了\n```\n\n####运行测试\n切换tengyunlong账户，进入/home/test目录下\n```bash\n$ ll\ntotal 36\ndrwxr-xr-x 2 test test 4096 Jun  1 15:51 ./\ndrwxr-xr-x 4 root root 4096 Jun  1 15:49 ../\n-rw-r--r-- 1 test test  220 Jun  1 15:49 .bash_logout\n-rw-r--r-- 1 test test 3637 Jun  1 15:49 .bashrc\n-rw-r--r-- 1 test test 8980 Jun  1 15:49 examples.desktop\n-rw-r--r-- 1 test test  675 Jun  1 15:49 .profile\n-rw-rw-r-- 1 test test    8 Jun  1 15:53 test.txt\n$  echo 'sssssssssss'> test.txt\n$ cat test.txt \nsssssssssss\t#可以看到内容被写入了\n```","source":"_posts/Linux-将用户加入用户组.md","raw":"---\ntitle: Linux 将用户加入用户组\ndate: 2017-06-01 17:06:43\ntags: Linux\ncategories: Linux\n---\n\n#### 准备工作\n两个账户：tengyunlong test\n如果没有账户使用 adduser进行创建\n```bash\n$ adduser test\n$ usermod -a -G test test # 将test用户加入到test用户组\n$ groups test #查看test的所有分组\n$ test : test \n```\n使用test用户在/home/test/路径下新建test.txt使此文件允许test分组和test用户读写\n```bash\ntotal 36\ndrwxr-xr-x 2 test test 4096 Jun  1 15:51 ./\ndrwxr-xr-x 4 root root 4096 Jun  1 15:49 ../\n-rw-r--r-- 1 test test  220 Jun  1 15:49 .bash_logout\n-rw-r--r-- 1 test test 3637 Jun  1 15:49 .bashrc\n-rw-r--r-- 1 test test 8980 Jun  1 15:49 examples.desktop\n-rw-r--r-- 1 test test  675 Jun  1 15:49 .profile\n-rw-rw-r-- 1 test test    8 Jun  1 15:53 test.txt\n```\n#### 添加分组\n使用root账户将 tengyunlong加到test分组\n```bash\n$ usermod -a -G test tengyunlong\n$ groups tengyunlong\ntengyunlong : tengyunlong adm cdrom sudo dip plugdev lpadmin sambashare test #可以看到tengyunlong加到test分组了\n```\n\n####运行测试\n切换tengyunlong账户，进入/home/test目录下\n```bash\n$ ll\ntotal 36\ndrwxr-xr-x 2 test test 4096 Jun  1 15:51 ./\ndrwxr-xr-x 4 root root 4096 Jun  1 15:49 ../\n-rw-r--r-- 1 test test  220 Jun  1 15:49 .bash_logout\n-rw-r--r-- 1 test test 3637 Jun  1 15:49 .bashrc\n-rw-r--r-- 1 test test 8980 Jun  1 15:49 examples.desktop\n-rw-r--r-- 1 test test  675 Jun  1 15:49 .profile\n-rw-rw-r-- 1 test test    8 Jun  1 15:53 test.txt\n$  echo 'sssssssssss'> test.txt\n$ cat test.txt \nsssssssssss\t#可以看到内容被写入了\n```","slug":"Linux-将用户加入用户组","published":1,"updated":"2017-06-01T09:07:30.561Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31k000d0oqm6ahbuyxr","content":"<h4 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h4><p>两个账户：tengyunlong test<br>如果没有账户使用 adduser进行创建<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ adduser <span class=\"built_in\">test</span></div><div class=\"line\">$ usermod <span class=\"_\">-a</span> -G <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> <span class=\"comment\"># 将test用户加入到test用户组</span></div><div class=\"line\">$ groups <span class=\"built_in\">test</span> <span class=\"comment\">#查看test的所有分组</span></div><div class=\"line\">$ <span class=\"built_in\">test</span> : <span class=\"built_in\">test</span></div></pre></td></tr></table></figure></p>\n<p>使用test用户在/home/test/路径下新建test.txt使此文件允许test分组和test用户读写<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">total 36</div><div class=\"line\">drwxr-xr-x 2 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 4096 Jun  1 15:51 ./</div><div class=\"line\">drwxr-xr-x 4 root root 4096 Jun  1 15:49 ../</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>  220 Jun  1 15:49 .bash_<span class=\"built_in\">logout</span></div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 3637 Jun  1 15:49 .bashrc</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 8980 Jun  1 15:49 examples.desktop</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>  675 Jun  1 15:49 .profile</div><div class=\"line\">-rw-rw-r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>    8 Jun  1 15:53 test.txt</div></pre></td></tr></table></figure></p>\n<h4 id=\"添加分组\"><a href=\"#添加分组\" class=\"headerlink\" title=\"添加分组\"></a>添加分组</h4><p>使用root账户将 tengyunlong加到test分组<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ usermod <span class=\"_\">-a</span> -G <span class=\"built_in\">test</span> tengyunlong</div><div class=\"line\">$ groups tengyunlong</div><div class=\"line\">tengyunlong : tengyunlong adm cdrom sudo dip plugdev lpadmin sambashare <span class=\"built_in\">test</span> <span class=\"comment\">#可以看到tengyunlong加到test分组了</span></div></pre></td></tr></table></figure></p>\n<p>####运行测试<br>切换tengyunlong账户，进入/home/test目录下<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ ll</div><div class=\"line\">total 36</div><div class=\"line\">drwxr-xr-x 2 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 4096 Jun  1 15:51 ./</div><div class=\"line\">drwxr-xr-x 4 root root 4096 Jun  1 15:49 ../</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>  220 Jun  1 15:49 .bash_<span class=\"built_in\">logout</span></div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 3637 Jun  1 15:49 .bashrc</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 8980 Jun  1 15:49 examples.desktop</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>  675 Jun  1 15:49 .profile</div><div class=\"line\">-rw-rw-r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>    8 Jun  1 15:53 test.txt</div><div class=\"line\">$  <span class=\"built_in\">echo</span> <span class=\"string\">'sssssssssss'</span>&gt; test.txt</div><div class=\"line\">$ cat test.txt </div><div class=\"line\">sssssssssss\t<span class=\"comment\">#可以看到内容被写入了</span></div></pre></td></tr></table></figure></p>\n","excerpt":"","more":"<h4 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h4><p>两个账户：tengyunlong test<br>如果没有账户使用 adduser进行创建<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ adduser <span class=\"built_in\">test</span></div><div class=\"line\">$ usermod <span class=\"_\">-a</span> -G <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> <span class=\"comment\"># 将test用户加入到test用户组</span></div><div class=\"line\">$ groups <span class=\"built_in\">test</span> <span class=\"comment\">#查看test的所有分组</span></div><div class=\"line\">$ <span class=\"built_in\">test</span> : <span class=\"built_in\">test</span></div></pre></td></tr></table></figure></p>\n<p>使用test用户在/home/test/路径下新建test.txt使此文件允许test分组和test用户读写<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">total 36</div><div class=\"line\">drwxr-xr-x 2 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 4096 Jun  1 15:51 ./</div><div class=\"line\">drwxr-xr-x 4 root root 4096 Jun  1 15:49 ../</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>  220 Jun  1 15:49 .bash_<span class=\"built_in\">logout</span></div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 3637 Jun  1 15:49 .bashrc</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 8980 Jun  1 15:49 examples.desktop</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>  675 Jun  1 15:49 .profile</div><div class=\"line\">-rw-rw-r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>    8 Jun  1 15:53 test.txt</div></pre></td></tr></table></figure></p>\n<h4 id=\"添加分组\"><a href=\"#添加分组\" class=\"headerlink\" title=\"添加分组\"></a>添加分组</h4><p>使用root账户将 tengyunlong加到test分组<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ usermod <span class=\"_\">-a</span> -G <span class=\"built_in\">test</span> tengyunlong</div><div class=\"line\">$ groups tengyunlong</div><div class=\"line\">tengyunlong : tengyunlong adm cdrom sudo dip plugdev lpadmin sambashare <span class=\"built_in\">test</span> <span class=\"comment\">#可以看到tengyunlong加到test分组了</span></div></pre></td></tr></table></figure></p>\n<p>####运行测试<br>切换tengyunlong账户，进入/home/test目录下<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ ll</div><div class=\"line\">total 36</div><div class=\"line\">drwxr-xr-x 2 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 4096 Jun  1 15:51 ./</div><div class=\"line\">drwxr-xr-x 4 root root 4096 Jun  1 15:49 ../</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>  220 Jun  1 15:49 .bash_<span class=\"built_in\">logout</span></div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 3637 Jun  1 15:49 .bashrc</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span> 8980 Jun  1 15:49 examples.desktop</div><div class=\"line\">-rw-r--r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>  675 Jun  1 15:49 .profile</div><div class=\"line\">-rw-rw-r-- 1 <span class=\"built_in\">test</span> <span class=\"built_in\">test</span>    8 Jun  1 15:53 test.txt</div><div class=\"line\">$  <span class=\"built_in\">echo</span> <span class=\"string\">'sssssssssss'</span>&gt; test.txt</div><div class=\"line\">$ cat test.txt </div><div class=\"line\">sssssssssss\t<span class=\"comment\">#可以看到内容被写入了</span></div></pre></td></tr></table></figure></p>\n"},{"title":"MySQL事务隔离级别详解","date":"2017-05-19T03:28:59.000Z","_content":"\n#### 四种隔离级别的解释\n\nSQL标准定义了4类隔离级别，包括了一些具体规则，用来限定事务内外的哪些改变是可见的，哪些是不可见的。低级别的隔离级一般支持更高的并发处理，并拥有更低的系统开销。\n\n\n* Read Uncommitted（读取未提交内容）\n\n在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。本隔离级别很少用于实际应用，因为它的性能也不比其他级别好多少。读取未提交的数据，也被称之为**脏读（Dirty Read**）。\n\n* Read Committed（读取提交内容）\n\n这是大多数数据库系统的默认隔离级别（但不是MySQL默认的）。它满足了隔离的简单定义：一个事务只能看见已经提交事务所做的改变。这种隔离级别 也支持所谓的**不可重复读（Nonrepeatable Read**），因为同一事务的其他实例在该实例处理其间可能会有新的commit，所以同一select可能返回不同结果。\n\n* Repeatable Read（可重读）\n\n**这是MySQL的默认事务隔离级别**，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行。不过理论上，这会导致另一个棘手的问题：**幻读 （Phantom Read**）。简单的说，幻读指当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影” 行。**InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题**。\n\n* Serializable（可串行化） \n\n这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之，它是在每个读的数据行上加上共享锁。在这个级别，可能导致大量的超时现象和锁竞争。\n\n#### 不同隔离级别带来的问题\n\n这四种隔离级别采取不同的锁类型来实现，若读取的是同一个数据的话，就容易发生问题。例如：\n\n**脏读(Drity Read)**：某个事务已更新一份数据，另一个事务在此时读取了同一份数据，由于某些原因，前一个RollBack了操作，则后一个事务所读取的数据就会是不正确的。\n\n**不可重复读(Non-repeatable read)**:在一个事务的两次查询之中数据不一致，这可能是两次查询过程中间插入了一个事务更新的原有的数据。\n\n**幻读(Phantom Read)**:在一个事务的两次查询中数据行数不一致，例如有一个事务查询了几列行Row)数据，而另一个事务却在此时插入了新的几行数据，先前的事务在接下来的查询中，就会发现有几行数据是它先前所没有的。 （Mysql的InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题。）\n\n在MySQL中，实现了这四种隔离级别，分别有可能产生问题如下所示：\n![Alt text](/img/a.jpg)\n\n\n\n#### MySQL 中如何更新事务级别:\n\n```\nSELECT @@GLOBAL.tx_isolation, @@tx_isolation;\nSET GLOBAL tx_isolation='REPEATABLE-READ';\nSET SESSION tx_isolation='SERIALIZABLE';\n\nor\n\nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\nSET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ\n\n整个语法是：\n\nSET [GLOBAL | SESSION] TRANSACTION\n    transaction_characteristic [, transaction_characteristic] ...\n\ntransaction_characteristic:\n    ISOLATION LEVEL level\n  | READ WRITE\n  | READ ONLY\n\nlevel:\n     REPEATABLE READ\n   | READ COMMITTED\n   | READ UNCOMMITTED\n   | SERIALIZABLE\n\n```\n\n`但是两种修改方式效果是不一样的`\n\n![Alt text](/img/1.png)\n\n举例子：mysql打开两个客户端A、B，在A客户端修改事务隔离\n\n> 使用global 修改，那么A和B下次重新登录的时候显示修改后的效果\n> 使用session形式的设置，当前的会话会立即生效，重新登录后不会生效\n\n详见: MySQL 官方文档: http://dev.mysql.com/doc/refman/5.0/en/set-transaction.html\n\n\n#### 实验\n\n下面，将利用MySQL的客户端程序，分别测试几种隔离级别。测试数据库为test，表为tx；\n表结构：\n\n```sql\nCREATE TABLE `tx` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `num` int(10) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB\n```\n\n两个命令行客户端分别为A，B；不断改变A的隔离级别，在B端修改数据。\n\n以下每次测试前初始数据为：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n```\n\n（一）、将A的隔离级别设置为read uncommitted(未提交读)\n * 在B未更新数据之前：\n客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> select @@tx_isolation;\n+------------------+\n| @@tx_isolation   |\n+------------------+\n| READ-UNCOMMITTED |\n+------------------+\n1 row in set (0.00 sec)\n\nmysql>\n\n```\n* B更新数据：\n客户端B：\n```sql\nmysql> select @@tx_isolation;\n+-----------------+\n| @@tx_isolation  |\n+-----------------+\n| REPEATABLE-READ |\n+-----------------+\n1 row in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> update tx set num=10 where id=3;\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n\n这个时候查看A客户端的数据:\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n客户端B的事务没有进行commit，但是已经可以在A客户端查看到更新的数据，这个时候就出现了`脏读`\n\n接下来将B事务进行回滚\n\n```sql\nmysql> rollback;\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n\n再进行查看A客户端的数据\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n\n\t\t经过上面的实验可以得出结论，事务B更新了一条记录，但是没有提交，此时事务A可以查询出未提交记录。造成脏读现象。未提交读是最低的隔离级别。\n\n（二）、将客户端A的事务隔离级别设置为read committed(已提交读)\n\n```sql\nmysql> SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql>\n```\n 在B未更新数据之前：\n客户端A：\n```sql\nmysql> select @@tx_isolation;\n+----------------+\n| @@tx_isolation |\n+----------------+\n| READ-COMMITTED |\n+----------------+\n1 row in set (0.00 sec)\n\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql>\n```\n\nB更新数据：\n客户端B：\n```sql\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> update tx set num=10 where id=3;\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n这个时候查看客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n接下来我们commit事务，然后查询A数据，发现能够查询到数据了（但是A还没有commit）：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n       经过上面的实验可以得出结论，已提交读隔离级别解决了脏读的问题，但是出现了不可重复读的问题，即事务A在两次查询的数据不一致，因为在两次查询之间事务B更新了一条数据。已提交读只允许读取已提交的记录，但不要求可重复读。\n(三)、将A的隔离级别设置为repeatable read(可重复读)\n 在B未更新数据之前：\n客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\n```\nB更新数据：\n客户端B：\n```sql\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> update tx set num=10 where id=3;\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n```\n客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\nB插入数据：\n客户端B：\n```sql\nmysql> insert tx set num = 5;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n|  5 |    5 |\n+----+------+\n5 rows in set (0.00 sec)\n\nmysql>\n```\n客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n```\n\n       由以上的实验可以得出结论，可重复读隔离级别只允许读取已提交记录，而且在一个事务两次读取一个记录期间，其他事务部的更新该记录。但该事务不要求与其他事务可串行化。例如，当一个事务可以找到由一个已提交事务更新的记录，但是可能产生幻读问题(注意Mysql的InnoDB 和 Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题)。\n\n(四)、将A的隔离级别设置为 可串行化 (Serializable)\nA端打开事务，B端插入一条记录\n事务A端：\n```sql\nmysql> SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql>\n```\n事务B端：\n```sql\nmysql> update tx set num=10 where id=3;\nQuery OK, 1 row affected (0.01 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n\t\t此时客户端B是可以修改数据的，（因为A还没有指定哪张表）\n接下来，我们使用A查询下表，然后使用B更新下数据\n客户端A\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n然后使用B客户端，进行更新数据:\n```sql\nmysql> update tx set num=3 where id=3;\nERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction\nmysql>\n\n```\n\t\t因为此时事务A的隔离级别设置为serializable，开始事务后，并没有提交，所以事务B只能等待。\n事务A提交事务：\n事务A端\n```sql\nmysql> commit;\nQuery OK, 0 rows affected (0.00 sec)\n```\n事务B端\n```sql\nmysql> update tx set num=3 where id=3;\nQuery OK, 1 row affected (0.01 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n```\n      \n\t\tserializable完全锁定字段，若一个事务来查询同一份数据就必须等待，直到前一个事务完成并解除锁定为止 。是完整的隔离级别，会锁定对应的数据表格，因而会有效率的问题。\n","source":"_posts/MySQL事务隔离级别详解.md","raw":"---\ntitle: MySQL事务隔离级别详解\ndate: 2017-05-19 11:28:59\ntags: MySQL\n---\n\n#### 四种隔离级别的解释\n\nSQL标准定义了4类隔离级别，包括了一些具体规则，用来限定事务内外的哪些改变是可见的，哪些是不可见的。低级别的隔离级一般支持更高的并发处理，并拥有更低的系统开销。\n\n\n* Read Uncommitted（读取未提交内容）\n\n在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。本隔离级别很少用于实际应用，因为它的性能也不比其他级别好多少。读取未提交的数据，也被称之为**脏读（Dirty Read**）。\n\n* Read Committed（读取提交内容）\n\n这是大多数数据库系统的默认隔离级别（但不是MySQL默认的）。它满足了隔离的简单定义：一个事务只能看见已经提交事务所做的改变。这种隔离级别 也支持所谓的**不可重复读（Nonrepeatable Read**），因为同一事务的其他实例在该实例处理其间可能会有新的commit，所以同一select可能返回不同结果。\n\n* Repeatable Read（可重读）\n\n**这是MySQL的默认事务隔离级别**，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行。不过理论上，这会导致另一个棘手的问题：**幻读 （Phantom Read**）。简单的说，幻读指当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影” 行。**InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题**。\n\n* Serializable（可串行化） \n\n这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之，它是在每个读的数据行上加上共享锁。在这个级别，可能导致大量的超时现象和锁竞争。\n\n#### 不同隔离级别带来的问题\n\n这四种隔离级别采取不同的锁类型来实现，若读取的是同一个数据的话，就容易发生问题。例如：\n\n**脏读(Drity Read)**：某个事务已更新一份数据，另一个事务在此时读取了同一份数据，由于某些原因，前一个RollBack了操作，则后一个事务所读取的数据就会是不正确的。\n\n**不可重复读(Non-repeatable read)**:在一个事务的两次查询之中数据不一致，这可能是两次查询过程中间插入了一个事务更新的原有的数据。\n\n**幻读(Phantom Read)**:在一个事务的两次查询中数据行数不一致，例如有一个事务查询了几列行Row)数据，而另一个事务却在此时插入了新的几行数据，先前的事务在接下来的查询中，就会发现有几行数据是它先前所没有的。 （Mysql的InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题。）\n\n在MySQL中，实现了这四种隔离级别，分别有可能产生问题如下所示：\n![Alt text](/img/a.jpg)\n\n\n\n#### MySQL 中如何更新事务级别:\n\n```\nSELECT @@GLOBAL.tx_isolation, @@tx_isolation;\nSET GLOBAL tx_isolation='REPEATABLE-READ';\nSET SESSION tx_isolation='SERIALIZABLE';\n\nor\n\nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\nSET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ\n\n整个语法是：\n\nSET [GLOBAL | SESSION] TRANSACTION\n    transaction_characteristic [, transaction_characteristic] ...\n\ntransaction_characteristic:\n    ISOLATION LEVEL level\n  | READ WRITE\n  | READ ONLY\n\nlevel:\n     REPEATABLE READ\n   | READ COMMITTED\n   | READ UNCOMMITTED\n   | SERIALIZABLE\n\n```\n\n`但是两种修改方式效果是不一样的`\n\n![Alt text](/img/1.png)\n\n举例子：mysql打开两个客户端A、B，在A客户端修改事务隔离\n\n> 使用global 修改，那么A和B下次重新登录的时候显示修改后的效果\n> 使用session形式的设置，当前的会话会立即生效，重新登录后不会生效\n\n详见: MySQL 官方文档: http://dev.mysql.com/doc/refman/5.0/en/set-transaction.html\n\n\n#### 实验\n\n下面，将利用MySQL的客户端程序，分别测试几种隔离级别。测试数据库为test，表为tx；\n表结构：\n\n```sql\nCREATE TABLE `tx` (\n  `id` int(10) NOT NULL AUTO_INCREMENT,\n  `num` int(10) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB\n```\n\n两个命令行客户端分别为A，B；不断改变A的隔离级别，在B端修改数据。\n\n以下每次测试前初始数据为：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n```\n\n（一）、将A的隔离级别设置为read uncommitted(未提交读)\n * 在B未更新数据之前：\n客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> select @@tx_isolation;\n+------------------+\n| @@tx_isolation   |\n+------------------+\n| READ-UNCOMMITTED |\n+------------------+\n1 row in set (0.00 sec)\n\nmysql>\n\n```\n* B更新数据：\n客户端B：\n```sql\nmysql> select @@tx_isolation;\n+-----------------+\n| @@tx_isolation  |\n+-----------------+\n| REPEATABLE-READ |\n+-----------------+\n1 row in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> update tx set num=10 where id=3;\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n\n这个时候查看A客户端的数据:\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n客户端B的事务没有进行commit，但是已经可以在A客户端查看到更新的数据，这个时候就出现了`脏读`\n\n接下来将B事务进行回滚\n\n```sql\nmysql> rollback;\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n\n再进行查看A客户端的数据\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n\n\t\t经过上面的实验可以得出结论，事务B更新了一条记录，但是没有提交，此时事务A可以查询出未提交记录。造成脏读现象。未提交读是最低的隔离级别。\n\n（二）、将客户端A的事务隔离级别设置为read committed(已提交读)\n\n```sql\nmysql> SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql>\n```\n 在B未更新数据之前：\n客户端A：\n```sql\nmysql> select @@tx_isolation;\n+----------------+\n| @@tx_isolation |\n+----------------+\n| READ-COMMITTED |\n+----------------+\n1 row in set (0.00 sec)\n\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql>\n```\n\nB更新数据：\n客户端B：\n```sql\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> update tx set num=10 where id=3;\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n这个时候查看客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n接下来我们commit事务，然后查询A数据，发现能够查询到数据了（但是A还没有commit）：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n       经过上面的实验可以得出结论，已提交读隔离级别解决了脏读的问题，但是出现了不可重复读的问题，即事务A在两次查询的数据不一致，因为在两次查询之间事务B更新了一条数据。已提交读只允许读取已提交的记录，但不要求可重复读。\n(三)、将A的隔离级别设置为repeatable read(可重复读)\n 在B未更新数据之前：\n客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\n```\nB更新数据：\n客户端B：\n```sql\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> update tx set num=10 where id=3;\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n```\n客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\nB插入数据：\n客户端B：\n```sql\nmysql> insert tx set num = 5;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n|  5 |    5 |\n+----+------+\n5 rows in set (0.00 sec)\n\nmysql>\n```\n客户端A：\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n```\n\n       由以上的实验可以得出结论，可重复读隔离级别只允许读取已提交记录，而且在一个事务两次读取一个记录期间，其他事务部的更新该记录。但该事务不要求与其他事务可串行化。例如，当一个事务可以找到由一个已提交事务更新的记录，但是可能产生幻读问题(注意Mysql的InnoDB 和 Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题)。\n\n(四)、将A的隔离级别设置为 可串行化 (Serializable)\nA端打开事务，B端插入一条记录\n事务A端：\n```sql\nmysql> SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql>\n```\n事务B端：\n```sql\nmysql> update tx set num=10 where id=3;\nQuery OK, 1 row affected (0.01 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n\t\t此时客户端B是可以修改数据的，（因为A还没有指定哪张表）\n接下来，我们使用A查询下表，然后使用B更新下数据\n客户端A\n```sql\nmysql> select * from test.tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |   10 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n\nmysql>\n```\n然后使用B客户端，进行更新数据:\n```sql\nmysql> update tx set num=3 where id=3;\nERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction\nmysql>\n\n```\n\t\t因为此时事务A的隔离级别设置为serializable，开始事务后，并没有提交，所以事务B只能等待。\n事务A提交事务：\n事务A端\n```sql\nmysql> commit;\nQuery OK, 0 rows affected (0.00 sec)\n```\n事务B端\n```sql\nmysql> update tx set num=3 where id=3;\nQuery OK, 1 row affected (0.01 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select * from tx;\n+----+------+\n| id | num  |\n+----+------+\n|  1 |    1 |\n|  2 |    2 |\n|  3 |    3 |\n|  4 |    4 |\n+----+------+\n4 rows in set (0.00 sec)\n```\n      \n\t\tserializable完全锁定字段，若一个事务来查询同一份数据就必须等待，直到前一个事务完成并解除锁定为止 。是完整的隔离级别，会锁定对应的数据表格，因而会有效率的问题。\n","slug":"MySQL事务隔离级别详解","published":1,"updated":"2017-06-02T06:20:18.776Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31l000f0oqmov2987hl","content":"<h4 id=\"四种隔离级别的解释\"><a href=\"#四种隔离级别的解释\" class=\"headerlink\" title=\"四种隔离级别的解释\"></a>四种隔离级别的解释</h4><p>SQL标准定义了4类隔离级别，包括了一些具体规则，用来限定事务内外的哪些改变是可见的，哪些是不可见的。低级别的隔离级一般支持更高的并发处理，并拥有更低的系统开销。</p>\n<ul>\n<li>Read Uncommitted（读取未提交内容）</li>\n</ul>\n<p>在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。本隔离级别很少用于实际应用，因为它的性能也不比其他级别好多少。读取未提交的数据，也被称之为<strong>脏读（Dirty Read</strong>）。</p>\n<ul>\n<li>Read Committed（读取提交内容）</li>\n</ul>\n<p>这是大多数数据库系统的默认隔离级别（但不是MySQL默认的）。它满足了隔离的简单定义：一个事务只能看见已经提交事务所做的改变。这种隔离级别 也支持所谓的<strong>不可重复读（Nonrepeatable Read</strong>），因为同一事务的其他实例在该实例处理其间可能会有新的commit，所以同一select可能返回不同结果。</p>\n<ul>\n<li>Repeatable Read（可重读）</li>\n</ul>\n<p><strong>这是MySQL的默认事务隔离级别</strong>，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行。不过理论上，这会导致另一个棘手的问题：<strong>幻读 （Phantom Read</strong>）。简单的说，幻读指当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影” 行。<strong>InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题</strong>。</p>\n<ul>\n<li>Serializable（可串行化） </li>\n</ul>\n<p>这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之，它是在每个读的数据行上加上共享锁。在这个级别，可能导致大量的超时现象和锁竞争。</p>\n<h4 id=\"不同隔离级别带来的问题\"><a href=\"#不同隔离级别带来的问题\" class=\"headerlink\" title=\"不同隔离级别带来的问题\"></a>不同隔离级别带来的问题</h4><p>这四种隔离级别采取不同的锁类型来实现，若读取的是同一个数据的话，就容易发生问题。例如：</p>\n<p><strong>脏读(Drity Read)</strong>：某个事务已更新一份数据，另一个事务在此时读取了同一份数据，由于某些原因，前一个RollBack了操作，则后一个事务所读取的数据就会是不正确的。</p>\n<p><strong>不可重复读(Non-repeatable read)</strong>:在一个事务的两次查询之中数据不一致，这可能是两次查询过程中间插入了一个事务更新的原有的数据。</p>\n<p><strong>幻读(Phantom Read)</strong>:在一个事务的两次查询中数据行数不一致，例如有一个事务查询了几列行Row)数据，而另一个事务却在此时插入了新的几行数据，先前的事务在接下来的查询中，就会发现有几行数据是它先前所没有的。 （Mysql的InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题。）</p>\n<p>在MySQL中，实现了这四种隔离级别，分别有可能产生问题如下所示：<br><img src=\"/img/a.jpg\" alt=\"Alt text\"></p>\n<h4 id=\"MySQL-中如何更新事务级别\"><a href=\"#MySQL-中如何更新事务级别\" class=\"headerlink\" title=\"MySQL 中如何更新事务级别:\"></a>MySQL 中如何更新事务级别:</h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">SELECT @@GLOBAL.tx_isolation, @@tx_isolation;</div><div class=\"line\">SET GLOBAL tx_isolation=&apos;REPEATABLE-READ&apos;;</div><div class=\"line\">SET SESSION tx_isolation=&apos;SERIALIZABLE&apos;;</div><div class=\"line\"></div><div class=\"line\">or</div><div class=\"line\"></div><div class=\"line\">SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</div><div class=\"line\">SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE</div><div class=\"line\">SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ</div><div class=\"line\"></div><div class=\"line\">整个语法是：</div><div class=\"line\"></div><div class=\"line\">SET [GLOBAL | SESSION] TRANSACTION</div><div class=\"line\">    transaction_characteristic [, transaction_characteristic] ...</div><div class=\"line\"></div><div class=\"line\">transaction_characteristic:</div><div class=\"line\">    ISOLATION LEVEL level</div><div class=\"line\">  | READ WRITE</div><div class=\"line\">  | READ ONLY</div><div class=\"line\"></div><div class=\"line\">level:</div><div class=\"line\">     REPEATABLE READ</div><div class=\"line\">   | READ COMMITTED</div><div class=\"line\">   | READ UNCOMMITTED</div><div class=\"line\">   | SERIALIZABLE</div></pre></td></tr></table></figure>\n<p><code>但是两种修改方式效果是不一样的</code></p>\n<p><img src=\"/img/1.png\" alt=\"Alt text\"></p>\n<p>举例子：mysql打开两个客户端A、B，在A客户端修改事务隔离</p>\n<blockquote>\n<p>使用global 修改，那么A和B下次重新登录的时候显示修改后的效果<br>使用session形式的设置，当前的会话会立即生效，重新登录后不会生效</p>\n</blockquote>\n<p>详见: MySQL 官方文档: <a href=\"http://dev.mysql.com/doc/refman/5.0/en/set-transaction.html\" target=\"_blank\" rel=\"external\">http://dev.mysql.com/doc/refman/5.0/en/set-transaction.html</a></p>\n<h4 id=\"实验\"><a href=\"#实验\" class=\"headerlink\" title=\"实验\"></a>实验</h4><p>下面，将利用MySQL的客户端程序，分别测试几种隔离级别。测试数据库为test，表为tx；<br>表结构：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`tx`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT,</div><div class=\"line\">  <span class=\"string\">`num`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span></div></pre></td></tr></table></figure>\n<p>两个命令行客户端分别为A，B；不断改变A的隔离级别，在B端修改数据。</p>\n<p>以下每次测试前初始数据为：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>\n<p>（一）、将A的隔离级别设置为read uncommitted(未提交读)</p>\n<ul>\n<li>在B未更新数据之前：<br>客户端A：<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select @@tx_isolation;</div><div class=\"line\">+------------------+</div><div class=\"line\">| @@tx_isolation   |</div><div class=\"line\">+------------------+</div><div class=\"line\">| READ-UNCOMMITTED |</div><div class=\"line\">+------------------+</div><div class=\"line\">1 row in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li>B更新数据：<br>客户端B：<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select @@tx_isolation;</div><div class=\"line\">+-----------------+</div><div class=\"line\">| @@tx_isolation  |</div><div class=\"line\">+-----------------+</div><div class=\"line\">| REPEATABLE-READ |</div><div class=\"line\">+-----------------+</div><div class=\"line\">1 row in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; update tx set num=10 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.00 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这个时候查看A客户端的数据:<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>客户端B的事务没有进行commit，但是已经可以在A客户端查看到更新的数据，这个时候就出现了<code>脏读</code></p>\n<p>接下来将B事务进行回滚</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; rollback;</div><div class=\"line\">Query OK, 0 rows affected (0.01 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure>\n<p>再进行查看A客户端的数据<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<pre><code>经过上面的实验可以得出结论，事务B更新了一条记录，但是没有提交，此时事务A可以查询出未提交记录。造成脏读现象。未提交读是最低的隔离级别。\n</code></pre><p>（二）、将客户端A的事务隔离级别设置为read committed(已提交读)</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure>\n<p> 在B未更新数据之前：<br>客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select @@tx_isolation;</div><div class=\"line\">+----------------+</div><div class=\"line\">| @@tx_isolation |</div><div class=\"line\">+----------------+</div><div class=\"line\">| READ-COMMITTED |</div><div class=\"line\">+----------------+</div><div class=\"line\">1 row in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>B更新数据：<br>客户端B：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; update tx set num=10 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.00 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>这个时候查看客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>接下来我们commit事务，然后查询A数据，发现能够查询到数据了（但是A还没有commit）：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<pre><code>经过上面的实验可以得出结论，已提交读隔离级别解决了脏读的问题，但是出现了不可重复读的问题，即事务A在两次查询的数据不一致，因为在两次查询之间事务B更新了一条数据。已提交读只允许读取已提交的记录，但不要求可重复读。\n</code></pre><p>(三)、将A的隔离级别设置为repeatable read(可重复读)<br> 在B未更新数据之前：<br>客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure></p>\n<p>B更新数据：<br>客户端B：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; update tx set num=10 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.00 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>\n<p>客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>B插入数据：<br>客户端B：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; insert tx set num = 5;</div><div class=\"line\">Query OK, 1 row affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">|  5 |    5 |</div><div class=\"line\">+----+------+</div><div class=\"line\">5 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>\n<pre><code>由以上的实验可以得出结论，可重复读隔离级别只允许读取已提交记录，而且在一个事务两次读取一个记录期间，其他事务部的更新该记录。但该事务不要求与其他事务可串行化。例如，当一个事务可以找到由一个已提交事务更新的记录，但是可能产生幻读问题(注意Mysql的InnoDB 和 Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题)。\n</code></pre><p>(四)、将A的隔离级别设置为 可串行化 (Serializable)<br>A端打开事务，B端插入一条记录<br>事务A端：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>事务B端：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; update tx set num=10 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.01 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<pre><code>此时客户端B是可以修改数据的，（因为A还没有指定哪张表）\n</code></pre><p>接下来，我们使用A查询下表，然后使用B更新下数据<br>客户端A<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>然后使用B客户端，进行更新数据:<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; update tx set num=3 where id=3;</div><div class=\"line\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<pre><code>因为此时事务A的隔离级别设置为serializable，开始事务后，并没有提交，所以事务B只能等待。\n</code></pre><p>事务A提交事务：<br>事务A端<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; commit;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure></p>\n<p>事务B端<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; update tx set num=3 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.01 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>\n<pre><code>serializable完全锁定字段，若一个事务来查询同一份数据就必须等待，直到前一个事务完成并解除锁定为止 。是完整的隔离级别，会锁定对应的数据表格，因而会有效率的问题。\n</code></pre>","excerpt":"","more":"<h4 id=\"四种隔离级别的解释\"><a href=\"#四种隔离级别的解释\" class=\"headerlink\" title=\"四种隔离级别的解释\"></a>四种隔离级别的解释</h4><p>SQL标准定义了4类隔离级别，包括了一些具体规则，用来限定事务内外的哪些改变是可见的，哪些是不可见的。低级别的隔离级一般支持更高的并发处理，并拥有更低的系统开销。</p>\n<ul>\n<li>Read Uncommitted（读取未提交内容）</li>\n</ul>\n<p>在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。本隔离级别很少用于实际应用，因为它的性能也不比其他级别好多少。读取未提交的数据，也被称之为<strong>脏读（Dirty Read</strong>）。</p>\n<ul>\n<li>Read Committed（读取提交内容）</li>\n</ul>\n<p>这是大多数数据库系统的默认隔离级别（但不是MySQL默认的）。它满足了隔离的简单定义：一个事务只能看见已经提交事务所做的改变。这种隔离级别 也支持所谓的<strong>不可重复读（Nonrepeatable Read</strong>），因为同一事务的其他实例在该实例处理其间可能会有新的commit，所以同一select可能返回不同结果。</p>\n<ul>\n<li>Repeatable Read（可重读）</li>\n</ul>\n<p><strong>这是MySQL的默认事务隔离级别</strong>，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行。不过理论上，这会导致另一个棘手的问题：<strong>幻读 （Phantom Read</strong>）。简单的说，幻读指当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影” 行。<strong>InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题</strong>。</p>\n<ul>\n<li>Serializable（可串行化） </li>\n</ul>\n<p>这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之，它是在每个读的数据行上加上共享锁。在这个级别，可能导致大量的超时现象和锁竞争。</p>\n<h4 id=\"不同隔离级别带来的问题\"><a href=\"#不同隔离级别带来的问题\" class=\"headerlink\" title=\"不同隔离级别带来的问题\"></a>不同隔离级别带来的问题</h4><p>这四种隔离级别采取不同的锁类型来实现，若读取的是同一个数据的话，就容易发生问题。例如：</p>\n<p><strong>脏读(Drity Read)</strong>：某个事务已更新一份数据，另一个事务在此时读取了同一份数据，由于某些原因，前一个RollBack了操作，则后一个事务所读取的数据就会是不正确的。</p>\n<p><strong>不可重复读(Non-repeatable read)</strong>:在一个事务的两次查询之中数据不一致，这可能是两次查询过程中间插入了一个事务更新的原有的数据。</p>\n<p><strong>幻读(Phantom Read)</strong>:在一个事务的两次查询中数据行数不一致，例如有一个事务查询了几列行Row)数据，而另一个事务却在此时插入了新的几行数据，先前的事务在接下来的查询中，就会发现有几行数据是它先前所没有的。 （Mysql的InnoDB和Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题。）</p>\n<p>在MySQL中，实现了这四种隔离级别，分别有可能产生问题如下所示：<br><img src=\"/img/a.jpg\" alt=\"Alt text\"></p>\n<h4 id=\"MySQL-中如何更新事务级别\"><a href=\"#MySQL-中如何更新事务级别\" class=\"headerlink\" title=\"MySQL 中如何更新事务级别:\"></a>MySQL 中如何更新事务级别:</h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">SELECT @@GLOBAL.tx_isolation, @@tx_isolation;</div><div class=\"line\">SET GLOBAL tx_isolation=&apos;REPEATABLE-READ&apos;;</div><div class=\"line\">SET SESSION tx_isolation=&apos;SERIALIZABLE&apos;;</div><div class=\"line\"></div><div class=\"line\">or</div><div class=\"line\"></div><div class=\"line\">SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</div><div class=\"line\">SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE</div><div class=\"line\">SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ</div><div class=\"line\"></div><div class=\"line\">整个语法是：</div><div class=\"line\"></div><div class=\"line\">SET [GLOBAL | SESSION] TRANSACTION</div><div class=\"line\">    transaction_characteristic [, transaction_characteristic] ...</div><div class=\"line\"></div><div class=\"line\">transaction_characteristic:</div><div class=\"line\">    ISOLATION LEVEL level</div><div class=\"line\">  | READ WRITE</div><div class=\"line\">  | READ ONLY</div><div class=\"line\"></div><div class=\"line\">level:</div><div class=\"line\">     REPEATABLE READ</div><div class=\"line\">   | READ COMMITTED</div><div class=\"line\">   | READ UNCOMMITTED</div><div class=\"line\">   | SERIALIZABLE</div></pre></td></tr></table></figure>\n<p><code>但是两种修改方式效果是不一样的</code></p>\n<p><img src=\"/img/1.png\" alt=\"Alt text\"></p>\n<p>举例子：mysql打开两个客户端A、B，在A客户端修改事务隔离</p>\n<blockquote>\n<p>使用global 修改，那么A和B下次重新登录的时候显示修改后的效果<br>使用session形式的设置，当前的会话会立即生效，重新登录后不会生效</p>\n</blockquote>\n<p>详见: MySQL 官方文档: <a href=\"http://dev.mysql.com/doc/refman/5.0/en/set-transaction.html\">http://dev.mysql.com/doc/refman/5.0/en/set-transaction.html</a></p>\n<h4 id=\"实验\"><a href=\"#实验\" class=\"headerlink\" title=\"实验\"></a>实验</h4><p>下面，将利用MySQL的客户端程序，分别测试几种隔离级别。测试数据库为test，表为tx；<br>表结构：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`tx`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT,</div><div class=\"line\">  <span class=\"string\">`num`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span></div></pre></td></tr></table></figure>\n<p>两个命令行客户端分别为A，B；不断改变A的隔离级别，在B端修改数据。</p>\n<p>以下每次测试前初始数据为：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>\n<p>（一）、将A的隔离级别设置为read uncommitted(未提交读)</p>\n<ul>\n<li>在B未更新数据之前：<br>客户端A：<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select @@tx_isolation;</div><div class=\"line\">+------------------+</div><div class=\"line\">| @@tx_isolation   |</div><div class=\"line\">+------------------+</div><div class=\"line\">| READ-UNCOMMITTED |</div><div class=\"line\">+------------------+</div><div class=\"line\">1 row in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li>B更新数据：<br>客户端B：<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select @@tx_isolation;</div><div class=\"line\">+-----------------+</div><div class=\"line\">| @@tx_isolation  |</div><div class=\"line\">+-----------------+</div><div class=\"line\">| REPEATABLE-READ |</div><div class=\"line\">+-----------------+</div><div class=\"line\">1 row in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; update tx set num=10 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.00 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>这个时候查看A客户端的数据:<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>客户端B的事务没有进行commit，但是已经可以在A客户端查看到更新的数据，这个时候就出现了<code>脏读</code></p>\n<p>接下来将B事务进行回滚</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; rollback;</div><div class=\"line\">Query OK, 0 rows affected (0.01 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure>\n<p>再进行查看A客户端的数据<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<pre><code>经过上面的实验可以得出结论，事务B更新了一条记录，但是没有提交，此时事务A可以查询出未提交记录。造成脏读现象。未提交读是最低的隔离级别。\n</code></pre><p>（二）、将客户端A的事务隔离级别设置为read committed(已提交读)</p>\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure>\n<p> 在B未更新数据之前：<br>客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select @@tx_isolation;</div><div class=\"line\">+----------------+</div><div class=\"line\">| @@tx_isolation |</div><div class=\"line\">+----------------+</div><div class=\"line\">| READ-COMMITTED |</div><div class=\"line\">+----------------+</div><div class=\"line\">1 row in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>B更新数据：<br>客户端B：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; update tx set num=10 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.00 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>这个时候查看客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>接下来我们commit事务，然后查询A数据，发现能够查询到数据了（但是A还没有commit）：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<pre><code>经过上面的实验可以得出结论，已提交读隔离级别解决了脏读的问题，但是出现了不可重复读的问题，即事务A在两次查询的数据不一致，因为在两次查询之间事务B更新了一条数据。已提交读只允许读取已提交的记录，但不要求可重复读。\n</code></pre><p>(三)、将A的隔离级别设置为repeatable read(可重复读)<br> 在B未更新数据之前：<br>客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure></p>\n<p>B更新数据：<br>客户端B：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; update tx set num=10 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.00 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>\n<p>客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>B插入数据：<br>客户端B：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; insert tx set num = 5;</div><div class=\"line\">Query OK, 1 row affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">|  5 |    5 |</div><div class=\"line\">+----+------+</div><div class=\"line\">5 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>客户端A：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>\n<pre><code>由以上的实验可以得出结论，可重复读隔离级别只允许读取已提交记录，而且在一个事务两次读取一个记录期间，其他事务部的更新该记录。但该事务不要求与其他事务可串行化。例如，当一个事务可以找到由一个已提交事务更新的记录，但是可能产生幻读问题(注意Mysql的InnoDB 和 Falcon存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）机制解决了该问题)。\n</code></pre><p>(四)、将A的隔离级别设置为 可串行化 (Serializable)<br>A端打开事务，B端插入一条记录<br>事务A端：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt; start transaction;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>事务B端：<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; update tx set num=10 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.01 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<pre><code>此时客户端B是可以修改数据的，（因为A还没有指定哪张表）\n</code></pre><p>接下来，我们使用A查询下表，然后使用B更新下数据<br>客户端A<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; select * from test.tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |   10 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div><div class=\"line\"></div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<p>然后使用B客户端，进行更新数据:<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; update tx set num=3 where id=3;</div><div class=\"line\">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</div><div class=\"line\">mysql&gt;</div></pre></td></tr></table></figure></p>\n<pre><code>因为此时事务A的隔离级别设置为serializable，开始事务后，并没有提交，所以事务B只能等待。\n</code></pre><p>事务A提交事务：<br>事务A端<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; commit;</div><div class=\"line\">Query OK, 0 rows affected (0.00 sec)</div></pre></td></tr></table></figure></p>\n<p>事务B端<br><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">mysql&gt; update tx set num=3 where id=3;</div><div class=\"line\">Query OK, 1 row affected (0.01 sec)</div><div class=\"line\">Rows matched: 1  Changed: 1  Warnings: 0</div><div class=\"line\"></div><div class=\"line\">mysql&gt; select * from tx;</div><div class=\"line\">+----+------+</div><div class=\"line\">| id | num  |</div><div class=\"line\">+----+------+</div><div class=\"line\">|  1 |    1 |</div><div class=\"line\">|  2 |    2 |</div><div class=\"line\">|  3 |    3 |</div><div class=\"line\">|  4 |    4 |</div><div class=\"line\">+----+------+</div><div class=\"line\">4 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>\n<pre><code>serializable完全锁定字段，若一个事务来查询同一份数据就必须等待，直到前一个事务完成并解除锁定为止 。是完整的隔离级别，会锁定对应的数据表格，因而会有效率的问题。\n</code></pre>"},{"title":"NodeJs 多语言包","date":"2016-07-26T11:00:00.000Z","_content":"### NodeJs实现多语言包\n\n公司的项目是PHP CI ( CodeIgniter ) 框架，框架有很多功能，可以切换多种语言包，Chinese/English。今天接到新需求，原有的Nodejs项目，也要实现多语言问题，在网上找到好多资料，也没有找到有用的。后来就在[Github](https://github.com)找了找资源，废了九牛二虎之力终于找到了。\n\n#### 1) 安装语言包langs\n\n命令和安装express差不多：\n\n```bash\n$ npm install langs --save\n```\n\n#### 2) 引入拓展\n\n```bash\nvar langs = require('langs');\n```\n\n#### 3) 获取url参数，根据参数判断语言类别\n\n```bash\nexports.index = function (req, res, next) { \n\tvar query = req.query;\n\tvar lang = query.lang;\n\tvar user_id = query.user_id;\n\tvar token = query.token;\n\tif (lang == 'chinese') {\n\t\tvar lang = langs.where(\"name\", \"Chinese\");\n\t} else {\n\t\tvar lang = langs.where(\"name\", \"English\");\n\t}\n\tres.render('index', {json_data});\n}\n```\n\n#### 4) 具体语言配置在 node_modules/langs/data.json 中配置\n\n#### 5) 拓展位置[nodejs-langs](https://github.com/adlawson/nodejs-langs)\n","source":"_posts/NodeJs-多语言包.md","raw":"---\ntitle: NodeJs 多语言包\ndate: 2016-07-26 19:00:00\ntags: Nodejs\ncategories: NodeJs\n---\n### NodeJs实现多语言包\n\n公司的项目是PHP CI ( CodeIgniter ) 框架，框架有很多功能，可以切换多种语言包，Chinese/English。今天接到新需求，原有的Nodejs项目，也要实现多语言问题，在网上找到好多资料，也没有找到有用的。后来就在[Github](https://github.com)找了找资源，废了九牛二虎之力终于找到了。\n\n#### 1) 安装语言包langs\n\n命令和安装express差不多：\n\n```bash\n$ npm install langs --save\n```\n\n#### 2) 引入拓展\n\n```bash\nvar langs = require('langs');\n```\n\n#### 3) 获取url参数，根据参数判断语言类别\n\n```bash\nexports.index = function (req, res, next) { \n\tvar query = req.query;\n\tvar lang = query.lang;\n\tvar user_id = query.user_id;\n\tvar token = query.token;\n\tif (lang == 'chinese') {\n\t\tvar lang = langs.where(\"name\", \"Chinese\");\n\t} else {\n\t\tvar lang = langs.where(\"name\", \"English\");\n\t}\n\tres.render('index', {json_data});\n}\n```\n\n#### 4) 具体语言配置在 node_modules/langs/data.json 中配置\n\n#### 5) 拓展位置[nodejs-langs](https://github.com/adlawson/nodejs-langs)\n","slug":"NodeJs-多语言包","published":1,"updated":"2016-07-29T07:18:16.452Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31n000k0oqm74e9vpoo","content":"<h3 id=\"NodeJs实现多语言包\"><a href=\"#NodeJs实现多语言包\" class=\"headerlink\" title=\"NodeJs实现多语言包\"></a>NodeJs实现多语言包</h3><p>公司的项目是PHP CI ( CodeIgniter ) 框架，框架有很多功能，可以切换多种语言包，Chinese/English。今天接到新需求，原有的Nodejs项目，也要实现多语言问题，在网上找到好多资料，也没有找到有用的。后来就在<a href=\"https://github.com\" target=\"_blank\" rel=\"external\">Github</a>找了找资源，废了九牛二虎之力终于找到了。</p>\n<h4 id=\"1-安装语言包langs\"><a href=\"#1-安装语言包langs\" class=\"headerlink\" title=\"1) 安装语言包langs\"></a>1) 安装语言包langs</h4><p>命令和安装express差不多：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ npm install langs --save</div></pre></td></tr></table></figure>\n<h4 id=\"2-引入拓展\"><a href=\"#2-引入拓展\" class=\"headerlink\" title=\"2) 引入拓展\"></a>2) 引入拓展</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">var langs = require(<span class=\"string\">'langs'</span>);</div></pre></td></tr></table></figure>\n<h4 id=\"3-获取url参数，根据参数判断语言类别\"><a href=\"#3-获取url参数，根据参数判断语言类别\" class=\"headerlink\" title=\"3) 获取url参数，根据参数判断语言类别\"></a>3) 获取url参数，根据参数判断语言类别</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">exports.index = <span class=\"keyword\">function</span> (req, res, next) &#123; </div><div class=\"line\">\tvar query = req.query;</div><div class=\"line\">\tvar lang = query.lang;</div><div class=\"line\">\tvar user_id = query.user_id;</div><div class=\"line\">\tvar token = query.token;</div><div class=\"line\">\t<span class=\"keyword\">if</span> (lang == <span class=\"string\">'chinese'</span>) &#123;</div><div class=\"line\">\t\tvar lang = langs.where(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"Chinese\"</span>);</div><div class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\tvar lang = langs.where(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"English\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tres.render(<span class=\"string\">'index'</span>, &#123;json_data&#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"4-具体语言配置在-node-modules-langs-data-json-中配置\"><a href=\"#4-具体语言配置在-node-modules-langs-data-json-中配置\" class=\"headerlink\" title=\"4) 具体语言配置在 node_modules/langs/data.json 中配置\"></a>4) 具体语言配置在 node_modules/langs/data.json 中配置</h4><h4 id=\"5-拓展位置nodejs-langs\"><a href=\"#5-拓展位置nodejs-langs\" class=\"headerlink\" title=\"5) 拓展位置nodejs-langs\"></a>5) 拓展位置<a href=\"https://github.com/adlawson/nodejs-langs\" target=\"_blank\" rel=\"external\">nodejs-langs</a></h4>","excerpt":"","more":"<h3 id=\"NodeJs实现多语言包\"><a href=\"#NodeJs实现多语言包\" class=\"headerlink\" title=\"NodeJs实现多语言包\"></a>NodeJs实现多语言包</h3><p>公司的项目是PHP CI ( CodeIgniter ) 框架，框架有很多功能，可以切换多种语言包，Chinese/English。今天接到新需求，原有的Nodejs项目，也要实现多语言问题，在网上找到好多资料，也没有找到有用的。后来就在<a href=\"https://github.com\">Github</a>找了找资源，废了九牛二虎之力终于找到了。</p>\n<h4 id=\"1-安装语言包langs\"><a href=\"#1-安装语言包langs\" class=\"headerlink\" title=\"1) 安装语言包langs\"></a>1) 安装语言包langs</h4><p>命令和安装express差不多：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ npm install langs --save</div></pre></td></tr></table></figure>\n<h4 id=\"2-引入拓展\"><a href=\"#2-引入拓展\" class=\"headerlink\" title=\"2) 引入拓展\"></a>2) 引入拓展</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">var langs = require(<span class=\"string\">'langs'</span>);</div></pre></td></tr></table></figure>\n<h4 id=\"3-获取url参数，根据参数判断语言类别\"><a href=\"#3-获取url参数，根据参数判断语言类别\" class=\"headerlink\" title=\"3) 获取url参数，根据参数判断语言类别\"></a>3) 获取url参数，根据参数判断语言类别</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">exports.index = <span class=\"keyword\">function</span> (req, res, next) &#123; </div><div class=\"line\">\tvar query = req.query;</div><div class=\"line\">\tvar lang = query.lang;</div><div class=\"line\">\tvar user_id = query.user_id;</div><div class=\"line\">\tvar token = query.token;</div><div class=\"line\">\t<span class=\"keyword\">if</span> (lang == <span class=\"string\">'chinese'</span>) &#123;</div><div class=\"line\">\t\tvar lang = langs.where(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"Chinese\"</span>);</div><div class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">\t\tvar lang = langs.where(<span class=\"string\">\"name\"</span>, <span class=\"string\">\"English\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tres.render(<span class=\"string\">'index'</span>, &#123;json_data&#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"4-具体语言配置在-node-modules-langs-data-json-中配置\"><a href=\"#4-具体语言配置在-node-modules-langs-data-json-中配置\" class=\"headerlink\" title=\"4) 具体语言配置在 node_modules/langs/data.json 中配置\"></a>4) 具体语言配置在 node_modules/langs/data.json 中配置</h4><h4 id=\"5-拓展位置nodejs-langs\"><a href=\"#5-拓展位置nodejs-langs\" class=\"headerlink\" title=\"5) 拓展位置nodejs-langs\"></a>5) 拓展位置<a href=\"https://github.com/adlawson/nodejs-langs\">nodejs-langs</a></h4>"},{"title":"NodeJs Error: Can't set headers after they are sent.怎么解决？","date":"2016-08-01T13:19:27.000Z","_content":"\n#### 从字面的意思来说：不能发送header，因为已经发送过一次了。\n\n\n#### 我的程序之所以出现这种情况，是因为多次使用`res.sent()`\n\n\n#### 原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过 `res.writeHead()` 或 `res.write()` 或 `res.end()`），你再尝试通过 `res.setHeader()` 或 `res.writeHead()` 来设置响应头时（有些方法比如 `res.redirect()` 会调用 `res.writeHead()`），就会报这个错误。\n\n\n#### 解决办法：在调用函数后面加上`return;` 终止，这样就搞定了。\n","source":"_posts/NodeJs-Error-Can-t-set-headers-after-they-are-sent-怎么解决？.md","raw":"---\ntitle: 'NodeJs Error: Can''t set headers after they are sent.怎么解决？'\ndate: 2016-08-01 21:19:27\ntags: NodeJs\ncategories: NodeJs\n---\n\n#### 从字面的意思来说：不能发送header，因为已经发送过一次了。\n\n\n#### 我的程序之所以出现这种情况，是因为多次使用`res.sent()`\n\n\n#### 原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过 `res.writeHead()` 或 `res.write()` 或 `res.end()`），你再尝试通过 `res.setHeader()` 或 `res.writeHead()` 来设置响应头时（有些方法比如 `res.redirect()` 会调用 `res.writeHead()`），就会报这个错误。\n\n\n#### 解决办法：在调用函数后面加上`return;` 终止，这样就搞定了。\n","slug":"NodeJs-Error-Can-t-set-headers-after-they-are-sent-怎么解决？","published":1,"updated":"2016-08-16T08:48:12.426Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31q000l0oqm1s1b2fxz","content":"<h4 id=\"从字面的意思来说：不能发送header，因为已经发送过一次了。\"><a href=\"#从字面的意思来说：不能发送header，因为已经发送过一次了。\" class=\"headerlink\" title=\"从字面的意思来说：不能发送header，因为已经发送过一次了。\"></a>从字面的意思来说：不能发送header，因为已经发送过一次了。</h4><h4 id=\"我的程序之所以出现这种情况，是因为多次使用res-sent\"><a href=\"#我的程序之所以出现这种情况，是因为多次使用res-sent\" class=\"headerlink\" title=\"我的程序之所以出现这种情况，是因为多次使用res.sent()\"></a>我的程序之所以出现这种情况，是因为多次使用<code>res.sent()</code></h4><h4 id=\"原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过-res-writeHead-或-res-write-或-res-end-），你再尝试通过-res-setHeader-或-res-writeHead-来设置响应头时（有些方法比如-res-redirect-会调用-res-writeHead-），就会报这个错误。\"><a href=\"#原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过-res-writeHead-或-res-write-或-res-end-），你再尝试通过-res-setHeader-或-res-writeHead-来设置响应头时（有些方法比如-res-redirect-会调用-res-writeHead-），就会报这个错误。\" class=\"headerlink\" title=\"原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过 res.writeHead() 或 res.write() 或 res.end()），你再尝试通过 res.setHeader() 或 res.writeHead() 来设置响应头时（有些方法比如 res.redirect() 会调用 res.writeHead()），就会报这个错误。\"></a>原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过 <code>res.writeHead()</code> 或 <code>res.write()</code> 或 <code>res.end()</code>），你再尝试通过 <code>res.setHeader()</code> 或 <code>res.writeHead()</code> 来设置响应头时（有些方法比如 <code>res.redirect()</code> 会调用 <code>res.writeHead()</code>），就会报这个错误。</h4><h4 id=\"解决办法：在调用函数后面加上return-终止，这样就搞定了。\"><a href=\"#解决办法：在调用函数后面加上return-终止，这样就搞定了。\" class=\"headerlink\" title=\"解决办法：在调用函数后面加上return; 终止，这样就搞定了。\"></a>解决办法：在调用函数后面加上<code>return;</code> 终止，这样就搞定了。</h4>","excerpt":"","more":"<h4 id=\"从字面的意思来说：不能发送header，因为已经发送过一次了。\"><a href=\"#从字面的意思来说：不能发送header，因为已经发送过一次了。\" class=\"headerlink\" title=\"从字面的意思来说：不能发送header，因为已经发送过一次了。\"></a>从字面的意思来说：不能发送header，因为已经发送过一次了。</h4><h4 id=\"我的程序之所以出现这种情况，是因为多次使用res-sent\"><a href=\"#我的程序之所以出现这种情况，是因为多次使用res-sent\" class=\"headerlink\" title=\"我的程序之所以出现这种情况，是因为多次使用res.sent()\"></a>我的程序之所以出现这种情况，是因为多次使用<code>res.sent()</code></h4><h4 id=\"原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过-res-writeHead-或-res-write-或-res-end-），你再尝试通过-res-setHeader-或-res-writeHead-来设置响应头时（有些方法比如-res-redirect-会调用-res-writeHead-），就会报这个错误。\"><a href=\"#原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过-res-writeHead-或-res-write-或-res-end-），你再尝试通过-res-setHeader-或-res-writeHead-来设置响应头时（有些方法比如-res-redirect-会调用-res-writeHead-），就会报这个错误。\" class=\"headerlink\" title=\"原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过 res.writeHead() 或 res.write() 或 res.end()），你再尝试通过 res.setHeader() 或 res.writeHead() 来设置响应头时（有些方法比如 res.redirect() 会调用 res.writeHead()），就会报这个错误。\"></a>原因：在处理HTTP请求时，服务器会先输出响应头，然后再输出主体内容，而一旦输出过一次响应头（比如执行过 <code>res.writeHead()</code> 或 <code>res.write()</code> 或 <code>res.end()</code>），你再尝试通过 <code>res.setHeader()</code> 或 <code>res.writeHead()</code> 来设置响应头时（有些方法比如 <code>res.redirect()</code> 会调用 <code>res.writeHead()</code>），就会报这个错误。</h4><h4 id=\"解决办法：在调用函数后面加上return-终止，这样就搞定了。\"><a href=\"#解决办法：在调用函数后面加上return-终止，这样就搞定了。\" class=\"headerlink\" title=\"解决办法：在调用函数后面加上return; 终止，这样就搞定了。\"></a>解决办法：在调用函数后面加上<code>return;</code> 终止，这样就搞定了。</h4>"},{"title":"Nginx根据端口配置虚拟主机","date":"2016-07-31T07:01:48.000Z","_content":"\n#### 1)  打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹 vhost，专门存放虚拟主机的配置文件 \n\n```nginx\n...\ninclude vhost/*.conf;\n}\n```\n\n#### 2) 在vhost文件夹，创建blog.conf\n\n> 我们根据端口进行配置\n> 配置8080端口，指向 blog文件夹\n\n```nginx \nserver {\n        listen       8080;\n        server_name  localhost:8080 ;\n        root   \"D:/blog\";\n        location / {\n            index  index.html index.htm index.php;\n        }\n        location ~ \\.php(.*)$ {\n            fastcgi_pass   127.0.0.1:9000;\n            fastcgi_index  index.php;\n            fastcgi_split_path_info  ^((?U).+\\.php)(/?.+)$;\n            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n            fastcgi_param  PATH_INFO  $fastcgi_path_info;\n            fastcgi_param  PATH_TRANSLATED  $document_root$fastcgi_path_info;\n            include        fastcgi_params;\n        }\n}\n```\n\n#### 3) 重启nginx服务，浏览器访问 http://localhost:8080","source":"_posts/Nginx配置虚拟主机.md","raw":"---\ntitle: Nginx根据端口配置虚拟主机\ndate: 2016-07-31 15:01:48\ntags: Nginx \ncategories: Linux\n---\n\n#### 1)  打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹 vhost，专门存放虚拟主机的配置文件 \n\n```nginx\n...\ninclude vhost/*.conf;\n}\n```\n\n#### 2) 在vhost文件夹，创建blog.conf\n\n> 我们根据端口进行配置\n> 配置8080端口，指向 blog文件夹\n\n```nginx \nserver {\n        listen       8080;\n        server_name  localhost:8080 ;\n        root   \"D:/blog\";\n        location / {\n            index  index.html index.htm index.php;\n        }\n        location ~ \\.php(.*)$ {\n            fastcgi_pass   127.0.0.1:9000;\n            fastcgi_index  index.php;\n            fastcgi_split_path_info  ^((?U).+\\.php)(/?.+)$;\n            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n            fastcgi_param  PATH_INFO  $fastcgi_path_info;\n            fastcgi_param  PATH_TRANSLATED  $document_root$fastcgi_path_info;\n            include        fastcgi_params;\n        }\n}\n```\n\n#### 3) 重启nginx服务，浏览器访问 http://localhost:8080","slug":"Nginx配置虚拟主机","published":1,"updated":"2016-08-16T08:47:29.771Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31u000p0oqmzqmtna49","content":"<h4 id=\"1-打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹-vhost，专门存放虚拟主机的配置文件\"><a href=\"#1-打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹-vhost，专门存放虚拟主机的配置文件\" class=\"headerlink\" title=\"1)  打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹 vhost，专门存放虚拟主机的配置文件\"></a>1)  打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹 vhost，专门存放虚拟主机的配置文件</h4><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">...</div><div class=\"line\">include vhost/*.conf;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"2-在vhost文件夹，创建blog-conf\"><a href=\"#2-在vhost文件夹，创建blog-conf\" class=\"headerlink\" title=\"2) 在vhost文件夹，创建blog.conf\"></a>2) 在vhost文件夹，创建blog.conf</h4><blockquote>\n<p>我们根据端口进行配置<br>配置8080端口，指向 blog文件夹</p>\n</blockquote>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">server</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">listen</span>       <span class=\"number\">8080</span>;</div><div class=\"line\">        <span class=\"attribute\">server_name</span>  localhost:<span class=\"number\">8080</span> ;</div><div class=\"line\">        <span class=\"attribute\">root</span>   <span class=\"string\">\"D:/blog\"</span>;</div><div class=\"line\">        <span class=\"attribute\">location</span> / &#123;</div><div class=\"line\">            <span class=\"attribute\">index</span>  index.html index.htm index.php;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"attribute\">location</span> <span class=\"regexp\">~ \\.php(.*)$</span> &#123;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_pass</span>   <span class=\"number\">127.0.0.1:9000</span>;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_index</span>  index.php;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_split_path_info</span> <span class=\"regexp\"> ^((?U).+\\.php)(/?.+)$</span>;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_param</span>  SCRIPT_FILENAME  <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_param</span>  PATH_INFO  <span class=\"variable\">$fastcgi_path_info</span>;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_param</span>  PATH_TRANSLATED  <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_path_info</span>;</div><div class=\"line\">            <span class=\"attribute\">include</span>        fastcgi_params;</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"3-重启nginx服务，浏览器访问-http-localhost-8080\"><a href=\"#3-重启nginx服务，浏览器访问-http-localhost-8080\" class=\"headerlink\" title=\"3) 重启nginx服务，浏览器访问 http://localhost:8080\"></a>3) 重启nginx服务，浏览器访问 <a href=\"http://localhost:8080\">http://localhost:8080</a></h4>","excerpt":"","more":"<h4 id=\"1-打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹-vhost，专门存放虚拟主机的配置文件\"><a href=\"#1-打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹-vhost，专门存放虚拟主机的配置文件\" class=\"headerlink\" title=\"1)  打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹 vhost，专门存放虚拟主机的配置文件\"></a>1)  打开nginx的配置文件，为了方便日后对虚拟主机进行管理，我们可以创建一个文件夹 vhost，专门存放虚拟主机的配置文件</h4><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><div class=\"line\">...</div><div class=\"line\">include vhost/*.conf;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"2-在vhost文件夹，创建blog-conf\"><a href=\"#2-在vhost文件夹，创建blog-conf\" class=\"headerlink\" title=\"2) 在vhost文件夹，创建blog.conf\"></a>2) 在vhost文件夹，创建blog.conf</h4><blockquote>\n<p>我们根据端口进行配置<br>配置8080端口，指向 blog文件夹</p>\n</blockquote>\n<figure class=\"highlight nginx\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"section\">server</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">listen</span>       <span class=\"number\">8080</span>;</div><div class=\"line\">        <span class=\"attribute\">server_name</span>  localhost:<span class=\"number\">8080</span> ;</div><div class=\"line\">        <span class=\"attribute\">root</span>   <span class=\"string\">\"D:/blog\"</span>;</div><div class=\"line\">        <span class=\"attribute\">location</span> / &#123;</div><div class=\"line\">            <span class=\"attribute\">index</span>  index.html index.htm index.php;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"attribute\">location</span> <span class=\"regexp\">~ \\.php(.*)$</span> &#123;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_pass</span>   <span class=\"number\">127.0.0.1:9000</span>;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_index</span>  index.php;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_split_path_info</span> <span class=\"regexp\"> ^((?U).+\\.php)(/?.+)$</span>;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_param</span>  SCRIPT_FILENAME  <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_param</span>  PATH_INFO  <span class=\"variable\">$fastcgi_path_info</span>;</div><div class=\"line\">            <span class=\"attribute\">fastcgi_param</span>  PATH_TRANSLATED  <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_path_info</span>;</div><div class=\"line\">            <span class=\"attribute\">include</span>        fastcgi_params;</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"3-重启nginx服务，浏览器访问-http-localhost-8080\"><a href=\"#3-重启nginx服务，浏览器访问-http-localhost-8080\" class=\"headerlink\" title=\"3) 重启nginx服务，浏览器访问 http://localhost:8080\"></a>3) 重启nginx服务，浏览器访问 <a href=\"http://localhost:8080\">http://localhost:8080</a></h4>"},{"title":"Nodejs 使用pm2实现开机自启","date":"2016-08-26T07:28:23.000Z","_content":"\n#### 公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因 `reboot` 的话，服务就挂掉了。这肯定是不允许的。so 想要写个脚本，来实现开机自启。奈何 `shell` 太渣渣，搞不定。所以在社区找到了`pm2`，可以把`nodejs`加到自启服务中。\n\n#### pm2有一些优势:\n> * 自带负载均衡功能的node应用进程管理器\n> * 可以监控应用CPU和内存情况\n> * 操作简单\n> * 非常适合IaaS结构\n\n#### pm2也有劣势:\n> * 不适合PaaS结构\n\n#### 拓展:\n> * SaaS: Software-as-a-Service 软件即服务，例如Google的Gmail，把软件做成服务\n> * IaaS: Infrastructure-as-a-Service 基础设施即服务，这是我们最常见的云端接口，网站等\n> * PaaS: Platform-as-a-Service 平台即服务，专门做平台服务，例如新浪云等\n> 详细了解参见[云服务模式：SaaS、PaaS和IaaS，哪一种适合你？](http://cloud.51cto.com/art/201107/278903.htm)\n\n#### 1、全局安装pm2\n\n```bash\n$ npm install pm2 -g\n```\n#### 2、找到项目的目录，并使用pm2启动node服务\n\n```bash\n$ cd /usr/share/nginx/wechat-iot\n$ pm2 start app.js\n[PM2] Starting app.js in fork_mode (1 instance)\n[PM2] Done.\n┌──────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐\n│ App name │ id │ mode │ pid   │ status │ restart │ uptime │ memory      │ watching │\n├──────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤\n│ app      │ 0  │ fork │ 12120 │ online │ 0       │ 0s     │ 15.863 MB   │ disabled │\n└──────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘\n Use `pm2 show <id|name>` to get more details about an app\n```\n\n#### 3、把node服务加到进程\n\n```bash\n$ pm2 startup centos #pm2 startup ubuntu\n$ pm2 save \n```\n\n#### 其他命令\n\n```bash\n$ pm2 stop app.js #停止node服务\n$ pm2 restart app.js #重启node服务\n$ pm2 delete app.js #在进程中删除\n$ pm2 status #查看状态\n$ pm2 monit #查看占用的CPU和内存\n```\n\n","source":"_posts/Nodejs-使用pm2实现开机自启.md","raw":"---\ntitle: Nodejs 使用pm2实现开机自启\ndate: 2016-08-26 15:28:23\ntags: Nodejs\ncategories: NodeJs\n---\n\n#### 公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因 `reboot` 的话，服务就挂掉了。这肯定是不允许的。so 想要写个脚本，来实现开机自启。奈何 `shell` 太渣渣，搞不定。所以在社区找到了`pm2`，可以把`nodejs`加到自启服务中。\n\n#### pm2有一些优势:\n> * 自带负载均衡功能的node应用进程管理器\n> * 可以监控应用CPU和内存情况\n> * 操作简单\n> * 非常适合IaaS结构\n\n#### pm2也有劣势:\n> * 不适合PaaS结构\n\n#### 拓展:\n> * SaaS: Software-as-a-Service 软件即服务，例如Google的Gmail，把软件做成服务\n> * IaaS: Infrastructure-as-a-Service 基础设施即服务，这是我们最常见的云端接口，网站等\n> * PaaS: Platform-as-a-Service 平台即服务，专门做平台服务，例如新浪云等\n> 详细了解参见[云服务模式：SaaS、PaaS和IaaS，哪一种适合你？](http://cloud.51cto.com/art/201107/278903.htm)\n\n#### 1、全局安装pm2\n\n```bash\n$ npm install pm2 -g\n```\n#### 2、找到项目的目录，并使用pm2启动node服务\n\n```bash\n$ cd /usr/share/nginx/wechat-iot\n$ pm2 start app.js\n[PM2] Starting app.js in fork_mode (1 instance)\n[PM2] Done.\n┌──────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐\n│ App name │ id │ mode │ pid   │ status │ restart │ uptime │ memory      │ watching │\n├──────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤\n│ app      │ 0  │ fork │ 12120 │ online │ 0       │ 0s     │ 15.863 MB   │ disabled │\n└──────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘\n Use `pm2 show <id|name>` to get more details about an app\n```\n\n#### 3、把node服务加到进程\n\n```bash\n$ pm2 startup centos #pm2 startup ubuntu\n$ pm2 save \n```\n\n#### 其他命令\n\n```bash\n$ pm2 stop app.js #停止node服务\n$ pm2 restart app.js #重启node服务\n$ pm2 delete app.js #在进程中删除\n$ pm2 status #查看状态\n$ pm2 monit #查看占用的CPU和内存\n```\n\n","slug":"Nodejs-使用pm2实现开机自启","published":1,"updated":"2016-08-26T11:14:47.292Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31v000r0oqm5qli8l7c","content":"<h4 id=\"公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因-reboot-的话，服务就挂掉了。这肯定是不允许的。so-想要写个脚本，来实现开机自启。奈何-shell-太渣渣，搞不定。所以在社区找到了pm2，可以把nodejs加到自启服务中。\"><a href=\"#公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因-reboot-的话，服务就挂掉了。这肯定是不允许的。so-想要写个脚本，来实现开机自启。奈何-shell-太渣渣，搞不定。所以在社区找到了pm2，可以把nodejs加到自启服务中。\" class=\"headerlink\" title=\"公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因 reboot 的话，服务就挂掉了。这肯定是不允许的。so 想要写个脚本，来实现开机自启。奈何 shell 太渣渣，搞不定。所以在社区找到了pm2，可以把nodejs加到自启服务中。\"></a>公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因 <code>reboot</code> 的话，服务就挂掉了。这肯定是不允许的。so 想要写个脚本，来实现开机自启。奈何 <code>shell</code> 太渣渣，搞不定。所以在社区找到了<code>pm2</code>，可以把<code>nodejs</code>加到自启服务中。</h4><h4 id=\"pm2有一些优势\"><a href=\"#pm2有一些优势\" class=\"headerlink\" title=\"pm2有一些优势:\"></a>pm2有一些优势:</h4><blockquote>\n<ul>\n<li>自带负载均衡功能的node应用进程管理器</li>\n<li>可以监控应用CPU和内存情况</li>\n<li>操作简单</li>\n<li>非常适合IaaS结构</li>\n</ul>\n</blockquote>\n<h4 id=\"pm2也有劣势\"><a href=\"#pm2也有劣势\" class=\"headerlink\" title=\"pm2也有劣势:\"></a>pm2也有劣势:</h4><blockquote>\n<ul>\n<li>不适合PaaS结构</li>\n</ul>\n</blockquote>\n<h4 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展:\"></a>拓展:</h4><blockquote>\n<ul>\n<li>SaaS: Software-as-a-Service 软件即服务，例如Google的Gmail，把软件做成服务</li>\n<li>IaaS: Infrastructure-as-a-Service 基础设施即服务，这是我们最常见的云端接口，网站等</li>\n<li>PaaS: Platform-as-a-Service 平台即服务，专门做平台服务，例如新浪云等<br>详细了解参见<a href=\"http://cloud.51cto.com/art/201107/278903.htm\" target=\"_blank\" rel=\"external\">云服务模式：SaaS、PaaS和IaaS，哪一种适合你？</a></li>\n</ul>\n</blockquote>\n<h4 id=\"1、全局安装pm2\"><a href=\"#1、全局安装pm2\" class=\"headerlink\" title=\"1、全局安装pm2\"></a>1、全局安装pm2</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ npm install pm2 -g</div></pre></td></tr></table></figure>\n<h4 id=\"2、找到项目的目录，并使用pm2启动node服务\"><a href=\"#2、找到项目的目录，并使用pm2启动node服务\" class=\"headerlink\" title=\"2、找到项目的目录，并使用pm2启动node服务\"></a>2、找到项目的目录，并使用pm2启动node服务</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">cd</span> /usr/share/nginx/wechat-iot</div><div class=\"line\">$ pm2 start app.js</div><div class=\"line\">[PM2] Starting app.js <span class=\"keyword\">in</span> fork_mode (1 instance)</div><div class=\"line\">[PM2] Done.</div><div class=\"line\">┌──────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐</div><div class=\"line\">│ App name │ id │ mode │ pid   │ status │ restart │ uptime │ memory      │ watching │</div><div class=\"line\">├──────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤</div><div class=\"line\">│ app      │ 0  │ fork │ 12120 │ online │ 0       │ 0s     │ 15.863 MB   │ disabled │</div><div class=\"line\">└──────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘</div><div class=\"line\"> Use `pm2 show &lt;id|name&gt;` to get more details about an app</div></pre></td></tr></table></figure>\n<h4 id=\"3、把node服务加到进程\"><a href=\"#3、把node服务加到进程\" class=\"headerlink\" title=\"3、把node服务加到进程\"></a>3、把node服务加到进程</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ pm2 startup centos <span class=\"comment\">#pm2 startup ubuntu</span></div><div class=\"line\">$ pm2 save</div></pre></td></tr></table></figure>\n<h4 id=\"其他命令\"><a href=\"#其他命令\" class=\"headerlink\" title=\"其他命令\"></a>其他命令</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ pm2 stop app.js <span class=\"comment\">#停止node服务</span></div><div class=\"line\">$ pm2 restart app.js <span class=\"comment\">#重启node服务</span></div><div class=\"line\">$ pm2 delete app.js <span class=\"comment\">#在进程中删除</span></div><div class=\"line\">$ pm2 status <span class=\"comment\">#查看状态</span></div><div class=\"line\">$ pm2 monit <span class=\"comment\">#查看占用的CPU和内存</span></div></pre></td></tr></table></figure>\n","excerpt":"","more":"<h4 id=\"公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因-reboot-的话，服务就挂掉了。这肯定是不允许的。so-想要写个脚本，来实现开机自启。奈何-shell-太渣渣，搞不定。所以在社区找到了pm2，可以把nodejs加到自启服务中。\"><a href=\"#公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因-reboot-的话，服务就挂掉了。这肯定是不允许的。so-想要写个脚本，来实现开机自启。奈何-shell-太渣渣，搞不定。所以在社区找到了pm2，可以把nodejs加到自启服务中。\" class=\"headerlink\" title=\"公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因 reboot 的话，服务就挂掉了。这肯定是不允许的。so 想要写个脚本，来实现开机自启。奈何 shell 太渣渣，搞不定。所以在社区找到了pm2，可以把nodejs加到自启服务中。\"></a>公司有个nodejs的云服务，但是没在开机自启的进程中，如果服务器因为某种原因 <code>reboot</code> 的话，服务就挂掉了。这肯定是不允许的。so 想要写个脚本，来实现开机自启。奈何 <code>shell</code> 太渣渣，搞不定。所以在社区找到了<code>pm2</code>，可以把<code>nodejs</code>加到自启服务中。</h4><h4 id=\"pm2有一些优势\"><a href=\"#pm2有一些优势\" class=\"headerlink\" title=\"pm2有一些优势:\"></a>pm2有一些优势:</h4><blockquote>\n<ul>\n<li>自带负载均衡功能的node应用进程管理器</li>\n<li>可以监控应用CPU和内存情况</li>\n<li>操作简单</li>\n<li>非常适合IaaS结构</li>\n</ul>\n</blockquote>\n<h4 id=\"pm2也有劣势\"><a href=\"#pm2也有劣势\" class=\"headerlink\" title=\"pm2也有劣势:\"></a>pm2也有劣势:</h4><blockquote>\n<ul>\n<li>不适合PaaS结构</li>\n</ul>\n</blockquote>\n<h4 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展:\"></a>拓展:</h4><blockquote>\n<ul>\n<li>SaaS: Software-as-a-Service 软件即服务，例如Google的Gmail，把软件做成服务</li>\n<li>IaaS: Infrastructure-as-a-Service 基础设施即服务，这是我们最常见的云端接口，网站等</li>\n<li>PaaS: Platform-as-a-Service 平台即服务，专门做平台服务，例如新浪云等<br>详细了解参见<a href=\"http://cloud.51cto.com/art/201107/278903.htm\">云服务模式：SaaS、PaaS和IaaS，哪一种适合你？</a></li>\n</ul>\n</blockquote>\n<h4 id=\"1、全局安装pm2\"><a href=\"#1、全局安装pm2\" class=\"headerlink\" title=\"1、全局安装pm2\"></a>1、全局安装pm2</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ npm install pm2 -g</div></pre></td></tr></table></figure>\n<h4 id=\"2、找到项目的目录，并使用pm2启动node服务\"><a href=\"#2、找到项目的目录，并使用pm2启动node服务\" class=\"headerlink\" title=\"2、找到项目的目录，并使用pm2启动node服务\"></a>2、找到项目的目录，并使用pm2启动node服务</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">cd</span> /usr/share/nginx/wechat-iot</div><div class=\"line\">$ pm2 start app.js</div><div class=\"line\">[PM2] Starting app.js <span class=\"keyword\">in</span> fork_mode (1 instance)</div><div class=\"line\">[PM2] Done.</div><div class=\"line\">┌──────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐</div><div class=\"line\">│ App name │ id │ mode │ pid   │ status │ restart │ uptime │ memory      │ watching │</div><div class=\"line\">├──────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤</div><div class=\"line\">│ app      │ 0  │ fork │ 12120 │ online │ 0       │ 0s     │ 15.863 MB   │ disabled │</div><div class=\"line\">└──────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘</div><div class=\"line\"> Use `pm2 show &lt;id|name&gt;` to get more details about an app</div></pre></td></tr></table></figure>\n<h4 id=\"3、把node服务加到进程\"><a href=\"#3、把node服务加到进程\" class=\"headerlink\" title=\"3、把node服务加到进程\"></a>3、把node服务加到进程</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ pm2 startup centos <span class=\"comment\">#pm2 startup ubuntu</span></div><div class=\"line\">$ pm2 save</div></pre></td></tr></table></figure>\n<h4 id=\"其他命令\"><a href=\"#其他命令\" class=\"headerlink\" title=\"其他命令\"></a>其他命令</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ pm2 stop app.js <span class=\"comment\">#停止node服务</span></div><div class=\"line\">$ pm2 restart app.js <span class=\"comment\">#重启node服务</span></div><div class=\"line\">$ pm2 delete app.js <span class=\"comment\">#在进程中删除</span></div><div class=\"line\">$ pm2 status <span class=\"comment\">#查看状态</span></div><div class=\"line\">$ pm2 monit <span class=\"comment\">#查看占用的CPU和内存</span></div></pre></td></tr></table></figure>\n"},{"title":"PHP 7 拓展编写--从hello world开始","date":"2017-05-22T13:04:40.000Z","_content":"\n##### 本文主要以PHP7为基础，学习从0开始编写PHP7 拓展，拓展的主要功能是通过拓展，实现如下代码的效果\n\n```php\n<?php\nfunction say() {\n\treturn 'hello world';\n}\necho say(); // hello world\n?>\n```\n##### 在拓展中实现say函数，输出hello world\n\n#### 第一步：生成代码\n##### PHP给我们提供了拓展的生成工具，`ext_skel`。这个工具在PHP源码的 `ext/`文件夹下面，而且在ext/文件夹下是各种拓展目录。\n\n```bash\n$ cd php_src/ext/\n$ ext_skel --extname=say\n```\n##### `--extname` 参数是设置拓展的名字。执行完这么命令后，`ext`文件夹下就会生成一个say的文件夹\n\n#### 第二步：修改config.m4配置文件\n\n##### config.m4 的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config.m4配置文件\n```bash\n$ cd say/\n$ vim config.m4\n```\n##### 打开config.m4文件，会有看到文件开头有如下内容\n```bash\ndnl If your extension references something external, use with:\n\ndnl PHP_ARG_WITH(say, for say support,\ndnl Make sure that the comment is aligned:\ndnl [  --with-say             Include say support])\n\ndnl Otherwise use enable:\n\ndnl PHP_ARG_ENABLE(say, whether to enable say support,\ndnl Make sure that the comment is aligned:\ndnl [  --enable-say           Enable say support])\n\n```\n\n##### 其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP_ARG_WITH注释内容，否则去掉PHP_ARG_ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP_ARG_ENABLE注释内容。去掉后的内容如下：\n```bash\n\ndnl If your extension references something external, use with:\n\ndnl PHP_ARG_WITH(say, for say support,\ndnl Make sure that the comment is aligned:\ndnl [  --with-say             Include say support])\n\ndnl Otherwise use enable:\n\nPHP_ARG_ENABLE(say, whether to enable say support,\nMake sure that the comment is aligned:\n[  --enable-say           Enable say support])\n```\n#### 第三步：代码实现\n##### 修改say.c代码 ，实现say方法。找到 PHP_FUNCTION(confirm_say_compiled) 方法，在上面增加如下方法：\n```bash\nPHP_FUNCTION(say)\n{\n\tzend_string *strg;\n\tstrg = strpprintf(0, \"hello world\");\n\tRETURN_STR(strg);\n}\n```\n##### 然后找到PHP_FE(confirm_say_compiled,    NULL)在上面增加PHP_FE(say, NULL) ，如果不加上这个，那么say函数将不能引用，加完后的代码如下：\n```bash\nconst zend_function_entry say_functions[] = {\n        PHP_FE(say, NULL)                       /* For testing, remove later. */\n        PHP_FE(confirm_say_compiled,    NULL)           /* For testing, remove later. */\n        PHP_FE_END      /* Must be the last line in say_functions[] */\n};\n```\n其实在zend_function_entry 上面，你会看到`Every user visible function must have an entry in say_functions[]`，意思是说每个用户的函数必须定义在say_functions函数里面，否则在PHP使用say函数的时候报出函数未定义的错误`Fatal error: Uncaught Error: Call to undefined function say()`\n\n#### 第四步：编译安装\n\n```bash\n$ phpize\n$ ./configure\n$ make && make install\n```\n##### 然后修改php.ini，在配置文件结尾加上如下代码\n可以使用`php --ini`查看配置文件的位置\n```php\n[say]\nextsion=say.so\n```\n\n##### 然后执行php -m 查看是否已经把say函数加载进来：\n```bash\n[PHP Modules]\nCore\nctype\ndate\ndom\nfileinfo\nfilter\ngd\nhash\niconv\njson\nlibxml\npcre\nPDO\npdo_sqlite\nPhar\nposix\nReflection\nsay\nsession\nSimpleXML\nSPL\nsqlite3\nstandard\ntokenizer\nxml\nxmlreader\nxmlwriter\n\n[Zend Modules]\n```\n#### 第五步：运行测试\n##### 编写PHP脚本，进行测试\n```php\n<?php\necho say();\n?>\n```\n##### 结果输出：\n```bash\n$ php test.php\n$ hello world\n```\n\n\n\n\n\n","source":"_posts/PHP-7-拓展编写-从hello-world开始.md","raw":"---\ntitle: PHP 7 拓展编写--从hello world开始\ndate: 2017-05-22 21:04:40\ntags:\n---\n\n##### 本文主要以PHP7为基础，学习从0开始编写PHP7 拓展，拓展的主要功能是通过拓展，实现如下代码的效果\n\n```php\n<?php\nfunction say() {\n\treturn 'hello world';\n}\necho say(); // hello world\n?>\n```\n##### 在拓展中实现say函数，输出hello world\n\n#### 第一步：生成代码\n##### PHP给我们提供了拓展的生成工具，`ext_skel`。这个工具在PHP源码的 `ext/`文件夹下面，而且在ext/文件夹下是各种拓展目录。\n\n```bash\n$ cd php_src/ext/\n$ ext_skel --extname=say\n```\n##### `--extname` 参数是设置拓展的名字。执行完这么命令后，`ext`文件夹下就会生成一个say的文件夹\n\n#### 第二步：修改config.m4配置文件\n\n##### config.m4 的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config.m4配置文件\n```bash\n$ cd say/\n$ vim config.m4\n```\n##### 打开config.m4文件，会有看到文件开头有如下内容\n```bash\ndnl If your extension references something external, use with:\n\ndnl PHP_ARG_WITH(say, for say support,\ndnl Make sure that the comment is aligned:\ndnl [  --with-say             Include say support])\n\ndnl Otherwise use enable:\n\ndnl PHP_ARG_ENABLE(say, whether to enable say support,\ndnl Make sure that the comment is aligned:\ndnl [  --enable-say           Enable say support])\n\n```\n\n##### 其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP_ARG_WITH注释内容，否则去掉PHP_ARG_ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP_ARG_ENABLE注释内容。去掉后的内容如下：\n```bash\n\ndnl If your extension references something external, use with:\n\ndnl PHP_ARG_WITH(say, for say support,\ndnl Make sure that the comment is aligned:\ndnl [  --with-say             Include say support])\n\ndnl Otherwise use enable:\n\nPHP_ARG_ENABLE(say, whether to enable say support,\nMake sure that the comment is aligned:\n[  --enable-say           Enable say support])\n```\n#### 第三步：代码实现\n##### 修改say.c代码 ，实现say方法。找到 PHP_FUNCTION(confirm_say_compiled) 方法，在上面增加如下方法：\n```bash\nPHP_FUNCTION(say)\n{\n\tzend_string *strg;\n\tstrg = strpprintf(0, \"hello world\");\n\tRETURN_STR(strg);\n}\n```\n##### 然后找到PHP_FE(confirm_say_compiled,    NULL)在上面增加PHP_FE(say, NULL) ，如果不加上这个，那么say函数将不能引用，加完后的代码如下：\n```bash\nconst zend_function_entry say_functions[] = {\n        PHP_FE(say, NULL)                       /* For testing, remove later. */\n        PHP_FE(confirm_say_compiled,    NULL)           /* For testing, remove later. */\n        PHP_FE_END      /* Must be the last line in say_functions[] */\n};\n```\n其实在zend_function_entry 上面，你会看到`Every user visible function must have an entry in say_functions[]`，意思是说每个用户的函数必须定义在say_functions函数里面，否则在PHP使用say函数的时候报出函数未定义的错误`Fatal error: Uncaught Error: Call to undefined function say()`\n\n#### 第四步：编译安装\n\n```bash\n$ phpize\n$ ./configure\n$ make && make install\n```\n##### 然后修改php.ini，在配置文件结尾加上如下代码\n可以使用`php --ini`查看配置文件的位置\n```php\n[say]\nextsion=say.so\n```\n\n##### 然后执行php -m 查看是否已经把say函数加载进来：\n```bash\n[PHP Modules]\nCore\nctype\ndate\ndom\nfileinfo\nfilter\ngd\nhash\niconv\njson\nlibxml\npcre\nPDO\npdo_sqlite\nPhar\nposix\nReflection\nsay\nsession\nSimpleXML\nSPL\nsqlite3\nstandard\ntokenizer\nxml\nxmlreader\nxmlwriter\n\n[Zend Modules]\n```\n#### 第五步：运行测试\n##### 编写PHP脚本，进行测试\n```php\n<?php\necho say();\n?>\n```\n##### 结果输出：\n```bash\n$ php test.php\n$ hello world\n```\n\n\n\n\n\n","slug":"PHP-7-拓展编写-从hello-world开始","published":1,"updated":"2017-05-22T13:05:12.235Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31x000v0oqmh7ei3arb","content":"<h5 id=\"本文主要以PHP7为基础，学习从0开始编写PHP7-拓展，拓展的主要功能是通过拓展，实现如下代码的效果\"><a href=\"#本文主要以PHP7为基础，学习从0开始编写PHP7-拓展，拓展的主要功能是通过拓展，实现如下代码的效果\" class=\"headerlink\" title=\"本文主要以PHP7为基础，学习从0开始编写PHP7 拓展，拓展的主要功能是通过拓展，实现如下代码的效果\"></a>本文主要以PHP7为基础，学习从0开始编写PHP7 拓展，拓展的主要功能是通过拓展，实现如下代码的效果</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">'hello world'</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">echo</span> say(); <span class=\"comment\">// hello world</span></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h5 id=\"在拓展中实现say函数，输出hello-world\"><a href=\"#在拓展中实现say函数，输出hello-world\" class=\"headerlink\" title=\"在拓展中实现say函数，输出hello world\"></a>在拓展中实现say函数，输出hello world</h5><h4 id=\"第一步：生成代码\"><a href=\"#第一步：生成代码\" class=\"headerlink\" title=\"第一步：生成代码\"></a>第一步：生成代码</h4><h5 id=\"PHP给我们提供了拓展的生成工具，ext-skel。这个工具在PHP源码的-ext-文件夹下面，而且在ext-文件夹下是各种拓展目录。\"><a href=\"#PHP给我们提供了拓展的生成工具，ext-skel。这个工具在PHP源码的-ext-文件夹下面，而且在ext-文件夹下是各种拓展目录。\" class=\"headerlink\" title=\"PHP给我们提供了拓展的生成工具，ext_skel。这个工具在PHP源码的 ext/文件夹下面，而且在ext/文件夹下是各种拓展目录。\"></a>PHP给我们提供了拓展的生成工具，<code>ext_skel</code>。这个工具在PHP源码的 <code>ext/</code>文件夹下面，而且在ext/文件夹下是各种拓展目录。</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">cd</span> php_src/ext/</div><div class=\"line\">$ ext_skel --extname=say</div></pre></td></tr></table></figure>\n<h5 id=\"extname-参数是设置拓展的名字。执行完这么命令后，ext文件夹下就会生成一个say的文件夹\"><a href=\"#extname-参数是设置拓展的名字。执行完这么命令后，ext文件夹下就会生成一个say的文件夹\" class=\"headerlink\" title=\"--extname 参数是设置拓展的名字。执行完这么命令后，ext文件夹下就会生成一个say的文件夹\"></a><code>--extname</code> 参数是设置拓展的名字。执行完这么命令后，<code>ext</code>文件夹下就会生成一个say的文件夹</h5><h4 id=\"第二步：修改config-m4配置文件\"><a href=\"#第二步：修改config-m4配置文件\" class=\"headerlink\" title=\"第二步：修改config.m4配置文件\"></a>第二步：修改config.m4配置文件</h4><h5 id=\"config-m4-的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config-m4配置文件\"><a href=\"#config-m4-的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config-m4配置文件\" class=\"headerlink\" title=\"config.m4 的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config.m4配置文件\"></a>config.m4 的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config.m4配置文件</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">cd</span> say/</div><div class=\"line\">$ vim config.m4</div></pre></td></tr></table></figure>\n<h5 id=\"打开config-m4文件，会有看到文件开头有如下内容\"><a href=\"#打开config-m4文件，会有看到文件开头有如下内容\" class=\"headerlink\" title=\"打开config.m4文件，会有看到文件开头有如下内容\"></a>打开config.m4文件，会有看到文件开头有如下内容</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">dnl If your extension references something external, use with:</div><div class=\"line\"></div><div class=\"line\">dnl PHP_ARG_WITH(say, <span class=\"keyword\">for</span> say support,</div><div class=\"line\">dnl Make sure that the comment is aligned:</div><div class=\"line\">dnl [  --with-say             Include say support])</div><div class=\"line\"></div><div class=\"line\">dnl Otherwise use <span class=\"built_in\">enable</span>:</div><div class=\"line\"></div><div class=\"line\">dnl PHP_ARG_ENABLE(say, whether to <span class=\"built_in\">enable</span> say support,</div><div class=\"line\">dnl Make sure that the comment is aligned:</div><div class=\"line\">dnl [  --enable-say           Enable say support])</div></pre></td></tr></table></figure>\n<h5 id=\"其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP-ARG-WITH注释内容，否则去掉PHP-ARG-ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP-ARG-ENABLE注释内容。去掉后的内容如下：\"><a href=\"#其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP-ARG-WITH注释内容，否则去掉PHP-ARG-ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP-ARG-ENABLE注释内容。去掉后的内容如下：\" class=\"headerlink\" title=\"其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP_ARG_WITH注释内容，否则去掉PHP_ARG_ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP_ARG_ENABLE注释内容。去掉后的内容如下：\"></a>其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP_ARG_WITH注释内容，否则去掉PHP_ARG_ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP_ARG_ENABLE注释内容。去掉后的内容如下：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">dnl If your extension references something external, use with:</div><div class=\"line\"></div><div class=\"line\">dnl PHP_ARG_WITH(say, <span class=\"keyword\">for</span> say support,</div><div class=\"line\">dnl Make sure that the comment is aligned:</div><div class=\"line\">dnl [  --with-say             Include say support])</div><div class=\"line\"></div><div class=\"line\">dnl Otherwise use <span class=\"built_in\">enable</span>:</div><div class=\"line\"></div><div class=\"line\">PHP_ARG_ENABLE(say, whether to <span class=\"built_in\">enable</span> say support,</div><div class=\"line\">Make sure that the comment is aligned:</div><div class=\"line\">[  --enable-say           Enable say support])</div></pre></td></tr></table></figure>\n<h4 id=\"第三步：代码实现\"><a href=\"#第三步：代码实现\" class=\"headerlink\" title=\"第三步：代码实现\"></a>第三步：代码实现</h4><h5 id=\"修改say-c代码-，实现say方法。找到-PHP-FUNCTION-confirm-say-compiled-方法，在上面增加如下方法：\"><a href=\"#修改say-c代码-，实现say方法。找到-PHP-FUNCTION-confirm-say-compiled-方法，在上面增加如下方法：\" class=\"headerlink\" title=\"修改say.c代码 ，实现say方法。找到 PHP_FUNCTION(confirm_say_compiled) 方法，在上面增加如下方法：\"></a>修改say.c代码 ，实现say方法。找到 PHP_FUNCTION(confirm_say_compiled) 方法，在上面增加如下方法：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_FUNCTION(say)</div><div class=\"line\">&#123;</div><div class=\"line\">\tzend_string *strg;</div><div class=\"line\">\tstrg = strpprintf(0, <span class=\"string\">\"hello world\"</span>);</div><div class=\"line\">\tRETURN_STR(strg);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h5 id=\"然后找到PHP-FE-confirm-say-compiled-NULL-在上面增加PHP-FE-say-NULL-，如果不加上这个，那么say函数将不能引用，加完后的代码如下：\"><a href=\"#然后找到PHP-FE-confirm-say-compiled-NULL-在上面增加PHP-FE-say-NULL-，如果不加上这个，那么say函数将不能引用，加完后的代码如下：\" class=\"headerlink\" title=\"然后找到PHP_FE(confirm_say_compiled,    NULL)在上面增加PHP_FE(say, NULL) ，如果不加上这个，那么say函数将不能引用，加完后的代码如下：\"></a>然后找到PHP_FE(confirm_say_compiled,    NULL)在上面增加PHP_FE(say, NULL) ，如果不加上这个，那么say函数将不能引用，加完后的代码如下：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">const zend_<span class=\"keyword\">function</span>_entry say_<span class=\"built_in\">functions</span>[] = &#123;</div><div class=\"line\">        PHP_FE(say, NULL)                       /* For testing, remove later. */</div><div class=\"line\">        PHP_FE(confirm_say_compiled,    NULL)           /* For testing, remove later. */</div><div class=\"line\">        PHP_FE_END      /* Must be the last line <span class=\"keyword\">in</span> say_<span class=\"built_in\">functions</span>[] */</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>其实在zend_function_entry 上面，你会看到<code>Every user visible function must have an entry in say_functions[]</code>，意思是说每个用户的函数必须定义在say_functions函数里面，否则在PHP使用say函数的时候报出函数未定义的错误<code>Fatal error: Uncaught Error: Call to undefined function say()</code></p>\n<h4 id=\"第四步：编译安装\"><a href=\"#第四步：编译安装\" class=\"headerlink\" title=\"第四步：编译安装\"></a>第四步：编译安装</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ phpize</div><div class=\"line\">$ ./configure</div><div class=\"line\">$ make &amp;&amp; make install</div></pre></td></tr></table></figure>\n<h5 id=\"然后修改php-ini，在配置文件结尾加上如下代码\"><a href=\"#然后修改php-ini，在配置文件结尾加上如下代码\" class=\"headerlink\" title=\"然后修改php.ini，在配置文件结尾加上如下代码\"></a>然后修改php.ini，在配置文件结尾加上如下代码</h5><p>可以使用<code>php --ini</code>查看配置文件的位置<br><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">[say]</div><div class=\"line\">extsion=say.so</div></pre></td></tr></table></figure></p>\n<h5 id=\"然后执行php-m-查看是否已经把say函数加载进来：\"><a href=\"#然后执行php-m-查看是否已经把say函数加载进来：\" class=\"headerlink\" title=\"然后执行php -m 查看是否已经把say函数加载进来：\"></a>然后执行php -m 查看是否已经把say函数加载进来：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">[PHP Modules]</div><div class=\"line\">Core</div><div class=\"line\">ctype</div><div class=\"line\">date</div><div class=\"line\">dom</div><div class=\"line\">fileinfo</div><div class=\"line\">filter</div><div class=\"line\">gd</div><div class=\"line\"><span class=\"built_in\">hash</span></div><div class=\"line\">iconv</div><div class=\"line\">json</div><div class=\"line\">libxml</div><div class=\"line\">pcre</div><div class=\"line\">PDO</div><div class=\"line\">pdo_sqlite</div><div class=\"line\">Phar</div><div class=\"line\">posix</div><div class=\"line\">Reflection</div><div class=\"line\">say</div><div class=\"line\">session</div><div class=\"line\">SimpleXML</div><div class=\"line\">SPL</div><div class=\"line\">sqlite3</div><div class=\"line\">standard</div><div class=\"line\">tokenizer</div><div class=\"line\">xml</div><div class=\"line\">xmlreader</div><div class=\"line\">xmlwriter</div><div class=\"line\"></div><div class=\"line\">[Zend Modules]</div></pre></td></tr></table></figure>\n<h4 id=\"第五步：运行测试\"><a href=\"#第五步：运行测试\" class=\"headerlink\" title=\"第五步：运行测试\"></a>第五步：运行测试</h4><h5 id=\"编写PHP脚本，进行测试\"><a href=\"#编写PHP脚本，进行测试\" class=\"headerlink\" title=\"编写PHP脚本，进行测试\"></a>编写PHP脚本，进行测试</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"keyword\">echo</span> say();</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h5 id=\"结果输出：\"><a href=\"#结果输出：\" class=\"headerlink\" title=\"结果输出：\"></a>结果输出：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ php test.php</div><div class=\"line\">$ hello world</div></pre></td></tr></table></figure>\n","excerpt":"","more":"<h5 id=\"本文主要以PHP7为基础，学习从0开始编写PHP7-拓展，拓展的主要功能是通过拓展，实现如下代码的效果\"><a href=\"#本文主要以PHP7为基础，学习从0开始编写PHP7-拓展，拓展的主要功能是通过拓展，实现如下代码的效果\" class=\"headerlink\" title=\"本文主要以PHP7为基础，学习从0开始编写PHP7 拓展，拓展的主要功能是通过拓展，实现如下代码的效果\"></a>本文主要以PHP7为基础，学习从0开始编写PHP7 拓展，拓展的主要功能是通过拓展，实现如下代码的效果</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">say</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">'hello world'</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">echo</span> say(); <span class=\"comment\">// hello world</span></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h5 id=\"在拓展中实现say函数，输出hello-world\"><a href=\"#在拓展中实现say函数，输出hello-world\" class=\"headerlink\" title=\"在拓展中实现say函数，输出hello world\"></a>在拓展中实现say函数，输出hello world</h5><h4 id=\"第一步：生成代码\"><a href=\"#第一步：生成代码\" class=\"headerlink\" title=\"第一步：生成代码\"></a>第一步：生成代码</h4><h5 id=\"PHP给我们提供了拓展的生成工具，ext-skel。这个工具在PHP源码的-ext-文件夹下面，而且在ext-文件夹下是各种拓展目录。\"><a href=\"#PHP给我们提供了拓展的生成工具，ext-skel。这个工具在PHP源码的-ext-文件夹下面，而且在ext-文件夹下是各种拓展目录。\" class=\"headerlink\" title=\"PHP给我们提供了拓展的生成工具，ext_skel。这个工具在PHP源码的 ext/文件夹下面，而且在ext/文件夹下是各种拓展目录。\"></a>PHP给我们提供了拓展的生成工具，<code>ext_skel</code>。这个工具在PHP源码的 <code>ext/</code>文件夹下面，而且在ext/文件夹下是各种拓展目录。</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">cd</span> php_src/ext/</div><div class=\"line\">$ ext_skel --extname=say</div></pre></td></tr></table></figure>\n<h5 id=\"extname-参数是设置拓展的名字。执行完这么命令后，ext文件夹下就会生成一个say的文件夹\"><a href=\"#extname-参数是设置拓展的名字。执行完这么命令后，ext文件夹下就会生成一个say的文件夹\" class=\"headerlink\" title=\"--extname 参数是设置拓展的名字。执行完这么命令后，ext文件夹下就会生成一个say的文件夹\"></a><code>--extname</code> 参数是设置拓展的名字。执行完这么命令后，<code>ext</code>文件夹下就会生成一个say的文件夹</h5><h4 id=\"第二步：修改config-m4配置文件\"><a href=\"#第二步：修改config-m4配置文件\" class=\"headerlink\" title=\"第二步：修改config.m4配置文件\"></a>第二步：修改config.m4配置文件</h4><h5 id=\"config-m4-的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config-m4配置文件\"><a href=\"#config-m4-的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config-m4配置文件\" class=\"headerlink\" title=\"config.m4 的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config.m4配置文件\"></a>config.m4 的作用是为了配合phpize工具生成configure文件。configure文件是为了用于环境监测，监测编译的环境是否满足条件。现在我们开始修改config.m4配置文件</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">cd</span> say/</div><div class=\"line\">$ vim config.m4</div></pre></td></tr></table></figure>\n<h5 id=\"打开config-m4文件，会有看到文件开头有如下内容\"><a href=\"#打开config-m4文件，会有看到文件开头有如下内容\" class=\"headerlink\" title=\"打开config.m4文件，会有看到文件开头有如下内容\"></a>打开config.m4文件，会有看到文件开头有如下内容</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">dnl If your extension references something external, use with:</div><div class=\"line\"></div><div class=\"line\">dnl PHP_ARG_WITH(say, <span class=\"keyword\">for</span> say support,</div><div class=\"line\">dnl Make sure that the comment is aligned:</div><div class=\"line\">dnl [  --with-say             Include say support])</div><div class=\"line\"></div><div class=\"line\">dnl Otherwise use <span class=\"built_in\">enable</span>:</div><div class=\"line\"></div><div class=\"line\">dnl PHP_ARG_ENABLE(say, whether to <span class=\"built_in\">enable</span> say support,</div><div class=\"line\">dnl Make sure that the comment is aligned:</div><div class=\"line\">dnl [  --enable-say           Enable say support])</div></pre></td></tr></table></figure>\n<h5 id=\"其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP-ARG-WITH注释内容，否则去掉PHP-ARG-ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP-ARG-ENABLE注释内容。去掉后的内容如下：\"><a href=\"#其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP-ARG-WITH注释内容，否则去掉PHP-ARG-ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP-ARG-ENABLE注释内容。去掉后的内容如下：\" class=\"headerlink\" title=\"其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP_ARG_WITH注释内容，否则去掉PHP_ARG_ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP_ARG_ENABLE注释内容。去掉后的内容如下：\"></a>其中dnl是注释，上面的内容大概是说：如果你编写的拓展依赖其他拓展，就使用去掉PHP_ARG_WITH注释内容，否则去掉PHP_ARG_ENABLE注释内容。我们这里不需要依赖其他拓展，所以我们去掉PHP_ARG_ENABLE注释内容。去掉后的内容如下：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"></div><div class=\"line\">dnl If your extension references something external, use with:</div><div class=\"line\"></div><div class=\"line\">dnl PHP_ARG_WITH(say, <span class=\"keyword\">for</span> say support,</div><div class=\"line\">dnl Make sure that the comment is aligned:</div><div class=\"line\">dnl [  --with-say             Include say support])</div><div class=\"line\"></div><div class=\"line\">dnl Otherwise use <span class=\"built_in\">enable</span>:</div><div class=\"line\"></div><div class=\"line\">PHP_ARG_ENABLE(say, whether to <span class=\"built_in\">enable</span> say support,</div><div class=\"line\">Make sure that the comment is aligned:</div><div class=\"line\">[  --enable-say           Enable say support])</div></pre></td></tr></table></figure>\n<h4 id=\"第三步：代码实现\"><a href=\"#第三步：代码实现\" class=\"headerlink\" title=\"第三步：代码实现\"></a>第三步：代码实现</h4><h5 id=\"修改say-c代码-，实现say方法。找到-PHP-FUNCTION-confirm-say-compiled-方法，在上面增加如下方法：\"><a href=\"#修改say-c代码-，实现say方法。找到-PHP-FUNCTION-confirm-say-compiled-方法，在上面增加如下方法：\" class=\"headerlink\" title=\"修改say.c代码 ，实现say方法。找到 PHP_FUNCTION(confirm_say_compiled) 方法，在上面增加如下方法：\"></a>修改say.c代码 ，实现say方法。找到 PHP_FUNCTION(confirm_say_compiled) 方法，在上面增加如下方法：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_FUNCTION(say)</div><div class=\"line\">&#123;</div><div class=\"line\">\tzend_string *strg;</div><div class=\"line\">\tstrg = strpprintf(0, <span class=\"string\">\"hello world\"</span>);</div><div class=\"line\">\tRETURN_STR(strg);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h5 id=\"然后找到PHP-FE-confirm-say-compiled-NULL-在上面增加PHP-FE-say-NULL-，如果不加上这个，那么say函数将不能引用，加完后的代码如下：\"><a href=\"#然后找到PHP-FE-confirm-say-compiled-NULL-在上面增加PHP-FE-say-NULL-，如果不加上这个，那么say函数将不能引用，加完后的代码如下：\" class=\"headerlink\" title=\"然后找到PHP_FE(confirm_say_compiled,    NULL)在上面增加PHP_FE(say, NULL) ，如果不加上这个，那么say函数将不能引用，加完后的代码如下：\"></a>然后找到PHP_FE(confirm_say_compiled,    NULL)在上面增加PHP_FE(say, NULL) ，如果不加上这个，那么say函数将不能引用，加完后的代码如下：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">const zend_<span class=\"keyword\">function</span>_entry say_<span class=\"built_in\">functions</span>[] = &#123;</div><div class=\"line\">        PHP_FE(say, NULL)                       /* For testing, remove later. */</div><div class=\"line\">        PHP_FE(confirm_say_compiled,    NULL)           /* For testing, remove later. */</div><div class=\"line\">        PHP_FE_END      /* Must be the last line <span class=\"keyword\">in</span> say_<span class=\"built_in\">functions</span>[] */</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n<p>其实在zend_function_entry 上面，你会看到<code>Every user visible function must have an entry in say_functions[]</code>，意思是说每个用户的函数必须定义在say_functions函数里面，否则在PHP使用say函数的时候报出函数未定义的错误<code>Fatal error: Uncaught Error: Call to undefined function say()</code></p>\n<h4 id=\"第四步：编译安装\"><a href=\"#第四步：编译安装\" class=\"headerlink\" title=\"第四步：编译安装\"></a>第四步：编译安装</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ phpize</div><div class=\"line\">$ ./configure</div><div class=\"line\">$ make &amp;&amp; make install</div></pre></td></tr></table></figure>\n<h5 id=\"然后修改php-ini，在配置文件结尾加上如下代码\"><a href=\"#然后修改php-ini，在配置文件结尾加上如下代码\" class=\"headerlink\" title=\"然后修改php.ini，在配置文件结尾加上如下代码\"></a>然后修改php.ini，在配置文件结尾加上如下代码</h5><p>可以使用<code>php --ini</code>查看配置文件的位置<br><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">[say]</div><div class=\"line\">extsion=say.so</div></pre></td></tr></table></figure></p>\n<h5 id=\"然后执行php-m-查看是否已经把say函数加载进来：\"><a href=\"#然后执行php-m-查看是否已经把say函数加载进来：\" class=\"headerlink\" title=\"然后执行php -m 查看是否已经把say函数加载进来：\"></a>然后执行php -m 查看是否已经把say函数加载进来：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">[PHP Modules]</div><div class=\"line\">Core</div><div class=\"line\">ctype</div><div class=\"line\">date</div><div class=\"line\">dom</div><div class=\"line\">fileinfo</div><div class=\"line\">filter</div><div class=\"line\">gd</div><div class=\"line\"><span class=\"built_in\">hash</span></div><div class=\"line\">iconv</div><div class=\"line\">json</div><div class=\"line\">libxml</div><div class=\"line\">pcre</div><div class=\"line\">PDO</div><div class=\"line\">pdo_sqlite</div><div class=\"line\">Phar</div><div class=\"line\">posix</div><div class=\"line\">Reflection</div><div class=\"line\">say</div><div class=\"line\">session</div><div class=\"line\">SimpleXML</div><div class=\"line\">SPL</div><div class=\"line\">sqlite3</div><div class=\"line\">standard</div><div class=\"line\">tokenizer</div><div class=\"line\">xml</div><div class=\"line\">xmlreader</div><div class=\"line\">xmlwriter</div><div class=\"line\"></div><div class=\"line\">[Zend Modules]</div></pre></td></tr></table></figure>\n<h4 id=\"第五步：运行测试\"><a href=\"#第五步：运行测试\" class=\"headerlink\" title=\"第五步：运行测试\"></a>第五步：运行测试</h4><h5 id=\"编写PHP脚本，进行测试\"><a href=\"#编写PHP脚本，进行测试\" class=\"headerlink\" title=\"编写PHP脚本，进行测试\"></a>编写PHP脚本，进行测试</h5><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"keyword\">echo</span> say();</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h5 id=\"结果输出：\"><a href=\"#结果输出：\" class=\"headerlink\" title=\"结果输出：\"></a>结果输出：</h5><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ php test.php</div><div class=\"line\">$ hello world</div></pre></td></tr></table></figure>\n"},{"title":"PHP7 拓展编写--在拓展中调用函数","date":"2017-05-27T12:39:47.000Z","_content":"### PHP 7 拓展编写--在拓展中调用函数\n\n@(PHP)\n\n--------------------------------\n\n#### PHP中调用函数都比较简单，今天要实现如下效果的代码\n```php\n<?php\nclass demo {\n\tpublic function get_site_name($prefix)\n\t{\n\t\treturn $prefix . \"肥龙的博客\\n\";\n\t}\n}\n\nfunction get_site_url($prefix)\n{\n\treturn $prefix . \"www.feilong.tech\\n\";\n}\n\nfunction call_function($obj, $fun, $param)\n{\n\tif ($obj == null)\n\t{\n\t\t$result = $fun($param);\n\t}\n\telse\n\t{\n\t\t$result = $obj->$fun($param);\n\t}\n\treturn $result;\n}\n$demo = new demo();\necho call_function($demo, \"get_site_name\", \"site name:\");\necho call_function(null, \"get_site_url\", \"site url:\");\n?>\n```\n我们将要实现call_function的方法的功能\n#### 代码实现\n```cpp\nPHP_FUNCTION(call_function)\n{\n    zval            *obj = NULL;\n    zval             *fun = NULL;\n    zval             *param = NULL;\n    zval             retval;\n    zval             args[1];\n\n#ifndef FAST_ZPP\n    /* Get function parameters and do error-checking. */\n    if (zend_parse_parameters(ZEND_NUM_ARGS(), \"zzz\", &obj, &fun, &param) == FAILURE) {\n        return;\n    }\n#else\n    ZEND_PARSE_PARAMETERS_START(3, 3)\n        Z_PARAM_ZVAL(obj)\n        Z_PARAM_ZVAL(fun)\n        Z_PARAM_ZVAL(param)\n    ZEND_PARSE_PARAMETERS_END();\n#endif\n\n    args[0] = *param;\n    if (obj == NULL || Z_TYPE_P(obj) == IS_NULL) {\n        call_user_function_ex(EG(function_table), NULL, fun, &retval, 1, args, 0, NULL);\n    } else {\n        call_user_function_ex(EG(function_table), obj, fun, &retval, 1, args, 0, NULL);\n    }\n    RETURN_ZVAL(&retval, 0, 1);\n}\n```\n#### 代码解读\n`zend_parse_parameters`\n在PHP7中提供了两种获取参数的方法。`zend_parse_parameters`和`FAST ZPP`方式.\n在PHP7之前一直使用zend_parse_parameters函数获取参数。这个函数的作用，就是把传入的参数转换为PHP内核中相应的类型，方便在PHP扩展中使用。 \n`zend_parse_parameters(ZEND_NUM_ARGS(), type_spec, &param1, &param2)`\n`ZEND_NUM_ARGS()`代表参数的个数，\n`type_spec`代表参数的类型：具体的类型如下\n|参数|对应数据类型\n|:-:|:-:|\n|\\||之后的参数是可选。可以传，也可以不传|\n|b | Boolean|\n|l | long|\n|d | double|\n|s | String 字符串|\n|r | Resource 资源|\n|a | Array 数组|\n|o | Object instance 对象|\n|O | Object instance of a specified type 特定类型的对象|\n|z | Non-specific zval 任意类型|\n|Z | zval**类型|\n\n`fast zpp`\n在PHP7中新提供的方式。是为了提高参数解析的性能。对应经常使用的方法，建议使用\t`FAST ZPP`\t方式。 使用方式： 以\t`ZEND_PARSE_PARAMETERS_START(1, 2)`\t开头。 第一个参数表示必传的参数个数，第二个参数表示最多传入的参数个数。 `以ZEND_PARSE_PARAMETERS_END();`结束。 中间是传入参数的解析。\n\n值得注意的是，一般FAST ZPP的宏方法与\t`zend_parse_parameters`\t的specifier是一一对应的。如：\n`Z_PARAM_OPTIONAL` 对应` |`\n`Z_PARAM_STR` 对应` S`\n`Z_PARAM_ZVAL` 对应 `z`\n但是，`Z_PARAM_ZVAL_EX`方法比较特殊。它对应两个specifier，分别是 ! 和 / 。! 对应宏方法的第二个参数。/ 对应宏方法的第三个参数。如果想开启，只要设置为1即可。\n\n`call_user_function_ex`\n\n`call_user_function_ex`方法用于调用函数和方法。参数说明如下：\n\n第一个参数：方法表。通常情况下，写 `EG(function_table) `\n第二个参数：对象。如果不是调用对象的方法，而是调用函数，填写NULL\n第三个参数：方法名。\n第四个参数：返回值。\n第五个参数：参数个数。\n第六个参数：参数值。是一个zval数组。\n第七个参数：参数是否进行分离操作。\n第八个参数：符号表。一般情况写设置为NULL即可。","source":"_posts/PHP-7-拓展编写-在拓展中调用函数.md","raw":"---\ntitle: PHP7 拓展编写--在拓展中调用函数\ndate: 2017-05-27 20:39:47\ntags: PHP7\n---\n### PHP 7 拓展编写--在拓展中调用函数\n\n@(PHP)\n\n--------------------------------\n\n#### PHP中调用函数都比较简单，今天要实现如下效果的代码\n```php\n<?php\nclass demo {\n\tpublic function get_site_name($prefix)\n\t{\n\t\treturn $prefix . \"肥龙的博客\\n\";\n\t}\n}\n\nfunction get_site_url($prefix)\n{\n\treturn $prefix . \"www.feilong.tech\\n\";\n}\n\nfunction call_function($obj, $fun, $param)\n{\n\tif ($obj == null)\n\t{\n\t\t$result = $fun($param);\n\t}\n\telse\n\t{\n\t\t$result = $obj->$fun($param);\n\t}\n\treturn $result;\n}\n$demo = new demo();\necho call_function($demo, \"get_site_name\", \"site name:\");\necho call_function(null, \"get_site_url\", \"site url:\");\n?>\n```\n我们将要实现call_function的方法的功能\n#### 代码实现\n```cpp\nPHP_FUNCTION(call_function)\n{\n    zval            *obj = NULL;\n    zval             *fun = NULL;\n    zval             *param = NULL;\n    zval             retval;\n    zval             args[1];\n\n#ifndef FAST_ZPP\n    /* Get function parameters and do error-checking. */\n    if (zend_parse_parameters(ZEND_NUM_ARGS(), \"zzz\", &obj, &fun, &param) == FAILURE) {\n        return;\n    }\n#else\n    ZEND_PARSE_PARAMETERS_START(3, 3)\n        Z_PARAM_ZVAL(obj)\n        Z_PARAM_ZVAL(fun)\n        Z_PARAM_ZVAL(param)\n    ZEND_PARSE_PARAMETERS_END();\n#endif\n\n    args[0] = *param;\n    if (obj == NULL || Z_TYPE_P(obj) == IS_NULL) {\n        call_user_function_ex(EG(function_table), NULL, fun, &retval, 1, args, 0, NULL);\n    } else {\n        call_user_function_ex(EG(function_table), obj, fun, &retval, 1, args, 0, NULL);\n    }\n    RETURN_ZVAL(&retval, 0, 1);\n}\n```\n#### 代码解读\n`zend_parse_parameters`\n在PHP7中提供了两种获取参数的方法。`zend_parse_parameters`和`FAST ZPP`方式.\n在PHP7之前一直使用zend_parse_parameters函数获取参数。这个函数的作用，就是把传入的参数转换为PHP内核中相应的类型，方便在PHP扩展中使用。 \n`zend_parse_parameters(ZEND_NUM_ARGS(), type_spec, &param1, &param2)`\n`ZEND_NUM_ARGS()`代表参数的个数，\n`type_spec`代表参数的类型：具体的类型如下\n|参数|对应数据类型\n|:-:|:-:|\n|\\||之后的参数是可选。可以传，也可以不传|\n|b | Boolean|\n|l | long|\n|d | double|\n|s | String 字符串|\n|r | Resource 资源|\n|a | Array 数组|\n|o | Object instance 对象|\n|O | Object instance of a specified type 特定类型的对象|\n|z | Non-specific zval 任意类型|\n|Z | zval**类型|\n\n`fast zpp`\n在PHP7中新提供的方式。是为了提高参数解析的性能。对应经常使用的方法，建议使用\t`FAST ZPP`\t方式。 使用方式： 以\t`ZEND_PARSE_PARAMETERS_START(1, 2)`\t开头。 第一个参数表示必传的参数个数，第二个参数表示最多传入的参数个数。 `以ZEND_PARSE_PARAMETERS_END();`结束。 中间是传入参数的解析。\n\n值得注意的是，一般FAST ZPP的宏方法与\t`zend_parse_parameters`\t的specifier是一一对应的。如：\n`Z_PARAM_OPTIONAL` 对应` |`\n`Z_PARAM_STR` 对应` S`\n`Z_PARAM_ZVAL` 对应 `z`\n但是，`Z_PARAM_ZVAL_EX`方法比较特殊。它对应两个specifier，分别是 ! 和 / 。! 对应宏方法的第二个参数。/ 对应宏方法的第三个参数。如果想开启，只要设置为1即可。\n\n`call_user_function_ex`\n\n`call_user_function_ex`方法用于调用函数和方法。参数说明如下：\n\n第一个参数：方法表。通常情况下，写 `EG(function_table) `\n第二个参数：对象。如果不是调用对象的方法，而是调用函数，填写NULL\n第三个参数：方法名。\n第四个参数：返回值。\n第五个参数：参数个数。\n第六个参数：参数值。是一个zval数组。\n第七个参数：参数是否进行分离操作。\n第八个参数：符号表。一般情况写设置为NULL即可。","slug":"PHP-7-拓展编写-在拓展中调用函数","published":1,"updated":"2017-05-27T12:40:36.193Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv31y000y0oqm9qolpajx","content":"<h3 id=\"PHP-7-拓展编写–在拓展中调用函数\"><a href=\"#PHP-7-拓展编写–在拓展中调用函数\" class=\"headerlink\" title=\"PHP 7 拓展编写–在拓展中调用函数\"></a>PHP 7 拓展编写–在拓展中调用函数</h3><p>@(PHP)</p>\n<hr>\n<h4 id=\"PHP中调用函数都比较简单，今天要实现如下效果的代码\"><a href=\"#PHP中调用函数都比较简单，今天要实现如下效果的代码\" class=\"headerlink\" title=\"PHP中调用函数都比较简单，今天要实现如下效果的代码\"></a>PHP中调用函数都比较简单，今天要实现如下效果的代码</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">demo</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_site_name</span><span class=\"params\">($prefix)</span></span></div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> $prefix . <span class=\"string\">\"肥龙的博客\\n\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_site_url</span><span class=\"params\">($prefix)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> $prefix . <span class=\"string\">\"www.feilong.tech\\n\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">call_function</span><span class=\"params\">($obj, $fun, $param)</span></span></div><div class=\"line\">&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span> ($obj == <span class=\"keyword\">null</span>)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t$result = $fun($param);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">else</span></div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t$result = $obj-&gt;$fun($param);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> $result;</div><div class=\"line\">&#125;</div><div class=\"line\">$demo = <span class=\"keyword\">new</span> demo();</div><div class=\"line\"><span class=\"keyword\">echo</span> call_function($demo, <span class=\"string\">\"get_site_name\"</span>, <span class=\"string\">\"site name:\"</span>);</div><div class=\"line\"><span class=\"keyword\">echo</span> call_function(<span class=\"keyword\">null</span>, <span class=\"string\">\"get_site_url\"</span>, <span class=\"string\">\"site url:\"</span>);</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<p>我们将要实现call_function的方法的功能</p>\n<h4 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h4><figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_FUNCTION(call_function)</div><div class=\"line\">&#123;</div><div class=\"line\">    zval            *obj = <span class=\"literal\">NULL</span>;</div><div class=\"line\">    zval             *fun = <span class=\"literal\">NULL</span>;</div><div class=\"line\">    zval             *param = <span class=\"literal\">NULL</span>;</div><div class=\"line\">    zval             retval;</div><div class=\"line\">    zval             args[<span class=\"number\">1</span>];</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> FAST_ZPP</span></div><div class=\"line\">    <span class=\"comment\">/* Get function parameters and do error-checking. */</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (zend_parse_parameters(ZEND_NUM_ARGS(), <span class=\"string\">\"zzz\"</span>, &amp;obj, &amp;fun, &amp;param) == FAILURE) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\">    ZEND_PARSE_PARAMETERS_START(<span class=\"number\">3</span>, <span class=\"number\">3</span>)</div><div class=\"line\">        Z_PARAM_ZVAL(obj)</div><div class=\"line\">        Z_PARAM_ZVAL(fun)</div><div class=\"line\">        Z_PARAM_ZVAL(param)</div><div class=\"line\">    ZEND_PARSE_PARAMETERS_END();</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"></div><div class=\"line\">    args[<span class=\"number\">0</span>] = *param;</div><div class=\"line\">    <span class=\"keyword\">if</span> (obj == <span class=\"literal\">NULL</span> || Z_TYPE_P(obj) == IS_NULL) &#123;</div><div class=\"line\">        call_user_function_ex(EG(function_table), <span class=\"literal\">NULL</span>, fun, &amp;retval, <span class=\"number\">1</span>, args, <span class=\"number\">0</span>, <span class=\"literal\">NULL</span>);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        call_user_function_ex(EG(function_table), obj, fun, &amp;retval, <span class=\"number\">1</span>, args, <span class=\"number\">0</span>, <span class=\"literal\">NULL</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">    RETURN_ZVAL(&amp;retval, <span class=\"number\">0</span>, <span class=\"number\">1</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"代码解读\"><a href=\"#代码解读\" class=\"headerlink\" title=\"代码解读\"></a>代码解读</h4><p><code>zend_parse_parameters</code><br>在PHP7中提供了两种获取参数的方法。<code>zend_parse_parameters</code>和<code>FAST ZPP</code>方式.<br>在PHP7之前一直使用zend_parse_parameters函数获取参数。这个函数的作用，就是把传入的参数转换为PHP内核中相应的类型，方便在PHP扩展中使用。<br><code>zend_parse_parameters(ZEND_NUM_ARGS(), type_spec, &amp;param1, &amp;param2)</code><br><code>ZEND_NUM_ARGS()</code>代表参数的个数，<br><code>type_spec</code>代表参数的类型：具体的类型如下<br>|参数|对应数据类型<br>|:-:|:-:|<br>|||之后的参数是可选。可以传，也可以不传|<br>|b | Boolean|<br>|l | long|<br>|d | double|<br>|s | String 字符串|<br>|r | Resource 资源|<br>|a | Array 数组|<br>|o | Object instance 对象|<br>|O | Object instance of a specified type 特定类型的对象|<br>|z | Non-specific zval 任意类型|<br>|Z | zval**类型|</p>\n<p><code>fast zpp</code><br>在PHP7中新提供的方式。是为了提高参数解析的性能。对应经常使用的方法，建议使用    <code>FAST ZPP</code>    方式。 使用方式： 以    <code>ZEND_PARSE_PARAMETERS_START(1, 2)</code>    开头。 第一个参数表示必传的参数个数，第二个参数表示最多传入的参数个数。 <code>以ZEND_PARSE_PARAMETERS_END();</code>结束。 中间是传入参数的解析。</p>\n<p>值得注意的是，一般FAST ZPP的宏方法与    <code>zend_parse_parameters</code>    的specifier是一一对应的。如：<br><code>Z_PARAM_OPTIONAL</code> 对应<code>|</code><br><code>Z_PARAM_STR</code> 对应<code>S</code><br><code>Z_PARAM_ZVAL</code> 对应 <code>z</code><br>但是，<code>Z_PARAM_ZVAL_EX</code>方法比较特殊。它对应两个specifier，分别是 ! 和 / 。! 对应宏方法的第二个参数。/ 对应宏方法的第三个参数。如果想开启，只要设置为1即可。</p>\n<p><code>call_user_function_ex</code></p>\n<p><code>call_user_function_ex</code>方法用于调用函数和方法。参数说明如下：</p>\n<p>第一个参数：方法表。通常情况下，写 <code>EG(function_table)</code><br>第二个参数：对象。如果不是调用对象的方法，而是调用函数，填写NULL<br>第三个参数：方法名。<br>第四个参数：返回值。<br>第五个参数：参数个数。<br>第六个参数：参数值。是一个zval数组。<br>第七个参数：参数是否进行分离操作。<br>第八个参数：符号表。一般情况写设置为NULL即可。</p>\n","excerpt":"","more":"<h3 id=\"PHP-7-拓展编写–在拓展中调用函数\"><a href=\"#PHP-7-拓展编写–在拓展中调用函数\" class=\"headerlink\" title=\"PHP 7 拓展编写–在拓展中调用函数\"></a>PHP 7 拓展编写–在拓展中调用函数</h3><p>@(PHP)</p>\n<hr>\n<h4 id=\"PHP中调用函数都比较简单，今天要实现如下效果的代码\"><a href=\"#PHP中调用函数都比较简单，今天要实现如下效果的代码\" class=\"headerlink\" title=\"PHP中调用函数都比较简单，今天要实现如下效果的代码\"></a>PHP中调用函数都比较简单，今天要实现如下效果的代码</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">demo</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_site_name</span><span class=\"params\">($prefix)</span></div><div class=\"line\">\t</span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> $prefix . <span class=\"string\">\"肥龙的博客\\n\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get_site_url</span><span class=\"params\">($prefix)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> $prefix . <span class=\"string\">\"www.feilong.tech\\n\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">call_function</span><span class=\"params\">($obj, $fun, $param)</span></div><div class=\"line\"></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span> ($obj == <span class=\"keyword\">null</span>)</div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t$result = $fun($param);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">else</span></div><div class=\"line\">\t&#123;</div><div class=\"line\">\t\t$result = $obj-&gt;$fun($param);</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> $result;</div><div class=\"line\">&#125;</div><div class=\"line\">$demo = <span class=\"keyword\">new</span> demo();</div><div class=\"line\"><span class=\"keyword\">echo</span> call_function($demo, <span class=\"string\">\"get_site_name\"</span>, <span class=\"string\">\"site name:\"</span>);</div><div class=\"line\"><span class=\"keyword\">echo</span> call_function(<span class=\"keyword\">null</span>, <span class=\"string\">\"get_site_url\"</span>, <span class=\"string\">\"site url:\"</span>);</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<p>我们将要实现call_function的方法的功能</p>\n<h4 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h4><figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_FUNCTION(call_function)</div><div class=\"line\">&#123;</div><div class=\"line\">    zval            *obj = <span class=\"literal\">NULL</span>;</div><div class=\"line\">    zval             *fun = <span class=\"literal\">NULL</span>;</div><div class=\"line\">    zval             *param = <span class=\"literal\">NULL</span>;</div><div class=\"line\">    zval             retval;</div><div class=\"line\">    zval             args[<span class=\"number\">1</span>];</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> FAST_ZPP</span></div><div class=\"line\">    <span class=\"comment\">/* Get function parameters and do error-checking. */</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (zend_parse_parameters(ZEND_NUM_ARGS(), <span class=\"string\">\"zzz\"</span>, &amp;obj, &amp;fun, &amp;param) == FAILURE) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\">    ZEND_PARSE_PARAMETERS_START(<span class=\"number\">3</span>, <span class=\"number\">3</span>)</div><div class=\"line\">        Z_PARAM_ZVAL(obj)</div><div class=\"line\">        Z_PARAM_ZVAL(fun)</div><div class=\"line\">        Z_PARAM_ZVAL(param)</div><div class=\"line\">    ZEND_PARSE_PARAMETERS_END();</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"></div><div class=\"line\">    args[<span class=\"number\">0</span>] = *param;</div><div class=\"line\">    <span class=\"keyword\">if</span> (obj == <span class=\"literal\">NULL</span> || Z_TYPE_P(obj) == IS_NULL) &#123;</div><div class=\"line\">        call_user_function_ex(EG(function_table), <span class=\"literal\">NULL</span>, fun, &amp;retval, <span class=\"number\">1</span>, args, <span class=\"number\">0</span>, <span class=\"literal\">NULL</span>);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        call_user_function_ex(EG(function_table), obj, fun, &amp;retval, <span class=\"number\">1</span>, args, <span class=\"number\">0</span>, <span class=\"literal\">NULL</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">    RETURN_ZVAL(&amp;retval, <span class=\"number\">0</span>, <span class=\"number\">1</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"代码解读\"><a href=\"#代码解读\" class=\"headerlink\" title=\"代码解读\"></a>代码解读</h4><p><code>zend_parse_parameters</code><br>在PHP7中提供了两种获取参数的方法。<code>zend_parse_parameters</code>和<code>FAST ZPP</code>方式.<br>在PHP7之前一直使用zend_parse_parameters函数获取参数。这个函数的作用，就是把传入的参数转换为PHP内核中相应的类型，方便在PHP扩展中使用。<br><code>zend_parse_parameters(ZEND_NUM_ARGS(), type_spec, &amp;param1, &amp;param2)</code><br><code>ZEND_NUM_ARGS()</code>代表参数的个数，<br><code>type_spec</code>代表参数的类型：具体的类型如下<br>|参数|对应数据类型<br>|:-:|:-:|<br>|||之后的参数是可选。可以传，也可以不传|<br>|b | Boolean|<br>|l | long|<br>|d | double|<br>|s | String 字符串|<br>|r | Resource 资源|<br>|a | Array 数组|<br>|o | Object instance 对象|<br>|O | Object instance of a specified type 特定类型的对象|<br>|z | Non-specific zval 任意类型|<br>|Z | zval**类型|</p>\n<p><code>fast zpp</code><br>在PHP7中新提供的方式。是为了提高参数解析的性能。对应经常使用的方法，建议使用    <code>FAST ZPP</code>    方式。 使用方式： 以    <code>ZEND_PARSE_PARAMETERS_START(1, 2)</code>    开头。 第一个参数表示必传的参数个数，第二个参数表示最多传入的参数个数。 <code>以ZEND_PARSE_PARAMETERS_END();</code>结束。 中间是传入参数的解析。</p>\n<p>值得注意的是，一般FAST ZPP的宏方法与    <code>zend_parse_parameters</code>    的specifier是一一对应的。如：<br><code>Z_PARAM_OPTIONAL</code> 对应<code>|</code><br><code>Z_PARAM_STR</code> 对应<code>S</code><br><code>Z_PARAM_ZVAL</code> 对应 <code>z</code><br>但是，<code>Z_PARAM_ZVAL_EX</code>方法比较特殊。它对应两个specifier，分别是 ! 和 / 。! 对应宏方法的第二个参数。/ 对应宏方法的第三个参数。如果想开启，只要设置为1即可。</p>\n<p><code>call_user_function_ex</code></p>\n<p><code>call_user_function_ex</code>方法用于调用函数和方法。参数说明如下：</p>\n<p>第一个参数：方法表。通常情况下，写 <code>EG(function_table)</code><br>第二个参数：对象。如果不是调用对象的方法，而是调用函数，填写NULL<br>第三个参数：方法名。<br>第四个参数：返回值。<br>第五个参数：参数个数。<br>第六个参数：参数值。是一个zval数组。<br>第七个参数：参数是否进行分离操作。<br>第八个参数：符号表。一般情况写设置为NULL即可。</p>\n"},{"title":"PHP UTC转GMT时区","date":"2016-08-23T11:29:56.000Z","_content":"\n> 很长时间没有写blog了，并不是因为我偷懒了，而是最近没什么好写的东西，今天就费劲挤出一些东西，写一篇blog。\n\n> 背景：公司的项目海外市场比较多，所以需要兼容多时区问题。这块也是一个比较头疼的问题。\n\n#### 公司主要的云端开发是PHP ci框架，用过ci的都知道，`index.php`的第一句话就是\n\n```php\ndate_default_timezone_set('UTC');\n```\n#### 这就决定了，整个项目的时区是UTC时区。\n\n#### 但是客户端传上来的时区基本上是GMT开头，例如`GMT+8(北京时间)`\n\n#### 所以要把UTC时区转换成GMT时区\n\n#### Code如下\n```php\n$time_zone = \"GMT+8\";\n$time = time();\n$date = date_create(date(\"Y-m-d H:i\", $time), timezone_open('UTC'));\n$date = date_timezone_set($date, timezone_open($time_zone));\n$date = date_format($date, 'Y-m-d H:i');\n```\n\n#### 或者参照[php时区转换转换函数](http://www.poluoluo.com/jzxy/201401/258989.html):\n```php\nfunction toTimeZone($src, $from_tz = 'America/Denver', $to_tz = 'Asia/Shanghai', $fm = 'Y-m-d H:i:s') {\n    $datetime = new DateTime($src, new DateTimeZone($from_tz));\n    $datetime->setTimezone(new DateTimeZone($to_tz));\n    return $datetime->format($fm);\n}\n```\n\n","source":"_posts/PHP-UTC转GMT时区.md","raw":"---\ntitle: PHP UTC转GMT时区\ndate: 2016-08-23 19:29:56\ntags: PHP\n---\n\n> 很长时间没有写blog了，并不是因为我偷懒了，而是最近没什么好写的东西，今天就费劲挤出一些东西，写一篇blog。\n\n> 背景：公司的项目海外市场比较多，所以需要兼容多时区问题。这块也是一个比较头疼的问题。\n\n#### 公司主要的云端开发是PHP ci框架，用过ci的都知道，`index.php`的第一句话就是\n\n```php\ndate_default_timezone_set('UTC');\n```\n#### 这就决定了，整个项目的时区是UTC时区。\n\n#### 但是客户端传上来的时区基本上是GMT开头，例如`GMT+8(北京时间)`\n\n#### 所以要把UTC时区转换成GMT时区\n\n#### Code如下\n```php\n$time_zone = \"GMT+8\";\n$time = time();\n$date = date_create(date(\"Y-m-d H:i\", $time), timezone_open('UTC'));\n$date = date_timezone_set($date, timezone_open($time_zone));\n$date = date_format($date, 'Y-m-d H:i');\n```\n\n#### 或者参照[php时区转换转换函数](http://www.poluoluo.com/jzxy/201401/258989.html):\n```php\nfunction toTimeZone($src, $from_tz = 'America/Denver', $to_tz = 'Asia/Shanghai', $fm = 'Y-m-d H:i:s') {\n    $datetime = new DateTime($src, new DateTimeZone($from_tz));\n    $datetime->setTimezone(new DateTimeZone($to_tz));\n    return $datetime->format($fm);\n}\n```\n\n","slug":"PHP-UTC转GMT时区","published":1,"updated":"2016-08-23T11:32:28.263Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32000120oqmgh2dslsc","content":"<blockquote>\n<p>很长时间没有写blog了，并不是因为我偷懒了，而是最近没什么好写的东西，今天就费劲挤出一些东西，写一篇blog。</p>\n<p>背景：公司的项目海外市场比较多，所以需要兼容多时区问题。这块也是一个比较头疼的问题。</p>\n</blockquote>\n<h4 id=\"公司主要的云端开发是PHP-ci框架，用过ci的都知道，index-php的第一句话就是\"><a href=\"#公司主要的云端开发是PHP-ci框架，用过ci的都知道，index-php的第一句话就是\" class=\"headerlink\" title=\"公司主要的云端开发是PHP ci框架，用过ci的都知道，index.php的第一句话就是\"></a>公司主要的云端开发是PHP ci框架，用过ci的都知道，<code>index.php</code>的第一句话就是</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">date_default_timezone_set(<span class=\"string\">'UTC'</span>);</div></pre></td></tr></table></figure>\n<h4 id=\"这就决定了，整个项目的时区是UTC时区。\"><a href=\"#这就决定了，整个项目的时区是UTC时区。\" class=\"headerlink\" title=\"这就决定了，整个项目的时区是UTC时区。\"></a>这就决定了，整个项目的时区是UTC时区。</h4><h4 id=\"但是客户端传上来的时区基本上是GMT开头，例如GMT-8-北京时间\"><a href=\"#但是客户端传上来的时区基本上是GMT开头，例如GMT-8-北京时间\" class=\"headerlink\" title=\"但是客户端传上来的时区基本上是GMT开头，例如GMT+8(北京时间)\"></a>但是客户端传上来的时区基本上是GMT开头，例如<code>GMT+8(北京时间)</code></h4><h4 id=\"所以要把UTC时区转换成GMT时区\"><a href=\"#所以要把UTC时区转换成GMT时区\" class=\"headerlink\" title=\"所以要把UTC时区转换成GMT时区\"></a>所以要把UTC时区转换成GMT时区</h4><h4 id=\"Code如下\"><a href=\"#Code如下\" class=\"headerlink\" title=\"Code如下\"></a>Code如下</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$time_zone = <span class=\"string\">\"GMT+8\"</span>;</div><div class=\"line\">$time = time();</div><div class=\"line\">$date = date_create(date(<span class=\"string\">\"Y-m-d H:i\"</span>, $time), timezone_open(<span class=\"string\">'UTC'</span>));</div><div class=\"line\">$date = date_timezone_set($date, timezone_open($time_zone));</div><div class=\"line\">$date = date_format($date, <span class=\"string\">'Y-m-d H:i'</span>);</div></pre></td></tr></table></figure>\n<h4 id=\"或者参照php时区转换转换函数\"><a href=\"#或者参照php时区转换转换函数\" class=\"headerlink\" title=\"或者参照php时区转换转换函数:\"></a>或者参照<a href=\"http://www.poluoluo.com/jzxy/201401/258989.html\" target=\"_blank\" rel=\"external\">php时区转换转换函数</a>:</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toTimeZone</span><span class=\"params\">($src, $from_tz = <span class=\"string\">'America/Denver'</span>, $to_tz = <span class=\"string\">'Asia/Shanghai'</span>, $fm = <span class=\"string\">'Y-m-d H:i:s'</span>)</span> </span>&#123;</div><div class=\"line\">    $datetime = <span class=\"keyword\">new</span> DateTime($src, <span class=\"keyword\">new</span> DateTimeZone($from_tz));</div><div class=\"line\">    $datetime-&gt;setTimezone(<span class=\"keyword\">new</span> DateTimeZone($to_tz));</div><div class=\"line\">    <span class=\"keyword\">return</span> $datetime-&gt;format($fm);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","excerpt":"","more":"<blockquote>\n<p>很长时间没有写blog了，并不是因为我偷懒了，而是最近没什么好写的东西，今天就费劲挤出一些东西，写一篇blog。</p>\n<p>背景：公司的项目海外市场比较多，所以需要兼容多时区问题。这块也是一个比较头疼的问题。</p>\n</blockquote>\n<h4 id=\"公司主要的云端开发是PHP-ci框架，用过ci的都知道，index-php的第一句话就是\"><a href=\"#公司主要的云端开发是PHP-ci框架，用过ci的都知道，index-php的第一句话就是\" class=\"headerlink\" title=\"公司主要的云端开发是PHP ci框架，用过ci的都知道，index.php的第一句话就是\"></a>公司主要的云端开发是PHP ci框架，用过ci的都知道，<code>index.php</code>的第一句话就是</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">date_default_timezone_set(<span class=\"string\">'UTC'</span>);</div></pre></td></tr></table></figure>\n<h4 id=\"这就决定了，整个项目的时区是UTC时区。\"><a href=\"#这就决定了，整个项目的时区是UTC时区。\" class=\"headerlink\" title=\"这就决定了，整个项目的时区是UTC时区。\"></a>这就决定了，整个项目的时区是UTC时区。</h4><h4 id=\"但是客户端传上来的时区基本上是GMT开头，例如GMT-8-北京时间\"><a href=\"#但是客户端传上来的时区基本上是GMT开头，例如GMT-8-北京时间\" class=\"headerlink\" title=\"但是客户端传上来的时区基本上是GMT开头，例如GMT+8(北京时间)\"></a>但是客户端传上来的时区基本上是GMT开头，例如<code>GMT+8(北京时间)</code></h4><h4 id=\"所以要把UTC时区转换成GMT时区\"><a href=\"#所以要把UTC时区转换成GMT时区\" class=\"headerlink\" title=\"所以要把UTC时区转换成GMT时区\"></a>所以要把UTC时区转换成GMT时区</h4><h4 id=\"Code如下\"><a href=\"#Code如下\" class=\"headerlink\" title=\"Code如下\"></a>Code如下</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$time_zone = <span class=\"string\">\"GMT+8\"</span>;</div><div class=\"line\">$time = time();</div><div class=\"line\">$date = date_create(date(<span class=\"string\">\"Y-m-d H:i\"</span>, $time), timezone_open(<span class=\"string\">'UTC'</span>));</div><div class=\"line\">$date = date_timezone_set($date, timezone_open($time_zone));</div><div class=\"line\">$date = date_format($date, <span class=\"string\">'Y-m-d H:i'</span>);</div></pre></td></tr></table></figure>\n<h4 id=\"或者参照php时区转换转换函数\"><a href=\"#或者参照php时区转换转换函数\" class=\"headerlink\" title=\"或者参照php时区转换转换函数:\"></a>或者参照<a href=\"http://www.poluoluo.com/jzxy/201401/258989.html\">php时区转换转换函数</a>:</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">toTimeZone</span><span class=\"params\">($src, $from_tz = <span class=\"string\">'America/Denver'</span>, $to_tz = <span class=\"string\">'Asia/Shanghai'</span>, $fm = <span class=\"string\">'Y-m-d H:i:s'</span>)</span> </span>&#123;</div><div class=\"line\">    $datetime = <span class=\"keyword\">new</span> DateTime($src, <span class=\"keyword\">new</span> DateTimeZone($from_tz));</div><div class=\"line\">    $datetime-&gt;setTimezone(<span class=\"keyword\">new</span> DateTimeZone($to_tz));</div><div class=\"line\">    <span class=\"keyword\">return</span> $datetime-&gt;format($fm);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n"},{"title":"PHP curl传送json数据","date":"2016-07-25T12:28:01.000Z","_content":"### PHP curl传送json数据\n#### 说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）\n#### 今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file_get_contents()和json_decode()。\n\n#### 1)定义数据格式\n\n```php\n$params = array(\n\t'name' => 'Tyler Teng',\n\t'sex'  => 'male'\n);\n$params = json_encode($params);\n```\n\n#### 2)创建curl句柄，并且采用post方式进行传输\n\n```php\n$url    =  'http://localhost/get.php';\n$ch = curl_init();\ncurl_setopt($ch, CURLOPT_URL, $url);\ncurl_setopt($ch, CURLOPT_POST, 1);\ncurl_setopt($ch, CURLOPT_POSTFIELDS, $params);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\ncurl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);\ncurl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);\n$out = curl_exec($ch);\ncurl_close($ch);\n```\n\n#### 3) 一般情况下，我们会在get.php使用\n```php\nprint_r($_POST);\n//string 'Array()' (length=10)\n```\n这个时候一定是空的，因为现在的数据不是以键值对传输的，而是使用数据流进行传输。所以应该使用\n```php\nprint_r(file_get_contents('php://input'));\n//string '{\"name\":\"Tyler Teng\",\"sex\":\"male\"}' (length=34)\n```\n来检验一下是不是有数据。\n\n#### 4)使用json_decode()函数进行解析。\n```php\n$json = file_get_contents('php://input');\n$array = json_decode($json, true);\n```\n\n#### 5)解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了\n```php\necho $array['name'];\n//string 'Tyler Teng' (length=10)\n```","source":"_posts/PHP-curl传送json数据.md","raw":"---\ntitle: PHP curl传送json数据\ndate: 2016-07-25 20:28:01\ntags: curl json\ncategories: PHP\n---\n### PHP curl传送json数据\n#### 说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）\n#### 今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file_get_contents()和json_decode()。\n\n#### 1)定义数据格式\n\n```php\n$params = array(\n\t'name' => 'Tyler Teng',\n\t'sex'  => 'male'\n);\n$params = json_encode($params);\n```\n\n#### 2)创建curl句柄，并且采用post方式进行传输\n\n```php\n$url    =  'http://localhost/get.php';\n$ch = curl_init();\ncurl_setopt($ch, CURLOPT_URL, $url);\ncurl_setopt($ch, CURLOPT_POST, 1);\ncurl_setopt($ch, CURLOPT_POSTFIELDS, $params);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\ncurl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);\ncurl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);\n$out = curl_exec($ch);\ncurl_close($ch);\n```\n\n#### 3) 一般情况下，我们会在get.php使用\n```php\nprint_r($_POST);\n//string 'Array()' (length=10)\n```\n这个时候一定是空的，因为现在的数据不是以键值对传输的，而是使用数据流进行传输。所以应该使用\n```php\nprint_r(file_get_contents('php://input'));\n//string '{\"name\":\"Tyler Teng\",\"sex\":\"male\"}' (length=34)\n```\n来检验一下是不是有数据。\n\n#### 4)使用json_decode()函数进行解析。\n```php\n$json = file_get_contents('php://input');\n$array = json_decode($json, true);\n```\n\n#### 5)解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了\n```php\necho $array['name'];\n//string 'Tyler Teng' (length=10)\n```","slug":"PHP-curl传送json数据","published":1,"updated":"2016-07-27T11:25:24.757Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32100140oqmqsnpfcxo","content":"<h3 id=\"PHP-curl传送json数据\"><a href=\"#PHP-curl传送json数据\" class=\"headerlink\" title=\"PHP curl传送json数据\"></a>PHP curl传送json数据</h3><h4 id=\"说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）\"><a href=\"#说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）\" class=\"headerlink\" title=\"说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）\"></a>说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）</h4><h4 id=\"今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file-get-contents-和json-decode-。\"><a href=\"#今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file-get-contents-和json-decode-。\" class=\"headerlink\" title=\"今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file_get_contents()和json_decode()。\"></a>今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file_get_contents()和json_decode()。</h4><h4 id=\"1-定义数据格式\"><a href=\"#1-定义数据格式\" class=\"headerlink\" title=\"1)定义数据格式\"></a>1)定义数据格式</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$params = <span class=\"keyword\">array</span>(</div><div class=\"line\">\t<span class=\"string\">'name'</span> =&gt; <span class=\"string\">'Tyler Teng'</span>,</div><div class=\"line\">\t<span class=\"string\">'sex'</span>  =&gt; <span class=\"string\">'male'</span></div><div class=\"line\">);</div><div class=\"line\">$params = json_encode($params);</div></pre></td></tr></table></figure>\n<h4 id=\"2-创建curl句柄，并且采用post方式进行传输\"><a href=\"#2-创建curl句柄，并且采用post方式进行传输\" class=\"headerlink\" title=\"2)创建curl句柄，并且采用post方式进行传输\"></a>2)创建curl句柄，并且采用post方式进行传输</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$url    =  <span class=\"string\">'http://localhost/get.php'</span>;</div><div class=\"line\">$ch = curl_init();</div><div class=\"line\">curl_setopt($ch, CURLOPT_URL, $url);</div><div class=\"line\">curl_setopt($ch, CURLOPT_POST, <span class=\"number\">1</span>);</div><div class=\"line\">curl_setopt($ch, CURLOPT_POSTFIELDS, $params);</div><div class=\"line\">curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class=\"number\">1</span>);</div><div class=\"line\">curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class=\"number\">0</span>);</div><div class=\"line\">curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class=\"number\">0</span>);</div><div class=\"line\">$out = curl_exec($ch);</div><div class=\"line\">curl_close($ch);</div></pre></td></tr></table></figure>\n<h4 id=\"3-一般情况下，我们会在get-php使用\"><a href=\"#3-一般情况下，我们会在get-php使用\" class=\"headerlink\" title=\"3) 一般情况下，我们会在get.php使用\"></a>3) 一般情况下，我们会在get.php使用</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">print_r($_POST);</div><div class=\"line\"><span class=\"comment\">//string 'Array()' (length=10)</span></div></pre></td></tr></table></figure>\n<p>这个时候一定是空的，因为现在的数据不是以键值对传输的，而是使用数据流进行传输。所以应该使用<br><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">print_r(file_get_contents(<span class=\"string\">'php://input'</span>));</div><div class=\"line\"><span class=\"comment\">//string '&#123;\"name\":\"Tyler Teng\",\"sex\":\"male\"&#125;' (length=34)</span></div></pre></td></tr></table></figure></p>\n<p>来检验一下是不是有数据。</p>\n<h4 id=\"4-使用json-decode-函数进行解析。\"><a href=\"#4-使用json-decode-函数进行解析。\" class=\"headerlink\" title=\"4)使用json_decode()函数进行解析。\"></a>4)使用json_decode()函数进行解析。</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$json = file_get_contents(<span class=\"string\">'php://input'</span>);</div><div class=\"line\">$array = json_decode($json, <span class=\"keyword\">true</span>);</div></pre></td></tr></table></figure>\n<h4 id=\"5-解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了\"><a href=\"#5-解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了\" class=\"headerlink\" title=\"5)解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了\"></a>5)解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">echo</span> $array[<span class=\"string\">'name'</span>];</div><div class=\"line\"><span class=\"comment\">//string 'Tyler Teng' (length=10)</span></div></pre></td></tr></table></figure>","excerpt":"","more":"<h3 id=\"PHP-curl传送json数据\"><a href=\"#PHP-curl传送json数据\" class=\"headerlink\" title=\"PHP curl传送json数据\"></a>PHP curl传送json数据</h3><h4 id=\"说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）\"><a href=\"#说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）\" class=\"headerlink\" title=\"说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）\"></a>说句实话，写PHP也有几年了，不过感觉技术还是渣的不行。前段时间给公司的机器人写接口，客户端的哥哥打算用json上报数据。这可憋闷死我了，因为以前都是直接使用form表单的形式，也就是键值对。没办法，只能双方商量一下，改用键值对的方式了。（大写的尴尬）</h4><h4 id=\"今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file-get-contents-和json-decode-。\"><a href=\"#今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file-get-contents-和json-decode-。\" class=\"headerlink\" title=\"今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file_get_contents()和json_decode()。\"></a>今天终于找到了使用json互传数据的办法了。用到的主要函数是curl，file_get_contents()和json_decode()。</h4><h4 id=\"1-定义数据格式\"><a href=\"#1-定义数据格式\" class=\"headerlink\" title=\"1)定义数据格式\"></a>1)定义数据格式</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$params = <span class=\"keyword\">array</span>(</div><div class=\"line\">\t<span class=\"string\">'name'</span> =&gt; <span class=\"string\">'Tyler Teng'</span>,</div><div class=\"line\">\t<span class=\"string\">'sex'</span>  =&gt; <span class=\"string\">'male'</span></div><div class=\"line\">);</div><div class=\"line\">$params = json_encode($params);</div></pre></td></tr></table></figure>\n<h4 id=\"2-创建curl句柄，并且采用post方式进行传输\"><a href=\"#2-创建curl句柄，并且采用post方式进行传输\" class=\"headerlink\" title=\"2)创建curl句柄，并且采用post方式进行传输\"></a>2)创建curl句柄，并且采用post方式进行传输</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$url    =  <span class=\"string\">'http://localhost/get.php'</span>;</div><div class=\"line\">$ch = curl_init();</div><div class=\"line\">curl_setopt($ch, CURLOPT_URL, $url);</div><div class=\"line\">curl_setopt($ch, CURLOPT_POST, <span class=\"number\">1</span>);</div><div class=\"line\">curl_setopt($ch, CURLOPT_POSTFIELDS, $params);</div><div class=\"line\">curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class=\"number\">1</span>);</div><div class=\"line\">curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class=\"number\">0</span>);</div><div class=\"line\">curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class=\"number\">0</span>);</div><div class=\"line\">$out = curl_exec($ch);</div><div class=\"line\">curl_close($ch);</div></pre></td></tr></table></figure>\n<h4 id=\"3-一般情况下，我们会在get-php使用\"><a href=\"#3-一般情况下，我们会在get-php使用\" class=\"headerlink\" title=\"3) 一般情况下，我们会在get.php使用\"></a>3) 一般情况下，我们会在get.php使用</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">print_r($_POST);</div><div class=\"line\"><span class=\"comment\">//string 'Array()' (length=10)</span></div></pre></td></tr></table></figure>\n<p>这个时候一定是空的，因为现在的数据不是以键值对传输的，而是使用数据流进行传输。所以应该使用<br><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">print_r(file_get_contents(<span class=\"string\">'php://input'</span>));</div><div class=\"line\"><span class=\"comment\">//string '&#123;\"name\":\"Tyler Teng\",\"sex\":\"male\"&#125;' (length=34)</span></div></pre></td></tr></table></figure></p>\n<p>来检验一下是不是有数据。</p>\n<h4 id=\"4-使用json-decode-函数进行解析。\"><a href=\"#4-使用json-decode-函数进行解析。\" class=\"headerlink\" title=\"4)使用json_decode()函数进行解析。\"></a>4)使用json_decode()函数进行解析。</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$json = file_get_contents(<span class=\"string\">'php://input'</span>);</div><div class=\"line\">$array = json_decode($json, <span class=\"keyword\">true</span>);</div></pre></td></tr></table></figure>\n<h4 id=\"5-解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了\"><a href=\"#5-解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了\" class=\"headerlink\" title=\"5)解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了\"></a>5)解析后的json就是数组了，我们只需要按照数组方式进行获取数值就好了</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">echo</span> $array[<span class=\"string\">'name'</span>];</div><div class=\"line\"><span class=\"comment\">//string 'Tyler Teng' (length=10)</span></div></pre></td></tr></table></figure>"},{"title":"PHP 底层：PHP的生命周期","date":"2017-04-15T11:46:50.000Z","_content":"### PHP 底层：PHP的生命周期\n\n@(PHP)\n\n#### 一切开始：SAPI接口\nSAPI 是Server Application Programming Interface 的简称，意思就是说，服务应用编程接口，PHP所有接口都是在这和系统进行交互。就像pc一样，无论安装在哪个系统，只要满足接口，都是可以正常运行的。PHP的脚本有很多运行方式，大多数是运行在web服务器，比如Apache或者nginx，或者命令行（CLI），或者嵌入其他程序里。\n#### 开始和结束\n PHP的开始和结束主要有两个阶段：**处理请求之前的开始**和**请求之后的结束阶段**。开始的阶段有两个过程：**模块初始化阶段**和**模块激活阶段**。\n> - 模块初始化阶段是MINIT(module init)，是在整个SAPI的什么周期内**只会发生一次**。也就是在lamp的时候，当Apache启动后，就开始启动MINIT，或者lnmp，当php-fpm启动后，会进行该步骤。例如PHP注册了一些拓展，则在该阶段回调所有的MINIT函数。\n```cpp\nPHP_MINIT_FUNCTION(myphpextension)\n{\n    // 注册常量或者类等初始化操作\n    return SUCCESS; \n}\n```\n> - 模块激活阶段RINIT也叫请求初始化阶段（request init），该过程发生在请求的阶段。例如，当通过url请求某个页面，则在请求之前会进行模块激活（RINIT请求开始）。请求到达之后PHP初始化执行脚本的基本环境，例如创建一个执行环境，包括保存PHP运行过程中变量名称和值内容的符号表，以及当前所有的函数以及类等信息的符号表。然后PHP会调用所有模块的RINIT函数\n```cpp\nPHP_RINIT_FUNCTION(myphpextension)\n{\n    // 例如记录请求开始时间\n    // 随后在请求结束的时候记录结束时间。这样我们就能够记录下处理请求所花费的时间了\n    return SUCCESS; \n}\n```\n> - 请求处理到达结束阶段，一般是执行到程序末尾或者调用`exit()`或者`die()` ，PHP都将进入结束阶段。和开始阶段对应，结束阶段也会分为两环节，一个在请求结束后停用模块(RSHUTDOWN，对应RINIT)\n```cpp\nPHP_RSHUTDOWN_FUNCTION(myphpextension)\n{\n    // 例如记录请求结束时间，并把相应的信息写入到日至文件中。\n    return SUCCESS; \n}\n```\n> - 另一个阶段是，所有的请求都已处理完毕，SAPI也准备关闭了， PHP调用每个扩展的MSHUTDOWN方法，这是各个模块最后一次释放内存的机会。（这个是对于CGI和CLI等SAPI，没有“下一个请求”，所以SAPI立刻开始关闭。）\n```cpp\nPHP_MSHUTDOWN_FUNCTION(extension_name) {   \n    /* Free handlers and persistent memory etc */   \n    return SUCCESS;   \n}  \n```\n这样，整个PHP生命周期就结束了。要注意的是，只有在服务器没有请求的情况下才会执行“启动第一步”和“关闭第二步”。\n\nSAPI运行PHP都经过下面几个阶段:\n- **模块初始化阶段(Module init) **  \n即调用每个拓展源码中的的PHP_MINIT_FUNCTION中的方法初始化模块,进行一些模块所需变量的申请,内存分配等。\n- **请求初始化阶段(Request init) **\n即接受到客户端的请求后调用每个拓展的PHP_RINIT_FUNCTION中的方法,初始化PHP脚本的执行环境。\n- **执行PHP脚本**\n- **请求结束(Request Shutdown)**\n这时候调用每个拓展的PHP_RSHUTDOWN_FUNCTION方法清理请求现场,并且ZE开始回收变量和内存。\n- **关闭模块(Module shutdown)**\nWeb服务器退出或者命令行脚本执行完毕退出会调用拓展源码中的PHP_MSHUTDOWN_FUNCTION 方法\n\n#### 单进程SAPI生命周期\nCLI/CGI模式的PHP属于单进程的SAPI模式。这类的请求在处理一次请求后就关闭。也就是只会经过如下几个环节： 开始 - 请求开始 - 请求关闭 - 结束 SAPI接口实现就完成了其生命周期。如图所示：\n\n![Alt text](/img/QQ截图20170415194833)\n\n#### 多进程SAPI生命周期\n通常PHP是编译为apache的一个模块来处理PHP请求。Apache一般会采用多进程模式， Apache启动后会fork出多个子进程，每个进程的内存空间独立，每个子进程都会经过开始和结束环节，不过每个进程的开始阶段只在进程fork出来以来后进行，在整个进程的生命周期内可能会处理多个请求。只有在Apache关闭或者进程被结束之后才会进行关闭阶段，在这两个阶段之间会随着每个请求重复请求开始-请求关闭的环节。\n<center>![Alt text](/img/QQ截图20170415194749.png)</center>\n\n#### 多线程的SAPI生命周期\n多线程模式和多进程中的某个进程类似，不同的是在整个进程的生命周期内会并行的重复着 请求开始-请求关闭的环节.\n在这种模式下，只有一个服务器进程在运行着，但会同时运行很多线程，这样可以减少一些资源开销，向Module init和Module shutdown就只需要运行一遍就行了，一些全局变量也只需要初始化一次，因为线程独具的特质，使得各个请求之间方便的共享一些数据成为可能。\n![Alt text](/img/QQ截图20170415194807.png)\n\n","source":"_posts/PHP-底层：PHP的生命周期.md","raw":"---\ntitle: PHP 底层：PHP的生命周期\ndate: 2017-04-15 19:46:50\ntags:\n---\n### PHP 底层：PHP的生命周期\n\n@(PHP)\n\n#### 一切开始：SAPI接口\nSAPI 是Server Application Programming Interface 的简称，意思就是说，服务应用编程接口，PHP所有接口都是在这和系统进行交互。就像pc一样，无论安装在哪个系统，只要满足接口，都是可以正常运行的。PHP的脚本有很多运行方式，大多数是运行在web服务器，比如Apache或者nginx，或者命令行（CLI），或者嵌入其他程序里。\n#### 开始和结束\n PHP的开始和结束主要有两个阶段：**处理请求之前的开始**和**请求之后的结束阶段**。开始的阶段有两个过程：**模块初始化阶段**和**模块激活阶段**。\n> - 模块初始化阶段是MINIT(module init)，是在整个SAPI的什么周期内**只会发生一次**。也就是在lamp的时候，当Apache启动后，就开始启动MINIT，或者lnmp，当php-fpm启动后，会进行该步骤。例如PHP注册了一些拓展，则在该阶段回调所有的MINIT函数。\n```cpp\nPHP_MINIT_FUNCTION(myphpextension)\n{\n    // 注册常量或者类等初始化操作\n    return SUCCESS; \n}\n```\n> - 模块激活阶段RINIT也叫请求初始化阶段（request init），该过程发生在请求的阶段。例如，当通过url请求某个页面，则在请求之前会进行模块激活（RINIT请求开始）。请求到达之后PHP初始化执行脚本的基本环境，例如创建一个执行环境，包括保存PHP运行过程中变量名称和值内容的符号表，以及当前所有的函数以及类等信息的符号表。然后PHP会调用所有模块的RINIT函数\n```cpp\nPHP_RINIT_FUNCTION(myphpextension)\n{\n    // 例如记录请求开始时间\n    // 随后在请求结束的时候记录结束时间。这样我们就能够记录下处理请求所花费的时间了\n    return SUCCESS; \n}\n```\n> - 请求处理到达结束阶段，一般是执行到程序末尾或者调用`exit()`或者`die()` ，PHP都将进入结束阶段。和开始阶段对应，结束阶段也会分为两环节，一个在请求结束后停用模块(RSHUTDOWN，对应RINIT)\n```cpp\nPHP_RSHUTDOWN_FUNCTION(myphpextension)\n{\n    // 例如记录请求结束时间，并把相应的信息写入到日至文件中。\n    return SUCCESS; \n}\n```\n> - 另一个阶段是，所有的请求都已处理完毕，SAPI也准备关闭了， PHP调用每个扩展的MSHUTDOWN方法，这是各个模块最后一次释放内存的机会。（这个是对于CGI和CLI等SAPI，没有“下一个请求”，所以SAPI立刻开始关闭。）\n```cpp\nPHP_MSHUTDOWN_FUNCTION(extension_name) {   \n    /* Free handlers and persistent memory etc */   \n    return SUCCESS;   \n}  \n```\n这样，整个PHP生命周期就结束了。要注意的是，只有在服务器没有请求的情况下才会执行“启动第一步”和“关闭第二步”。\n\nSAPI运行PHP都经过下面几个阶段:\n- **模块初始化阶段(Module init) **  \n即调用每个拓展源码中的的PHP_MINIT_FUNCTION中的方法初始化模块,进行一些模块所需变量的申请,内存分配等。\n- **请求初始化阶段(Request init) **\n即接受到客户端的请求后调用每个拓展的PHP_RINIT_FUNCTION中的方法,初始化PHP脚本的执行环境。\n- **执行PHP脚本**\n- **请求结束(Request Shutdown)**\n这时候调用每个拓展的PHP_RSHUTDOWN_FUNCTION方法清理请求现场,并且ZE开始回收变量和内存。\n- **关闭模块(Module shutdown)**\nWeb服务器退出或者命令行脚本执行完毕退出会调用拓展源码中的PHP_MSHUTDOWN_FUNCTION 方法\n\n#### 单进程SAPI生命周期\nCLI/CGI模式的PHP属于单进程的SAPI模式。这类的请求在处理一次请求后就关闭。也就是只会经过如下几个环节： 开始 - 请求开始 - 请求关闭 - 结束 SAPI接口实现就完成了其生命周期。如图所示：\n\n![Alt text](/img/QQ截图20170415194833)\n\n#### 多进程SAPI生命周期\n通常PHP是编译为apache的一个模块来处理PHP请求。Apache一般会采用多进程模式， Apache启动后会fork出多个子进程，每个进程的内存空间独立，每个子进程都会经过开始和结束环节，不过每个进程的开始阶段只在进程fork出来以来后进行，在整个进程的生命周期内可能会处理多个请求。只有在Apache关闭或者进程被结束之后才会进行关闭阶段，在这两个阶段之间会随着每个请求重复请求开始-请求关闭的环节。\n<center>![Alt text](/img/QQ截图20170415194749.png)</center>\n\n#### 多线程的SAPI生命周期\n多线程模式和多进程中的某个进程类似，不同的是在整个进程的生命周期内会并行的重复着 请求开始-请求关闭的环节.\n在这种模式下，只有一个服务器进程在运行着，但会同时运行很多线程，这样可以减少一些资源开销，向Module init和Module shutdown就只需要运行一遍就行了，一些全局变量也只需要初始化一次，因为线程独具的特质，使得各个请求之间方便的共享一些数据成为可能。\n![Alt text](/img/QQ截图20170415194807.png)\n\n","slug":"PHP-底层：PHP的生命周期","published":1,"updated":"2017-04-15T11:50:09.655Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32300180oqmvleprq1y","content":"<h3 id=\"PHP-底层：PHP的生命周期\"><a href=\"#PHP-底层：PHP的生命周期\" class=\"headerlink\" title=\"PHP 底层：PHP的生命周期\"></a>PHP 底层：PHP的生命周期</h3><p>@(PHP)</p>\n<h4 id=\"一切开始：SAPI接口\"><a href=\"#一切开始：SAPI接口\" class=\"headerlink\" title=\"一切开始：SAPI接口\"></a>一切开始：SAPI接口</h4><p>SAPI 是Server Application Programming Interface 的简称，意思就是说，服务应用编程接口，PHP所有接口都是在这和系统进行交互。就像pc一样，无论安装在哪个系统，只要满足接口，都是可以正常运行的。PHP的脚本有很多运行方式，大多数是运行在web服务器，比如Apache或者nginx，或者命令行（CLI），或者嵌入其他程序里。</p>\n<h4 id=\"开始和结束\"><a href=\"#开始和结束\" class=\"headerlink\" title=\"开始和结束\"></a>开始和结束</h4><p> PHP的开始和结束主要有两个阶段：<strong>处理请求之前的开始</strong>和<strong>请求之后的结束阶段</strong>。开始的阶段有两个过程：<strong>模块初始化阶段</strong>和<strong>模块激活阶段</strong>。</p>\n<blockquote>\n<ul>\n<li><p>模块初始化阶段是MINIT(module init)，是在整个SAPI的什么周期内<strong>只会发生一次</strong>。也就是在lamp的时候，当Apache启动后，就开始启动MINIT，或者lnmp，当php-fpm启动后，会进行该步骤。例如PHP注册了一些拓展，则在该阶段回调所有的MINIT函数。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_MINIT_FUNCTION(myphpextension)</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"comment\">// 注册常量或者类等初始化操作</span></div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>模块激活阶段RINIT也叫请求初始化阶段（request init），该过程发生在请求的阶段。例如，当通过url请求某个页面，则在请求之前会进行模块激活（RINIT请求开始）。请求到达之后PHP初始化执行脚本的基本环境，例如创建一个执行环境，包括保存PHP运行过程中变量名称和值内容的符号表，以及当前所有的函数以及类等信息的符号表。然后PHP会调用所有模块的RINIT函数</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_RINIT_FUNCTION(myphpextension)</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"comment\">// 例如记录请求开始时间</span></div><div class=\"line\">    <span class=\"comment\">// 随后在请求结束的时候记录结束时间。这样我们就能够记录下处理请求所花费的时间了</span></div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>请求处理到达结束阶段，一般是执行到程序末尾或者调用<code>exit()</code>或者<code>die()</code> ，PHP都将进入结束阶段。和开始阶段对应，结束阶段也会分为两环节，一个在请求结束后停用模块(RSHUTDOWN，对应RINIT)</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_RSHUTDOWN_FUNCTION(myphpextension)</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"comment\">// 例如记录请求结束时间，并把相应的信息写入到日至文件中。</span></div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>另一个阶段是，所有的请求都已处理完毕，SAPI也准备关闭了， PHP调用每个扩展的MSHUTDOWN方法，这是各个模块最后一次释放内存的机会。（这个是对于CGI和CLI等SAPI，没有“下一个请求”，所以SAPI立刻开始关闭。）</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_MSHUTDOWN_FUNCTION(extension_name) &#123;   </div><div class=\"line\">    <span class=\"comment\">/* Free handlers and persistent memory etc */</span>   </div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</blockquote>\n<p>这样，整个PHP生命周期就结束了。要注意的是，只有在服务器没有请求的情况下才会执行“启动第一步”和“关闭第二步”。</p>\n<p>SAPI运行PHP都经过下面几个阶段:</p>\n<ul>\n<li><strong>模块初始化阶段(Module init) </strong><br>即调用每个拓展源码中的的PHP_MINIT_FUNCTION中的方法初始化模块,进行一些模块所需变量的申请,内存分配等。</li>\n<li><strong>请求初始化阶段(Request init) </strong><br>即接受到客户端的请求后调用每个拓展的PHP_RINIT_FUNCTION中的方法,初始化PHP脚本的执行环境。</li>\n<li><strong>执行PHP脚本</strong></li>\n<li><strong>请求结束(Request Shutdown)</strong><br>这时候调用每个拓展的PHP_RSHUTDOWN_FUNCTION方法清理请求现场,并且ZE开始回收变量和内存。</li>\n<li><strong>关闭模块(Module shutdown)</strong><br>Web服务器退出或者命令行脚本执行完毕退出会调用拓展源码中的PHP_MSHUTDOWN_FUNCTION 方法</li>\n</ul>\n<h4 id=\"单进程SAPI生命周期\"><a href=\"#单进程SAPI生命周期\" class=\"headerlink\" title=\"单进程SAPI生命周期\"></a>单进程SAPI生命周期</h4><p>CLI/CGI模式的PHP属于单进程的SAPI模式。这类的请求在处理一次请求后就关闭。也就是只会经过如下几个环节： 开始 - 请求开始 - 请求关闭 - 结束 SAPI接口实现就完成了其生命周期。如图所示：</p>\n<p><img src=\"/img/QQ截图20170415194833\" alt=\"Alt text\"></p>\n<h4 id=\"多进程SAPI生命周期\"><a href=\"#多进程SAPI生命周期\" class=\"headerlink\" title=\"多进程SAPI生命周期\"></a>多进程SAPI生命周期</h4><p>通常PHP是编译为apache的一个模块来处理PHP请求。Apache一般会采用多进程模式， Apache启动后会fork出多个子进程，每个进程的内存空间独立，每个子进程都会经过开始和结束环节，不过每个进程的开始阶段只在进程fork出来以来后进行，在整个进程的生命周期内可能会处理多个请求。只有在Apache关闭或者进程被结束之后才会进行关闭阶段，在这两个阶段之间会随着每个请求重复请求开始-请求关闭的环节。</p>\n<center><img src=\"/img/QQ截图20170415194749.png\" alt=\"Alt text\"></center>\n\n<h4 id=\"多线程的SAPI生命周期\"><a href=\"#多线程的SAPI生命周期\" class=\"headerlink\" title=\"多线程的SAPI生命周期\"></a>多线程的SAPI生命周期</h4><p>多线程模式和多进程中的某个进程类似，不同的是在整个进程的生命周期内会并行的重复着 请求开始-请求关闭的环节.<br>在这种模式下，只有一个服务器进程在运行着，但会同时运行很多线程，这样可以减少一些资源开销，向Module init和Module shutdown就只需要运行一遍就行了，一些全局变量也只需要初始化一次，因为线程独具的特质，使得各个请求之间方便的共享一些数据成为可能。<br><img src=\"/img/QQ截图20170415194807.png\" alt=\"Alt text\"></p>\n","excerpt":"","more":"<h3 id=\"PHP-底层：PHP的生命周期\"><a href=\"#PHP-底层：PHP的生命周期\" class=\"headerlink\" title=\"PHP 底层：PHP的生命周期\"></a>PHP 底层：PHP的生命周期</h3><p>@(PHP)</p>\n<h4 id=\"一切开始：SAPI接口\"><a href=\"#一切开始：SAPI接口\" class=\"headerlink\" title=\"一切开始：SAPI接口\"></a>一切开始：SAPI接口</h4><p>SAPI 是Server Application Programming Interface 的简称，意思就是说，服务应用编程接口，PHP所有接口都是在这和系统进行交互。就像pc一样，无论安装在哪个系统，只要满足接口，都是可以正常运行的。PHP的脚本有很多运行方式，大多数是运行在web服务器，比如Apache或者nginx，或者命令行（CLI），或者嵌入其他程序里。</p>\n<h4 id=\"开始和结束\"><a href=\"#开始和结束\" class=\"headerlink\" title=\"开始和结束\"></a>开始和结束</h4><p> PHP的开始和结束主要有两个阶段：<strong>处理请求之前的开始</strong>和<strong>请求之后的结束阶段</strong>。开始的阶段有两个过程：<strong>模块初始化阶段</strong>和<strong>模块激活阶段</strong>。</p>\n<blockquote>\n<ul>\n<li><p>模块初始化阶段是MINIT(module init)，是在整个SAPI的什么周期内<strong>只会发生一次</strong>。也就是在lamp的时候，当Apache启动后，就开始启动MINIT，或者lnmp，当php-fpm启动后，会进行该步骤。例如PHP注册了一些拓展，则在该阶段回调所有的MINIT函数。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_MINIT_FUNCTION(myphpextension)</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"comment\">// 注册常量或者类等初始化操作</span></div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>模块激活阶段RINIT也叫请求初始化阶段（request init），该过程发生在请求的阶段。例如，当通过url请求某个页面，则在请求之前会进行模块激活（RINIT请求开始）。请求到达之后PHP初始化执行脚本的基本环境，例如创建一个执行环境，包括保存PHP运行过程中变量名称和值内容的符号表，以及当前所有的函数以及类等信息的符号表。然后PHP会调用所有模块的RINIT函数</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_RINIT_FUNCTION(myphpextension)</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"comment\">// 例如记录请求开始时间</span></div><div class=\"line\">    <span class=\"comment\">// 随后在请求结束的时候记录结束时间。这样我们就能够记录下处理请求所花费的时间了</span></div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>请求处理到达结束阶段，一般是执行到程序末尾或者调用<code>exit()</code>或者<code>die()</code> ，PHP都将进入结束阶段。和开始阶段对应，结束阶段也会分为两环节，一个在请求结束后停用模块(RSHUTDOWN，对应RINIT)</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_RSHUTDOWN_FUNCTION(myphpextension)</div><div class=\"line\">&#123;</div><div class=\"line\">    <span class=\"comment\">// 例如记录请求结束时间，并把相应的信息写入到日至文件中。</span></div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS; </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>另一个阶段是，所有的请求都已处理完毕，SAPI也准备关闭了， PHP调用每个扩展的MSHUTDOWN方法，这是各个模块最后一次释放内存的机会。（这个是对于CGI和CLI等SAPI，没有“下一个请求”，所以SAPI立刻开始关闭。）</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_MSHUTDOWN_FUNCTION(extension_name) &#123;   </div><div class=\"line\">    <span class=\"comment\">/* Free handlers and persistent memory etc */</span>   </div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</blockquote>\n<p>这样，整个PHP生命周期就结束了。要注意的是，只有在服务器没有请求的情况下才会执行“启动第一步”和“关闭第二步”。</p>\n<p>SAPI运行PHP都经过下面几个阶段:</p>\n<ul>\n<li><strong>模块初始化阶段(Module init) </strong><br>即调用每个拓展源码中的的PHP_MINIT_FUNCTION中的方法初始化模块,进行一些模块所需变量的申请,内存分配等。</li>\n<li><strong>请求初始化阶段(Request init) </strong><br>即接受到客户端的请求后调用每个拓展的PHP_RINIT_FUNCTION中的方法,初始化PHP脚本的执行环境。</li>\n<li><strong>执行PHP脚本</strong></li>\n<li><strong>请求结束(Request Shutdown)</strong><br>这时候调用每个拓展的PHP_RSHUTDOWN_FUNCTION方法清理请求现场,并且ZE开始回收变量和内存。</li>\n<li><strong>关闭模块(Module shutdown)</strong><br>Web服务器退出或者命令行脚本执行完毕退出会调用拓展源码中的PHP_MSHUTDOWN_FUNCTION 方法</li>\n</ul>\n<h4 id=\"单进程SAPI生命周期\"><a href=\"#单进程SAPI生命周期\" class=\"headerlink\" title=\"单进程SAPI生命周期\"></a>单进程SAPI生命周期</h4><p>CLI/CGI模式的PHP属于单进程的SAPI模式。这类的请求在处理一次请求后就关闭。也就是只会经过如下几个环节： 开始 - 请求开始 - 请求关闭 - 结束 SAPI接口实现就完成了其生命周期。如图所示：</p>\n<p><img src=\"/img/QQ截图20170415194833\" alt=\"Alt text\"></p>\n<h4 id=\"多进程SAPI生命周期\"><a href=\"#多进程SAPI生命周期\" class=\"headerlink\" title=\"多进程SAPI生命周期\"></a>多进程SAPI生命周期</h4><p>通常PHP是编译为apache的一个模块来处理PHP请求。Apache一般会采用多进程模式， Apache启动后会fork出多个子进程，每个进程的内存空间独立，每个子进程都会经过开始和结束环节，不过每个进程的开始阶段只在进程fork出来以来后进行，在整个进程的生命周期内可能会处理多个请求。只有在Apache关闭或者进程被结束之后才会进行关闭阶段，在这两个阶段之间会随着每个请求重复请求开始-请求关闭的环节。</p>\n<center><img src=\"/img/QQ截图20170415194749.png\" alt=\"Alt text\"></center>\n\n<h4 id=\"多线程的SAPI生命周期\"><a href=\"#多线程的SAPI生命周期\" class=\"headerlink\" title=\"多线程的SAPI生命周期\"></a>多线程的SAPI生命周期</h4><p>多线程模式和多进程中的某个进程类似，不同的是在整个进程的生命周期内会并行的重复着 请求开始-请求关闭的环节.<br>在这种模式下，只有一个服务器进程在运行着，但会同时运行很多线程，这样可以减少一些资源开销，向Module init和Module shutdown就只需要运行一遍就行了，一些全局变量也只需要初始化一次，因为线程独具的特质，使得各个请求之间方便的共享一些数据成为可能。<br><img src=\"/img/QQ截图20170415194807.png\" alt=\"Alt text\"></p>\n"},{"title":"PHP7拓展开发--函数的传参和返回值","date":"2017-05-31T12:26:22.000Z","_content":"\n#### 前言\n这次，我们将演示如果在PHP拓展中接收传参和输出返回值\n实现大代码效果和下面一样\n```php\n<?php\nfunction default_value($type, $value = null) {\n\tif ($type = 'int') {\n\t\treturn $value ?? 0;\n\t} else if ($type = 'bool') {\n\t\treturn $value ?? false;\t\n\t} else if ($type = 'str') {\n\t\treturn is_null($value) ? \"\" : $value;\n\t}\n\treturn null;\n\t\n}\n\n    var_dump(default_value(\"int\"));\n    var_dump(default_value(\"int\", 1));\n    var_dump(default_value(\"bool\"));\n    var_dump(default_value(\"bool\", true));\n    var_dump(default_value(\"str\"));\n    var_dump(default_value(\"str\", \"a\"));\n    var_dump(default_value(\"array\"));\n\n\n?>\n```\n\n#### 代码实现\n##### 基础代码\n```cpp\nPHP_FUNCTION(default_value)\n{\n    zend_string     *type;    \n    zval            *value = NULL;\n\n#ifndef FAST_ZPP\n    /* Get function parameters and do error-checking. */\n    if (zend_parse_parameters(ZEND_NUM_ARGS(), \"S|z\", &type, &value) == FAILURE) {\n        return;\n    }    \n#else\n    ZEND_PARSE_PARAMETERS_START(1, 2)\n        Z_PARAM_STR(type)\n        Z_PARAM_OPTIONAL\n        Z_PARAM_ZVAL_EX(value, 0, 1)\n    ZEND_PARSE_PARAMETERS_END();\n#endif\n\n    if (ZSTR_LEN(type) == 3 && strncmp(ZSTR_VAL(type), \"int\", 3) == 0 && value == NULL) {\n        RETURN_LONG(0);\n    } else if (ZSTR_LEN(type) == 3 && strncmp(ZSTR_VAL(type), \"int\", 3) == 0 && value != NULL) {\n        RETURN_ZVAL(value, 0, 1); \n    } else if (ZSTR_LEN(type) == 4 && strncmp(ZSTR_VAL(type), \"bool\", 4) == 0 && value == NULL) {\n        RETURN_FALSE;\n    } else if (ZSTR_LEN(type) == 4 && strncmp(ZSTR_VAL(type), \"bool\", 4) == 0 && value != NULL) {\n        RETURN_ZVAL(value, 0, 1); \n    } else if (ZSTR_LEN(type) == 3 && strncmp(ZSTR_VAL(type), \"str\", 3) == 0 && value == NULL) {\n        RETURN_EMPTY_STRING();\n    } else if (ZSTR_LEN(type) == 3 && strncmp(ZSTR_VAL(type), \"str\", 3) == 0 && value != NULL) {\n        RETURN_ZVAL(value, 0, 1); \n    } \n    RETURN_NULL();\n}\n```","source":"_posts/PHP7拓展开发-函数的传参和返回值.md","raw":"---\ntitle: PHP7拓展开发--函数的传参和返回值\ndate: 2017-05-31 20:26:22\ntags: PHP7\n---\n\n#### 前言\n这次，我们将演示如果在PHP拓展中接收传参和输出返回值\n实现大代码效果和下面一样\n```php\n<?php\nfunction default_value($type, $value = null) {\n\tif ($type = 'int') {\n\t\treturn $value ?? 0;\n\t} else if ($type = 'bool') {\n\t\treturn $value ?? false;\t\n\t} else if ($type = 'str') {\n\t\treturn is_null($value) ? \"\" : $value;\n\t}\n\treturn null;\n\t\n}\n\n    var_dump(default_value(\"int\"));\n    var_dump(default_value(\"int\", 1));\n    var_dump(default_value(\"bool\"));\n    var_dump(default_value(\"bool\", true));\n    var_dump(default_value(\"str\"));\n    var_dump(default_value(\"str\", \"a\"));\n    var_dump(default_value(\"array\"));\n\n\n?>\n```\n\n#### 代码实现\n##### 基础代码\n```cpp\nPHP_FUNCTION(default_value)\n{\n    zend_string     *type;    \n    zval            *value = NULL;\n\n#ifndef FAST_ZPP\n    /* Get function parameters and do error-checking. */\n    if (zend_parse_parameters(ZEND_NUM_ARGS(), \"S|z\", &type, &value) == FAILURE) {\n        return;\n    }    \n#else\n    ZEND_PARSE_PARAMETERS_START(1, 2)\n        Z_PARAM_STR(type)\n        Z_PARAM_OPTIONAL\n        Z_PARAM_ZVAL_EX(value, 0, 1)\n    ZEND_PARSE_PARAMETERS_END();\n#endif\n\n    if (ZSTR_LEN(type) == 3 && strncmp(ZSTR_VAL(type), \"int\", 3) == 0 && value == NULL) {\n        RETURN_LONG(0);\n    } else if (ZSTR_LEN(type) == 3 && strncmp(ZSTR_VAL(type), \"int\", 3) == 0 && value != NULL) {\n        RETURN_ZVAL(value, 0, 1); \n    } else if (ZSTR_LEN(type) == 4 && strncmp(ZSTR_VAL(type), \"bool\", 4) == 0 && value == NULL) {\n        RETURN_FALSE;\n    } else if (ZSTR_LEN(type) == 4 && strncmp(ZSTR_VAL(type), \"bool\", 4) == 0 && value != NULL) {\n        RETURN_ZVAL(value, 0, 1); \n    } else if (ZSTR_LEN(type) == 3 && strncmp(ZSTR_VAL(type), \"str\", 3) == 0 && value == NULL) {\n        RETURN_EMPTY_STRING();\n    } else if (ZSTR_LEN(type) == 3 && strncmp(ZSTR_VAL(type), \"str\", 3) == 0 && value != NULL) {\n        RETURN_ZVAL(value, 0, 1); \n    } \n    RETURN_NULL();\n}\n```","slug":"PHP7拓展开发-函数的传参和返回值","published":1,"updated":"2017-05-31T12:27:23.402Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv325001a0oqm7wbaff0b","content":"<h4 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h4><p>这次，我们将演示如果在PHP拓展中接收传参和输出返回值<br>实现大代码效果和下面一样<br><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">default_value</span><span class=\"params\">($type, $value = null)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span> ($type = <span class=\"string\">'int'</span>) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> $value ?? <span class=\"number\">0</span>;</div><div class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ($type = <span class=\"string\">'bool'</span>) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> $value ?? <span class=\"keyword\">false</span>;\t</div><div class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ($type = <span class=\"string\">'str'</span>) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> is_null($value) ? <span class=\"string\">\"\"</span> : $value;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">\t</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"int\"</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"int\"</span>, <span class=\"number\">1</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"bool\"</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"bool\"</span>, <span class=\"keyword\">true</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"str\"</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"str\"</span>, <span class=\"string\">\"a\"</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"array\"</span>));</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h4><h5 id=\"基础代码\"><a href=\"#基础代码\" class=\"headerlink\" title=\"基础代码\"></a>基础代码</h5><figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_FUNCTION(default_value)</div><div class=\"line\">&#123;</div><div class=\"line\">    zend_string     *type;    </div><div class=\"line\">    zval            *value = <span class=\"literal\">NULL</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> FAST_ZPP</span></div><div class=\"line\">    <span class=\"comment\">/* Get function parameters and do error-checking. */</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (zend_parse_parameters(ZEND_NUM_ARGS(), <span class=\"string\">\"S|z\"</span>, &amp;type, &amp;value) == FAILURE) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;    </div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\">    ZEND_PARSE_PARAMETERS_START(<span class=\"number\">1</span>, <span class=\"number\">2</span>)</div><div class=\"line\">        Z_PARAM_STR(type)</div><div class=\"line\">        <span class=\"function\">Z_PARAM_OPTIONAL</span></div><div class=\"line\">        <span class=\"title\">Z_PARAM_ZVAL_EX</span><span class=\"params\">(value, <span class=\"number\">0</span>, <span class=\"number\">1</span>)</span></div><div class=\"line\">    <span class=\"title\">ZEND_PARSE_PARAMETERS_END</span><span class=\"params\">()</span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">3</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"int\"</span>, <span class=\"number\">3</span>) == <span class=\"number\">0</span> &amp;&amp; value == <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_LONG(<span class=\"number\">0</span>);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">3</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"int\"</span>, <span class=\"number\">3</span>) == <span class=\"number\">0</span> &amp;&amp; value != <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_ZVAL(value, <span class=\"number\">0</span>, <span class=\"number\">1</span>); </div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">4</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"bool\"</span>, <span class=\"number\">4</span>) == <span class=\"number\">0</span> &amp;&amp; value == <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_FALSE;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">4</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"bool\"</span>, <span class=\"number\">4</span>) == <span class=\"number\">0</span> &amp;&amp; value != <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_ZVAL(value, <span class=\"number\">0</span>, <span class=\"number\">1</span>); </div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">3</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"str\"</span>, <span class=\"number\">3</span>) == <span class=\"number\">0</span> &amp;&amp; value == <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_EMPTY_STRING();</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">3</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"str\"</span>, <span class=\"number\">3</span>) == <span class=\"number\">0</span> &amp;&amp; value != <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_ZVAL(value, <span class=\"number\">0</span>, <span class=\"number\">1</span>); </div><div class=\"line\">    &#125; </div><div class=\"line\">    RETURN_NULL();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","excerpt":"","more":"<h4 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h4><p>这次，我们将演示如果在PHP拓展中接收传参和输出返回值<br>实现大代码效果和下面一样<br><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">default_value</span><span class=\"params\">($type, $value = null)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span> ($type = <span class=\"string\">'int'</span>) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> $value ?? <span class=\"number\">0</span>;</div><div class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ($type = <span class=\"string\">'bool'</span>) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> $value ?? <span class=\"keyword\">false</span>;\t</div><div class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ($type = <span class=\"string\">'str'</span>) &#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> is_null($value) ? <span class=\"string\">\"\"</span> : $value;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">\t</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"int\"</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"int\"</span>, <span class=\"number\">1</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"bool\"</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"bool\"</span>, <span class=\"keyword\">true</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"str\"</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"str\"</span>, <span class=\"string\">\"a\"</span>));</div><div class=\"line\">    var_dump(default_value(<span class=\"string\">\"array\"</span>));</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h4><h5 id=\"基础代码\"><a href=\"#基础代码\" class=\"headerlink\" title=\"基础代码\"></a>基础代码</h5><figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\">PHP_FUNCTION(default_value)</div><div class=\"line\">&#123;</div><div class=\"line\">    zend_string     *type;    </div><div class=\"line\">    zval            *value = <span class=\"literal\">NULL</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifndef</span> FAST_ZPP</span></div><div class=\"line\">    <span class=\"comment\">/* Get function parameters and do error-checking. */</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (zend_parse_parameters(ZEND_NUM_ARGS(), <span class=\"string\">\"S|z\"</span>, &amp;type, &amp;value) == FAILURE) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;    </div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></div><div class=\"line\">    ZEND_PARSE_PARAMETERS_START(<span class=\"number\">1</span>, <span class=\"number\">2</span>)</div><div class=\"line\">        Z_PARAM_STR(type)</div><div class=\"line\">        <span class=\"function\">Z_PARAM_OPTIONAL</div><div class=\"line\">        <span class=\"title\">Z_PARAM_ZVAL_EX</span><span class=\"params\">(value, <span class=\"number\">0</span>, <span class=\"number\">1</span>)</span></div><div class=\"line\">    <span class=\"title\">ZEND_PARSE_PARAMETERS_END</span><span class=\"params\">()</span></span>;</div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">3</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"int\"</span>, <span class=\"number\">3</span>) == <span class=\"number\">0</span> &amp;&amp; value == <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_LONG(<span class=\"number\">0</span>);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">3</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"int\"</span>, <span class=\"number\">3</span>) == <span class=\"number\">0</span> &amp;&amp; value != <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_ZVAL(value, <span class=\"number\">0</span>, <span class=\"number\">1</span>); </div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">4</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"bool\"</span>, <span class=\"number\">4</span>) == <span class=\"number\">0</span> &amp;&amp; value == <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_FALSE;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">4</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"bool\"</span>, <span class=\"number\">4</span>) == <span class=\"number\">0</span> &amp;&amp; value != <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_ZVAL(value, <span class=\"number\">0</span>, <span class=\"number\">1</span>); </div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">3</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"str\"</span>, <span class=\"number\">3</span>) == <span class=\"number\">0</span> &amp;&amp; value == <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_EMPTY_STRING();</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (ZSTR_LEN(type) == <span class=\"number\">3</span> &amp;&amp; <span class=\"built_in\">strncmp</span>(ZSTR_VAL(type), <span class=\"string\">\"str\"</span>, <span class=\"number\">3</span>) == <span class=\"number\">0</span> &amp;&amp; value != <span class=\"literal\">NULL</span>) &#123;</div><div class=\"line\">        RETURN_ZVAL(value, <span class=\"number\">0</span>, <span class=\"number\">1</span>); </div><div class=\"line\">    &#125; </div><div class=\"line\">    RETURN_NULL();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"PHP 零散函数（一）","date":"2016-09-23T08:00:36.000Z","_content":"\n#### parse_url\n\n```php\nmixed parse_url ( string $url [, int $component = -1 ] )\n\n```\n<br>\n#### 作用：\n> 解析一个URL并返回一个关联数组，包含URL各个组成部分\n\n> *本函数不是用来验证给定 URL 的合法性的，只是将其分解为下面列出的部分。不完整的 URL 也被接受，parse_url() 会尝试尽量正确地将其解析。*\n\n```php\n$url = \"http://3c.ycwb.com/2016-09/21/content_23077306.htm?name=tyler&pass=123\";\n$parse_array = parse_url($url);\necho \"<pre>\";\nprint_r($parse_array);\necho \"</pre>\";\n//export:\n//Array\n//(\n//    [scheme] => http\n//    [host] => 3c.ycwb.com\n//    [path] => /2016-09/21/content_23077306.htm\n//    [query] => name=tyler&pass=123\n//)\n```\n\n#### parse_str\n\n```php\nvoid parse_str ( string $str [, array &$arr ] )\n\n```\n<br>\n\n#### 作用：\n> 如果 str 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域\n\n> 如果设置了第二个变量 arr，变量将会以数组元素的形式存入到这个数组，作为替代。\n\n```php\n$str = \"first=value&arr[]=foo+bar&arr[]=baz\";\nparse_str($str);\necho $first;  // value\necho $arr[0]; // foo bar\necho $arr[1]; // baz\n\nparse_str($str, $output);\necho $output['first'];  // value\necho $output['arr'][0]; // foo bar\necho $output['arr'][1]; // baz\n\n```","source":"_posts/PHP-零散函数（一）.md","raw":"---\ntitle: PHP 零散函数（一）\ndate: 2016-09-23 16:00:36\ntags:\n---\n\n#### parse_url\n\n```php\nmixed parse_url ( string $url [, int $component = -1 ] )\n\n```\n<br>\n#### 作用：\n> 解析一个URL并返回一个关联数组，包含URL各个组成部分\n\n> *本函数不是用来验证给定 URL 的合法性的，只是将其分解为下面列出的部分。不完整的 URL 也被接受，parse_url() 会尝试尽量正确地将其解析。*\n\n```php\n$url = \"http://3c.ycwb.com/2016-09/21/content_23077306.htm?name=tyler&pass=123\";\n$parse_array = parse_url($url);\necho \"<pre>\";\nprint_r($parse_array);\necho \"</pre>\";\n//export:\n//Array\n//(\n//    [scheme] => http\n//    [host] => 3c.ycwb.com\n//    [path] => /2016-09/21/content_23077306.htm\n//    [query] => name=tyler&pass=123\n//)\n```\n\n#### parse_str\n\n```php\nvoid parse_str ( string $str [, array &$arr ] )\n\n```\n<br>\n\n#### 作用：\n> 如果 str 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域\n\n> 如果设置了第二个变量 arr，变量将会以数组元素的形式存入到这个数组，作为替代。\n\n```php\n$str = \"first=value&arr[]=foo+bar&arr[]=baz\";\nparse_str($str);\necho $first;  // value\necho $arr[0]; // foo bar\necho $arr[1]; // baz\n\nparse_str($str, $output);\necho $output['first'];  // value\necho $output['arr'][0]; // foo bar\necho $output['arr'][1]; // baz\n\n```","slug":"PHP-零散函数（一）","published":1,"updated":"2016-09-23T08:14:07.688Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv327001d0oqmd49r4v1s","content":"<h4 id=\"parse-url\"><a href=\"#parse-url\" class=\"headerlink\" title=\"parse_url\"></a>parse_url</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">mixed parse_url ( string $url [, int $component = <span class=\"number\">-1</span> ] )</div></pre></td></tr></table></figure>\n<p><br></p>\n<h4 id=\"作用：\"><a href=\"#作用：\" class=\"headerlink\" title=\"作用：\"></a>作用：</h4><blockquote>\n<p>解析一个URL并返回一个关联数组，包含URL各个组成部分</p>\n<p><em>本函数不是用来验证给定 URL 的合法性的，只是将其分解为下面列出的部分。不完整的 URL 也被接受，parse_url() 会尝试尽量正确地将其解析。</em></p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$url = <span class=\"string\">\"http://3c.ycwb.com/2016-09/21/content_23077306.htm?name=tyler&amp;pass=123\"</span>;</div><div class=\"line\">$parse_array = parse_url($url);</div><div class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;pre&gt;\"</span>;</div><div class=\"line\">print_r($parse_array);</div><div class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/pre&gt;\"</span>;</div><div class=\"line\"><span class=\"comment\">//export:</span></div><div class=\"line\"><span class=\"comment\">//Array</span></div><div class=\"line\"><span class=\"comment\">//(</span></div><div class=\"line\"><span class=\"comment\">//    [scheme] =&gt; http</span></div><div class=\"line\"><span class=\"comment\">//    [host] =&gt; 3c.ycwb.com</span></div><div class=\"line\"><span class=\"comment\">//    [path] =&gt; /2016-09/21/content_23077306.htm</span></div><div class=\"line\"><span class=\"comment\">//    [query] =&gt; name=tyler&amp;pass=123</span></div><div class=\"line\"><span class=\"comment\">//)</span></div></pre></td></tr></table></figure>\n<h4 id=\"parse-str\"><a href=\"#parse-str\" class=\"headerlink\" title=\"parse_str\"></a>parse_str</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">void parse_str ( string $str [, <span class=\"keyword\">array</span> &amp;$arr ] )</div></pre></td></tr></table></figure>\n<p><br></p>\n<h4 id=\"作用：-1\"><a href=\"#作用：-1\" class=\"headerlink\" title=\"作用：\"></a>作用：</h4><blockquote>\n<p>如果 str 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域</p>\n<p>如果设置了第二个变量 arr，变量将会以数组元素的形式存入到这个数组，作为替代。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$str = <span class=\"string\">\"first=value&amp;arr[]=foo+bar&amp;arr[]=baz\"</span>;</div><div class=\"line\">parse_str($str);</div><div class=\"line\"><span class=\"keyword\">echo</span> $first;  <span class=\"comment\">// value</span></div><div class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"number\">0</span>]; <span class=\"comment\">// foo bar</span></div><div class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"number\">1</span>]; <span class=\"comment\">// baz</span></div><div class=\"line\"></div><div class=\"line\">parse_str($str, $output);</div><div class=\"line\"><span class=\"keyword\">echo</span> $output[<span class=\"string\">'first'</span>];  <span class=\"comment\">// value</span></div><div class=\"line\"><span class=\"keyword\">echo</span> $output[<span class=\"string\">'arr'</span>][<span class=\"number\">0</span>]; <span class=\"comment\">// foo bar</span></div><div class=\"line\"><span class=\"keyword\">echo</span> $output[<span class=\"string\">'arr'</span>][<span class=\"number\">1</span>]; <span class=\"comment\">// baz</span></div></pre></td></tr></table></figure>","excerpt":"","more":"<h4 id=\"parse-url\"><a href=\"#parse-url\" class=\"headerlink\" title=\"parse_url\"></a>parse_url</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">mixed parse_url ( string $url [, int $component = <span class=\"number\">-1</span> ] )</div></pre></td></tr></table></figure>\n<p><br></p>\n<h4 id=\"作用：\"><a href=\"#作用：\" class=\"headerlink\" title=\"作用：\"></a>作用：</h4><blockquote>\n<p>解析一个URL并返回一个关联数组，包含URL各个组成部分</p>\n<p><em>本函数不是用来验证给定 URL 的合法性的，只是将其分解为下面列出的部分。不完整的 URL 也被接受，parse_url() 会尝试尽量正确地将其解析。</em></p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$url = <span class=\"string\">\"http://3c.ycwb.com/2016-09/21/content_23077306.htm?name=tyler&amp;pass=123\"</span>;</div><div class=\"line\">$parse_array = parse_url($url);</div><div class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;pre&gt;\"</span>;</div><div class=\"line\">print_r($parse_array);</div><div class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">\"&lt;/pre&gt;\"</span>;</div><div class=\"line\"><span class=\"comment\">//export:</span></div><div class=\"line\"><span class=\"comment\">//Array</span></div><div class=\"line\"><span class=\"comment\">//(</span></div><div class=\"line\"><span class=\"comment\">//    [scheme] =&gt; http</span></div><div class=\"line\"><span class=\"comment\">//    [host] =&gt; 3c.ycwb.com</span></div><div class=\"line\"><span class=\"comment\">//    [path] =&gt; /2016-09/21/content_23077306.htm</span></div><div class=\"line\"><span class=\"comment\">//    [query] =&gt; name=tyler&amp;pass=123</span></div><div class=\"line\"><span class=\"comment\">//)</span></div></pre></td></tr></table></figure>\n<h4 id=\"parse-str\"><a href=\"#parse-str\" class=\"headerlink\" title=\"parse_str\"></a>parse_str</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">void parse_str ( string $str [, <span class=\"keyword\">array</span> &amp;$arr ] )</div></pre></td></tr></table></figure>\n<p><br></p>\n<h4 id=\"作用：-1\"><a href=\"#作用：-1\" class=\"headerlink\" title=\"作用：\"></a>作用：</h4><blockquote>\n<p>如果 str 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域</p>\n<p>如果设置了第二个变量 arr，变量将会以数组元素的形式存入到这个数组，作为替代。</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$str = <span class=\"string\">\"first=value&amp;arr[]=foo+bar&amp;arr[]=baz\"</span>;</div><div class=\"line\">parse_str($str);</div><div class=\"line\"><span class=\"keyword\">echo</span> $first;  <span class=\"comment\">// value</span></div><div class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"number\">0</span>]; <span class=\"comment\">// foo bar</span></div><div class=\"line\"><span class=\"keyword\">echo</span> $arr[<span class=\"number\">1</span>]; <span class=\"comment\">// baz</span></div><div class=\"line\"></div><div class=\"line\">parse_str($str, $output);</div><div class=\"line\"><span class=\"keyword\">echo</span> $output[<span class=\"string\">'first'</span>];  <span class=\"comment\">// value</span></div><div class=\"line\"><span class=\"keyword\">echo</span> $output[<span class=\"string\">'arr'</span>][<span class=\"number\">0</span>]; <span class=\"comment\">// foo bar</span></div><div class=\"line\"><span class=\"keyword\">echo</span> $output[<span class=\"string\">'arr'</span>][<span class=\"number\">1</span>]; <span class=\"comment\">// baz</span></div></pre></td></tr></table></figure>"},{"title":"PHP实现RSA加密、解密操作","date":"2016-09-09T10:49:15.000Z","_content":"\n#### [RSA生成工具](https://os.alipayobjects.com/download/secret_key_tools_RSA_win.zip)\n\n#### 现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名`sign`验证。\n\n####   签名的作用\n\n#### 签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。\n\n#### RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。\n\n#### 使用方法\n> * 使用私钥进行加密，公钥用于解密\n> * 私钥和公钥嘴放放在server上面，并且放在非项目目录，防止泄露 \n\n\n\n\n#### 实现代码\n\n```php\n//生成签名\nfunction build_sign($data) {\n\t$private_key = openssl_pkey_get_private('file://C:/key/rsa_private_key.pem');//私钥位置\n\topenssl_sign($data, $sign, OPENSSL_ALGO_SHA1);\n\t$sign = base64_encode($sign);\n\t\n\treturn $sign;\n}\n//解密\nfunction check_sign($date, $sign) {\n\t$sign = base64_decode($sign);\n\t$public_key = openssl_pkey_get_public('file://C:/key/rsa_public_key.pem');//公钥位置\n\t$result = openssl_verify($data, $sign, $key, OPENSSL_ALGO_SHA1) == 1;\n\n\treturn $result;\n}\n```","source":"_posts/PHP实现RSA加密、解密操作.md","raw":"---\ntitle: PHP实现RSA加密、解密操作\ndate: 2016-09-09 18:49:15\ntags:\ncategories: PHP\n---\n\n#### [RSA生成工具](https://os.alipayobjects.com/download/secret_key_tools_RSA_win.zip)\n\n#### 现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名`sign`验证。\n\n####   签名的作用\n\n#### 签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。\n\n#### RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。\n\n#### 使用方法\n> * 使用私钥进行加密，公钥用于解密\n> * 私钥和公钥嘴放放在server上面，并且放在非项目目录，防止泄露 \n\n\n\n\n#### 实现代码\n\n```php\n//生成签名\nfunction build_sign($data) {\n\t$private_key = openssl_pkey_get_private('file://C:/key/rsa_private_key.pem');//私钥位置\n\topenssl_sign($data, $sign, OPENSSL_ALGO_SHA1);\n\t$sign = base64_encode($sign);\n\t\n\treturn $sign;\n}\n//解密\nfunction check_sign($date, $sign) {\n\t$sign = base64_decode($sign);\n\t$public_key = openssl_pkey_get_public('file://C:/key/rsa_public_key.pem');//公钥位置\n\t$result = openssl_verify($data, $sign, $key, OPENSSL_ALGO_SHA1) == 1;\n\n\treturn $result;\n}\n```","slug":"PHP实现RSA加密、解密操作","published":1,"updated":"2016-09-09T10:51:31.673Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32b001h0oqmvhdnp8g3","content":"<h4 id=\"RSA生成工具\"><a href=\"#RSA生成工具\" class=\"headerlink\" title=\"RSA生成工具\"></a><a href=\"https://os.alipayobjects.com/download/secret_key_tools_RSA_win.zip\" target=\"_blank\" rel=\"external\">RSA生成工具</a></h4><h4 id=\"现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名sign验证。\"><a href=\"#现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名sign验证。\" class=\"headerlink\" title=\"现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名sign验证。\"></a>现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名<code>sign</code>验证。</h4><h4 id=\"签名的作用\"><a href=\"#签名的作用\" class=\"headerlink\" title=\"签名的作用\"></a>签名的作用</h4><h4 id=\"签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。\"><a href=\"#签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。\" class=\"headerlink\" title=\"签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。\"></a>签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。</h4><h4 id=\"RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。\"><a href=\"#RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。\" class=\"headerlink\" title=\"RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。\"></a>RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。</h4><h4 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h4><blockquote>\n<ul>\n<li>使用私钥进行加密，公钥用于解密</li>\n<li>私钥和公钥嘴放放在server上面，并且放在非项目目录，防止泄露 </li>\n</ul>\n</blockquote>\n<h4 id=\"实现代码\"><a href=\"#实现代码\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//生成签名</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">build_sign</span><span class=\"params\">($data)</span> </span>&#123;</div><div class=\"line\">\t$private_key = openssl_pkey_get_private(<span class=\"string\">'file://C:/key/rsa_private_key.pem'</span>);<span class=\"comment\">//私钥位置</span></div><div class=\"line\">\topenssl_sign($data, $sign, OPENSSL_ALGO_SHA1);</div><div class=\"line\">\t$sign = base64_encode($sign);</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"keyword\">return</span> $sign;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//解密</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">check_sign</span><span class=\"params\">($date, $sign)</span> </span>&#123;</div><div class=\"line\">\t$sign = base64_decode($sign);</div><div class=\"line\">\t$public_key = openssl_pkey_get_public(<span class=\"string\">'file://C:/key/rsa_public_key.pem'</span>);<span class=\"comment\">//公钥位置</span></div><div class=\"line\">\t$result = openssl_verify($data, $sign, $key, OPENSSL_ALGO_SHA1) == <span class=\"number\">1</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">return</span> $result;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>","excerpt":"","more":"<h4 id=\"RSA生成工具\"><a href=\"#RSA生成工具\" class=\"headerlink\" title=\"RSA生成工具\"></a><a href=\"https://os.alipayobjects.com/download/secret_key_tools_RSA_win.zip\">RSA生成工具</a></h4><h4 id=\"现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名sign验证。\"><a href=\"#现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名sign验证。\" class=\"headerlink\" title=\"现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名sign验证。\"></a>现在越来越多的人注重安全问题，尤其是在支付过程中，不管是卖家还是买家都希望交易过程中不出现任何差错，顺利进行，没有损失。所以在各大支付接口都在支付过程中加入了签名<code>sign</code>验证。</h4><h4 id=\"签名的作用\"><a href=\"#签名的作用\" class=\"headerlink\" title=\"签名的作用\"></a>签名的作用</h4><h4 id=\"签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。\"><a href=\"#签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。\" class=\"headerlink\" title=\"签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。\"></a>签名有个最基本的作用就是安全，你可以把一些数据生成签名一块传过去，接收方通过接收的数据和签名，进行验签，如果验证通过，则继续下一个逻辑。这样做防止传输过程中数据被篡改或者丢失造成的损失。</h4><h4 id=\"RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。\"><a href=\"#RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。\" class=\"headerlink\" title=\"RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。\"></a>RSA签名是目前最具影响力的公钥加密算法，可以抵制绝大多数密码攻击，而且秘钥比较长，不容易破解。</h4><h4 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h4><blockquote>\n<ul>\n<li>使用私钥进行加密，公钥用于解密</li>\n<li>私钥和公钥嘴放放在server上面，并且放在非项目目录，防止泄露 </li>\n</ul>\n</blockquote>\n<h4 id=\"实现代码\"><a href=\"#实现代码\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//生成签名</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">build_sign</span><span class=\"params\">($data)</span> </span>&#123;</div><div class=\"line\">\t$private_key = openssl_pkey_get_private(<span class=\"string\">'file://C:/key/rsa_private_key.pem'</span>);<span class=\"comment\">//私钥位置</span></div><div class=\"line\">\topenssl_sign($data, $sign, OPENSSL_ALGO_SHA1);</div><div class=\"line\">\t$sign = base64_encode($sign);</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"keyword\">return</span> $sign;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"comment\">//解密</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">check_sign</span><span class=\"params\">($date, $sign)</span> </span>&#123;</div><div class=\"line\">\t$sign = base64_decode($sign);</div><div class=\"line\">\t$public_key = openssl_pkey_get_public(<span class=\"string\">'file://C:/key/rsa_public_key.pem'</span>);<span class=\"comment\">//公钥位置</span></div><div class=\"line\">\t$result = openssl_verify($data, $sign, $key, OPENSSL_ALGO_SHA1) == <span class=\"number\">1</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"keyword\">return</span> $result;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"PHP拓展开发--函数的传参和返回值","date":"2017-05-31T12:25:43.000Z","_content":"","source":"_posts/PHP拓展开发-函数的传参和返回值.md","raw":"---\ntitle: PHP拓展开发--函数的传参和返回值\ndate: 2017-05-31 20:25:43\ntags:\n---\n","slug":"PHP拓展开发-函数的传参和返回值","published":1,"updated":"2017-05-31T12:25:43.082Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32d001j0oqm8a8n4d21","content":"","excerpt":"","more":""},{"title":"PHP使用fastcgi_finish_request 提高响应","date":"2016-10-17T12:00:18.000Z","_content":"\n#### 当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做`fastcgi_finish_request`的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。\n\n#### 听起来挺迷茫的，下面给大家举个例子\n\n```php\n<?php\n\techo 'This is example1';\n\tfastcgi_finish_request();\n\techo 'This is example2';\n\tfile_put_contents('/var/log/test.log', 'hello world');\n\n?>\n```\n\n#### 当通过浏览器访问的时候，页面会输出`This is example1`，但是没有输出`This is example2`同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi_finish_request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。\n\n#### 再来个直观的例子\n\n```php\n<?php\n\techo 'This is example1';\n\tfastcgi_finish_request();\n\techo 'This is example2';\n\tfile_put_contents('/var/log/test.log', time('Y-m-d H:i:s', time()), FILE_APPEND);\n\tsleep(1);\n\tfile_put_contents('/var/log/test.log', time('Y-m-d H:i:s', time()), FILE_APPEND);\n\tsleep(1);\n\tfile_put_contents('/var/log/test.log', time('Y-m-d H:i:s', time()), FILE_APPEND);\n?>\n```\n#### 执行的结果就是页面值输出了`This is example1`,服务器记录了三条日志信息。\n\n#### 个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。\n\n#### 另外，在代码移植上建议加上如下代码\n```php\n<?php\n\tif (!function_exists(\"fastcgi_finish_request\")) {\n\t      function fastcgi_finish_request()  {\n\t      }\n\t}\n?>\n```\n\n#### fastcgi_finish_request虽然很好用，但是也有很多限制：\n* PHP fastcgi有进程限制，如果并发太大的话，没办法处理新的请求，nginx可能会出现502 bad request\n\n内容参考鸟哥博客[使用fastcgi_finish_request提高页面响应速度](http://www.laruence.com/2011/04/13/1991.html)\n\n","source":"_posts/PHP使用fastcgi-finish-request-提高响应.md","raw":"---\ntitle: PHP使用fastcgi_finish_request 提高响应\ndate: 2016-10-17 20:00:18\ntags: PHP\ncategories: PHP\n---\n\n#### 当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做`fastcgi_finish_request`的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。\n\n#### 听起来挺迷茫的，下面给大家举个例子\n\n```php\n<?php\n\techo 'This is example1';\n\tfastcgi_finish_request();\n\techo 'This is example2';\n\tfile_put_contents('/var/log/test.log', 'hello world');\n\n?>\n```\n\n#### 当通过浏览器访问的时候，页面会输出`This is example1`，但是没有输出`This is example2`同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi_finish_request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。\n\n#### 再来个直观的例子\n\n```php\n<?php\n\techo 'This is example1';\n\tfastcgi_finish_request();\n\techo 'This is example2';\n\tfile_put_contents('/var/log/test.log', time('Y-m-d H:i:s', time()), FILE_APPEND);\n\tsleep(1);\n\tfile_put_contents('/var/log/test.log', time('Y-m-d H:i:s', time()), FILE_APPEND);\n\tsleep(1);\n\tfile_put_contents('/var/log/test.log', time('Y-m-d H:i:s', time()), FILE_APPEND);\n?>\n```\n#### 执行的结果就是页面值输出了`This is example1`,服务器记录了三条日志信息。\n\n#### 个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。\n\n#### 另外，在代码移植上建议加上如下代码\n```php\n<?php\n\tif (!function_exists(\"fastcgi_finish_request\")) {\n\t      function fastcgi_finish_request()  {\n\t      }\n\t}\n?>\n```\n\n#### fastcgi_finish_request虽然很好用，但是也有很多限制：\n* PHP fastcgi有进程限制，如果并发太大的话，没办法处理新的请求，nginx可能会出现502 bad request\n\n内容参考鸟哥博客[使用fastcgi_finish_request提高页面响应速度](http://www.laruence.com/2011/04/13/1991.html)\n\n","slug":"PHP使用fastcgi-finish-request-提高响应","published":1,"updated":"2016-10-17T12:01:16.457Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32f001l0oqms2up1f03","content":"<h4 id=\"当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做fastcgi-finish-request的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。\"><a href=\"#当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做fastcgi-finish-request的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。\" class=\"headerlink\" title=\"当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做fastcgi_finish_request的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。\"></a>当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做<code>fastcgi_finish_request</code>的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。</h4><h4 id=\"听起来挺迷茫的，下面给大家举个例子\"><a href=\"#听起来挺迷茫的，下面给大家举个例子\" class=\"headerlink\" title=\"听起来挺迷茫的，下面给大家举个例子\"></a>听起来挺迷茫的，下面给大家举个例子</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">'This is example1'</span>;</div><div class=\"line\">\tfastcgi_finish_request();</div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">'This is example2'</span>;</div><div class=\"line\">\tfile_put_contents(<span class=\"string\">'/var/log/test.log'</span>, <span class=\"string\">'hello world'</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"当通过浏览器访问的时候，页面会输出This-is-example1，但是没有输出This-is-example2同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi-finish-request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。\"><a href=\"#当通过浏览器访问的时候，页面会输出This-is-example1，但是没有输出This-is-example2同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi-finish-request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。\" class=\"headerlink\" title=\"当通过浏览器访问的时候，页面会输出This is example1，但是没有输出This is example2同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi_finish_request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。\"></a>当通过浏览器访问的时候，页面会输出<code>This is example1</code>，但是没有输出<code>This is example2</code>同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi_finish_request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。</h4><h4 id=\"再来个直观的例子\"><a href=\"#再来个直观的例子\" class=\"headerlink\" title=\"再来个直观的例子\"></a>再来个直观的例子</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">'This is example1'</span>;</div><div class=\"line\">\tfastcgi_finish_request();</div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">'This is example2'</span>;</div><div class=\"line\">\tfile_put_contents(<span class=\"string\">'/var/log/test.log'</span>, time(<span class=\"string\">'Y-m-d H:i:s'</span>, time()), FILE_APPEND);</div><div class=\"line\">\tsleep(<span class=\"number\">1</span>);</div><div class=\"line\">\tfile_put_contents(<span class=\"string\">'/var/log/test.log'</span>, time(<span class=\"string\">'Y-m-d H:i:s'</span>, time()), FILE_APPEND);</div><div class=\"line\">\tsleep(<span class=\"number\">1</span>);</div><div class=\"line\">\tfile_put_contents(<span class=\"string\">'/var/log/test.log'</span>, time(<span class=\"string\">'Y-m-d H:i:s'</span>, time()), FILE_APPEND);</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"执行的结果就是页面值输出了This-is-example1-服务器记录了三条日志信息。\"><a href=\"#执行的结果就是页面值输出了This-is-example1-服务器记录了三条日志信息。\" class=\"headerlink\" title=\"执行的结果就是页面值输出了This is example1,服务器记录了三条日志信息。\"></a>执行的结果就是页面值输出了<code>This is example1</code>,服务器记录了三条日志信息。</h4><h4 id=\"个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。\"><a href=\"#个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。\" class=\"headerlink\" title=\"个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。\"></a>个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。</h4><h4 id=\"另外，在代码移植上建议加上如下代码\"><a href=\"#另外，在代码移植上建议加上如下代码\" class=\"headerlink\" title=\"另外，在代码移植上建议加上如下代码\"></a>另外，在代码移植上建议加上如下代码</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">\t<span class=\"keyword\">if</span> (!function_exists(<span class=\"string\">\"fastcgi_finish_request\"</span>)) &#123;</div><div class=\"line\">\t      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fastcgi_finish_request</span><span class=\"params\">()</span>  </span>&#123;</div><div class=\"line\">\t      &#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"fastcgi-finish-request虽然很好用，但是也有很多限制：\"><a href=\"#fastcgi-finish-request虽然很好用，但是也有很多限制：\" class=\"headerlink\" title=\"fastcgi_finish_request虽然很好用，但是也有很多限制：\"></a>fastcgi_finish_request虽然很好用，但是也有很多限制：</h4><ul>\n<li>PHP fastcgi有进程限制，如果并发太大的话，没办法处理新的请求，nginx可能会出现502 bad request</li>\n</ul>\n<p>内容参考鸟哥博客<a href=\"http://www.laruence.com/2011/04/13/1991.html\" target=\"_blank\" rel=\"external\">使用fastcgi_finish_request提高页面响应速度</a></p>\n","excerpt":"","more":"<h4 id=\"当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做fastcgi-finish-request的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。\"><a href=\"#当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做fastcgi-finish-request的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。\" class=\"headerlink\" title=\"当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做fastcgi_finish_request的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。\"></a>当PHP在运行fastcgi模式的时候，php-fpm提供了一个函数，叫做<code>fastcgi_finish_request</code>的函数，来加快处理请求，如果有些后端请求可以先生成页面再处理的话，可以选择这个函数。</h4><h4 id=\"听起来挺迷茫的，下面给大家举个例子\"><a href=\"#听起来挺迷茫的，下面给大家举个例子\" class=\"headerlink\" title=\"听起来挺迷茫的，下面给大家举个例子\"></a>听起来挺迷茫的，下面给大家举个例子</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">'This is example1'</span>;</div><div class=\"line\">\tfastcgi_finish_request();</div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">'This is example2'</span>;</div><div class=\"line\">\tfile_put_contents(<span class=\"string\">'/var/log/test.log'</span>, <span class=\"string\">'hello world'</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"当通过浏览器访问的时候，页面会输出This-is-example1，但是没有输出This-is-example2同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi-finish-request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。\"><a href=\"#当通过浏览器访问的时候，页面会输出This-is-example1，但是没有输出This-is-example2同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi-finish-request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。\" class=\"headerlink\" title=\"当通过浏览器访问的时候，页面会输出This is example1，但是没有输出This is example2同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi_finish_request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。\"></a>当通过浏览器访问的时候，页面会输出<code>This is example1</code>，但是没有输出<code>This is example2</code>同时，也把内容写入到了日志文件中。这说明，当PHP执行到了fastcgi_finish_request的时候，服务器就和客户端结束了请求，但是服务器还是继续“异步”执行。</h4><h4 id=\"再来个直观的例子\"><a href=\"#再来个直观的例子\" class=\"headerlink\" title=\"再来个直观的例子\"></a>再来个直观的例子</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">'This is example1'</span>;</div><div class=\"line\">\tfastcgi_finish_request();</div><div class=\"line\">\t<span class=\"keyword\">echo</span> <span class=\"string\">'This is example2'</span>;</div><div class=\"line\">\tfile_put_contents(<span class=\"string\">'/var/log/test.log'</span>, time(<span class=\"string\">'Y-m-d H:i:s'</span>, time()), FILE_APPEND);</div><div class=\"line\">\tsleep(<span class=\"number\">1</span>);</div><div class=\"line\">\tfile_put_contents(<span class=\"string\">'/var/log/test.log'</span>, time(<span class=\"string\">'Y-m-d H:i:s'</span>, time()), FILE_APPEND);</div><div class=\"line\">\tsleep(<span class=\"number\">1</span>);</div><div class=\"line\">\tfile_put_contents(<span class=\"string\">'/var/log/test.log'</span>, time(<span class=\"string\">'Y-m-d H:i:s'</span>, time()), FILE_APPEND);</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"执行的结果就是页面值输出了This-is-example1-服务器记录了三条日志信息。\"><a href=\"#执行的结果就是页面值输出了This-is-example1-服务器记录了三条日志信息。\" class=\"headerlink\" title=\"执行的结果就是页面值输出了This is example1,服务器记录了三条日志信息。\"></a>执行的结果就是页面值输出了<code>This is example1</code>,服务器记录了三条日志信息。</h4><h4 id=\"个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。\"><a href=\"#个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。\" class=\"headerlink\" title=\"个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。\"></a>个人觉得这个函数很有用，尤其是在客户端与云端进行交互的时候，可以很快缩短响应时间，把多余的请求交给服务器来处理。</h4><h4 id=\"另外，在代码移植上建议加上如下代码\"><a href=\"#另外，在代码移植上建议加上如下代码\" class=\"headerlink\" title=\"另外，在代码移植上建议加上如下代码\"></a>另外，在代码移植上建议加上如下代码</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">\t<span class=\"keyword\">if</span> (!function_exists(<span class=\"string\">\"fastcgi_finish_request\"</span>)) &#123;</div><div class=\"line\">\t      <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fastcgi_finish_request</span><span class=\"params\">()</span>  </span>&#123;</div><div class=\"line\">\t      &#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"><span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"fastcgi-finish-request虽然很好用，但是也有很多限制：\"><a href=\"#fastcgi-finish-request虽然很好用，但是也有很多限制：\" class=\"headerlink\" title=\"fastcgi_finish_request虽然很好用，但是也有很多限制：\"></a>fastcgi_finish_request虽然很好用，但是也有很多限制：</h4><ul>\n<li>PHP fastcgi有进程限制，如果并发太大的话，没办法处理新的请求，nginx可能会出现502 bad request</li>\n</ul>\n<p>内容参考鸟哥博客<a href=\"http://www.laruence.com/2011/04/13/1991.html\">使用fastcgi_finish_request提高页面响应速度</a></p>\n"},{"title":"Team Building  (2016/07/23 - 2016/07/24)","date":"2016-07-29T11:04:59.000Z","_content":"\n> #### We're knights .\n\n![Alt text](/img/9840937207502475.jpg)\n\n![Alt text](/img/677081854238299223.jpg)\n\n> #### You jump, I jump .\n\n![Alt text](/img/129190938705992198.jpg)\n\n![Alt text](/img/249044889813158779.jpg)\n\n![Alt text](/img/276531659065385720.jpg)\n\n> #### Handsome boys .\n\n![Alt text](/img/576658516307111140.jpg)\n\n> #### We are a team .\n\n![Alt text](/img/282308221337490135.jpg)\n\n\n","source":"_posts/Team-building.md","raw":"---\ntitle: Team Building  (2016/07/23 - 2016/07/24) \ndate: 2016-07-29 19:04:59\ntags: Life Picture\ncategories: Life\n---\n\n> #### We're knights .\n\n![Alt text](/img/9840937207502475.jpg)\n\n![Alt text](/img/677081854238299223.jpg)\n\n> #### You jump, I jump .\n\n![Alt text](/img/129190938705992198.jpg)\n\n![Alt text](/img/249044889813158779.jpg)\n\n![Alt text](/img/276531659065385720.jpg)\n\n> #### Handsome boys .\n\n![Alt text](/img/576658516307111140.jpg)\n\n> #### We are a team .\n\n![Alt text](/img/282308221337490135.jpg)\n\n\n","slug":"Team-building","published":1,"updated":"2016-07-29T13:15:53.531Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32g001o0oqml5boi2jq","content":"<blockquote>\n<h4 id=\"We’re-knights\"><a href=\"#We’re-knights\" class=\"headerlink\" title=\"We’re knights .\"></a>We’re knights .</h4></blockquote>\n<p><img src=\"/img/9840937207502475.jpg\" alt=\"Alt text\"></p>\n<p><img src=\"/img/677081854238299223.jpg\" alt=\"Alt text\"></p>\n<blockquote>\n<h4 id=\"You-jump-I-jump\"><a href=\"#You-jump-I-jump\" class=\"headerlink\" title=\"You jump, I jump .\"></a>You jump, I jump .</h4></blockquote>\n<p><img src=\"/img/129190938705992198.jpg\" alt=\"Alt text\"></p>\n<p><img src=\"/img/249044889813158779.jpg\" alt=\"Alt text\"></p>\n<p><img src=\"/img/276531659065385720.jpg\" alt=\"Alt text\"></p>\n<blockquote>\n<h4 id=\"Handsome-boys\"><a href=\"#Handsome-boys\" class=\"headerlink\" title=\"Handsome boys .\"></a>Handsome boys .</h4></blockquote>\n<p><img src=\"/img/576658516307111140.jpg\" alt=\"Alt text\"></p>\n<blockquote>\n<h4 id=\"We-are-a-team\"><a href=\"#We-are-a-team\" class=\"headerlink\" title=\"We are a team .\"></a>We are a team .</h4></blockquote>\n<p><img src=\"/img/282308221337490135.jpg\" alt=\"Alt text\"></p>\n","excerpt":"","more":"<blockquote>\n<h4 id=\"We’re-knights\"><a href=\"#We’re-knights\" class=\"headerlink\" title=\"We’re knights .\"></a>We’re knights .</h4></blockquote>\n<p><img src=\"/img/9840937207502475.jpg\" alt=\"Alt text\"></p>\n<p><img src=\"/img/677081854238299223.jpg\" alt=\"Alt text\"></p>\n<blockquote>\n<h4 id=\"You-jump-I-jump\"><a href=\"#You-jump-I-jump\" class=\"headerlink\" title=\"You jump, I jump .\"></a>You jump, I jump .</h4></blockquote>\n<p><img src=\"/img/129190938705992198.jpg\" alt=\"Alt text\"></p>\n<p><img src=\"/img/249044889813158779.jpg\" alt=\"Alt text\"></p>\n<p><img src=\"/img/276531659065385720.jpg\" alt=\"Alt text\"></p>\n<blockquote>\n<h4 id=\"Handsome-boys\"><a href=\"#Handsome-boys\" class=\"headerlink\" title=\"Handsome boys .\"></a>Handsome boys .</h4></blockquote>\n<p><img src=\"/img/576658516307111140.jpg\" alt=\"Alt text\"></p>\n<blockquote>\n<h4 id=\"We-are-a-team\"><a href=\"#We-are-a-team\" class=\"headerlink\" title=\"We are a team .\"></a>We are a team .</h4></blockquote>\n<p><img src=\"/img/282308221337490135.jpg\" alt=\"Alt text\"></p>\n"},{"layout":"git","title":"Git SSH和HTTPS互相切换","date":"2016-07-27T11:24:28.000Z","_content":"### Git SSH和HTTPS互相切换\n\n#### 先前使用git clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH clone项目的，能不能通过HTTPS提交呢？查了下资料，发现 <font color=red>git remote </font>可以实现\n\n#### 1) 查看当前remote版本\n```bash\n$ git remote -v\norigin  git@your domain:tylerteng/project.git (fetch)\norigin  git@your domain:tylerteng/project.git (push)\n```\n\n#### 2) 上面的结果很明显是push 和pull都是使用SSH，使用如下命令改为HTTPS\n```bash\n$ git remote set-url origin https://your domain/tylerteng/project.git\n```\n\n#### 3) 然后你再进行push等操作，就是按照HTTPS进行提交\n\n```bash\n$ git push\nUsername for 'https://your domain':\nPassword for 'https://tylerteng@your domain':\n```\n","source":"_posts/SSH和HTTPS互相切换.md","raw":"---\nlayout: git\ntitle: Git SSH和HTTPS互相切换\ndate: 2016-07-27 19:24:28\ntags: git ssh https\ncategories: Git\n---\n### Git SSH和HTTPS互相切换\n\n#### 先前使用git clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH clone项目的，能不能通过HTTPS提交呢？查了下资料，发现 <font color=red>git remote </font>可以实现\n\n#### 1) 查看当前remote版本\n```bash\n$ git remote -v\norigin  git@your domain:tylerteng/project.git (fetch)\norigin  git@your domain:tylerteng/project.git (push)\n```\n\n#### 2) 上面的结果很明显是push 和pull都是使用SSH，使用如下命令改为HTTPS\n```bash\n$ git remote set-url origin https://your domain/tylerteng/project.git\n```\n\n#### 3) 然后你再进行push等操作，就是按照HTTPS进行提交\n\n```bash\n$ git push\nUsername for 'https://your domain':\nPassword for 'https://tylerteng@your domain':\n```\n","slug":"SSH和HTTPS互相切换","published":1,"updated":"2016-08-16T08:48:11.506Z","comments":1,"photos":[],"link":"","_id":"cj3fgv32h001r0oqmnh6ufx8y","content":"<h3 id=\"Git-SSH和HTTPS互相切换\"><a href=\"#Git-SSH和HTTPS互相切换\" class=\"headerlink\" title=\"Git SSH和HTTPS互相切换\"></a>Git SSH和HTTPS互相切换</h3><h4 id=\"先前使用git-clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH-clone项目的，能不能通过HTTPS提交呢？查了下资料，发现-git-remote-可以实现\"><a href=\"#先前使用git-clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH-clone项目的，能不能通过HTTPS提交呢？查了下资料，发现-git-remote-可以实现\" class=\"headerlink\" title=\"先前使用git clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH clone项目的，能不能通过HTTPS提交呢？查了下资料，发现 git remote 可以实现\"></a>先前使用git clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH clone项目的，能不能通过HTTPS提交呢？查了下资料，发现 <font color=\"red\">git remote </font>可以实现</h4><h4 id=\"1-查看当前remote版本\"><a href=\"#1-查看当前remote版本\" class=\"headerlink\" title=\"1) 查看当前remote版本\"></a>1) 查看当前remote版本</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git remote -v</div><div class=\"line\">origin  git@your domain:tylerteng/project.git (fetch)</div><div class=\"line\">origin  git@your domain:tylerteng/project.git (push)</div></pre></td></tr></table></figure>\n<h4 id=\"2-上面的结果很明显是push-和pull都是使用SSH，使用如下命令改为HTTPS\"><a href=\"#2-上面的结果很明显是push-和pull都是使用SSH，使用如下命令改为HTTPS\" class=\"headerlink\" title=\"2) 上面的结果很明显是push 和pull都是使用SSH，使用如下命令改为HTTPS\"></a>2) 上面的结果很明显是push 和pull都是使用SSH，使用如下命令改为HTTPS</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git remote <span class=\"built_in\">set</span>-url origin https://your domain/tylerteng/project.git</div></pre></td></tr></table></figure>\n<h4 id=\"3-然后你再进行push等操作，就是按照HTTPS进行提交\"><a href=\"#3-然后你再进行push等操作，就是按照HTTPS进行提交\" class=\"headerlink\" title=\"3) 然后你再进行push等操作，就是按照HTTPS进行提交\"></a>3) 然后你再进行push等操作，就是按照HTTPS进行提交</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push</div><div class=\"line\">Username <span class=\"keyword\">for</span> <span class=\"string\">'https://your domain'</span>:</div><div class=\"line\">Password <span class=\"keyword\">for</span> <span class=\"string\">'https://tylerteng@your domain'</span>:</div></pre></td></tr></table></figure>\n","excerpt":"","more":"<h3 id=\"Git-SSH和HTTPS互相切换\"><a href=\"#Git-SSH和HTTPS互相切换\" class=\"headerlink\" title=\"Git SSH和HTTPS互相切换\"></a>Git SSH和HTTPS互相切换</h3><h4 id=\"先前使用git-clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH-clone项目的，能不能通过HTTPS提交呢？查了下资料，发现-git-remote-可以实现\"><a href=\"#先前使用git-clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH-clone项目的，能不能通过HTTPS提交呢？查了下资料，发现-git-remote-可以实现\" class=\"headerlink\" title=\"先前使用git clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH clone项目的，能不能通过HTTPS提交呢？查了下资料，发现 git remote 可以实现\"></a>先前使用git clone到本地的项目，有一次提交的时候，莫名有个文件不能push了，错误提示是没有权限，也没找到具体的原因，后来想到一个办法，就是切换方式，例如，我是通过SSH clone项目的，能不能通过HTTPS提交呢？查了下资料，发现 <font color=red>git remote </font>可以实现</h4><h4 id=\"1-查看当前remote版本\"><a href=\"#1-查看当前remote版本\" class=\"headerlink\" title=\"1) 查看当前remote版本\"></a>1) 查看当前remote版本</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git remote -v</div><div class=\"line\">origin  git@your domain:tylerteng/project.git (fetch)</div><div class=\"line\">origin  git@your domain:tylerteng/project.git (push)</div></pre></td></tr></table></figure>\n<h4 id=\"2-上面的结果很明显是push-和pull都是使用SSH，使用如下命令改为HTTPS\"><a href=\"#2-上面的结果很明显是push-和pull都是使用SSH，使用如下命令改为HTTPS\" class=\"headerlink\" title=\"2) 上面的结果很明显是push 和pull都是使用SSH，使用如下命令改为HTTPS\"></a>2) 上面的结果很明显是push 和pull都是使用SSH，使用如下命令改为HTTPS</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git remote <span class=\"built_in\">set</span>-url origin https://your domain/tylerteng/project.git</div></pre></td></tr></table></figure>\n<h4 id=\"3-然后你再进行push等操作，就是按照HTTPS进行提交\"><a href=\"#3-然后你再进行push等操作，就是按照HTTPS进行提交\" class=\"headerlink\" title=\"3) 然后你再进行push等操作，就是按照HTTPS进行提交\"></a>3) 然后你再进行push等操作，就是按照HTTPS进行提交</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ git push</div><div class=\"line\">Username <span class=\"keyword\">for</span> <span class=\"string\">'https://your domain'</span>:</div><div class=\"line\">Password <span class=\"keyword\">for</span> <span class=\"string\">'https://tylerteng@your domain'</span>:</div></pre></td></tr></table></figure>\n"},{"title":"Ubuntu搭建lnmp环境","date":"2016-11-22T09:47:51.000Z","_content":"\n---------------------------------------\n\n**项目基于php CI**\n\n\n#### 1、安装mysql\n\n```bash\n$ sudo apt-get install mysql-server mysql-client\n```\n\n**安装过程会提示输入root的密码，连续输入两次**\n\n```bash\nNew password for the MySQL “root” user: <– 输入你的密码\nRepeat password for the MySQL “root” user: <– 再输入一次\n```\n\n#### 2、安装nginx\n\n**安装之前看看是否安装了Apache，如果安装了，先停掉Apache，防止端口占用**\n\n```bash\n$ sudo service apache2 stop\n$ sudo update-rc.d -f apache2 remove\n$ sudo apt-get remove apache2\n$ sudo apt-get install nginx\n$ sudo service nginx start \n```\n\n**试试安装是否成功，在浏览器输入IP或主机地址。**\n\n#### 3、安装php\n\n```bash\n$ sudo apt-get install php7.0 -y\n```\n\n**启动php-fpm**\n\n```bash\n$ sudo service php7.0-fpm start\n```\n\n**输入`php -i`命令，查看php是否运行, 这个命令和`phpinfo()`函数一样**\n\n```bash\n$ sudo php -i\n```\n\n#### 4、更改nginx配置文件\n\n```bash\n$ cd /etc/nginx/sites-enabled/\n$ ll\ntotal 8\ndrwxr-xr-x 2 root root 4096 Nov 22 08:20 ./\ndrwxr-xr-x 7 root root 4096 Nov 22 08:21 ../\nlrwxrwxrwx 1 root root   34 Nov 22 06:10 default -> /etc/nginx/sites-available/default\n```\n**这里会有一个默认的default配置文件，更改配置文件，进行项目配置**\n```bash\nserver {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n        server_tokens off;\n        root /usr/share/nginx/test;\n        # Add index.php to the list if you are using PHP\n        index  index.php index.html index.htm index.nginx-debian.html;\n        server_name _;\n        if ($request_filename !~ (\\.jpg|css|js|png|fonts|img)) {\n                rewrite ^/(.*)$ /index.php/$1 break;\n        }\n        location ~ / {\n                root /usr/share/nginx/test;\n                fastcgi_pass   unix:/var/run/php/php7.0-fpm.sock;\n                fastcgi_index  index.php;\n                set $path_info \"\";\n                set $real_script_name $fastcgi_script_name;\n                fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n                include        fastcgi_params;\n        }\n}\n```\n**按需配置CI框架的数据库**\n\n**新建控制器`Info.php`, 在里面增加php方法，运行检验**\n\n```php\n<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');\n\nclass Info extends CI_Controller {\n\tpublic function php() {\n\t\techo \"hello world!\";\n\t}\n}\n```\n\n**发现抛出一个致命的错误**\n\n`Fatal error: Uncaught TypeError: Argument 1 passed to CI_Exceptions::show_exception() must be an instance of Exception, instance of Error given, called in /usr/share/nginx/test/system/core/Common.php on line 659 and defined in /usr/share/nginx/test/system/core/Exceptions.php:192 Stack trace: #0 /usr/share/nginx/test/system/core/Common.php(659): CI_Exceptions->show_exception(Object(Error)) #1 [internal function]: _exception_handler(Object(Error)) #2 {main} thrown in /usr/share/nginx/test/system/core/Exceptions.php on line 192`\n\n**报错的意思大概是说show_exception方法的参数是个实例化的，但是传入的参数不是一个实例**\n\n**后来根据github上面的解决办法https://github.com/bcit-ci/CodeIgniter/commit/84f24c23baf5ea45c30c4ab3cbc57cd846ea0f56#diff-e57013406b22fdf1ec021ddda0d8e5aa，更改show_exception的参数**\n\n**刷新后发现提示mysql的php拓展，使用命令安装php相关拓展**\n\n#### 5、安装php拓展\n\n**查看支持的拓展**\n```bash\nsudo apt-cache search php7.0\n\nlibapache2-mod-php7.0 - server-side, HTML-embedded scripting language (Apache 2 module)\nphp-all-dev - package depending on all supported PHP development packages\nphp7.0 - server-side, HTML-embedded scripting language (metapackage)\nphp7.0-cgi - server-side, HTML-embedded scripting language (CGI binary)\nphp7.0-cli - command-line interpreter for the PHP scripting language\nphp7.0-common - documentation, examples and common module for PHP\nphp7.0-curl - CURL module for PHP\nphp7.0-dev - Files for PHP7.0 module development\nphp7.0-gd - GD module for PHP\nphp7.0-gmp - GMP module for PHP\nphp7.0-json - JSON module for PHP\nphp7.0-ldap - LDAP module for PHP\nphp7.0-mysql - MySQL module for PHP\nphp7.0-odbc - ODBC module for PHP\nphp7.0-opcache - Zend OpCache module for PHP\nphp7.0-pgsql - PostgreSQL module for PHP\nphp7.0-pspell - pspell module for PHP\n.\n.\n.\n```\n\n**为了保险起见，直接安装所有拓展**\n```bash\nsudo apt-get install php-all-dev\n```\n\n**然后刷新发现正常输出`hello world!`**\n\n**然后我把show_exception方法又改回原来的样子，刷新之后没有再出现该情况，则证明show_exception也是由于缺少拓展造成的**","source":"_posts/Ubuntu搭建lnmp环境.md","raw":"---\ntitle: Ubuntu搭建lnmp环境\ndate: 2016-11-22 17:47:51\ntags: php linux nginx\ncategories: Linux\n---\n\n---------------------------------------\n\n**项目基于php CI**\n\n\n#### 1、安装mysql\n\n```bash\n$ sudo apt-get install mysql-server mysql-client\n```\n\n**安装过程会提示输入root的密码，连续输入两次**\n\n```bash\nNew password for the MySQL “root” user: <– 输入你的密码\nRepeat password for the MySQL “root” user: <– 再输入一次\n```\n\n#### 2、安装nginx\n\n**安装之前看看是否安装了Apache，如果安装了，先停掉Apache，防止端口占用**\n\n```bash\n$ sudo service apache2 stop\n$ sudo update-rc.d -f apache2 remove\n$ sudo apt-get remove apache2\n$ sudo apt-get install nginx\n$ sudo service nginx start \n```\n\n**试试安装是否成功，在浏览器输入IP或主机地址。**\n\n#### 3、安装php\n\n```bash\n$ sudo apt-get install php7.0 -y\n```\n\n**启动php-fpm**\n\n```bash\n$ sudo service php7.0-fpm start\n```\n\n**输入`php -i`命令，查看php是否运行, 这个命令和`phpinfo()`函数一样**\n\n```bash\n$ sudo php -i\n```\n\n#### 4、更改nginx配置文件\n\n```bash\n$ cd /etc/nginx/sites-enabled/\n$ ll\ntotal 8\ndrwxr-xr-x 2 root root 4096 Nov 22 08:20 ./\ndrwxr-xr-x 7 root root 4096 Nov 22 08:21 ../\nlrwxrwxrwx 1 root root   34 Nov 22 06:10 default -> /etc/nginx/sites-available/default\n```\n**这里会有一个默认的default配置文件，更改配置文件，进行项目配置**\n```bash\nserver {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n        server_tokens off;\n        root /usr/share/nginx/test;\n        # Add index.php to the list if you are using PHP\n        index  index.php index.html index.htm index.nginx-debian.html;\n        server_name _;\n        if ($request_filename !~ (\\.jpg|css|js|png|fonts|img)) {\n                rewrite ^/(.*)$ /index.php/$1 break;\n        }\n        location ~ / {\n                root /usr/share/nginx/test;\n                fastcgi_pass   unix:/var/run/php/php7.0-fpm.sock;\n                fastcgi_index  index.php;\n                set $path_info \"\";\n                set $real_script_name $fastcgi_script_name;\n                fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n                include        fastcgi_params;\n        }\n}\n```\n**按需配置CI框架的数据库**\n\n**新建控制器`Info.php`, 在里面增加php方法，运行检验**\n\n```php\n<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');\n\nclass Info extends CI_Controller {\n\tpublic function php() {\n\t\techo \"hello world!\";\n\t}\n}\n```\n\n**发现抛出一个致命的错误**\n\n`Fatal error: Uncaught TypeError: Argument 1 passed to CI_Exceptions::show_exception() must be an instance of Exception, instance of Error given, called in /usr/share/nginx/test/system/core/Common.php on line 659 and defined in /usr/share/nginx/test/system/core/Exceptions.php:192 Stack trace: #0 /usr/share/nginx/test/system/core/Common.php(659): CI_Exceptions->show_exception(Object(Error)) #1 [internal function]: _exception_handler(Object(Error)) #2 {main} thrown in /usr/share/nginx/test/system/core/Exceptions.php on line 192`\n\n**报错的意思大概是说show_exception方法的参数是个实例化的，但是传入的参数不是一个实例**\n\n**后来根据github上面的解决办法https://github.com/bcit-ci/CodeIgniter/commit/84f24c23baf5ea45c30c4ab3cbc57cd846ea0f56#diff-e57013406b22fdf1ec021ddda0d8e5aa，更改show_exception的参数**\n\n**刷新后发现提示mysql的php拓展，使用命令安装php相关拓展**\n\n#### 5、安装php拓展\n\n**查看支持的拓展**\n```bash\nsudo apt-cache search php7.0\n\nlibapache2-mod-php7.0 - server-side, HTML-embedded scripting language (Apache 2 module)\nphp-all-dev - package depending on all supported PHP development packages\nphp7.0 - server-side, HTML-embedded scripting language (metapackage)\nphp7.0-cgi - server-side, HTML-embedded scripting language (CGI binary)\nphp7.0-cli - command-line interpreter for the PHP scripting language\nphp7.0-common - documentation, examples and common module for PHP\nphp7.0-curl - CURL module for PHP\nphp7.0-dev - Files for PHP7.0 module development\nphp7.0-gd - GD module for PHP\nphp7.0-gmp - GMP module for PHP\nphp7.0-json - JSON module for PHP\nphp7.0-ldap - LDAP module for PHP\nphp7.0-mysql - MySQL module for PHP\nphp7.0-odbc - ODBC module for PHP\nphp7.0-opcache - Zend OpCache module for PHP\nphp7.0-pgsql - PostgreSQL module for PHP\nphp7.0-pspell - pspell module for PHP\n.\n.\n.\n```\n\n**为了保险起见，直接安装所有拓展**\n```bash\nsudo apt-get install php-all-dev\n```\n\n**然后刷新发现正常输出`hello world!`**\n\n**然后我把show_exception方法又改回原来的样子，刷新之后没有再出现该情况，则证明show_exception也是由于缺少拓展造成的**","slug":"Ubuntu搭建lnmp环境","published":1,"updated":"2017-03-15T02:21:21.608Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32l001v0oqmtptulq6q","content":"<hr>\n<p><strong>项目基于php CI</strong></p>\n<h4 id=\"1、安装mysql\"><a href=\"#1、安装mysql\" class=\"headerlink\" title=\"1、安装mysql\"></a>1、安装mysql</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo apt-get install mysql-server mysql-client</div></pre></td></tr></table></figure>\n<p><strong>安装过程会提示输入root的密码，连续输入两次</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">New password <span class=\"keyword\">for</span> the MySQL “root” user: &lt;– 输入你的密码</div><div class=\"line\">Repeat password <span class=\"keyword\">for</span> the MySQL “root” user: &lt;– 再输入一次</div></pre></td></tr></table></figure>\n<h4 id=\"2、安装nginx\"><a href=\"#2、安装nginx\" class=\"headerlink\" title=\"2、安装nginx\"></a>2、安装nginx</h4><p><strong>安装之前看看是否安装了Apache，如果安装了，先停掉Apache，防止端口占用</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo service apache2 stop</div><div class=\"line\">$ sudo update-rc.d <span class=\"_\">-f</span> apache2 remove</div><div class=\"line\">$ sudo apt-get remove apache2</div><div class=\"line\">$ sudo apt-get install nginx</div><div class=\"line\">$ sudo service nginx start</div></pre></td></tr></table></figure>\n<p><strong>试试安装是否成功，在浏览器输入IP或主机地址。</strong></p>\n<h4 id=\"3、安装php\"><a href=\"#3、安装php\" class=\"headerlink\" title=\"3、安装php\"></a>3、安装php</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo apt-get install php7.0 -y</div></pre></td></tr></table></figure>\n<p><strong>启动php-fpm</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo service php7.0-fpm start</div></pre></td></tr></table></figure>\n<p><strong>输入<code>php -i</code>命令，查看php是否运行, 这个命令和<code>phpinfo()</code>函数一样</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo php -i</div></pre></td></tr></table></figure>\n<h4 id=\"4、更改nginx配置文件\"><a href=\"#4、更改nginx配置文件\" class=\"headerlink\" title=\"4、更改nginx配置文件\"></a>4、更改nginx配置文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">cd</span> /etc/nginx/sites-enabled/</div><div class=\"line\">$ ll</div><div class=\"line\">total 8</div><div class=\"line\">drwxr-xr-x 2 root root 4096 Nov 22 08:20 ./</div><div class=\"line\">drwxr-xr-x 7 root root 4096 Nov 22 08:21 ../</div><div class=\"line\">lrwxrwxrwx 1 root root   34 Nov 22 06:10 default -&gt; /etc/nginx/sites-available/default</div></pre></td></tr></table></figure>\n<p><strong>这里会有一个默认的default配置文件，更改配置文件，进行项目配置</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">server &#123;</div><div class=\"line\">        listen 80 default_server;</div><div class=\"line\">        listen [::]:80 default_server;</div><div class=\"line\">        server_tokens off;</div><div class=\"line\">        root /usr/share/nginx/<span class=\"built_in\">test</span>;</div><div class=\"line\">        <span class=\"comment\"># Add index.php to the list if you are using PHP</span></div><div class=\"line\">        index  index.php index.html index.htm index.nginx-debian.html;</div><div class=\"line\">        server_name _;</div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$request_filename</span> !~ (\\.jpg|css|js|png|fonts|img)) &#123;</div><div class=\"line\">                rewrite ^/(.*)$ /index.php/<span class=\"variable\">$1</span> <span class=\"built_in\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        location ~ / &#123;</div><div class=\"line\">                root /usr/share/nginx/<span class=\"built_in\">test</span>;</div><div class=\"line\">                fastcgi_pass   unix:/var/run/php/php7.0-fpm.sock;</div><div class=\"line\">                fastcgi_index  index.php;</div><div class=\"line\">                <span class=\"built_in\">set</span> <span class=\"variable\">$path_info</span> <span class=\"string\">\"\"</span>;</div><div class=\"line\">                <span class=\"built_in\">set</span> <span class=\"variable\">$real_script_name</span> <span class=\"variable\">$fastcgi_script_name</span>;</div><div class=\"line\">                fastcgi_param  SCRIPT_FILENAME  <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</div><div class=\"line\">                include        fastcgi_params;</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><strong>按需配置CI框架的数据库</strong></p>\n<p><strong>新建控制器<code>Info.php</code>, 在里面增加php方法，运行检验</strong></p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">if</span> ( ! defined(<span class=\"string\">'BASEPATH'</span>)) <span class=\"keyword\">exit</span>(<span class=\"string\">'No direct script access allowed'</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Info</span> <span class=\"keyword\">extends</span> <span class=\"title\">CI_Controller</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">php</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"hello world!\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><strong>发现抛出一个致命的错误</strong></p>\n<p><code>Fatal error: Uncaught TypeError: Argument 1 passed to CI_Exceptions::show_exception() must be an instance of Exception, instance of Error given, called in /usr/share/nginx/test/system/core/Common.php on line 659 and defined in /usr/share/nginx/test/system/core/Exceptions.php:192 Stack trace: #0 /usr/share/nginx/test/system/core/Common.php(659): CI_Exceptions-&gt;show_exception(Object(Error)) #1 [internal function]: _exception_handler(Object(Error)) #2 {main} thrown in /usr/share/nginx/test/system/core/Exceptions.php on line 192</code></p>\n<p><strong>报错的意思大概是说show_exception方法的参数是个实例化的，但是传入的参数不是一个实例</strong></p>\n<p><strong>后来根据github上面的解决办法<a href=\"https://github.com/bcit-ci/CodeIgniter/commit/84f24c23baf5ea45c30c4ab3cbc57cd846ea0f56#diff-e57013406b22fdf1ec021ddda0d8e5aa，更改show_exception的参数\" target=\"_blank\" rel=\"external\">https://github.com/bcit-ci/CodeIgniter/commit/84f24c23baf5ea45c30c4ab3cbc57cd846ea0f56#diff-e57013406b22fdf1ec021ddda0d8e5aa，更改show_exception的参数</a></strong></p>\n<p><strong>刷新后发现提示mysql的php拓展，使用命令安装php相关拓展</strong></p>\n<h4 id=\"5、安装php拓展\"><a href=\"#5、安装php拓展\" class=\"headerlink\" title=\"5、安装php拓展\"></a>5、安装php拓展</h4><p><strong>查看支持的拓展</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo apt-cache search php7.0</div><div class=\"line\"></div><div class=\"line\">libapache2-mod-php7.0 - server-side, HTML-embedded scripting language (Apache 2 module)</div><div class=\"line\">php-all-dev - package depending on all supported PHP development packages</div><div class=\"line\">php7.0 - server-side, HTML-embedded scripting language (metapackage)</div><div class=\"line\">php7.0-cgi - server-side, HTML-embedded scripting language (CGI binary)</div><div class=\"line\">php7.0-cli - <span class=\"built_in\">command</span>-line interpreter <span class=\"keyword\">for</span> the PHP scripting language</div><div class=\"line\">php7.0-common - documentation, examples and common module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-curl - CURL module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-dev - Files <span class=\"keyword\">for</span> PHP7.0 module development</div><div class=\"line\">php7.0-gd - GD module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-gmp - GMP module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-json - JSON module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-ldap - LDAP module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-mysql - MySQL module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-odbc - ODBC module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-opcache - Zend OpCache module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-pgsql - PostgreSQL module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-pspell - pspell module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">.</div><div class=\"line\">.</div><div class=\"line\">.</div></pre></td></tr></table></figure></p>\n<p><strong>为了保险起见，直接安装所有拓展</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo apt-get install php-all-dev</div></pre></td></tr></table></figure></p>\n<p><strong>然后刷新发现正常输出<code>hello world!</code></strong></p>\n<p><strong>然后我把show_exception方法又改回原来的样子，刷新之后没有再出现该情况，则证明show_exception也是由于缺少拓展造成的</strong></p>\n","excerpt":"","more":"<hr>\n<p><strong>项目基于php CI</strong></p>\n<h4 id=\"1、安装mysql\"><a href=\"#1、安装mysql\" class=\"headerlink\" title=\"1、安装mysql\"></a>1、安装mysql</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo apt-get install mysql-server mysql-client</div></pre></td></tr></table></figure>\n<p><strong>安装过程会提示输入root的密码，连续输入两次</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">New password <span class=\"keyword\">for</span> the MySQL “root” user: &lt;– 输入你的密码</div><div class=\"line\">Repeat password <span class=\"keyword\">for</span> the MySQL “root” user: &lt;– 再输入一次</div></pre></td></tr></table></figure>\n<h4 id=\"2、安装nginx\"><a href=\"#2、安装nginx\" class=\"headerlink\" title=\"2、安装nginx\"></a>2、安装nginx</h4><p><strong>安装之前看看是否安装了Apache，如果安装了，先停掉Apache，防止端口占用</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo service apache2 stop</div><div class=\"line\">$ sudo update-rc.d <span class=\"_\">-f</span> apache2 remove</div><div class=\"line\">$ sudo apt-get remove apache2</div><div class=\"line\">$ sudo apt-get install nginx</div><div class=\"line\">$ sudo service nginx start</div></pre></td></tr></table></figure>\n<p><strong>试试安装是否成功，在浏览器输入IP或主机地址。</strong></p>\n<h4 id=\"3、安装php\"><a href=\"#3、安装php\" class=\"headerlink\" title=\"3、安装php\"></a>3、安装php</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo apt-get install php7.0 -y</div></pre></td></tr></table></figure>\n<p><strong>启动php-fpm</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo service php7.0-fpm start</div></pre></td></tr></table></figure>\n<p><strong>输入<code>php -i</code>命令，查看php是否运行, 这个命令和<code>phpinfo()</code>函数一样</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ sudo php -i</div></pre></td></tr></table></figure>\n<h4 id=\"4、更改nginx配置文件\"><a href=\"#4、更改nginx配置文件\" class=\"headerlink\" title=\"4、更改nginx配置文件\"></a>4、更改nginx配置文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">cd</span> /etc/nginx/sites-enabled/</div><div class=\"line\">$ ll</div><div class=\"line\">total 8</div><div class=\"line\">drwxr-xr-x 2 root root 4096 Nov 22 08:20 ./</div><div class=\"line\">drwxr-xr-x 7 root root 4096 Nov 22 08:21 ../</div><div class=\"line\">lrwxrwxrwx 1 root root   34 Nov 22 06:10 default -&gt; /etc/nginx/sites-available/default</div></pre></td></tr></table></figure>\n<p><strong>这里会有一个默认的default配置文件，更改配置文件，进行项目配置</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">server &#123;</div><div class=\"line\">        listen 80 default_server;</div><div class=\"line\">        listen [::]:80 default_server;</div><div class=\"line\">        server_tokens off;</div><div class=\"line\">        root /usr/share/nginx/<span class=\"built_in\">test</span>;</div><div class=\"line\">        <span class=\"comment\"># Add index.php to the list if you are using PHP</span></div><div class=\"line\">        index  index.php index.html index.htm index.nginx-debian.html;</div><div class=\"line\">        server_name _;</div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$request_filename</span> !~ (\\.jpg|css|js|png|fonts|img)) &#123;</div><div class=\"line\">                rewrite ^/(.*)$ /index.php/<span class=\"variable\">$1</span> <span class=\"built_in\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        location ~ / &#123;</div><div class=\"line\">                root /usr/share/nginx/<span class=\"built_in\">test</span>;</div><div class=\"line\">                fastcgi_pass   unix:/var/run/php/php7.0-fpm.sock;</div><div class=\"line\">                fastcgi_index  index.php;</div><div class=\"line\">                <span class=\"built_in\">set</span> <span class=\"variable\">$path_info</span> <span class=\"string\">\"\"</span>;</div><div class=\"line\">                <span class=\"built_in\">set</span> <span class=\"variable\">$real_script_name</span> <span class=\"variable\">$fastcgi_script_name</span>;</div><div class=\"line\">                fastcgi_param  SCRIPT_FILENAME  <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</div><div class=\"line\">                include        fastcgi_params;</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><strong>按需配置CI框架的数据库</strong></p>\n<p><strong>新建控制器<code>Info.php</code>, 在里面增加php方法，运行检验</strong></p>\n<figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">if</span> ( ! defined(<span class=\"string\">'BASEPATH'</span>)) <span class=\"keyword\">exit</span>(<span class=\"string\">'No direct script access allowed'</span>);</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Info</span> <span class=\"keyword\">extends</span> <span class=\"title\">CI_Controller</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">php</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"hello world!\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p><strong>发现抛出一个致命的错误</strong></p>\n<p><code>Fatal error: Uncaught TypeError: Argument 1 passed to CI_Exceptions::show_exception() must be an instance of Exception, instance of Error given, called in /usr/share/nginx/test/system/core/Common.php on line 659 and defined in /usr/share/nginx/test/system/core/Exceptions.php:192 Stack trace: #0 /usr/share/nginx/test/system/core/Common.php(659): CI_Exceptions-&gt;show_exception(Object(Error)) #1 [internal function]: _exception_handler(Object(Error)) #2 {main} thrown in /usr/share/nginx/test/system/core/Exceptions.php on line 192</code></p>\n<p><strong>报错的意思大概是说show_exception方法的参数是个实例化的，但是传入的参数不是一个实例</strong></p>\n<p><strong>后来根据github上面的解决办法<a href=\"https://github.com/bcit-ci/CodeIgniter/commit/84f24c23baf5ea45c30c4ab3cbc57cd846ea0f56#diff-e57013406b22fdf1ec021ddda0d8e5aa，更改show_exception的参数\">https://github.com/bcit-ci/CodeIgniter/commit/84f24c23baf5ea45c30c4ab3cbc57cd846ea0f56#diff-e57013406b22fdf1ec021ddda0d8e5aa，更改show_exception的参数</a></strong></p>\n<p><strong>刷新后发现提示mysql的php拓展，使用命令安装php相关拓展</strong></p>\n<h4 id=\"5、安装php拓展\"><a href=\"#5、安装php拓展\" class=\"headerlink\" title=\"5、安装php拓展\"></a>5、安装php拓展</h4><p><strong>查看支持的拓展</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo apt-cache search php7.0</div><div class=\"line\"></div><div class=\"line\">libapache2-mod-php7.0 - server-side, HTML-embedded scripting language (Apache 2 module)</div><div class=\"line\">php-all-dev - package depending on all supported PHP development packages</div><div class=\"line\">php7.0 - server-side, HTML-embedded scripting language (metapackage)</div><div class=\"line\">php7.0-cgi - server-side, HTML-embedded scripting language (CGI binary)</div><div class=\"line\">php7.0-cli - <span class=\"built_in\">command</span>-line interpreter <span class=\"keyword\">for</span> the PHP scripting language</div><div class=\"line\">php7.0-common - documentation, examples and common module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-curl - CURL module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-dev - Files <span class=\"keyword\">for</span> PHP7.0 module development</div><div class=\"line\">php7.0-gd - GD module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-gmp - GMP module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-json - JSON module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-ldap - LDAP module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-mysql - MySQL module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-odbc - ODBC module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-opcache - Zend OpCache module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-pgsql - PostgreSQL module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">php7.0-pspell - pspell module <span class=\"keyword\">for</span> PHP</div><div class=\"line\">.</div><div class=\"line\">.</div><div class=\"line\">.</div></pre></td></tr></table></figure></p>\n<p><strong>为了保险起见，直接安装所有拓展</strong><br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">sudo apt-get install php-all-dev</div></pre></td></tr></table></figure></p>\n<p><strong>然后刷新发现正常输出<code>hello world!</code></strong></p>\n<p><strong>然后我把show_exception方法又改回原来的样子，刷新之后没有再出现该情况，则证明show_exception也是由于缺少拓展造成的</strong></p>\n"},{"title":"Ubuntu查看版本","date":"2016-11-28T06:06:51.000Z","_content":"\n---------------\n\n#### 使用命令：cat /proc/version 查看\n\n```bash\n$ cat /proc/version\nLinux version 4.4.0-47-generic (buildd@lcy01-03) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.2) ) #68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016\n```\n#### 使用命令：uname -a 查看\n\n```bash\n$ uname -a\nLinux ip-172-31-9-166 4.4.0-47-generic #68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n```\n\n#### 使用命令：lsb_release -a 查看\n\n```bash\n$ lsb_release -a\nLinux ip-172-31-9-166 4.4.0-47-generic #68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\nubuntu@ip-172-31-9-166:~/Download/php-5.6.28$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 16.04.1 LTS\nRelease:        16.04\nCodename:       xenial\n\n```","source":"_posts/Ubuntu查看版本.md","raw":"---\ntitle: Ubuntu查看版本\ndate: 2016-11-28 14:06:51\ntags: Linux\ncategories: Linux\n---\n\n---------------\n\n#### 使用命令：cat /proc/version 查看\n\n```bash\n$ cat /proc/version\nLinux version 4.4.0-47-generic (buildd@lcy01-03) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.2) ) #68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016\n```\n#### 使用命令：uname -a 查看\n\n```bash\n$ uname -a\nLinux ip-172-31-9-166 4.4.0-47-generic #68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n```\n\n#### 使用命令：lsb_release -a 查看\n\n```bash\n$ lsb_release -a\nLinux ip-172-31-9-166 4.4.0-47-generic #68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\nubuntu@ip-172-31-9-166:~/Download/php-5.6.28$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 16.04.1 LTS\nRelease:        16.04\nCodename:       xenial\n\n```","slug":"Ubuntu查看版本","published":1,"updated":"2016-11-28T06:07:58.037Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32m001x0oqmi7v7dvaj","content":"<hr>\n<h4 id=\"使用命令：cat-proc-version-查看\"><a href=\"#使用命令：cat-proc-version-查看\" class=\"headerlink\" title=\"使用命令：cat /proc/version 查看\"></a>使用命令：cat /proc/version 查看</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ cat /proc/version</div><div class=\"line\">Linux version 4.4.0-47-generic (buildd@lcy01-03) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.2) ) <span class=\"comment\">#68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016</span></div></pre></td></tr></table></figure>\n<h4 id=\"使用命令：uname-a-查看\"><a href=\"#使用命令：uname-a-查看\" class=\"headerlink\" title=\"使用命令：uname -a 查看\"></a>使用命令：uname -a 查看</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ uname <span class=\"_\">-a</span></div><div class=\"line\">Linux ip-172-31-9-166 4.4.0-47-generic <span class=\"comment\">#68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></div></pre></td></tr></table></figure>\n<h4 id=\"使用命令：lsb-release-a-查看\"><a href=\"#使用命令：lsb-release-a-查看\" class=\"headerlink\" title=\"使用命令：lsb_release -a 查看\"></a>使用命令：lsb_release -a 查看</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ lsb_release <span class=\"_\">-a</span></div><div class=\"line\">Linux ip-172-31-9-166 4.4.0-47-generic <span class=\"comment\">#68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></div><div class=\"line\">ubuntu@ip-172-31-9-166:~/Download/php-5.6.28$ lsb_release <span class=\"_\">-a</span></div><div class=\"line\">No LSB modules are available.</div><div class=\"line\">Distributor ID: Ubuntu</div><div class=\"line\">Description:    Ubuntu 16.04.1 LTS</div><div class=\"line\">Release:        16.04</div><div class=\"line\">Codename:       xenial</div></pre></td></tr></table></figure>","excerpt":"","more":"<hr>\n<h4 id=\"使用命令：cat-proc-version-查看\"><a href=\"#使用命令：cat-proc-version-查看\" class=\"headerlink\" title=\"使用命令：cat /proc/version 查看\"></a>使用命令：cat /proc/version 查看</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ cat /proc/version</div><div class=\"line\">Linux version 4.4.0-47-generic (buildd@lcy01-03) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.2) ) <span class=\"comment\">#68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016</span></div></pre></td></tr></table></figure>\n<h4 id=\"使用命令：uname-a-查看\"><a href=\"#使用命令：uname-a-查看\" class=\"headerlink\" title=\"使用命令：uname -a 查看\"></a>使用命令：uname -a 查看</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ uname <span class=\"_\">-a</span></div><div class=\"line\">Linux ip-172-31-9-166 4.4.0-47-generic <span class=\"comment\">#68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></div></pre></td></tr></table></figure>\n<h4 id=\"使用命令：lsb-release-a-查看\"><a href=\"#使用命令：lsb-release-a-查看\" class=\"headerlink\" title=\"使用命令：lsb_release -a 查看\"></a>使用命令：lsb_release -a 查看</h4><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ lsb_release <span class=\"_\">-a</span></div><div class=\"line\">Linux ip-172-31-9-166 4.4.0-47-generic <span class=\"comment\">#68-Ubuntu SMP Wed Oct 26 19:39:52 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></div><div class=\"line\">ubuntu@ip-172-31-9-166:~/Download/php-5.6.28$ lsb_release <span class=\"_\">-a</span></div><div class=\"line\">No LSB modules are available.</div><div class=\"line\">Distributor ID: Ubuntu</div><div class=\"line\">Description:    Ubuntu 16.04.1 LTS</div><div class=\"line\">Release:        16.04</div><div class=\"line\">Codename:       xenial</div></pre></td></tr></table></figure>"},{"title":"bash基础学习一","date":"2017-04-14T07:41:16.000Z","_content":"### Bash 中处理特殊字符\n\n@(bash)\n\n[toc]\n\n### #符号\n#### 注释\n\n行号以#开头是注释，bash脚本的第一行通常是`#!/bin/bash`，意思是这个文件是bash脚本 `#!` 用于当前脚本的解释器\n\n当然，在echo中转义的#是不能做转义的：\n\n```bash\n$ vim test.sh\n```\n输入如下代码，并保存\n```bash\n#!/bin/bash\n\n echo \"The # here does not begin a comment.\"\n echo 'The # here does not begin a comment.'\n echo The \\# here does not begin a comment.\n echo The # 这里开始一个注释\n\n echo ${PATH#*:}         # 参数替换，不是一个注释\n echo $(( 2#101011 ))   # 数制转换（使用二进制表示），32+8+2+1\n```\n执行结果\n```bash\n$ bash test.sh\n```\n运行效果\n```bash\nThe # here does not begin a comment.\nThe # here does not begin a comment.\nThe # here does not begin a comment.\nThe\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games\n43\n```\n\n### 分号\n#### 命令分隔符\n使用分号可以分割在同一行的两个或两个以上的命令\n```bash\n$ vim test2.sh\n```\n输入如下代码，并保存\n\n```bash\n#!/bin/bash\n echo hello; echo there\n filename=ttt.sh\n if [ -r \"$filename\" ]; then    # 注意: \"if\"和\"then\"需要分隔\n     echo \"File $filename exists.\"; cp $filename $filename.bak\n else\n     echo \"File $filename not found.\"; touch $filename\n fi; echo \"File test complete.\"\n```\n运行脚本\n```bash\n$ bash test2.sh\n```\n运行结果\n```bash\nhello\nthere\nFile ttt.sh not found\nFilename test complete.\n```\n#### 终止case选项(双;分号)\n\n使用双分号用于终止case选项\n```bash\n$ vim test.bash\n```\n输入如下代码，并保存\n```bash\n#!/bin/bash\nvarname=b\ncase $varname in \n\t[a-z]) echo \"abc\";;\n\t[0-9]) echo \"123\";;\nesac\t#case终止符号\n```\n执行脚本，查看输出\n```bash\n$ bash test.sh\nabc\n```\n\n解释说明，上面的代码，首先赋值给变量varname的值是b，然后使用case进行判断。\ncase的格式\n```bash\ncase $ in\n\t条件1) command;;\n\t条件2) command;;\n\t.\n\t.\n\t.\n\t*) command;; ##匹配所有\nesac\n```\n### 点号（.）\n等价于source命令\nbash 中的 source 命令用于在当前 bash 环境下读取并执行 FileName.sh 中的命令。\n```bash\n$ source test.sh\nHello World\n$ . test.sh\nHello World\n```\n### 引号\n\n#### 双引号\n\"STRING\" 将会阻止（解释）STRING中大部分特殊的字符。\n\n#### 单引号\n'STRING' 将会阻止STRING中所有特殊字符的解释，这是一种比使用\"更强烈的形式。\n\n### 反引号\n反引号通常是用于命令，反引号中的命令会优先执行\n```bash\n$ cp `mkdir back` test.sh back\n```\n分析：反引号类似算法中的小括号，会优先执行，上面的运行结果\n```bash\n$ cp `mkdir back` test.sh back\n$ ll\ntotal 16K\ndrwxrwxr-x 3 shiyanlou shiyanlou 4.0K Apr 14 14:43 Code\ndrwxrwxr-x 2 shiyanlou shiyanlou 4.0K Nov 27  2015 Desktop\ndrwxrwxr-x 2 shiyanlou shiyanlou 4.0K Apr 14 15:07 back\n-rw-rw-r-- 1 shiyanlou shiyanlou   13 Apr 14 15:04 test.sh\n```\n为了验证一下，我们可以删除back文件夹内容，然后执行 **cp test.sh back `mkdir back`** 效果是一样的\n### 冒号\n#### 空命令\n等价于“NOP”（no op，一个什么也不干的命令）。也可以被认为与shell的内建命令true作用相同。“:”命令是一个bash的内建命令，它的退出码（exit status）是（0）。\n如：\n```bash\n#!/bin/bash\n\nwhile :\ndo\n    echo \"endless loop\"\ndone\n```\n等价于\n```bash\n#!/bin/bash\n\nwhile true\ndo\n    echo \"endless loop\"\ndone\n```\n可以在 if/then 中作占位符：\n```bash\ncondition=5\n\nif [ $condition -gt 0 ]\nthen :   # 什么都不做，退出分支\nelse\n    echo \"$condition\"\nfi\n```\n#### 变量拓展/子串替换\n在与`>`重定向操作符联合使用的时候，会把文件内容清空，但是并不会修改文件的权限。如果文件不存在，那么创建这个文件，在这方面，类似`cat`命令\n```bash\n$ : > test.bash\n# 与 cat /dev/null > test.sh\n# /dev/null一直是一个空内容\n```\n在与`>>`重定向操作符结合使用时，将不会对预先存在的目标文件(: >> target_file)产生任何影响。如果这个文件之前并不存在，那么就创建它。\n\":\"还用来在 /etc/passwd 和 $PATH 变量中做分隔符，如：\n```bash\n$ echo $PATH\n/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin:/sbin:/usr/sbin:/usr/games\n```\n###问号\n#### 操作符\n在一个双括号结构中，? 就是C语言的三元操作符，如：\n```bash\n#!/bin/bash\n a=10\n (( t=a<50?8:9 ))\n echo $t\n```\n","source":"_posts/bash基础学习一.md","raw":"---\ntitle: bash基础学习一\ndate: 2017-04-14 15:41:16\ntags: Bash Linux\ncategories: Bash Linux\n---\n### Bash 中处理特殊字符\n\n@(bash)\n\n[toc]\n\n### #符号\n#### 注释\n\n行号以#开头是注释，bash脚本的第一行通常是`#!/bin/bash`，意思是这个文件是bash脚本 `#!` 用于当前脚本的解释器\n\n当然，在echo中转义的#是不能做转义的：\n\n```bash\n$ vim test.sh\n```\n输入如下代码，并保存\n```bash\n#!/bin/bash\n\n echo \"The # here does not begin a comment.\"\n echo 'The # here does not begin a comment.'\n echo The \\# here does not begin a comment.\n echo The # 这里开始一个注释\n\n echo ${PATH#*:}         # 参数替换，不是一个注释\n echo $(( 2#101011 ))   # 数制转换（使用二进制表示），32+8+2+1\n```\n执行结果\n```bash\n$ bash test.sh\n```\n运行效果\n```bash\nThe # here does not begin a comment.\nThe # here does not begin a comment.\nThe # here does not begin a comment.\nThe\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games\n43\n```\n\n### 分号\n#### 命令分隔符\n使用分号可以分割在同一行的两个或两个以上的命令\n```bash\n$ vim test2.sh\n```\n输入如下代码，并保存\n\n```bash\n#!/bin/bash\n echo hello; echo there\n filename=ttt.sh\n if [ -r \"$filename\" ]; then    # 注意: \"if\"和\"then\"需要分隔\n     echo \"File $filename exists.\"; cp $filename $filename.bak\n else\n     echo \"File $filename not found.\"; touch $filename\n fi; echo \"File test complete.\"\n```\n运行脚本\n```bash\n$ bash test2.sh\n```\n运行结果\n```bash\nhello\nthere\nFile ttt.sh not found\nFilename test complete.\n```\n#### 终止case选项(双;分号)\n\n使用双分号用于终止case选项\n```bash\n$ vim test.bash\n```\n输入如下代码，并保存\n```bash\n#!/bin/bash\nvarname=b\ncase $varname in \n\t[a-z]) echo \"abc\";;\n\t[0-9]) echo \"123\";;\nesac\t#case终止符号\n```\n执行脚本，查看输出\n```bash\n$ bash test.sh\nabc\n```\n\n解释说明，上面的代码，首先赋值给变量varname的值是b，然后使用case进行判断。\ncase的格式\n```bash\ncase $ in\n\t条件1) command;;\n\t条件2) command;;\n\t.\n\t.\n\t.\n\t*) command;; ##匹配所有\nesac\n```\n### 点号（.）\n等价于source命令\nbash 中的 source 命令用于在当前 bash 环境下读取并执行 FileName.sh 中的命令。\n```bash\n$ source test.sh\nHello World\n$ . test.sh\nHello World\n```\n### 引号\n\n#### 双引号\n\"STRING\" 将会阻止（解释）STRING中大部分特殊的字符。\n\n#### 单引号\n'STRING' 将会阻止STRING中所有特殊字符的解释，这是一种比使用\"更强烈的形式。\n\n### 反引号\n反引号通常是用于命令，反引号中的命令会优先执行\n```bash\n$ cp `mkdir back` test.sh back\n```\n分析：反引号类似算法中的小括号，会优先执行，上面的运行结果\n```bash\n$ cp `mkdir back` test.sh back\n$ ll\ntotal 16K\ndrwxrwxr-x 3 shiyanlou shiyanlou 4.0K Apr 14 14:43 Code\ndrwxrwxr-x 2 shiyanlou shiyanlou 4.0K Nov 27  2015 Desktop\ndrwxrwxr-x 2 shiyanlou shiyanlou 4.0K Apr 14 15:07 back\n-rw-rw-r-- 1 shiyanlou shiyanlou   13 Apr 14 15:04 test.sh\n```\n为了验证一下，我们可以删除back文件夹内容，然后执行 **cp test.sh back `mkdir back`** 效果是一样的\n### 冒号\n#### 空命令\n等价于“NOP”（no op，一个什么也不干的命令）。也可以被认为与shell的内建命令true作用相同。“:”命令是一个bash的内建命令，它的退出码（exit status）是（0）。\n如：\n```bash\n#!/bin/bash\n\nwhile :\ndo\n    echo \"endless loop\"\ndone\n```\n等价于\n```bash\n#!/bin/bash\n\nwhile true\ndo\n    echo \"endless loop\"\ndone\n```\n可以在 if/then 中作占位符：\n```bash\ncondition=5\n\nif [ $condition -gt 0 ]\nthen :   # 什么都不做，退出分支\nelse\n    echo \"$condition\"\nfi\n```\n#### 变量拓展/子串替换\n在与`>`重定向操作符联合使用的时候，会把文件内容清空，但是并不会修改文件的权限。如果文件不存在，那么创建这个文件，在这方面，类似`cat`命令\n```bash\n$ : > test.bash\n# 与 cat /dev/null > test.sh\n# /dev/null一直是一个空内容\n```\n在与`>>`重定向操作符结合使用时，将不会对预先存在的目标文件(: >> target_file)产生任何影响。如果这个文件之前并不存在，那么就创建它。\n\":\"还用来在 /etc/passwd 和 $PATH 变量中做分隔符，如：\n```bash\n$ echo $PATH\n/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin:/sbin:/usr/sbin:/usr/games\n```\n###问号\n#### 操作符\n在一个双括号结构中，? 就是C语言的三元操作符，如：\n```bash\n#!/bin/bash\n a=10\n (( t=a<50?8:9 ))\n echo $t\n```\n","slug":"bash基础学习一","published":1,"updated":"2017-04-14T07:42:03.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32o00200oqmdm9sx62a","content":"<h3 id=\"Bash-中处理特殊字符\"><a href=\"#Bash-中处理特殊字符\" class=\"headerlink\" title=\"Bash 中处理特殊字符\"></a>Bash 中处理特殊字符</h3><p>@(bash)</p>\n<p>[toc]</p>\n<h3 id=\"符号\"><a href=\"#符号\" class=\"headerlink\" title=\"#符号\"></a>#符号</h3><h4 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h4><p>行号以#开头是注释，bash脚本的第一行通常是<code>#!/bin/bash</code>，意思是这个文件是bash脚本 <code>#!</code> 用于当前脚本的解释器</p>\n<p>当然，在echo中转义的#是不能做转义的：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ vim test.sh</div></pre></td></tr></table></figure>\n<p>输入如下代码，并保存<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"></div><div class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">\"The # here does not begin a comment.\"</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">'The # here does not begin a comment.'</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> The \\<span class=\"comment\"># here does not begin a comment.</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> The <span class=\"comment\"># 这里开始一个注释</span></div><div class=\"line\"></div><div class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;PATH#*:&#125;</span>         <span class=\"comment\"># 参数替换，不是一个注释</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> $(( 2<span class=\"comment\">#101011 ))   # 数制转换（使用二进制表示），32+8+2+1</span></div></pre></td></tr></table></figure></p>\n<p>执行结果<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ bash test.sh</div></pre></td></tr></table></figure></p>\n<p>运行效果<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">The <span class=\"comment\"># here does not begin a comment.</span></div><div class=\"line\">The <span class=\"comment\"># here does not begin a comment.</span></div><div class=\"line\">The <span class=\"comment\"># here does not begin a comment.</span></div><div class=\"line\">The</div><div class=\"line\">/usr/<span class=\"built_in\">local</span>/sbin:/usr/<span class=\"built_in\">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/<span class=\"built_in\">local</span>/games</div><div class=\"line\">43</div></pre></td></tr></table></figure></p>\n<h3 id=\"分号\"><a href=\"#分号\" class=\"headerlink\" title=\"分号\"></a>分号</h3><h4 id=\"命令分隔符\"><a href=\"#命令分隔符\" class=\"headerlink\" title=\"命令分隔符\"></a>命令分隔符</h4><p>使用分号可以分割在同一行的两个或两个以上的命令<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ vim <span class=\"built_in\">test</span>2.sh</div></pre></td></tr></table></figure></p>\n<p>输入如下代码，并保存</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> hello; <span class=\"built_in\">echo</span> there</div><div class=\"line\"> filename=ttt.sh</div><div class=\"line\"> <span class=\"keyword\">if</span> [ -r <span class=\"string\">\"<span class=\"variable\">$filename</span>\"</span> ]; <span class=\"keyword\">then</span>    <span class=\"comment\"># 注意: \"if\"和\"then\"需要分隔</span></div><div class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">\"File <span class=\"variable\">$filename</span> exists.\"</span>; cp <span class=\"variable\">$filename</span> <span class=\"variable\">$filename</span>.bak</div><div class=\"line\"> <span class=\"keyword\">else</span></div><div class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">\"File <span class=\"variable\">$filename</span> not found.\"</span>; touch <span class=\"variable\">$filename</span></div><div class=\"line\"> <span class=\"keyword\">fi</span>; <span class=\"built_in\">echo</span> <span class=\"string\">\"File test complete.\"</span></div></pre></td></tr></table></figure>\n<p>运行脚本<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ bash <span class=\"built_in\">test</span>2.sh</div></pre></td></tr></table></figure></p>\n<p>运行结果<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">hello</div><div class=\"line\">there</div><div class=\"line\">File ttt.sh not found</div><div class=\"line\">Filename <span class=\"built_in\">test</span> complete.</div></pre></td></tr></table></figure></p>\n<h4 id=\"终止case选项-双-分号\"><a href=\"#终止case选项-双-分号\" class=\"headerlink\" title=\"终止case选项(双;分号)\"></a>终止case选项(双;分号)</h4><p>使用双分号用于终止case选项<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ vim test.bash</div></pre></td></tr></table></figure></p>\n<p>输入如下代码，并保存<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\">varname=b</div><div class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$varname</span> <span class=\"keyword\">in</span> </div><div class=\"line\">\t[a-z]) <span class=\"built_in\">echo</span> <span class=\"string\">\"abc\"</span>;;</div><div class=\"line\">\t[0-9]) <span class=\"built_in\">echo</span> <span class=\"string\">\"123\"</span>;;</div><div class=\"line\"><span class=\"keyword\">esac</span>\t<span class=\"comment\">#case终止符号</span></div></pre></td></tr></table></figure></p>\n<p>执行脚本，查看输出<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ bash test.sh</div><div class=\"line\">abc</div></pre></td></tr></table></figure></p>\n<p>解释说明，上面的代码，首先赋值给变量varname的值是b，然后使用case进行判断。<br>case的格式<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> $ <span class=\"keyword\">in</span></div><div class=\"line\">\t条件1) <span class=\"built_in\">command</span>;;</div><div class=\"line\">\t条件2) <span class=\"built_in\">command</span>;;</div><div class=\"line\">\t.</div><div class=\"line\">\t.</div><div class=\"line\">\t.</div><div class=\"line\">\t*) <span class=\"built_in\">command</span>;; <span class=\"comment\">##匹配所有</span></div><div class=\"line\"><span class=\"keyword\">esac</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"点号（-）\"><a href=\"#点号（-）\" class=\"headerlink\" title=\"点号（.）\"></a>点号（.）</h3><p>等价于source命令<br>bash 中的 source 命令用于在当前 bash 环境下读取并执行 FileName.sh 中的命令。<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">source</span> test.sh</div><div class=\"line\">Hello World</div><div class=\"line\">$ . test.sh</div><div class=\"line\">Hello World</div></pre></td></tr></table></figure></p>\n<h3 id=\"引号\"><a href=\"#引号\" class=\"headerlink\" title=\"引号\"></a>引号</h3><h4 id=\"双引号\"><a href=\"#双引号\" class=\"headerlink\" title=\"双引号\"></a>双引号</h4><p>“STRING” 将会阻止（解释）STRING中大部分特殊的字符。</p>\n<h4 id=\"单引号\"><a href=\"#单引号\" class=\"headerlink\" title=\"单引号\"></a>单引号</h4><p>‘STRING’ 将会阻止STRING中所有特殊字符的解释，这是一种比使用”更强烈的形式。</p>\n<h3 id=\"反引号\"><a href=\"#反引号\" class=\"headerlink\" title=\"反引号\"></a>反引号</h3><p>反引号通常是用于命令，反引号中的命令会优先执行<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ cp `mkdir back` test.sh back</div></pre></td></tr></table></figure></p>\n<p>分析：反引号类似算法中的小括号，会优先执行，上面的运行结果<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ cp `mkdir back` test.sh back</div><div class=\"line\">$ ll</div><div class=\"line\">total 16K</div><div class=\"line\">drwxrwxr-x 3 shiyanlou shiyanlou 4.0K Apr 14 14:43 Code</div><div class=\"line\">drwxrwxr-x 2 shiyanlou shiyanlou 4.0K Nov 27  2015 Desktop</div><div class=\"line\">drwxrwxr-x 2 shiyanlou shiyanlou 4.0K Apr 14 15:07 back</div><div class=\"line\">-rw-rw-r-- 1 shiyanlou shiyanlou   13 Apr 14 15:04 test.sh</div></pre></td></tr></table></figure></p>\n<p>为了验证一下，我们可以删除back文件夹内容，然后执行 <strong>cp test.sh back <code>mkdir back</code></strong> 效果是一样的</p>\n<h3 id=\"冒号\"><a href=\"#冒号\" class=\"headerlink\" title=\"冒号\"></a>冒号</h3><h4 id=\"空命令\"><a href=\"#空命令\" class=\"headerlink\" title=\"空命令\"></a>空命令</h4><p>等价于“NOP”（no op，一个什么也不干的命令）。也可以被认为与shell的内建命令true作用相同。“:”命令是一个bash的内建命令，它的退出码（exit status）是（0）。<br>如：<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">while</span> :</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"endless loop\"</span></div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure></p>\n<p>等价于<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">true</span></div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"endless loop\"</span></div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure></p>\n<p>可以在 if/then 中作占位符：<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">condition=5</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$condition</span> <span class=\"_\">-gt</span> 0 ]</div><div class=\"line\"><span class=\"keyword\">then</span> :   <span class=\"comment\"># 什么都不做，退出分支</span></div><div class=\"line\"><span class=\"keyword\">else</span></div><div class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$condition</span>\"</span></div><div class=\"line\"><span class=\"keyword\">fi</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"变量拓展-子串替换\"><a href=\"#变量拓展-子串替换\" class=\"headerlink\" title=\"变量拓展/子串替换\"></a>变量拓展/子串替换</h4><p>在与<code>&gt;</code>重定向操作符联合使用的时候，会把文件内容清空，但是并不会修改文件的权限。如果文件不存在，那么创建这个文件，在这方面，类似<code>cat</code>命令<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ : &gt; test.bash</div><div class=\"line\"><span class=\"comment\"># 与 cat /dev/null &gt; test.sh</span></div><div class=\"line\"><span class=\"comment\"># /dev/null一直是一个空内容</span></div></pre></td></tr></table></figure></p>\n<p>在与<code>&gt;&gt;</code>重定向操作符结合使用时，将不会对预先存在的目标文件(: &gt;&gt; target_file)产生任何影响。如果这个文件之前并不存在，那么就创建它。<br>“:”还用来在 /etc/passwd 和 $PATH 变量中做分隔符，如：<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span></div><div class=\"line\">/usr/<span class=\"built_in\">local</span>/bin:/bin:/usr/bin:/usr/X11R6/bin:/sbin:/usr/sbin:/usr/games</div></pre></td></tr></table></figure></p>\n<p>###问号</p>\n<h4 id=\"操作符\"><a href=\"#操作符\" class=\"headerlink\" title=\"操作符\"></a>操作符</h4><p>在一个双括号结构中，? 就是C语言的三元操作符，如：<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"> a=10</div><div class=\"line\"> (( t=a&lt;50?8:9 ))</div><div class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"variable\">$t</span></div></pre></td></tr></table></figure></p>\n","excerpt":"","more":"<h3 id=\"Bash-中处理特殊字符\"><a href=\"#Bash-中处理特殊字符\" class=\"headerlink\" title=\"Bash 中处理特殊字符\"></a>Bash 中处理特殊字符</h3><p>@(bash)</p>\n<p>[toc]</p>\n<h3 id=\"符号\"><a href=\"#符号\" class=\"headerlink\" title=\"#符号\"></a>#符号</h3><h4 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"注释\"></a>注释</h4><p>行号以#开头是注释，bash脚本的第一行通常是<code>#!/bin/bash</code>，意思是这个文件是bash脚本 <code>#!</code> 用于当前脚本的解释器</p>\n<p>当然，在echo中转义的#是不能做转义的：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ vim test.sh</div></pre></td></tr></table></figure>\n<p>输入如下代码，并保存<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</div><div class=\"line\"></span></div><div class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">\"The # here does not begin a comment.\"</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"string\">'The # here does not begin a comment.'</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> The \\<span class=\"comment\"># here does not begin a comment.</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> The <span class=\"comment\"># 这里开始一个注释</span></div><div class=\"line\"></div><div class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"variable\">$&#123;PATH#*:&#125;</span>         <span class=\"comment\"># 参数替换，不是一个注释</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> $(( 2<span class=\"comment\">#101011 ))   # 数制转换（使用二进制表示），32+8+2+1</span></div></pre></td></tr></table></figure></p>\n<p>执行结果<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ bash test.sh</div></pre></td></tr></table></figure></p>\n<p>运行效果<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">The <span class=\"comment\"># here does not begin a comment.</span></div><div class=\"line\">The <span class=\"comment\"># here does not begin a comment.</span></div><div class=\"line\">The <span class=\"comment\"># here does not begin a comment.</span></div><div class=\"line\">The</div><div class=\"line\">/usr/<span class=\"built_in\">local</span>/sbin:/usr/<span class=\"built_in\">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/<span class=\"built_in\">local</span>/games</div><div class=\"line\">43</div></pre></td></tr></table></figure></p>\n<h3 id=\"分号\"><a href=\"#分号\" class=\"headerlink\" title=\"分号\"></a>分号</h3><h4 id=\"命令分隔符\"><a href=\"#命令分隔符\" class=\"headerlink\" title=\"命令分隔符\"></a>命令分隔符</h4><p>使用分号可以分割在同一行的两个或两个以上的命令<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ vim <span class=\"built_in\">test</span>2.sh</div></pre></td></tr></table></figure></p>\n<p>输入如下代码，并保存</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"> <span class=\"built_in\">echo</span> hello; <span class=\"built_in\">echo</span> there</div><div class=\"line\"> filename=ttt.sh</div><div class=\"line\"> <span class=\"keyword\">if</span> [ -r <span class=\"string\">\"<span class=\"variable\">$filename</span>\"</span> ]; <span class=\"keyword\">then</span>    <span class=\"comment\"># 注意: \"if\"和\"then\"需要分隔</span></div><div class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">\"File <span class=\"variable\">$filename</span> exists.\"</span>; cp <span class=\"variable\">$filename</span> <span class=\"variable\">$filename</span>.bak</div><div class=\"line\"> <span class=\"keyword\">else</span></div><div class=\"line\">     <span class=\"built_in\">echo</span> <span class=\"string\">\"File <span class=\"variable\">$filename</span> not found.\"</span>; touch <span class=\"variable\">$filename</span></div><div class=\"line\"> <span class=\"keyword\">fi</span>; <span class=\"built_in\">echo</span> <span class=\"string\">\"File test complete.\"</span></div></pre></td></tr></table></figure>\n<p>运行脚本<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ bash <span class=\"built_in\">test</span>2.sh</div></pre></td></tr></table></figure></p>\n<p>运行结果<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">hello</div><div class=\"line\">there</div><div class=\"line\">File ttt.sh not found</div><div class=\"line\">Filename <span class=\"built_in\">test</span> complete.</div></pre></td></tr></table></figure></p>\n<h4 id=\"终止case选项-双-分号\"><a href=\"#终止case选项-双-分号\" class=\"headerlink\" title=\"终止case选项(双;分号)\"></a>终止case选项(双;分号)</h4><p>使用双分号用于终止case选项<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ vim test.bash</div></pre></td></tr></table></figure></p>\n<p>输入如下代码，并保存<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\">varname=b</div><div class=\"line\"><span class=\"keyword\">case</span> <span class=\"variable\">$varname</span> <span class=\"keyword\">in</span> </div><div class=\"line\">\t[a-z]) <span class=\"built_in\">echo</span> <span class=\"string\">\"abc\"</span>;;</div><div class=\"line\">\t[0-9]) <span class=\"built_in\">echo</span> <span class=\"string\">\"123\"</span>;;</div><div class=\"line\"><span class=\"keyword\">esac</span>\t<span class=\"comment\">#case终止符号</span></div></pre></td></tr></table></figure></p>\n<p>执行脚本，查看输出<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ bash test.sh</div><div class=\"line\">abc</div></pre></td></tr></table></figure></p>\n<p>解释说明，上面的代码，首先赋值给变量varname的值是b，然后使用case进行判断。<br>case的格式<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">case</span> $ <span class=\"keyword\">in</span></div><div class=\"line\">\t条件1) <span class=\"built_in\">command</span>;;</div><div class=\"line\">\t条件2) <span class=\"built_in\">command</span>;;</div><div class=\"line\">\t.</div><div class=\"line\">\t.</div><div class=\"line\">\t.</div><div class=\"line\">\t*) <span class=\"built_in\">command</span>;; <span class=\"comment\">##匹配所有</span></div><div class=\"line\"><span class=\"keyword\">esac</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"点号（-）\"><a href=\"#点号（-）\" class=\"headerlink\" title=\"点号（.）\"></a>点号（.）</h3><p>等价于source命令<br>bash 中的 source 命令用于在当前 bash 环境下读取并执行 FileName.sh 中的命令。<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">source</span> test.sh</div><div class=\"line\">Hello World</div><div class=\"line\">$ . test.sh</div><div class=\"line\">Hello World</div></pre></td></tr></table></figure></p>\n<h3 id=\"引号\"><a href=\"#引号\" class=\"headerlink\" title=\"引号\"></a>引号</h3><h4 id=\"双引号\"><a href=\"#双引号\" class=\"headerlink\" title=\"双引号\"></a>双引号</h4><p>“STRING” 将会阻止（解释）STRING中大部分特殊的字符。</p>\n<h4 id=\"单引号\"><a href=\"#单引号\" class=\"headerlink\" title=\"单引号\"></a>单引号</h4><p>‘STRING’ 将会阻止STRING中所有特殊字符的解释，这是一种比使用”更强烈的形式。</p>\n<h3 id=\"反引号\"><a href=\"#反引号\" class=\"headerlink\" title=\"反引号\"></a>反引号</h3><p>反引号通常是用于命令，反引号中的命令会优先执行<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ cp `mkdir back` test.sh back</div></pre></td></tr></table></figure></p>\n<p>分析：反引号类似算法中的小括号，会优先执行，上面的运行结果<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ cp `mkdir back` test.sh back</div><div class=\"line\">$ ll</div><div class=\"line\">total 16K</div><div class=\"line\">drwxrwxr-x 3 shiyanlou shiyanlou 4.0K Apr 14 14:43 Code</div><div class=\"line\">drwxrwxr-x 2 shiyanlou shiyanlou 4.0K Nov 27  2015 Desktop</div><div class=\"line\">drwxrwxr-x 2 shiyanlou shiyanlou 4.0K Apr 14 15:07 back</div><div class=\"line\">-rw-rw-r-- 1 shiyanlou shiyanlou   13 Apr 14 15:04 test.sh</div></pre></td></tr></table></figure></p>\n<p>为了验证一下，我们可以删除back文件夹内容，然后执行 <strong>cp test.sh back <code>mkdir back</code></strong> 效果是一样的</p>\n<h3 id=\"冒号\"><a href=\"#冒号\" class=\"headerlink\" title=\"冒号\"></a>冒号</h3><h4 id=\"空命令\"><a href=\"#空命令\" class=\"headerlink\" title=\"空命令\"></a>空命令</h4><p>等价于“NOP”（no op，一个什么也不干的命令）。也可以被认为与shell的内建命令true作用相同。“:”命令是一个bash的内建命令，它的退出码（exit status）是（0）。<br>如：<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</div><div class=\"line\"></span></div><div class=\"line\"><span class=\"keyword\">while</span> :</div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"endless loop\"</span></div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure></p>\n<p>等价于<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</div><div class=\"line\"></span></div><div class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">true</span></div><div class=\"line\"><span class=\"keyword\">do</span></div><div class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"endless loop\"</span></div><div class=\"line\"><span class=\"keyword\">done</span></div></pre></td></tr></table></figure></p>\n<p>可以在 if/then 中作占位符：<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">condition=5</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$condition</span> <span class=\"_\">-gt</span> 0 ]</div><div class=\"line\"><span class=\"keyword\">then</span> :   <span class=\"comment\"># 什么都不做，退出分支</span></div><div class=\"line\"><span class=\"keyword\">else</span></div><div class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$condition</span>\"</span></div><div class=\"line\"><span class=\"keyword\">fi</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"变量拓展-子串替换\"><a href=\"#变量拓展-子串替换\" class=\"headerlink\" title=\"变量拓展/子串替换\"></a>变量拓展/子串替换</h4><p>在与<code>&gt;</code>重定向操作符联合使用的时候，会把文件内容清空，但是并不会修改文件的权限。如果文件不存在，那么创建这个文件，在这方面，类似<code>cat</code>命令<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ : &gt; test.bash</div><div class=\"line\"><span class=\"comment\"># 与 cat /dev/null &gt; test.sh</span></div><div class=\"line\"><span class=\"comment\"># /dev/null一直是一个空内容</span></div></pre></td></tr></table></figure></p>\n<p>在与<code>&gt;&gt;</code>重定向操作符结合使用时，将不会对预先存在的目标文件(: &gt;&gt; target_file)产生任何影响。如果这个文件之前并不存在，那么就创建它。<br>“:”还用来在 /etc/passwd 和 $PATH 变量中做分隔符，如：<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ <span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span></div><div class=\"line\">/usr/<span class=\"built_in\">local</span>/bin:/bin:/usr/bin:/usr/X11R6/bin:/sbin:/usr/sbin:/usr/games</div></pre></td></tr></table></figure></p>\n<p>###问号</p>\n<h4 id=\"操作符\"><a href=\"#操作符\" class=\"headerlink\" title=\"操作符\"></a>操作符</h4><p>在一个双括号结构中，? 就是C语言的三元操作符，如：<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#!/bin/bash</span></div><div class=\"line\"> a=10</div><div class=\"line\"> (( t=a&lt;50?8:9 ))</div><div class=\"line\"> <span class=\"built_in\">echo</span> <span class=\"variable\">$t</span></div></pre></td></tr></table></figure></p>\n"},{"title":"Linux后台运行脚本","date":"2017-03-15T02:19:23.000Z","_content":"\n### Linux后台运行脚本\n\n#### 我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen\n\n### 测试方法：持续写入内容，然后查看写入的内容结果\n\n#### 为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。\n\n* **创建一个test.c和test.txt**\n```bash\n$ touch test.c\n$ touch test.txt\n```\n* **编写代码**\n```cpp\n#include<stdio.h>\n#include<string.h>\n#include <unistd.h>\nint main() {\n        FILE *fp = fopen(\"test.txt\", \"a+\");\n        if (fp == 0) {\n                printf(\"Can not open file \\n\");\n                return 0;\n        }\n        int ix = 0;\n        for (;; ix++) {\n                fseek(fp, 0, SEEK_END);\n                char s_add_arr[10];\n                memset(s_add_arr, '\\0', 10);\n                sprintf(s_add_arr, \"%i this is test \\n\", ix);\n                fwrite(s_add_arr, strlen(s_add_arr), 1, fp);\n                sleep(1);\n        }\n        fclose(fp);\n        return 0;\n}\n```\n\n* **编译c++文件**\n```bash\n$ gcc -o test test.c\n```\n* **此时会生成一个test的可运行程序**\n\n![Alt text](./1489635532801.png)\n\n* **测试脚本是否可行**\n\n```bash\n$ ./test\n```\n* **打开一个新窗口，使用vim命令查看是否有写入内容**\n![Alt text](./1489635664287.png)\n![Alt text](./1489635678506.png)\n\n\n### nuhup\n\n* **运行脚本**\n```bash\n$ nohup ./test > myout.file 2>&1 &\n[2] 3172\n[1]   Terminated              nohup ./test\n```\n* **查看进程**\n···bash\n$ jobs\n[2]+  Running                 nohup ./test > myout.file 2>&1 &\n```\n* **查看test.txt是否写进内容**\n···bash\n$ vim test.txt\n```\n\n### supervisor\n\n#### 之前写过supervisor安装配置方法，具体参见 [Linux 安装supervisor (CentOs or RedHat)](http://www.feilong.tech/2016/11/09/Linux-%E5%AE%89%E8%A3%85supervisor-CentOs-or-RedHat/)\n\n### screen\n\n#### 只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen -r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。\n\n* **运行脚本**\n```bash\n$ screen -S test ./test ##screen -S 会话命名 command，然后Ctrl+a+d放到后台\n[detached from 4070.test]\n$ screen -ls ## 查看会话\nThere is a screen on:\n        4070.test       (03/15/2017 10:27:19 PM)        (Detached)\n1 Socket in /var/run/screen/S-tengyunlong.\n```\n\n* **查看test.txt内容是否写入**","source":"_posts/linux后台运行脚本.md","raw":"---\ntitle: Linux后台运行脚本\ndate: 2017-03-15 10:19:23\ntags: Linux\ncategories: Linux\n---\n\n### Linux后台运行脚本\n\n#### 我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen\n\n### 测试方法：持续写入内容，然后查看写入的内容结果\n\n#### 为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。\n\n* **创建一个test.c和test.txt**\n```bash\n$ touch test.c\n$ touch test.txt\n```\n* **编写代码**\n```cpp\n#include<stdio.h>\n#include<string.h>\n#include <unistd.h>\nint main() {\n        FILE *fp = fopen(\"test.txt\", \"a+\");\n        if (fp == 0) {\n                printf(\"Can not open file \\n\");\n                return 0;\n        }\n        int ix = 0;\n        for (;; ix++) {\n                fseek(fp, 0, SEEK_END);\n                char s_add_arr[10];\n                memset(s_add_arr, '\\0', 10);\n                sprintf(s_add_arr, \"%i this is test \\n\", ix);\n                fwrite(s_add_arr, strlen(s_add_arr), 1, fp);\n                sleep(1);\n        }\n        fclose(fp);\n        return 0;\n}\n```\n\n* **编译c++文件**\n```bash\n$ gcc -o test test.c\n```\n* **此时会生成一个test的可运行程序**\n\n![Alt text](./1489635532801.png)\n\n* **测试脚本是否可行**\n\n```bash\n$ ./test\n```\n* **打开一个新窗口，使用vim命令查看是否有写入内容**\n![Alt text](./1489635664287.png)\n![Alt text](./1489635678506.png)\n\n\n### nuhup\n\n* **运行脚本**\n```bash\n$ nohup ./test > myout.file 2>&1 &\n[2] 3172\n[1]   Terminated              nohup ./test\n```\n* **查看进程**\n···bash\n$ jobs\n[2]+  Running                 nohup ./test > myout.file 2>&1 &\n```\n* **查看test.txt是否写进内容**\n···bash\n$ vim test.txt\n```\n\n### supervisor\n\n#### 之前写过supervisor安装配置方法，具体参见 [Linux 安装supervisor (CentOs or RedHat)](http://www.feilong.tech/2016/11/09/Linux-%E5%AE%89%E8%A3%85supervisor-CentOs-or-RedHat/)\n\n### screen\n\n#### 只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen -r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。\n\n* **运行脚本**\n```bash\n$ screen -S test ./test ##screen -S 会话命名 command，然后Ctrl+a+d放到后台\n[detached from 4070.test]\n$ screen -ls ## 查看会话\nThere is a screen on:\n        4070.test       (03/15/2017 10:27:19 PM)        (Detached)\n1 Socket in /var/run/screen/S-tengyunlong.\n```\n\n* **查看test.txt内容是否写入**","slug":"linux后台运行脚本","published":1,"updated":"2017-03-16T05:30:41.715Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32t00240oqmqz949olt","content":"<h3 id=\"Linux后台运行脚本\"><a href=\"#Linux后台运行脚本\" class=\"headerlink\" title=\"Linux后台运行脚本\"></a>Linux后台运行脚本</h3><h4 id=\"我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen\"><a href=\"#我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen\" class=\"headerlink\" title=\"我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen\"></a>我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen</h4><h3 id=\"测试方法：持续写入内容，然后查看写入的内容结果\"><a href=\"#测试方法：持续写入内容，然后查看写入的内容结果\" class=\"headerlink\" title=\"测试方法：持续写入内容，然后查看写入的内容结果\"></a>测试方法：持续写入内容，然后查看写入的内容结果</h3><h4 id=\"为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。\"><a href=\"#为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。\" class=\"headerlink\" title=\"为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。\"></a>为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。</h4><ul>\n<li><p><strong>创建一个test.c和test.txt</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ touch test.c</div><div class=\"line\">$ touch test.txt</div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>编写代码</strong></p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdio.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;string.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        FILE *fp = fopen(<span class=\"string\">\"test.txt\"</span>, <span class=\"string\">\"a+\"</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span> (fp == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"built_in\">printf</span>(<span class=\"string\">\"Can not open file \\n\"</span>);</div><div class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">int</span> ix = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (;; ix++) &#123;</div><div class=\"line\">                fseek(fp, <span class=\"number\">0</span>, SEEK_END);</div><div class=\"line\">                <span class=\"keyword\">char</span> s_add_arr[<span class=\"number\">10</span>];</div><div class=\"line\">                <span class=\"built_in\">memset</span>(s_add_arr, <span class=\"string\">'\\0'</span>, <span class=\"number\">10</span>);</div><div class=\"line\">                <span class=\"built_in\">sprintf</span>(s_add_arr, <span class=\"string\">\"%i this is test \\n\"</span>, ix);</div><div class=\"line\">                fwrite(s_add_arr, <span class=\"built_in\">strlen</span>(s_add_arr), <span class=\"number\">1</span>, fp);</div><div class=\"line\">                sleep(<span class=\"number\">1</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        fclose(fp);</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>编译c++文件</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ gcc -o <span class=\"built_in\">test</span> test.c</div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>此时会生成一个test的可运行程序</strong></p>\n</li>\n</ul>\n<p><img src=\"./1489635532801.png\" alt=\"Alt text\"></p>\n<ul>\n<li><strong>测试脚本是否可行</strong></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ ./<span class=\"built_in\">test</span></div></pre></td></tr></table></figure>\n<ul>\n<li><strong>打开一个新窗口，使用vim命令查看是否有写入内容</strong><br><img src=\"./1489635664287.png\" alt=\"Alt text\"><br><img src=\"./1489635678506.png\" alt=\"Alt text\"></li>\n</ul>\n<h3 id=\"nuhup\"><a href=\"#nuhup\" class=\"headerlink\" title=\"nuhup\"></a>nuhup</h3><ul>\n<li><p><strong>运行脚本</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ nohup ./<span class=\"built_in\">test</span> &gt; myout.file 2&gt;&amp;1 &amp;</div><div class=\"line\">[2] 3172</div><div class=\"line\">[1]   Terminated              nohup ./<span class=\"built_in\">test</span></div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>查看进程</strong><br>···bash<br>$ jobs<br>[2]+  Running                 nohup ./test &gt; myout.file 2&gt;&amp;1 &amp;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">* **查看test.txt是否写进内容**</div><div class=\"line\">···bash</div><div class=\"line\">$ vim test.txt</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"supervisor\"><a href=\"#supervisor\" class=\"headerlink\" title=\"supervisor\"></a>supervisor</h3><h4 id=\"之前写过supervisor安装配置方法，具体参见-Linux-安装supervisor-CentOs-or-RedHat\"><a href=\"#之前写过supervisor安装配置方法，具体参见-Linux-安装supervisor-CentOs-or-RedHat\" class=\"headerlink\" title=\"之前写过supervisor安装配置方法，具体参见 Linux 安装supervisor (CentOs or RedHat)\"></a>之前写过supervisor安装配置方法，具体参见 <a href=\"http://www.feilong.tech/2016/11/09/Linux-%E5%AE%89%E8%A3%85supervisor-CentOs-or-RedHat/\" target=\"_blank\" rel=\"external\">Linux 安装supervisor (CentOs or RedHat)</a></h4><h3 id=\"screen\"><a href=\"#screen\" class=\"headerlink\" title=\"screen\"></a>screen</h3><h4 id=\"只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen-r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。\"><a href=\"#只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen-r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。\" class=\"headerlink\" title=\"只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen -r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。\"></a>只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen -r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。</h4><ul>\n<li><p><strong>运行脚本</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ screen -S <span class=\"built_in\">test</span> ./<span class=\"built_in\">test</span> <span class=\"comment\">##screen -S 会话命名 command，然后Ctrl+a+d放到后台</span></div><div class=\"line\">[detached from 4070.test]</div><div class=\"line\">$ screen -ls <span class=\"comment\">## 查看会话</span></div><div class=\"line\">There is a screen on:</div><div class=\"line\">        4070.test       (03/15/2017 10:27:19 PM)        (Detached)</div><div class=\"line\">1 Socket <span class=\"keyword\">in</span> /var/run/screen/S-tengyunlong.</div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>查看test.txt内容是否写入</strong></p>\n</li>\n</ul>\n","excerpt":"","more":"<h3 id=\"Linux后台运行脚本\"><a href=\"#Linux后台运行脚本\" class=\"headerlink\" title=\"Linux后台运行脚本\"></a>Linux后台运行脚本</h3><h4 id=\"我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen\"><a href=\"#我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen\" class=\"headerlink\" title=\"我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen\"></a>我们经常会在Linux运行很多脚本，但是有些脚本是没办法因为某些原因没办法放到后台运行，这就需要我们使用一些工具了，我作为linux新手，目前只知道部分工具或者命令：nuhup，supervisor，screen</h4><h3 id=\"测试方法：持续写入内容，然后查看写入的内容结果\"><a href=\"#测试方法：持续写入内容，然后查看写入的内容结果\" class=\"headerlink\" title=\"测试方法：持续写入内容，然后查看写入的内容结果\"></a>测试方法：持续写入内容，然后查看写入的内容结果</h3><h4 id=\"为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。\"><a href=\"#为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。\" class=\"headerlink\" title=\"为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。\"></a>为了验证是否把程序挂到后台运行，我们使用一个循环写入的程序，然后查看被写入的文件，时不时刷新，查看是否有数据持续写入。</h4><ul>\n<li><p><strong>创建一个test.c和test.txt</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ touch test.c</div><div class=\"line\">$ touch test.txt</div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>编写代码</strong></p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;stdio.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;string.h&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;unistd.h&gt;</span></span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        FILE *fp = fopen(<span class=\"string\">\"test.txt\"</span>, <span class=\"string\">\"a+\"</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span> (fp == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                <span class=\"built_in\">printf</span>(<span class=\"string\">\"Can not open file \\n\"</span>);</div><div class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">int</span> ix = <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"keyword\">for</span> (;; ix++) &#123;</div><div class=\"line\">                fseek(fp, <span class=\"number\">0</span>, SEEK_END);</div><div class=\"line\">                <span class=\"keyword\">char</span> s_add_arr[<span class=\"number\">10</span>];</div><div class=\"line\">                <span class=\"built_in\">memset</span>(s_add_arr, <span class=\"string\">'\\0'</span>, <span class=\"number\">10</span>);</div><div class=\"line\">                <span class=\"built_in\">sprintf</span>(s_add_arr, <span class=\"string\">\"%i this is test \\n\"</span>, ix);</div><div class=\"line\">                fwrite(s_add_arr, <span class=\"built_in\">strlen</span>(s_add_arr), <span class=\"number\">1</span>, fp);</div><div class=\"line\">                sleep(<span class=\"number\">1</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        fclose(fp);</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>编译c++文件</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ gcc -o <span class=\"built_in\">test</span> test.c</div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>此时会生成一个test的可运行程序</strong></p>\n</li>\n</ul>\n<p><img src=\"./1489635532801.png\" alt=\"Alt text\"></p>\n<ul>\n<li><strong>测试脚本是否可行</strong></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ ./<span class=\"built_in\">test</span></div></pre></td></tr></table></figure>\n<ul>\n<li><strong>打开一个新窗口，使用vim命令查看是否有写入内容</strong><br><img src=\"./1489635664287.png\" alt=\"Alt text\"><br><img src=\"./1489635678506.png\" alt=\"Alt text\"></li>\n</ul>\n<h3 id=\"nuhup\"><a href=\"#nuhup\" class=\"headerlink\" title=\"nuhup\"></a>nuhup</h3><ul>\n<li><p><strong>运行脚本</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ nohup ./<span class=\"built_in\">test</span> &gt; myout.file 2&gt;&amp;1 &amp;</div><div class=\"line\">[2] 3172</div><div class=\"line\">[1]   Terminated              nohup ./<span class=\"built_in\">test</span></div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>查看进程</strong><br>···bash<br>$ jobs<br>[2]+  Running                 nohup ./test &gt; myout.file 2&gt;&amp;1 &amp;</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">* **查看test.txt是否写进内容**</div><div class=\"line\">···bash</div><div class=\"line\">$ vim test.txt</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"supervisor\"><a href=\"#supervisor\" class=\"headerlink\" title=\"supervisor\"></a>supervisor</h3><h4 id=\"之前写过supervisor安装配置方法，具体参见-Linux-安装supervisor-CentOs-or-RedHat\"><a href=\"#之前写过supervisor安装配置方法，具体参见-Linux-安装supervisor-CentOs-or-RedHat\" class=\"headerlink\" title=\"之前写过supervisor安装配置方法，具体参见 Linux 安装supervisor (CentOs or RedHat)\"></a>之前写过supervisor安装配置方法，具体参见 <a href=\"http://www.feilong.tech/2016/11/09/Linux-%E5%AE%89%E8%A3%85supervisor-CentOs-or-RedHat/\">Linux 安装supervisor (CentOs or RedHat)</a></h4><h3 id=\"screen\"><a href=\"#screen\" class=\"headerlink\" title=\"screen\"></a>screen</h3><h4 id=\"只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen-r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。\"><a href=\"#只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen-r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。\" class=\"headerlink\" title=\"只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen -r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。\"></a>只要Screen本身没有终止，在其内部运行的会话都可以恢复。这一点对于远程登录的用户特别有用——即使网络连接中断，用户也不会失去对已经打开的命令行会话的控制。只要再次登录到主机上执行screen -r就可以恢复会话的运行。同样在暂时离开的时候，也可以执行分离命令detach，在保证里面的程序正常运行的情况下让Screen挂起（切换到后台）。</h4><ul>\n<li><p><strong>运行脚本</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><div class=\"line\">$ screen -S <span class=\"built_in\">test</span> ./<span class=\"built_in\">test</span> <span class=\"comment\">##screen -S 会话命名 command，然后Ctrl+a+d放到后台</span></div><div class=\"line\">[detached from 4070.test]</div><div class=\"line\">$ screen -ls <span class=\"comment\">## 查看会话</span></div><div class=\"line\">There is a screen on:</div><div class=\"line\">        4070.test       (03/15/2017 10:27:19 PM)        (Detached)</div><div class=\"line\">1 Socket <span class=\"keyword\">in</span> /var/run/screen/S-tengyunlong.</div></pre></td></tr></table></figure>\n</li>\n<li><p><strong>查看test.txt内容是否写入</strong></p>\n</li>\n</ul>\n"},{"title":"php 创建xml的几种方式","date":"2016-11-15T06:19:12.000Z","_content":"\n#### 1、直接创建字符串\n\n```php\nheader(\"content-type:application/xml;\");\n$xml = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\n\t\t<people>\n\t\t<name>Tyler Teng</name>\n\t\t<sex>man</sex>\n\t\t</people>\";\necho $xml;\n```\n\n#### 2、使用DOMDocument进行创建\n\n```php\nheader(\"content-type:application/xml;\");\n$xml = new DOMDocument('1.0', 'utf-8');\n$root = $xml->createElement('people');\n$name = $xml->createElement('name', 'Tyler Teng');\n$sex = $xml->createElement('sex', 'man');\n$root->appendChild($name);\n$root->appendChild($sex);\n$xml->appendChild($root);\n\necho $xml->saveXML();\n```\n\n#### 3、使用XMLWriter进行创建\n\n```php\nheader('Content-type:application/xml');\n$xml_writer = new XMLWriter;\n$xml_writer->openMemory();\n$xml_writer->startDocument('1.0', 'utf-8');\n$xml_writer->startElement('people');\n$xml_writer->writeElement('name', 'Tyler Teng');\n$xml_writer->writeElement('sex', 'man');\n$xml_writer->endElement();\n$xml_writer->endDocument();\n\necho $xml_writer->outputMemory();\n```","source":"_posts/php-创建xml的几种方式.md","raw":"---\ntitle: php 创建xml的几种方式\ndate: 2016-11-15 14:19:12\ntags: \ncategories: PHP\n---\n\n#### 1、直接创建字符串\n\n```php\nheader(\"content-type:application/xml;\");\n$xml = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\n\t\t<people>\n\t\t<name>Tyler Teng</name>\n\t\t<sex>man</sex>\n\t\t</people>\";\necho $xml;\n```\n\n#### 2、使用DOMDocument进行创建\n\n```php\nheader(\"content-type:application/xml;\");\n$xml = new DOMDocument('1.0', 'utf-8');\n$root = $xml->createElement('people');\n$name = $xml->createElement('name', 'Tyler Teng');\n$sex = $xml->createElement('sex', 'man');\n$root->appendChild($name);\n$root->appendChild($sex);\n$xml->appendChild($root);\n\necho $xml->saveXML();\n```\n\n#### 3、使用XMLWriter进行创建\n\n```php\nheader('Content-type:application/xml');\n$xml_writer = new XMLWriter;\n$xml_writer->openMemory();\n$xml_writer->startDocument('1.0', 'utf-8');\n$xml_writer->startElement('people');\n$xml_writer->writeElement('name', 'Tyler Teng');\n$xml_writer->writeElement('sex', 'man');\n$xml_writer->endElement();\n$xml_writer->endDocument();\n\necho $xml_writer->outputMemory();\n```","slug":"php-创建xml的几种方式","published":1,"updated":"2016-11-15T06:20:07.837Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32w00280oqmdhioj96g","content":"<h4 id=\"1、直接创建字符串\"><a href=\"#1、直接创建字符串\" class=\"headerlink\" title=\"1、直接创建字符串\"></a>1、直接创建字符串</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">header(<span class=\"string\">\"content-type:application/xml;\"</span>);</div><div class=\"line\">$xml = <span class=\"string\">\"&lt;?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?&gt;</span></div><div class=\"line\">\t\t&lt;people&gt;</div><div class=\"line\">\t\t&lt;name&gt;Tyler Teng&lt;/name&gt;</div><div class=\"line\">\t\t&lt;sex&gt;man&lt;/sex&gt;</div><div class=\"line\">\t\t&lt;/people&gt;\";</div><div class=\"line\"><span class=\"keyword\">echo</span> $xml;</div></pre></td></tr></table></figure>\n<h4 id=\"2、使用DOMDocument进行创建\"><a href=\"#2、使用DOMDocument进行创建\" class=\"headerlink\" title=\"2、使用DOMDocument进行创建\"></a>2、使用DOMDocument进行创建</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">header(<span class=\"string\">\"content-type:application/xml;\"</span>);</div><div class=\"line\">$xml = <span class=\"keyword\">new</span> DOMDocument(<span class=\"string\">'1.0'</span>, <span class=\"string\">'utf-8'</span>);</div><div class=\"line\">$root = $xml-&gt;createElement(<span class=\"string\">'people'</span>);</div><div class=\"line\">$name = $xml-&gt;createElement(<span class=\"string\">'name'</span>, <span class=\"string\">'Tyler Teng'</span>);</div><div class=\"line\">$sex = $xml-&gt;createElement(<span class=\"string\">'sex'</span>, <span class=\"string\">'man'</span>);</div><div class=\"line\">$root-&gt;appendChild($name);</div><div class=\"line\">$root-&gt;appendChild($sex);</div><div class=\"line\">$xml-&gt;appendChild($root);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">echo</span> $xml-&gt;saveXML();</div></pre></td></tr></table></figure>\n<h4 id=\"3、使用XMLWriter进行创建\"><a href=\"#3、使用XMLWriter进行创建\" class=\"headerlink\" title=\"3、使用XMLWriter进行创建\"></a>3、使用XMLWriter进行创建</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">header(<span class=\"string\">'Content-type:application/xml'</span>);</div><div class=\"line\">$xml_writer = <span class=\"keyword\">new</span> XMLWriter;</div><div class=\"line\">$xml_writer-&gt;openMemory();</div><div class=\"line\">$xml_writer-&gt;startDocument(<span class=\"string\">'1.0'</span>, <span class=\"string\">'utf-8'</span>);</div><div class=\"line\">$xml_writer-&gt;startElement(<span class=\"string\">'people'</span>);</div><div class=\"line\">$xml_writer-&gt;writeElement(<span class=\"string\">'name'</span>, <span class=\"string\">'Tyler Teng'</span>);</div><div class=\"line\">$xml_writer-&gt;writeElement(<span class=\"string\">'sex'</span>, <span class=\"string\">'man'</span>);</div><div class=\"line\">$xml_writer-&gt;endElement();</div><div class=\"line\">$xml_writer-&gt;endDocument();</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">echo</span> $xml_writer-&gt;outputMemory();</div></pre></td></tr></table></figure>","excerpt":"","more":"<h4 id=\"1、直接创建字符串\"><a href=\"#1、直接创建字符串\" class=\"headerlink\" title=\"1、直接创建字符串\"></a>1、直接创建字符串</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">header(<span class=\"string\">\"content-type:application/xml;\"</span>);</div><div class=\"line\">$xml = <span class=\"string\">\"&lt;?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?&gt;</div><div class=\"line\">\t\t&lt;people&gt;</div><div class=\"line\">\t\t&lt;name&gt;Tyler Teng&lt;/name&gt;</div><div class=\"line\">\t\t&lt;sex&gt;man&lt;/sex&gt;</div><div class=\"line\">\t\t&lt;/people&gt;\"</span>;</div><div class=\"line\"><span class=\"keyword\">echo</span> $xml;</div></pre></td></tr></table></figure>\n<h4 id=\"2、使用DOMDocument进行创建\"><a href=\"#2、使用DOMDocument进行创建\" class=\"headerlink\" title=\"2、使用DOMDocument进行创建\"></a>2、使用DOMDocument进行创建</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">header(<span class=\"string\">\"content-type:application/xml;\"</span>);</div><div class=\"line\">$xml = <span class=\"keyword\">new</span> DOMDocument(<span class=\"string\">'1.0'</span>, <span class=\"string\">'utf-8'</span>);</div><div class=\"line\">$root = $xml-&gt;createElement(<span class=\"string\">'people'</span>);</div><div class=\"line\">$name = $xml-&gt;createElement(<span class=\"string\">'name'</span>, <span class=\"string\">'Tyler Teng'</span>);</div><div class=\"line\">$sex = $xml-&gt;createElement(<span class=\"string\">'sex'</span>, <span class=\"string\">'man'</span>);</div><div class=\"line\">$root-&gt;appendChild($name);</div><div class=\"line\">$root-&gt;appendChild($sex);</div><div class=\"line\">$xml-&gt;appendChild($root);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">echo</span> $xml-&gt;saveXML();</div></pre></td></tr></table></figure>\n<h4 id=\"3、使用XMLWriter进行创建\"><a href=\"#3、使用XMLWriter进行创建\" class=\"headerlink\" title=\"3、使用XMLWriter进行创建\"></a>3、使用XMLWriter进行创建</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">header(<span class=\"string\">'Content-type:application/xml'</span>);</div><div class=\"line\">$xml_writer = <span class=\"keyword\">new</span> XMLWriter;</div><div class=\"line\">$xml_writer-&gt;openMemory();</div><div class=\"line\">$xml_writer-&gt;startDocument(<span class=\"string\">'1.0'</span>, <span class=\"string\">'utf-8'</span>);</div><div class=\"line\">$xml_writer-&gt;startElement(<span class=\"string\">'people'</span>);</div><div class=\"line\">$xml_writer-&gt;writeElement(<span class=\"string\">'name'</span>, <span class=\"string\">'Tyler Teng'</span>);</div><div class=\"line\">$xml_writer-&gt;writeElement(<span class=\"string\">'sex'</span>, <span class=\"string\">'man'</span>);</div><div class=\"line\">$xml_writer-&gt;endElement();</div><div class=\"line\">$xml_writer-&gt;endDocument();</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">echo</span> $xml_writer-&gt;outputMemory();</div></pre></td></tr></table></figure>"},{"title":"sphinx 生成索引时出现WARNING: attribute 'id' not found - IGNORING","date":"2017-04-02T07:38:26.000Z","_content":"### sphinx 生成索引时出现WARNING: attribute 'id' not found - IGNORING\n\n@(Linux)\n\n#### 公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING: attribute 'id' not found - IGNORING\n\n我的表结构\n```sql\nCREATE TABLE `user` (\n  `id` int(10) NOT NULL,\n  `name` varchar(20) DEFAULT NULL,\n  `sex` tinyint(4) DEFAULT NULL,\n  `create_time` int(10) DEFAULT NULL,\n  `update_time` int(10) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=MyISAM DEFAULT CHARSET=gbk;\n```\n\n部分sphinx配置\n```roboconf\nsql_query               = \\\n                SELECT id, name, sex, create_time, update_time FROM user\nsql_attr_uint           = id\nsql_attr_timestamp      = create_time\nsql_attr_timestamp      = update_time\n\n```\n\n#### 查了一下资料，才知道sphinx会内置一个id 的字段，所以选择索引的时候，就不能设置`sql_attr_uint = id`，要不然就是重复了。但是sql第一列还必须是id字段才行 （听着有点矛盾）\n\n#### 可以有两个思路：\n\n##### 第一种\n\n* 更改表结构，把id->uid\n* 更改配置\n```roboconf\nsql_query               = \\\n                SELECT uid as id, uid, name, sex, create_time, update_time FROM user\nsql_attr_uint           = uid\nsql_attr_timestamp      = create_time\nsql_attr_timestamp      = update_time\n```\n\n##### 第二种\n\n* 不改表结构，只更改配置\n\n ```roboconf\nsql_query               = \\\n                SELECT  id, id as uid, name, sex, create_time, update_time FROM user\nsql_attr_uint\t\t\t= uid\nsql_attr_timestamp      = create_time\nsql_attr_timestamp      = update_time\n```\n\n#### 然后再生成索引应该就好了 \n\n#### 附上sphinx配置说明\n\n![Alt text](/img/1491118645070.png)\n![Alt text](/img/1491118649031.png)\n","source":"_posts/sphinx-生成索引时出现WARNING-attribute-id-not-found-IGNORING.md","raw":"---\ntitle: 'sphinx 生成索引时出现WARNING: attribute ''id'' not found - IGNORING'\ndate: 2017-04-02 15:38:26\ntags: sphinx\ncategories: Linux\n---\n### sphinx 生成索引时出现WARNING: attribute 'id' not found - IGNORING\n\n@(Linux)\n\n#### 公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING: attribute 'id' not found - IGNORING\n\n我的表结构\n```sql\nCREATE TABLE `user` (\n  `id` int(10) NOT NULL,\n  `name` varchar(20) DEFAULT NULL,\n  `sex` tinyint(4) DEFAULT NULL,\n  `create_time` int(10) DEFAULT NULL,\n  `update_time` int(10) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=MyISAM DEFAULT CHARSET=gbk;\n```\n\n部分sphinx配置\n```roboconf\nsql_query               = \\\n                SELECT id, name, sex, create_time, update_time FROM user\nsql_attr_uint           = id\nsql_attr_timestamp      = create_time\nsql_attr_timestamp      = update_time\n\n```\n\n#### 查了一下资料，才知道sphinx会内置一个id 的字段，所以选择索引的时候，就不能设置`sql_attr_uint = id`，要不然就是重复了。但是sql第一列还必须是id字段才行 （听着有点矛盾）\n\n#### 可以有两个思路：\n\n##### 第一种\n\n* 更改表结构，把id->uid\n* 更改配置\n```roboconf\nsql_query               = \\\n                SELECT uid as id, uid, name, sex, create_time, update_time FROM user\nsql_attr_uint           = uid\nsql_attr_timestamp      = create_time\nsql_attr_timestamp      = update_time\n```\n\n##### 第二种\n\n* 不改表结构，只更改配置\n\n ```roboconf\nsql_query               = \\\n                SELECT  id, id as uid, name, sex, create_time, update_time FROM user\nsql_attr_uint\t\t\t= uid\nsql_attr_timestamp      = create_time\nsql_attr_timestamp      = update_time\n```\n\n#### 然后再生成索引应该就好了 \n\n#### 附上sphinx配置说明\n\n![Alt text](/img/1491118645070.png)\n![Alt text](/img/1491118649031.png)\n","slug":"sphinx-生成索引时出现WARNING-attribute-id-not-found-IGNORING","published":1,"updated":"2017-04-02T07:46:23.023Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv32y002b0oqm8ku7na8c","content":"<h3 id=\"sphinx-生成索引时出现WARNING-attribute-‘id’-not-found-IGNORING\"><a href=\"#sphinx-生成索引时出现WARNING-attribute-‘id’-not-found-IGNORING\" class=\"headerlink\" title=\"sphinx 生成索引时出现WARNING: attribute ‘id’ not found - IGNORING\"></a>sphinx 生成索引时出现WARNING: attribute ‘id’ not found - IGNORING</h3><p>@(Linux)</p>\n<h4 id=\"公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING-attribute-‘id’-not-found-IGNORING\"><a href=\"#公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING-attribute-‘id’-not-found-IGNORING\" class=\"headerlink\" title=\"公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING: attribute ‘id’ not found - IGNORING\"></a>公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING: attribute ‘id’ not found - IGNORING</h4><p>我的表结构<br><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`user`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">20</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`sex`</span> tinyint(<span class=\"number\">4</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`create_time`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`update_time`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=MyISAM <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=gbk;</div></pre></td></tr></table></figure></p>\n<p>部分sphinx配置<br><figure class=\"highlight roboconf\"><table><tr><td class=\"code\"><pre><div class=\"line\">sql_query               = \\</div><div class=\"line\">                SELECT id, name, sex, create_time, update_time FROM user</div><div class=\"line\">sql_attr_uint           = id</div><div class=\"line\">sql_attr_timestamp      = create_time</div><div class=\"line\">sql_attr_timestamp      = update_time</div></pre></td></tr></table></figure></p>\n<h4 id=\"查了一下资料，才知道sphinx会内置一个id-的字段，所以选择索引的时候，就不能设置sql-attr-uint-id，要不然就是重复了。但是sql第一列还必须是id字段才行-（听着有点矛盾）\"><a href=\"#查了一下资料，才知道sphinx会内置一个id-的字段，所以选择索引的时候，就不能设置sql-attr-uint-id，要不然就是重复了。但是sql第一列还必须是id字段才行-（听着有点矛盾）\" class=\"headerlink\" title=\"查了一下资料，才知道sphinx会内置一个id 的字段，所以选择索引的时候，就不能设置sql_attr_uint = id，要不然就是重复了。但是sql第一列还必须是id字段才行 （听着有点矛盾）\"></a>查了一下资料，才知道sphinx会内置一个id 的字段，所以选择索引的时候，就不能设置<code>sql_attr_uint = id</code>，要不然就是重复了。但是sql第一列还必须是id字段才行 （听着有点矛盾）</h4><h4 id=\"可以有两个思路：\"><a href=\"#可以有两个思路：\" class=\"headerlink\" title=\"可以有两个思路：\"></a>可以有两个思路：</h4><h5 id=\"第一种\"><a href=\"#第一种\" class=\"headerlink\" title=\"第一种\"></a>第一种</h5><ul>\n<li>更改表结构，把id-&gt;uid</li>\n<li>更改配置<figure class=\"highlight roboconf\"><table><tr><td class=\"code\"><pre><div class=\"line\">sql_query               = \\</div><div class=\"line\">                SELECT uid as id, uid, name, sex, create_time, update_time FROM user</div><div class=\"line\">sql_attr_uint           = uid</div><div class=\"line\">sql_attr_timestamp      = create_time</div><div class=\"line\">sql_attr_timestamp      = update_time</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h5 id=\"第二种\"><a href=\"#第二种\" class=\"headerlink\" title=\"第二种\"></a>第二种</h5><ul>\n<li><p>不改表结构，只更改配置</p>\n<figure class=\"highlight roboconf\"><table><tr><td class=\"code\"><pre><div class=\"line\">sql_query               = \\</div><div class=\"line\">                SELECT  id, id as uid, name, sex, create_time, update_time FROM user</div><div class=\"line\">sql_attr_uint\t\t\t= uid</div><div class=\"line\">sql_attr_timestamp      = create_time</div><div class=\"line\">sql_attr_timestamp      = update_time</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h4 id=\"然后再生成索引应该就好了\"><a href=\"#然后再生成索引应该就好了\" class=\"headerlink\" title=\"然后再生成索引应该就好了\"></a>然后再生成索引应该就好了</h4><h4 id=\"附上sphinx配置说明\"><a href=\"#附上sphinx配置说明\" class=\"headerlink\" title=\"附上sphinx配置说明\"></a>附上sphinx配置说明</h4><p><img src=\"/img/1491118645070.png\" alt=\"Alt text\"><br><img src=\"/img/1491118649031.png\" alt=\"Alt text\"></p>\n","excerpt":"","more":"<h3 id=\"sphinx-生成索引时出现WARNING-attribute-‘id’-not-found-IGNORING\"><a href=\"#sphinx-生成索引时出现WARNING-attribute-‘id’-not-found-IGNORING\" class=\"headerlink\" title=\"sphinx 生成索引时出现WARNING: attribute ‘id’ not found - IGNORING\"></a>sphinx 生成索引时出现WARNING: attribute ‘id’ not found - IGNORING</h3><p>@(Linux)</p>\n<h4 id=\"公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING-attribute-‘id’-not-found-IGNORING\"><a href=\"#公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING-attribute-‘id’-not-found-IGNORING\" class=\"headerlink\" title=\"公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING: attribute ‘id’ not found - IGNORING\"></a>公司由于业务发展需要使用sphinx、之前是师傅负责配置。现在变成是我来维护，由于对sphinx了解并不多，所以在生成索引的时候一直出现WARNING: attribute ‘id’ not found - IGNORING</h4><p>我的表结构<br><figure class=\"highlight sql\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`user`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">20</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`sex`</span> tinyint(<span class=\"number\">4</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`create_time`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`update_time`</span> <span class=\"built_in\">int</span>(<span class=\"number\">10</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=MyISAM <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=gbk;</div></pre></td></tr></table></figure></p>\n<p>部分sphinx配置<br><figure class=\"highlight roboconf\"><table><tr><td class=\"code\"><pre><div class=\"line\">sql_query               = \\</div><div class=\"line\">                SELECT id, name, sex, create_time, update_time FROM user</div><div class=\"line\">sql_attr_uint           = id</div><div class=\"line\">sql_attr_timestamp      = create_time</div><div class=\"line\">sql_attr_timestamp      = update_time</div></pre></td></tr></table></figure></p>\n<h4 id=\"查了一下资料，才知道sphinx会内置一个id-的字段，所以选择索引的时候，就不能设置sql-attr-uint-id，要不然就是重复了。但是sql第一列还必须是id字段才行-（听着有点矛盾）\"><a href=\"#查了一下资料，才知道sphinx会内置一个id-的字段，所以选择索引的时候，就不能设置sql-attr-uint-id，要不然就是重复了。但是sql第一列还必须是id字段才行-（听着有点矛盾）\" class=\"headerlink\" title=\"查了一下资料，才知道sphinx会内置一个id 的字段，所以选择索引的时候，就不能设置sql_attr_uint = id，要不然就是重复了。但是sql第一列还必须是id字段才行 （听着有点矛盾）\"></a>查了一下资料，才知道sphinx会内置一个id 的字段，所以选择索引的时候，就不能设置<code>sql_attr_uint = id</code>，要不然就是重复了。但是sql第一列还必须是id字段才行 （听着有点矛盾）</h4><h4 id=\"可以有两个思路：\"><a href=\"#可以有两个思路：\" class=\"headerlink\" title=\"可以有两个思路：\"></a>可以有两个思路：</h4><h5 id=\"第一种\"><a href=\"#第一种\" class=\"headerlink\" title=\"第一种\"></a>第一种</h5><ul>\n<li>更改表结构，把id-&gt;uid</li>\n<li>更改配置<figure class=\"highlight roboconf\"><table><tr><td class=\"code\"><pre><div class=\"line\">sql_query               = \\</div><div class=\"line\">                SELECT uid as id, uid, name, sex, create_time, update_time FROM user</div><div class=\"line\">sql_attr_uint           = uid</div><div class=\"line\">sql_attr_timestamp      = create_time</div><div class=\"line\">sql_attr_timestamp      = update_time</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h5 id=\"第二种\"><a href=\"#第二种\" class=\"headerlink\" title=\"第二种\"></a>第二种</h5><ul>\n<li><p>不改表结构，只更改配置</p>\n<figure class=\"highlight roboconf\"><table><tr><td class=\"code\"><pre><div class=\"line\">sql_query               = \\</div><div class=\"line\">                SELECT  id, id as uid, name, sex, create_time, update_time FROM user</div><div class=\"line\">sql_attr_uint\t\t\t= uid</div><div class=\"line\">sql_attr_timestamp      = create_time</div><div class=\"line\">sql_attr_timestamp      = update_time</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h4 id=\"然后再生成索引应该就好了\"><a href=\"#然后再生成索引应该就好了\" class=\"headerlink\" title=\"然后再生成索引应该就好了\"></a>然后再生成索引应该就好了</h4><h4 id=\"附上sphinx配置说明\"><a href=\"#附上sphinx配置说明\" class=\"headerlink\" title=\"附上sphinx配置说明\"></a>附上sphinx配置说明</h4><p><img src=\"/img/1491118645070.png\" alt=\"Alt text\"><br><img src=\"/img/1491118649031.png\" alt=\"Alt text\"></p>\n"},{"title":"一些杂谈琐事 —— 自我反思（一）","date":"2016-08-03T12:11:32.000Z","_content":"\n####  我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，`“思考不足”`。\n#### 怎么来理解这四个字呢？用一个简单的小事情举个例子吧。\n#### *假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情*。\n\n#### 刚来公司的时候，老大给我分配了任务，就是使用`Nodejs`搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：\n> *  开发语言：之前都是使用`PHP`，但是给的源码是`Nodejs`\n> *  实现功能：之前基本上都是软件上的操作，这次是微信 + 硬件，和嵌入式工程师合作\n\n#### 大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。\n\n#### 其实做过微信开发的，基本上都会知道一个名词——*access_token*，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access_token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access_token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。\n\n#### 时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨*英雄无用武之地*，辛苦写的demo迟迟没上线。\n\n#### 时间追溯到昨天（2016/08/03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。\n\n#### 这时候摆在我面前的有两条路：\n\n> * 继续查Nodejs资料\n> * 重新设计接口\n\n#### 这次我并没有像之前一样，而是耐心从多个方面进行思考：*`技术可行性`  *和*  `时间成本`*\n\n> * 对于第一条，技术完全不熟悉，时间更是很难估计\n> * 对于第二条，把授权接口和普通接口合并在一起，符合设计常规，PHP也是很熟的语言。\n\n#### 于是，我便重新设计接口，设计方法：\n\n> * access_token依然放在Nodejs那台服务器，作为核心的参数\n> * 使用Nodejs写一个接口，给云端使用，用来读取access_token\n> * Nodejs还要写一个rebuilt接口，当access_token过期的时候，重新生成\n\n#### 写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。\n\n记录下当前的时间：2016/08/03  21 : 54","source":"_posts/一些杂谈琐事—-—-———-自我反思.md","raw":"---\ntitle: 一些杂谈琐事 —— 自我反思（一）\ndate: 2016-08-03 20:11:32\ntags: 自我反思\ncategories: 自我反思\n---\n\n####  我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，`“思考不足”`。\n#### 怎么来理解这四个字呢？用一个简单的小事情举个例子吧。\n#### *假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情*。\n\n#### 刚来公司的时候，老大给我分配了任务，就是使用`Nodejs`搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：\n> *  开发语言：之前都是使用`PHP`，但是给的源码是`Nodejs`\n> *  实现功能：之前基本上都是软件上的操作，这次是微信 + 硬件，和嵌入式工程师合作\n\n#### 大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。\n\n#### 其实做过微信开发的，基本上都会知道一个名词——*access_token*，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access_token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access_token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。\n\n#### 时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨*英雄无用武之地*，辛苦写的demo迟迟没上线。\n\n#### 时间追溯到昨天（2016/08/03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。\n\n#### 这时候摆在我面前的有两条路：\n\n> * 继续查Nodejs资料\n> * 重新设计接口\n\n#### 这次我并没有像之前一样，而是耐心从多个方面进行思考：*`技术可行性`  *和*  `时间成本`*\n\n> * 对于第一条，技术完全不熟悉，时间更是很难估计\n> * 对于第二条，把授权接口和普通接口合并在一起，符合设计常规，PHP也是很熟的语言。\n\n#### 于是，我便重新设计接口，设计方法：\n\n> * access_token依然放在Nodejs那台服务器，作为核心的参数\n> * 使用Nodejs写一个接口，给云端使用，用来读取access_token\n> * Nodejs还要写一个rebuilt接口，当access_token过期的时候，重新生成\n\n#### 写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。\n\n记录下当前的时间：2016/08/03  21 : 54","slug":"一些杂谈琐事—-—-———-自我反思","published":1,"updated":"2016-08-16T08:51:03.499Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv331002f0oqmujkj3ke2","content":"<h4 id=\"我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，“思考不足”。\"><a href=\"#我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，“思考不足”。\" class=\"headerlink\" title=\"我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，“思考不足”。\"></a>我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，<code>“思考不足”</code>。</h4><h4 id=\"怎么来理解这四个字呢？用一个简单的小事情举个例子吧。\"><a href=\"#怎么来理解这四个字呢？用一个简单的小事情举个例子吧。\" class=\"headerlink\" title=\"怎么来理解这四个字呢？用一个简单的小事情举个例子吧。\"></a>怎么来理解这四个字呢？用一个简单的小事情举个例子吧。</h4><h4 id=\"假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情。\"><a href=\"#假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情。\" class=\"headerlink\" title=\"假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情。\"></a><em>假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情</em>。</h4><h4 id=\"刚来公司的时候，老大给我分配了任务，就是使用Nodejs搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：\"><a href=\"#刚来公司的时候，老大给我分配了任务，就是使用Nodejs搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：\" class=\"headerlink\" title=\"刚来公司的时候，老大给我分配了任务，就是使用Nodejs搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：\"></a>刚来公司的时候，老大给我分配了任务，就是使用<code>Nodejs</code>搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：</h4><blockquote>\n<ul>\n<li>开发语言：之前都是使用<code>PHP</code>，但是给的源码是<code>Nodejs</code></li>\n<li>实现功能：之前基本上都是软件上的操作，这次是微信 + 硬件，和嵌入式工程师合作</li>\n</ul>\n</blockquote>\n<h4 id=\"大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。\"><a href=\"#大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。\" class=\"headerlink\" title=\"大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。\"></a>大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。</h4><h4 id=\"其实做过微信开发的，基本上都会知道一个名词——access-token，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access-token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access-token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。\"><a href=\"#其实做过微信开发的，基本上都会知道一个名词——access-token，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access-token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access-token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。\" class=\"headerlink\" title=\"其实做过微信开发的，基本上都会知道一个名词——access_token，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access_token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access_token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。\"></a>其实做过微信开发的，基本上都会知道一个名词——<em>access_token</em>，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access_token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access_token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。</h4><h4 id=\"时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨英雄无用武之地，辛苦写的demo迟迟没上线。\"><a href=\"#时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨英雄无用武之地，辛苦写的demo迟迟没上线。\" class=\"headerlink\" title=\"时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨英雄无用武之地，辛苦写的demo迟迟没上线。\"></a>时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨<em>英雄无用武之地</em>，辛苦写的demo迟迟没上线。</h4><h4 id=\"时间追溯到昨天（2016-08-03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。\"><a href=\"#时间追溯到昨天（2016-08-03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。\" class=\"headerlink\" title=\"时间追溯到昨天（2016/08/03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。\"></a>时间追溯到昨天（2016/08/03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。</h4><h4 id=\"这时候摆在我面前的有两条路：\"><a href=\"#这时候摆在我面前的有两条路：\" class=\"headerlink\" title=\"这时候摆在我面前的有两条路：\"></a>这时候摆在我面前的有两条路：</h4><blockquote>\n<ul>\n<li>继续查Nodejs资料</li>\n<li>重新设计接口</li>\n</ul>\n</blockquote>\n<h4 id=\"这次我并没有像之前一样，而是耐心从多个方面进行思考：技术可行性-和-时间成本\"><a href=\"#这次我并没有像之前一样，而是耐心从多个方面进行思考：技术可行性-和-时间成本\" class=\"headerlink\" title=\"这次我并没有像之前一样，而是耐心从多个方面进行思考：技术可行性  和  时间成本\"></a>这次我并没有像之前一样，而是耐心从多个方面进行思考：<em><code>技术可行性</code>  </em>和<em>  <code>时间成本</code></em></h4><blockquote>\n<ul>\n<li>对于第一条，技术完全不熟悉，时间更是很难估计</li>\n<li>对于第二条，把授权接口和普通接口合并在一起，符合设计常规，PHP也是很熟的语言。</li>\n</ul>\n</blockquote>\n<h4 id=\"于是，我便重新设计接口，设计方法：\"><a href=\"#于是，我便重新设计接口，设计方法：\" class=\"headerlink\" title=\"于是，我便重新设计接口，设计方法：\"></a>于是，我便重新设计接口，设计方法：</h4><blockquote>\n<ul>\n<li>access_token依然放在Nodejs那台服务器，作为核心的参数</li>\n<li>使用Nodejs写一个接口，给云端使用，用来读取access_token</li>\n<li>Nodejs还要写一个rebuilt接口，当access_token过期的时候，重新生成</li>\n</ul>\n</blockquote>\n<h4 id=\"写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。\"><a href=\"#写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。\" class=\"headerlink\" title=\"写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。\"></a>写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。</h4><p>记录下当前的时间：2016/08/03  21 : 54</p>\n","excerpt":"","more":"<h4 id=\"我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，“思考不足”。\"><a href=\"#我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，“思考不足”。\" class=\"headerlink\" title=\"我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，“思考不足”。\"></a>我个人觉得，一个人想要成长，自我反思是必不可少的事情。说句实话，做了这么长时间的开发了，做过很多坑别人的事情，也被别人坑过不少，总结一句话来讲，<code>“思考不足”</code>。</h4><h4 id=\"怎么来理解这四个字呢？用一个简单的小事情举个例子吧。\"><a href=\"#怎么来理解这四个字呢？用一个简单的小事情举个例子吧。\" class=\"headerlink\" title=\"怎么来理解这四个字呢？用一个简单的小事情举个例子吧。\"></a>怎么来理解这四个字呢？用一个简单的小事情举个例子吧。</h4><h4 id=\"假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情。\"><a href=\"#假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情。\" class=\"headerlink\" title=\"假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情。\"></a><em>假如自己写了一个测试功能的代码文件，后来感觉用不上了，就手欠，把这个文件删了；可以有一天，这个测试代码有到了需要的时候，但是当初被自己删了，导致自己还要重新写一遍。对于我这样基本上记不住代码的人来说，还会花一些时间去百度函数，花了很多不必要的时间，来做无用功的事情</em>。</h4><h4 id=\"刚来公司的时候，老大给我分配了任务，就是使用Nodejs搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：\"><a href=\"#刚来公司的时候，老大给我分配了任务，就是使用Nodejs搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：\" class=\"headerlink\" title=\"刚来公司的时候，老大给我分配了任务，就是使用Nodejs搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：\"></a>刚来公司的时候，老大给我分配了任务，就是使用<code>Nodejs</code>搭建微信公众平台，虽然在此之前也搞了很长时间的微信公众平台，但是这次和之前后很大不同：</h4><blockquote>\n<ul>\n<li>开发语言：之前都是使用<code>PHP</code>，但是给的源码是<code>Nodejs</code></li>\n<li>实现功能：之前基本上都是软件上的操作，这次是微信 + 硬件，和嵌入式工程师合作</li>\n</ul>\n</blockquote>\n<h4 id=\"大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。\"><a href=\"#大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。\" class=\"headerlink\" title=\"大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。\"></a>大致花了2-3个月的时间吧，终于把demo搞定，并且实现微信H5页面能够扫描设备的功能。这算是一个里程碑吧。</h4><h4 id=\"其实做过微信开发的，基本上都会知道一个名词——access-token，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access-token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access-token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。\"><a href=\"#其实做过微信开发的，基本上都会知道一个名词——access-token，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access-token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access-token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。\" class=\"headerlink\" title=\"其实做过微信开发的，基本上都会知道一个名词——access_token，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access_token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access_token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。\"></a>其实做过微信开发的，基本上都会知道一个名词——<em>access_token</em>，可以说这是调用其他所有微信接口的重要凭证。而且有效时间是7200秒（2小时），当时感觉access_token属于一个核心的参数，需要放在Nodejs这台服务器上面才行（普通接口和Nodejs在两台服务器上面部署着）。然后app在进行设备授权的时候，使用Nodejs写一个接口，不但能够调用微信API，还能较容易的控制access_token。当时感觉这样的设计还不错，但是我却无形之中给自己埋了一个坑：对Nodejs仅仅算是半入门的阶段。</h4><h4 id=\"时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨英雄无用武之地，辛苦写的demo迟迟没上线。\"><a href=\"#时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨英雄无用武之地，辛苦写的demo迟迟没上线。\" class=\"headerlink\" title=\"时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨英雄无用武之地，辛苦写的demo迟迟没上线。\"></a>时间大概过了4-5个月，当时设计的demo终于派上用场了，之前还在埋怨<em>英雄无用武之地</em>，辛苦写的demo迟迟没上线。</h4><h4 id=\"时间追溯到昨天（2016-08-03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。\"><a href=\"#时间追溯到昨天（2016-08-03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。\" class=\"headerlink\" title=\"时间追溯到昨天（2016/08/03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。\"></a>时间追溯到昨天（2016/08/03），本以为一切看似顺利的事情，突然卡住了：app客户端数据是经过gzip压缩过的，传上云端需要进行gzip解压才行。不得已，只能赶快查资料“Nodejs解压gzip数据”。结果很遗憾，没找到合适的解决方案，因为毕竟对于Nodejs并不熟悉。</h4><h4 id=\"这时候摆在我面前的有两条路：\"><a href=\"#这时候摆在我面前的有两条路：\" class=\"headerlink\" title=\"这时候摆在我面前的有两条路：\"></a>这时候摆在我面前的有两条路：</h4><blockquote>\n<ul>\n<li>继续查Nodejs资料</li>\n<li>重新设计接口</li>\n</ul>\n</blockquote>\n<h4 id=\"这次我并没有像之前一样，而是耐心从多个方面进行思考：技术可行性-和-时间成本\"><a href=\"#这次我并没有像之前一样，而是耐心从多个方面进行思考：技术可行性-和-时间成本\" class=\"headerlink\" title=\"这次我并没有像之前一样，而是耐心从多个方面进行思考：技术可行性  和  时间成本\"></a>这次我并没有像之前一样，而是耐心从多个方面进行思考：<em><code>技术可行性</code>  </em>和<em>  <code>时间成本</code></em></h4><blockquote>\n<ul>\n<li>对于第一条，技术完全不熟悉，时间更是很难估计</li>\n<li>对于第二条，把授权接口和普通接口合并在一起，符合设计常规，PHP也是很熟的语言。</li>\n</ul>\n</blockquote>\n<h4 id=\"于是，我便重新设计接口，设计方法：\"><a href=\"#于是，我便重新设计接口，设计方法：\" class=\"headerlink\" title=\"于是，我便重新设计接口，设计方法：\"></a>于是，我便重新设计接口，设计方法：</h4><blockquote>\n<ul>\n<li>access_token依然放在Nodejs那台服务器，作为核心的参数</li>\n<li>使用Nodejs写一个接口，给云端使用，用来读取access_token</li>\n<li>Nodejs还要写一个rebuilt接口，当access_token过期的时候，重新生成</li>\n</ul>\n</blockquote>\n<h4 id=\"写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。\"><a href=\"#写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。\" class=\"headerlink\" title=\"写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。\"></a>写完所有的接口，包括简单的测试，大致花了半天多的时间，这也算是对之前的坑的填补，这边blog也算是对自己的一个警示，和对“每天一篇Blog”打卡任务替代吧，因为今天实在是没什么写的了。</h4><p>记录下当前的时间：2016/08/03  21 : 54</p>\n"},{"title":"关于多个chatbot的调研结果","date":"2016-08-26T11:14:10.000Z","_content":"\n\n### 调研API list：\n> * [小黄鸡：SimSimi](http://developer.simsimi.com/)\n> * [潘多拉机器人：Pandorabots](https://developer.pandorabots.com)\n> * [人格锻造机器人：personalityforge](http://www.personalityforge.com/)\n\n### SimSimi：\n\n### 语言支持：韩、英、中为首的45中语言\n\n#### 小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。\n\n### 培养：官方\n\n#### SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。\n\n### 优势：\n\n> #### 1、接入简单快捷：只需要简单十多行代码即可\n> #### 2、语言支持广泛：支持多种语言\n> #### 3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉\n\n### 劣势：\n\n> #### 1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素\n\n###  Pandorabots\n\n### 语言支持：英语\n\n#### Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。 其实我要吐槽一下，在实用Pandorabots API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。\n\n### 培养：开发者。\n\n#### 潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete -> upload -> compile -> talk\n\n![Alt text](/img/QQ截图20160826192107.png)\n\n### 优势：\n\n> ####  1、交谈内控可控，回答内容完全在自己控制下\n\n### 劣势：\n\n> #### 1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk\n> #### 2、需要频繁的进行upload和compile\n> #### 3、蛋疼的试用限制：需要信用卡认证\n> #### 4、应用范围比较小，不适合做聊天机器人\n\n### Personalityforge：\n\n### 语言支持：英语\n\n#### 人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万+的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人......\n\n### 培养：开发者\n\n#### Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。\n#### 你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。\n\n### 优势：\n\n> #### 1、操作比较简单，官方提供demo\n> #### 2、官方提供插件，方便集成\n> #### 3、机器人众多\n\n### 劣势：\n\n> #### 1、机器人需要开发者进行训练\n> #### 2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途\n\n\n### 以上便是我对三种机器人的调研结果了: )","source":"_posts/关于多个chatbot的调研结果.md","raw":"---\ntitle: 关于多个chatbot的调研结果\ndate: 2016-08-26 19:14:10\ntags: 随笔\ncategories: 随笔\n---\n\n\n### 调研API list：\n> * [小黄鸡：SimSimi](http://developer.simsimi.com/)\n> * [潘多拉机器人：Pandorabots](https://developer.pandorabots.com)\n> * [人格锻造机器人：personalityforge](http://www.personalityforge.com/)\n\n### SimSimi：\n\n### 语言支持：韩、英、中为首的45中语言\n\n#### 小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。\n\n### 培养：官方\n\n#### SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。\n\n### 优势：\n\n> #### 1、接入简单快捷：只需要简单十多行代码即可\n> #### 2、语言支持广泛：支持多种语言\n> #### 3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉\n\n### 劣势：\n\n> #### 1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素\n\n###  Pandorabots\n\n### 语言支持：英语\n\n#### Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。 其实我要吐槽一下，在实用Pandorabots API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。\n\n### 培养：开发者。\n\n#### 潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete -> upload -> compile -> talk\n\n![Alt text](/img/QQ截图20160826192107.png)\n\n### 优势：\n\n> ####  1、交谈内控可控，回答内容完全在自己控制下\n\n### 劣势：\n\n> #### 1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk\n> #### 2、需要频繁的进行upload和compile\n> #### 3、蛋疼的试用限制：需要信用卡认证\n> #### 4、应用范围比较小，不适合做聊天机器人\n\n### Personalityforge：\n\n### 语言支持：英语\n\n#### 人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万+的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人......\n\n### 培养：开发者\n\n#### Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。\n#### 你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。\n\n### 优势：\n\n> #### 1、操作比较简单，官方提供demo\n> #### 2、官方提供插件，方便集成\n> #### 3、机器人众多\n\n### 劣势：\n\n> #### 1、机器人需要开发者进行训练\n> #### 2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途\n\n\n### 以上便是我对三种机器人的调研结果了: )","slug":"关于多个chatbot的调研结果","published":1,"updated":"2016-08-26T11:21:30.252Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv333002h0oqmpl8yepsh","content":"<h3 id=\"调研API-list：\"><a href=\"#调研API-list：\" class=\"headerlink\" title=\"调研API list：\"></a>调研API list：</h3><blockquote>\n<ul>\n<li><a href=\"http://developer.simsimi.com/\" target=\"_blank\" rel=\"external\">小黄鸡：SimSimi</a></li>\n<li><a href=\"https://developer.pandorabots.com\" target=\"_blank\" rel=\"external\">潘多拉机器人：Pandorabots</a></li>\n<li><a href=\"http://www.personalityforge.com/\" target=\"_blank\" rel=\"external\">人格锻造机器人：personalityforge</a></li>\n</ul>\n</blockquote>\n<h3 id=\"SimSimi：\"><a href=\"#SimSimi：\" class=\"headerlink\" title=\"SimSimi：\"></a>SimSimi：</h3><h3 id=\"语言支持：韩、英、中为首的45中语言\"><a href=\"#语言支持：韩、英、中为首的45中语言\" class=\"headerlink\" title=\"语言支持：韩、英、中为首的45中语言\"></a>语言支持：韩、英、中为首的45中语言</h3><h4 id=\"小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。\"><a href=\"#小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。\" class=\"headerlink\" title=\"小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。\"></a>小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。</h4><h3 id=\"培养：官方\"><a href=\"#培养：官方\" class=\"headerlink\" title=\"培养：官方\"></a>培养：官方</h3><h4 id=\"SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。\"><a href=\"#SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。\" class=\"headerlink\" title=\"SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。\"></a>SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。</h4><h3 id=\"优势：\"><a href=\"#优势：\" class=\"headerlink\" title=\"优势：\"></a>优势：</h3><blockquote>\n<h4 id=\"1、接入简单快捷：只需要简单十多行代码即可\"><a href=\"#1、接入简单快捷：只需要简单十多行代码即可\" class=\"headerlink\" title=\"1、接入简单快捷：只需要简单十多行代码即可\"></a>1、接入简单快捷：只需要简单十多行代码即可</h4><h4 id=\"2、语言支持广泛：支持多种语言\"><a href=\"#2、语言支持广泛：支持多种语言\" class=\"headerlink\" title=\"2、语言支持广泛：支持多种语言\"></a>2、语言支持广泛：支持多种语言</h4><h4 id=\"3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉\"><a href=\"#3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉\" class=\"headerlink\" title=\"3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉\"></a>3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉</h4></blockquote>\n<h3 id=\"劣势：\"><a href=\"#劣势：\" class=\"headerlink\" title=\"劣势：\"></a>劣势：</h3><blockquote>\n<h4 id=\"1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素\"><a href=\"#1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素\" class=\"headerlink\" title=\"1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素\"></a>1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素</h4></blockquote>\n<h3 id=\"Pandorabots\"><a href=\"#Pandorabots\" class=\"headerlink\" title=\"Pandorabots\"></a>Pandorabots</h3><h3 id=\"语言支持：英语\"><a href=\"#语言支持：英语\" class=\"headerlink\" title=\"语言支持：英语\"></a>语言支持：英语</h3><h4 id=\"Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful-API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。-其实我要吐槽一下，在实用Pandorabots-API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。\"><a href=\"#Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful-API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。-其实我要吐槽一下，在实用Pandorabots-API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。\" class=\"headerlink\" title=\"Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。 其实我要吐槽一下，在实用Pandorabots API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。\"></a>Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。 其实我要吐槽一下，在实用Pandorabots API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。</h4><h3 id=\"培养：开发者。\"><a href=\"#培养：开发者。\" class=\"headerlink\" title=\"培养：开发者。\"></a>培养：开发者。</h3><h4 id=\"潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete-gt-upload-gt-compile-gt-talk\"><a href=\"#潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete-gt-upload-gt-compile-gt-talk\" class=\"headerlink\" title=\"潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete -&gt; upload -&gt; compile -&gt; talk\"></a>潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete -&gt; upload -&gt; compile -&gt; talk</h4><p><img src=\"/img/QQ截图20160826192107.png\" alt=\"Alt text\"></p>\n<h3 id=\"优势：-1\"><a href=\"#优势：-1\" class=\"headerlink\" title=\"优势：\"></a>优势：</h3><blockquote>\n<h4 id=\"1、交谈内控可控，回答内容完全在自己控制下\"><a href=\"#1、交谈内控可控，回答内容完全在自己控制下\" class=\"headerlink\" title=\"1、交谈内控可控，回答内容完全在自己控制下\"></a>1、交谈内控可控，回答内容完全在自己控制下</h4></blockquote>\n<h3 id=\"劣势：-1\"><a href=\"#劣势：-1\" class=\"headerlink\" title=\"劣势：\"></a>劣势：</h3><blockquote>\n<h4 id=\"1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk\"><a href=\"#1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk\" class=\"headerlink\" title=\"1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk\"></a>1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk</h4><h4 id=\"2、需要频繁的进行upload和compile\"><a href=\"#2、需要频繁的进行upload和compile\" class=\"headerlink\" title=\"2、需要频繁的进行upload和compile\"></a>2、需要频繁的进行upload和compile</h4><h4 id=\"3、蛋疼的试用限制：需要信用卡认证\"><a href=\"#3、蛋疼的试用限制：需要信用卡认证\" class=\"headerlink\" title=\"3、蛋疼的试用限制：需要信用卡认证\"></a>3、蛋疼的试用限制：需要信用卡认证</h4><h4 id=\"4、应用范围比较小，不适合做聊天机器人\"><a href=\"#4、应用范围比较小，不适合做聊天机器人\" class=\"headerlink\" title=\"4、应用范围比较小，不适合做聊天机器人\"></a>4、应用范围比较小，不适合做聊天机器人</h4></blockquote>\n<h3 id=\"Personalityforge：\"><a href=\"#Personalityforge：\" class=\"headerlink\" title=\"Personalityforge：\"></a>Personalityforge：</h3><h3 id=\"语言支持：英语-1\"><a href=\"#语言支持：英语-1\" class=\"headerlink\" title=\"语言支持：英语\"></a>语言支持：英语</h3><h4 id=\"人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万-的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人……\"><a href=\"#人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万-的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人……\" class=\"headerlink\" title=\"人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万+的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人……\"></a>人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万+的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人……</h4><h3 id=\"培养：开发者\"><a href=\"#培养：开发者\" class=\"headerlink\" title=\"培养：开发者\"></a>培养：开发者</h3><h4 id=\"Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。\"><a href=\"#Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。\" class=\"headerlink\" title=\"Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。\"></a>Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。</h4><h4 id=\"你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。\"><a href=\"#你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。\" class=\"headerlink\" title=\"你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。\"></a>你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。</h4><h3 id=\"优势：-2\"><a href=\"#优势：-2\" class=\"headerlink\" title=\"优势：\"></a>优势：</h3><blockquote>\n<h4 id=\"1、操作比较简单，官方提供demo\"><a href=\"#1、操作比较简单，官方提供demo\" class=\"headerlink\" title=\"1、操作比较简单，官方提供demo\"></a>1、操作比较简单，官方提供demo</h4><h4 id=\"2、官方提供插件，方便集成\"><a href=\"#2、官方提供插件，方便集成\" class=\"headerlink\" title=\"2、官方提供插件，方便集成\"></a>2、官方提供插件，方便集成</h4><h4 id=\"3、机器人众多\"><a href=\"#3、机器人众多\" class=\"headerlink\" title=\"3、机器人众多\"></a>3、机器人众多</h4></blockquote>\n<h3 id=\"劣势：-2\"><a href=\"#劣势：-2\" class=\"headerlink\" title=\"劣势：\"></a>劣势：</h3><blockquote>\n<h4 id=\"1、机器人需要开发者进行训练\"><a href=\"#1、机器人需要开发者进行训练\" class=\"headerlink\" title=\"1、机器人需要开发者进行训练\"></a>1、机器人需要开发者进行训练</h4><h4 id=\"2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途\"><a href=\"#2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途\" class=\"headerlink\" title=\"2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途\"></a>2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途</h4></blockquote>\n<h3 id=\"以上便是我对三种机器人的调研结果了\"><a href=\"#以上便是我对三种机器人的调研结果了\" class=\"headerlink\" title=\"以上便是我对三种机器人的调研结果了: )\"></a>以上便是我对三种机器人的调研结果了: )</h3>","excerpt":"","more":"<h3 id=\"调研API-list：\"><a href=\"#调研API-list：\" class=\"headerlink\" title=\"调研API list：\"></a>调研API list：</h3><blockquote>\n<ul>\n<li><a href=\"http://developer.simsimi.com/\">小黄鸡：SimSimi</a></li>\n<li><a href=\"https://developer.pandorabots.com\">潘多拉机器人：Pandorabots</a></li>\n<li><a href=\"http://www.personalityforge.com/\">人格锻造机器人：personalityforge</a></li>\n</ul>\n</blockquote>\n<h3 id=\"SimSimi：\"><a href=\"#SimSimi：\" class=\"headerlink\" title=\"SimSimi：\"></a>SimSimi：</h3><h3 id=\"语言支持：韩、英、中为首的45中语言\"><a href=\"#语言支持：韩、英、中为首的45中语言\" class=\"headerlink\" title=\"语言支持：韩、英、中为首的45中语言\"></a>语言支持：韩、英、中为首的45中语言</h3><h4 id=\"小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。\"><a href=\"#小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。\" class=\"headerlink\" title=\"小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。\"></a>小黄鸡可以说是最喜闻乐见的机器人了。小黄鸡在国人眼中比较熟悉，应用范围比较广泛，而且百度，人人网也是合作伙伴之一，支持多达45中语言，不过这些语言中并非所有的都能准确回应。韩语、英语和汉语是小黄鸡支持最好的三种语言了。首先，小黄鸡产自韩国，对韩语支持最大；英语作为世界应用范围最广的语言紧随其后；全球用户使用者最多的汉语位居第三。我之所以这么说，也并非毫无依据，官网语言仅支持这三种语言。</h4><h3 id=\"培养：官方\"><a href=\"#培养：官方\" class=\"headerlink\" title=\"培养：官方\"></a>培养：官方</h3><h4 id=\"SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。\"><a href=\"#SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。\" class=\"headerlink\" title=\"SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。\"></a>SimSimi的语言培养完全来自官方培养，所以只要接入之后，完全不需要自己配置，这一点在三者之中最方便快捷，只需要通过API传入对应参数即可。</h4><h3 id=\"优势：\"><a href=\"#优势：\" class=\"headerlink\" title=\"优势：\"></a>优势：</h3><blockquote>\n<h4 id=\"1、接入简单快捷：只需要简单十多行代码即可\"><a href=\"#1、接入简单快捷：只需要简单十多行代码即可\" class=\"headerlink\" title=\"1、接入简单快捷：只需要简单十多行代码即可\"></a>1、接入简单快捷：只需要简单十多行代码即可</h4><h4 id=\"2、语言支持广泛：支持多种语言\"><a href=\"#2、语言支持广泛：支持多种语言\" class=\"headerlink\" title=\"2、语言支持广泛：支持多种语言\"></a>2、语言支持广泛：支持多种语言</h4><h4 id=\"3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉\"><a href=\"#3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉\" class=\"headerlink\" title=\"3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉\"></a>3、口语化：交谈更接近两人交谈，没有那种冷冷的机器人的感觉</h4></blockquote>\n<h3 id=\"劣势：\"><a href=\"#劣势：\" class=\"headerlink\" title=\"劣势：\"></a>劣势：</h3><blockquote>\n<h4 id=\"1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素\"><a href=\"#1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素\" class=\"headerlink\" title=\"1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素\"></a>1、语气太轻松：口语化虽然有些优势，但是SimSimi回复的内容有时候会充斥着轻浮和暴力因素</h4></blockquote>\n<h3 id=\"Pandorabots\"><a href=\"#Pandorabots\" class=\"headerlink\" title=\"Pandorabots\"></a>Pandorabots</h3><h3 id=\"语言支持：英语\"><a href=\"#语言支持：英语\" class=\"headerlink\" title=\"语言支持：英语\"></a>语言支持：英语</h3><h4 id=\"Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful-API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。-其实我要吐槽一下，在实用Pandorabots-API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。\"><a href=\"#Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful-API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。-其实我要吐槽一下，在实用Pandorabots-API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。\" class=\"headerlink\" title=\"Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。 其实我要吐槽一下，在实用Pandorabots API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。\"></a>Pandorabots在Google排名比较靠前的chatbot，他和SimSimi有比较大的差别，Pandorabots是基于RESTful API的人工智能应用程序，这类机器人并不适合经常的语音交谈聊天，更适合人工智能操作。比如，对台灯说：关灯！适用于简单、快捷的机器指令操作。 其实我要吐槽一下，在实用Pandorabots API的时候，必须要信用卡认证才行，没用信用卡则代表着没办法试用接口，这是一个非常蛋疼的地方。</h4><h3 id=\"培养：开发者。\"><a href=\"#培养：开发者。\" class=\"headerlink\" title=\"培养：开发者。\"></a>培养：开发者。</h3><h4 id=\"潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete-gt-upload-gt-compile-gt-talk\"><a href=\"#潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete-gt-upload-gt-compile-gt-talk\" class=\"headerlink\" title=\"潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete -&gt; upload -&gt; compile -&gt; talk\"></a>潘多拉机器人的培养依靠开发者自身，不定时的上传固定格式的配置文件，然后进行编译，编译结束后进行谈话。其实完整的流程是：crete -&gt; upload -&gt; compile -&gt; talk</h4><p><img src=\"/img/QQ截图20160826192107.png\" alt=\"Alt text\"></p>\n<h3 id=\"优势：-1\"><a href=\"#优势：-1\" class=\"headerlink\" title=\"优势：\"></a>优势：</h3><blockquote>\n<h4 id=\"1、交谈内控可控，回答内容完全在自己控制下\"><a href=\"#1、交谈内控可控，回答内容完全在自己控制下\" class=\"headerlink\" title=\"1、交谈内控可控，回答内容完全在自己控制下\"></a>1、交谈内控可控，回答内容完全在自己控制下</h4></blockquote>\n<h3 id=\"劣势：-1\"><a href=\"#劣势：-1\" class=\"headerlink\" title=\"劣势：\"></a>劣势：</h3><blockquote>\n<h4 id=\"1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk\"><a href=\"#1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk\" class=\"headerlink\" title=\"1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk\"></a>1、接入比较复杂，官方只提供Java、Python和nodejs的sdk，需要github上下载第三方sdk</h4><h4 id=\"2、需要频繁的进行upload和compile\"><a href=\"#2、需要频繁的进行upload和compile\" class=\"headerlink\" title=\"2、需要频繁的进行upload和compile\"></a>2、需要频繁的进行upload和compile</h4><h4 id=\"3、蛋疼的试用限制：需要信用卡认证\"><a href=\"#3、蛋疼的试用限制：需要信用卡认证\" class=\"headerlink\" title=\"3、蛋疼的试用限制：需要信用卡认证\"></a>3、蛋疼的试用限制：需要信用卡认证</h4><h4 id=\"4、应用范围比较小，不适合做聊天机器人\"><a href=\"#4、应用范围比较小，不适合做聊天机器人\" class=\"headerlink\" title=\"4、应用范围比较小，不适合做聊天机器人\"></a>4、应用范围比较小，不适合做聊天机器人</h4></blockquote>\n<h3 id=\"Personalityforge：\"><a href=\"#Personalityforge：\" class=\"headerlink\" title=\"Personalityforge：\"></a>Personalityforge：</h3><h3 id=\"语言支持：英语-1\"><a href=\"#语言支持：英语-1\" class=\"headerlink\" title=\"语言支持：英语\"></a>语言支持：英语</h3><h4 id=\"人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万-的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人……\"><a href=\"#人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万-的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人……\" class=\"headerlink\" title=\"人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万+的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人……\"></a>人格锻造机器人是我自己找的API，从机器人的名字中，我们基本上可以理解出两层信息，首先，这个机器人是有人格的，然后这个机器人是需要锻造。事实上却是如此，当我打开这个机器人website的时候，发现上面有1万+的机器人，可以说上面每个机器人都有各自的性格，风格迥异，你可以找到性格激进暴躁的，可以发现性格温柔腼腆的机器人……</h4><h3 id=\"培养：开发者\"><a href=\"#培养：开发者\" class=\"headerlink\" title=\"培养：开发者\"></a>培养：开发者</h3><h4 id=\"Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。\"><a href=\"#Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。\" class=\"headerlink\" title=\"Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。\"></a>Personalityforge和Pandorabots有些相似之处，就是需要开发者设置对话内容。当你在网站上面创建一个机器人的时候，会有一个id，这个id也是在调用API的时候必须的，因为它决定你和哪一个机器人在对话。此外，创建后，机器人自带一些简单对话内容，官方也提供了一些例如food，color等插件，可以集成到你的机器人上面。</h4><h4 id=\"你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。\"><a href=\"#你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。\" class=\"headerlink\" title=\"你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。\"></a>你也可以使用其他人创建的机器人，不过你需要联系对方获取授权才行。所以Personalityforge更像是一个平台。</h4><h3 id=\"优势：-2\"><a href=\"#优势：-2\" class=\"headerlink\" title=\"优势：\"></a>优势：</h3><blockquote>\n<h4 id=\"1、操作比较简单，官方提供demo\"><a href=\"#1、操作比较简单，官方提供demo\" class=\"headerlink\" title=\"1、操作比较简单，官方提供demo\"></a>1、操作比较简单，官方提供demo</h4><h4 id=\"2、官方提供插件，方便集成\"><a href=\"#2、官方提供插件，方便集成\" class=\"headerlink\" title=\"2、官方提供插件，方便集成\"></a>2、官方提供插件，方便集成</h4><h4 id=\"3、机器人众多\"><a href=\"#3、机器人众多\" class=\"headerlink\" title=\"3、机器人众多\"></a>3、机器人众多</h4></blockquote>\n<h3 id=\"劣势：-2\"><a href=\"#劣势：-2\" class=\"headerlink\" title=\"劣势：\"></a>劣势：</h3><blockquote>\n<h4 id=\"1、机器人需要开发者进行训练\"><a href=\"#1、机器人需要开发者进行训练\" class=\"headerlink\" title=\"1、机器人需要开发者进行训练\"></a>1、机器人需要开发者进行训练</h4><h4 id=\"2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途\"><a href=\"#2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途\" class=\"headerlink\" title=\"2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途\"></a>2、虽然网站上面机器人数量众多，但是大多私人创建，可能不太适合商业用途</h4></blockquote>\n<h3 id=\"以上便是我对三种机器人的调研结果了\"><a href=\"#以上便是我对三种机器人的调研结果了\" class=\"headerlink\" title=\"以上便是我对三种机器人的调研结果了: )\"></a>以上便是我对三种机器人的调研结果了: )</h3>"},{"title":"读《代码整洁之道》","date":"2016-09-02T12:02:53.000Z","_content":"\n#### 每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。\n\n#### 由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。\n\n#### 就像说的题目一样，主旨就是一个词：整洁\n\n#### 糟糕的代码\n\n#### 我们应该如何理解糟糕的代码？\n\n#### 无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。\n\n#### 假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·\t\n\n#### 整洁的代码\n\n#### 当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。\n\n#### *整洁的原则*\n\n#### *变量*\n\n#### 真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现`$name1`，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名+角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：\n```php\n$getActiveAccount\n$getActiveAccounts\n$getActiveAccountInfo\n```\n#### 应该很难有人区分这三个函数有什么不同了，moneyAmount 和  money两个变量其实没有任何区别。\n\n#### *函数*\n\n#### 对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。\n\n#### 在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。\n\n#### 作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。\n\n#### *格式*\n\n#### 我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？\n\n#### 其实书的内容远不止此，况且我现在才读1/3，虽然书中的代码是`Java`但是思想是一致的。","source":"_posts/读《代码整洁之道》.md","raw":"---\ntitle: 读《代码整洁之道》\ndate: 2016-09-02 20:02:53\ntags: 随笔\ncategories: 随笔\n---\n\n#### 每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。\n\n#### 由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。\n\n#### 就像说的题目一样，主旨就是一个词：整洁\n\n#### 糟糕的代码\n\n#### 我们应该如何理解糟糕的代码？\n\n#### 无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。\n\n#### 假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·\t\n\n#### 整洁的代码\n\n#### 当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。\n\n#### *整洁的原则*\n\n#### *变量*\n\n#### 真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现`$name1`，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名+角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：\n```php\n$getActiveAccount\n$getActiveAccounts\n$getActiveAccountInfo\n```\n#### 应该很难有人区分这三个函数有什么不同了，moneyAmount 和  money两个变量其实没有任何区别。\n\n#### *函数*\n\n#### 对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。\n\n#### 在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。\n\n#### 作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。\n\n#### *格式*\n\n#### 我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？\n\n#### 其实书的内容远不止此，况且我现在才读1/3，虽然书中的代码是`Java`但是思想是一致的。","slug":"读《代码整洁之道》","published":1,"updated":"2016-09-02T12:03:30.286Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv335002l0oqmkxc2hk8z","content":"<h4 id=\"每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。\"><a href=\"#每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。\" class=\"headerlink\" title=\"每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。\"></a>每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。</h4><h4 id=\"由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。\"><a href=\"#由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。\" class=\"headerlink\" title=\"由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。\"></a>由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。</h4><h4 id=\"就像说的题目一样，主旨就是一个词：整洁\"><a href=\"#就像说的题目一样，主旨就是一个词：整洁\" class=\"headerlink\" title=\"就像说的题目一样，主旨就是一个词：整洁\"></a>就像说的题目一样，主旨就是一个词：整洁</h4><h4 id=\"糟糕的代码\"><a href=\"#糟糕的代码\" class=\"headerlink\" title=\"糟糕的代码\"></a>糟糕的代码</h4><h4 id=\"我们应该如何理解糟糕的代码？\"><a href=\"#我们应该如何理解糟糕的代码？\" class=\"headerlink\" title=\"我们应该如何理解糟糕的代码？\"></a>我们应该如何理解糟糕的代码？</h4><h4 id=\"无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。\"><a href=\"#无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。\" class=\"headerlink\" title=\"无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。\"></a>无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。</h4><h4 id=\"假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·\"><a href=\"#假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·\" class=\"headerlink\" title=\"假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·\"></a>假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·</h4><h4 id=\"整洁的代码\"><a href=\"#整洁的代码\" class=\"headerlink\" title=\"整洁的代码\"></a>整洁的代码</h4><h4 id=\"当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。\"><a href=\"#当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。\" class=\"headerlink\" title=\"当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。\"></a>当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。</h4><h4 id=\"整洁的原则\"><a href=\"#整洁的原则\" class=\"headerlink\" title=\"整洁的原则\"></a><em>整洁的原则</em></h4><h4 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a><em>变量</em></h4><h4 id=\"真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现-name1，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名-角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：\"><a href=\"#真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现-name1，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名-角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：\" class=\"headerlink\" title=\"真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现$name1，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名+角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：\"></a>真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现<code>$name1</code>，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名+角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$getActiveAccount</div><div class=\"line\">$getActiveAccounts</div><div class=\"line\">$getActiveAccountInfo</div></pre></td></tr></table></figure>\n<h4 id=\"应该很难有人区分这三个函数有什么不同了，moneyAmount-和-money两个变量其实没有任何区别。\"><a href=\"#应该很难有人区分这三个函数有什么不同了，moneyAmount-和-money两个变量其实没有任何区别。\" class=\"headerlink\" title=\"应该很难有人区分这三个函数有什么不同了，moneyAmount 和  money两个变量其实没有任何区别。\"></a>应该很难有人区分这三个函数有什么不同了，moneyAmount 和  money两个变量其实没有任何区别。</h4><h4 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a><em>函数</em></h4><h4 id=\"对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。\"><a href=\"#对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。\" class=\"headerlink\" title=\"对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。\"></a>对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。</h4><h4 id=\"在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。\"><a href=\"#在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。\" class=\"headerlink\" title=\"在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。\"></a>在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。</h4><h4 id=\"作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。\"><a href=\"#作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。\" class=\"headerlink\" title=\"作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。\"></a>作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。</h4><h4 id=\"格式\"><a href=\"#格式\" class=\"headerlink\" title=\"格式\"></a><em>格式</em></h4><h4 id=\"我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？\"><a href=\"#我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？\" class=\"headerlink\" title=\"我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？\"></a>我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？</h4><h4 id=\"其实书的内容远不止此，况且我现在才读1-3，虽然书中的代码是Java但是思想是一致的。\"><a href=\"#其实书的内容远不止此，况且我现在才读1-3，虽然书中的代码是Java但是思想是一致的。\" class=\"headerlink\" title=\"其实书的内容远不止此，况且我现在才读1/3，虽然书中的代码是Java但是思想是一致的。\"></a>其实书的内容远不止此，况且我现在才读1/3，虽然书中的代码是<code>Java</code>但是思想是一致的。</h4>","excerpt":"","more":"<h4 id=\"每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。\"><a href=\"#每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。\" class=\"headerlink\" title=\"每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。\"></a>每次写代码的时候，总是感觉自己的代码很渣，于是买了一本《代码整洁之道》，希望能够学习一下优秀代码的书写原则。</h4><h4 id=\"由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。\"><a href=\"#由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。\" class=\"headerlink\" title=\"由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。\"></a>由于平时的工作比较多，我并没有专门找时间阅读这本书，只是用一些边角时间来阅读，这么长时间过去了，现在才读到100多页。这篇blog也算是对前段时间阅读的一个小结吧。</h4><h4 id=\"就像说的题目一样，主旨就是一个词：整洁\"><a href=\"#就像说的题目一样，主旨就是一个词：整洁\" class=\"headerlink\" title=\"就像说的题目一样，主旨就是一个词：整洁\"></a>就像说的题目一样，主旨就是一个词：整洁</h4><h4 id=\"糟糕的代码\"><a href=\"#糟糕的代码\" class=\"headerlink\" title=\"糟糕的代码\"></a>糟糕的代码</h4><h4 id=\"我们应该如何理解糟糕的代码？\"><a href=\"#我们应该如何理解糟糕的代码？\" class=\"headerlink\" title=\"我们应该如何理解糟糕的代码？\"></a>我们应该如何理解糟糕的代码？</h4><h4 id=\"无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。\"><a href=\"#无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。\" class=\"headerlink\" title=\"无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。\"></a>无非就是明明不准确的代码。其实糟糕的代码远不止此，很多时候，我们会为了时间和进度，赶着出产品，外包公司更甚。我最开始在腾骏，公司主要业务就是外包，由于当时没有把写代码当成一回事，导致后面代码维护比较困难，也使自己养成了坏习惯，其实应该在项目的初期，就应该定好编码规范，到后面的维护会要简单的多。</h4><h4 id=\"假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·\"><a href=\"#假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·\" class=\"headerlink\" title=\"假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·\"></a>假如我们在写代码的时候，不注意规范，到了后面如果有新同志加入项目，由于对业务的不熟悉，以及代码的规范，很容易是新同学造成误解，进而编写出更糟糕的代码。长此以往，整个项目将会被糟糕的代码所吞噬。后果不堪设想。·</h4><h4 id=\"整洁的代码\"><a href=\"#整洁的代码\" class=\"headerlink\" title=\"整洁的代码\"></a>整洁的代码</h4><h4 id=\"当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。\"><a href=\"#当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。\" class=\"headerlink\" title=\"当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。\"></a>当你阅读整洁的代码的时候，我会觉得你在阅读一首诗！事实确实是这样，当我首次来到轻客的时候，看到项目的代码，似乎不能仅仅使用整洁来形容，整个项目结构都相当严谨，有的时候，生怕自己的一个命名把整个项目玷污。</h4><h4 id=\"整洁的原则\"><a href=\"#整洁的原则\" class=\"headerlink\" title=\"整洁的原则\"></a><em>整洁的原则</em></h4><h4 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a><em>变量</em></h4><h4 id=\"真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现-name1，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名-角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：\"><a href=\"#真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现-name1，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名-角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：\" class=\"headerlink\" title=\"真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现$name1，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名+角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：\"></a>真应该是我们最经常听到的规范了。名副其实很容易理解，比如命名过程中出现<code>$name1</code>，呵呵，以前真的没少使用这种命名，现在我都想打死自己了，变量名+角标是需要严格禁止的。不过有些时候我们也会使用这样的命名：</h4><figure class=\"highlight php\"><table><tr><td class=\"code\"><pre><div class=\"line\">$getActiveAccount</div><div class=\"line\">$getActiveAccounts</div><div class=\"line\">$getActiveAccountInfo</div></pre></td></tr></table></figure>\n<h4 id=\"应该很难有人区分这三个函数有什么不同了，moneyAmount-和-money两个变量其实没有任何区别。\"><a href=\"#应该很难有人区分这三个函数有什么不同了，moneyAmount-和-money两个变量其实没有任何区别。\" class=\"headerlink\" title=\"应该很难有人区分这三个函数有什么不同了，moneyAmount 和  money两个变量其实没有任何区别。\"></a>应该很难有人区分这三个函数有什么不同了，moneyAmount 和  money两个变量其实没有任何区别。</h4><h4 id=\"函数\"><a href=\"#函数\" class=\"headerlink\" title=\"函数\"></a><em>函数</em></h4><h4 id=\"对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。\"><a href=\"#对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。\" class=\"headerlink\" title=\"对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。\"></a>对于面向对象，必不可少的就是类和函数了，在命名类的时候，应该使用名词，而函数应该是动词。</h4><h4 id=\"在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。\"><a href=\"#在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。\" class=\"headerlink\" title=\"在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。\"></a>在写函数的时候，我们也应该按照专一原则，把大函数拆分成小函数，按照调用原则在类中进行排序。</h4><h4 id=\"作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。\"><a href=\"#作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。\" class=\"headerlink\" title=\"作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。\"></a>作者还强调最好别写注释。如果是没读这本书的时候，我绝对是没办法理解的。因为项目在维护的时候，很少有人会去维护注释部分，随着时间的推移，注释和函数越来越不相符合。而且直接把代码注释是个讨厌的做法，因为后面的人，看着注释代码会觉得这段代码很有用，慢慢的，注释的代码就像破酒瓶一样。</h4><h4 id=\"格式\"><a href=\"#格式\" class=\"headerlink\" title=\"格式\"></a><em>格式</em></h4><h4 id=\"我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？\"><a href=\"#我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？\" class=\"headerlink\" title=\"我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？\"></a>我们应该尽量不要写巨大篇幅的代码，因为行数很多的话，会让阅读者很难阅读，你能容忍去阅读一个函数行数超过整个屏幕吗？</h4><h4 id=\"其实书的内容远不止此，况且我现在才读1-3，虽然书中的代码是Java但是思想是一致的。\"><a href=\"#其实书的内容远不止此，况且我现在才读1-3，虽然书中的代码是Java但是思想是一致的。\" class=\"headerlink\" title=\"其实书的内容远不止此，况且我现在才读1/3，虽然书中的代码是Java但是思想是一致的。\"></a>其实书的内容远不止此，况且我现在才读1/3，虽然书中的代码是<code>Java</code>但是思想是一致的。</h4>"},{"title":"阿里云消息队列和消息服务的使用","date":"2016-11-18T09:55:09.000Z","_content":"\n---------------------\n\n### 应用场景\n\n#### 异步处理\n\n消息队列的一的特点之一就是异步处理，这就决定了对于实时返回的信息就没办法使用消息队列。经常使用的消息队列比如发送邮箱验证、短信验证。因为一般的逻辑是串行方式，消息队列采用的是并行的模式。\n\n> **串行方式**：串行方式基本上是在编程中最常见的方式了，也就是完全按照流程做事。举个例子，我早上起床后，先刷牙（5分钟），然后再吃早饭（20分钟），我使用的时间是20+5分钟\n\n![Alt text](/img/消息队列1.png)\n\n> **并行方式**：并行方式也可以是算是异步处理，这样处理的效率会更快。举个例子，我晚上下班回家，我一边泡脚(5分钟)，泡脚的同时，我还顺便吃了晚饭（20分钟），这个过程我花了20分钟，因为泡脚和吃饭是同时进行的。\n\n![Alt text](/img/消息队列2.png)\n\n消息队列实现方式：\n\n![Alt text](/img/消息队列4.png)\n\n\n#### 应用解耦\n\n用户在下单之后，账单系统把账单信息发给库存系统，库存系统进行发货。但是如果库存系统某次访问不了，可能会导致订单失败。\n\n![Alt text](/img/消息队列5.png)\n\n消息队列形式：\n\n![Alt text](/img/消息队列6.png)\n\n#### 流量削峰\n\n很多网站的访问瓶颈大多数都是出现在数据库上面，如果某个接口出现访问量太大，必然会增加压力。或者某个接口调用第三方API，很容易出现数据丢失的状况，这种情景可以使用消息队列。\n\n![Alt text](/img/消息队列7.png)\n\n\n### 阿里云消息队列和消息服务\n\n#### 消息服务和消息队列的对比\n\n|对比项目|消息服务(MNS,原MQS)|消息队列(ONS)|\n|:-:|:-:|:-:|\n|queue模型|Yes|Yes|\n|官方SDK|Java,C++,Python,C#,PHP,Node.js(非官方),Golang(非官方)|Java,C/C++,C#,PHP(http),Python(http)|\n|支持JMS|Yes|No|\n|协议支持|HTTP|TCP,HTTP,MQTT|\n|延时消息|Yes|Yes|\n|定时消息|No|Yes|\n|事务消息|Yes|Yes|\n|消息Batch操作|Yes|No|\n|保证消息至少消费一次|Yes|Yes|\n|支持RAM访问控制|Yes|Yes|\n|消息优先级|Yes|No|\n|消息推拉模式|Pull，Push|Pull，Push|\n|消息轨迹追踪|Yes|Yes|\n|服务端消息过滤|Yes|Yes|\n|qps性能|默认5000|默认5000|\n|数据可靠性|99.99999999%|99.99%|\n|数据堆积\t|不限|不限|\n|服务可用性|99.9%|99.9%|\n\n#### API对比\n\n[消息服务API地址](https://help.aliyun.com/document_detail/27473.html?spm=5176.doc27437.6.226.7LkW7O)\n\n[消息队列http API地址](https://help.aliyun.com/document_detail/29572.html)\n\n> **消息服务的接口相对齐全一些，支持的类型也相对齐全，topic和queue两种形式。不过开发起来比较费劲，因为涉及到[签名](https://help.aliyun.com/document_detail/27487.html?spm=5176.doc27473.6.241.4ffAlt)的过程，在接收的时候，为了保证消息的安全性，需要进行验签，验签通过或才能进行逻辑处理。**\n\n\n> **消息队列的http接口比较简单，但是消息的重复率较高，达到了20%，官网提供的demo比较简单，只有发送，消费和删除，需要进程循环接收消息，比较消耗资源open API接口齐全，但是暂时没有支持PHP的SDK，综合考虑下选择了消息服务。**\n\n\n","source":"_posts/阿里云消息队列和消息服务的使用.md","raw":"---\ntitle: 阿里云消息队列和消息服务的使用\ndate: 2016-11-18 17:55:09\ntags: 消息队列 消息服务 阿里云\ncategories: PHP\n---\n\n---------------------\n\n### 应用场景\n\n#### 异步处理\n\n消息队列的一的特点之一就是异步处理，这就决定了对于实时返回的信息就没办法使用消息队列。经常使用的消息队列比如发送邮箱验证、短信验证。因为一般的逻辑是串行方式，消息队列采用的是并行的模式。\n\n> **串行方式**：串行方式基本上是在编程中最常见的方式了，也就是完全按照流程做事。举个例子，我早上起床后，先刷牙（5分钟），然后再吃早饭（20分钟），我使用的时间是20+5分钟\n\n![Alt text](/img/消息队列1.png)\n\n> **并行方式**：并行方式也可以是算是异步处理，这样处理的效率会更快。举个例子，我晚上下班回家，我一边泡脚(5分钟)，泡脚的同时，我还顺便吃了晚饭（20分钟），这个过程我花了20分钟，因为泡脚和吃饭是同时进行的。\n\n![Alt text](/img/消息队列2.png)\n\n消息队列实现方式：\n\n![Alt text](/img/消息队列4.png)\n\n\n#### 应用解耦\n\n用户在下单之后，账单系统把账单信息发给库存系统，库存系统进行发货。但是如果库存系统某次访问不了，可能会导致订单失败。\n\n![Alt text](/img/消息队列5.png)\n\n消息队列形式：\n\n![Alt text](/img/消息队列6.png)\n\n#### 流量削峰\n\n很多网站的访问瓶颈大多数都是出现在数据库上面，如果某个接口出现访问量太大，必然会增加压力。或者某个接口调用第三方API，很容易出现数据丢失的状况，这种情景可以使用消息队列。\n\n![Alt text](/img/消息队列7.png)\n\n\n### 阿里云消息队列和消息服务\n\n#### 消息服务和消息队列的对比\n\n|对比项目|消息服务(MNS,原MQS)|消息队列(ONS)|\n|:-:|:-:|:-:|\n|queue模型|Yes|Yes|\n|官方SDK|Java,C++,Python,C#,PHP,Node.js(非官方),Golang(非官方)|Java,C/C++,C#,PHP(http),Python(http)|\n|支持JMS|Yes|No|\n|协议支持|HTTP|TCP,HTTP,MQTT|\n|延时消息|Yes|Yes|\n|定时消息|No|Yes|\n|事务消息|Yes|Yes|\n|消息Batch操作|Yes|No|\n|保证消息至少消费一次|Yes|Yes|\n|支持RAM访问控制|Yes|Yes|\n|消息优先级|Yes|No|\n|消息推拉模式|Pull，Push|Pull，Push|\n|消息轨迹追踪|Yes|Yes|\n|服务端消息过滤|Yes|Yes|\n|qps性能|默认5000|默认5000|\n|数据可靠性|99.99999999%|99.99%|\n|数据堆积\t|不限|不限|\n|服务可用性|99.9%|99.9%|\n\n#### API对比\n\n[消息服务API地址](https://help.aliyun.com/document_detail/27473.html?spm=5176.doc27437.6.226.7LkW7O)\n\n[消息队列http API地址](https://help.aliyun.com/document_detail/29572.html)\n\n> **消息服务的接口相对齐全一些，支持的类型也相对齐全，topic和queue两种形式。不过开发起来比较费劲，因为涉及到[签名](https://help.aliyun.com/document_detail/27487.html?spm=5176.doc27473.6.241.4ffAlt)的过程，在接收的时候，为了保证消息的安全性，需要进行验签，验签通过或才能进行逻辑处理。**\n\n\n> **消息队列的http接口比较简单，但是消息的重复率较高，达到了20%，官网提供的demo比较简单，只有发送，消费和删除，需要进程循环接收消息，比较消耗资源open API接口齐全，但是暂时没有支持PHP的SDK，综合考虑下选择了消息服务。**\n\n\n","slug":"阿里云消息队列和消息服务的使用","published":1,"updated":"2016-11-18T10:00:20.611Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj3fgv336002o0oqmgpm9lglu","content":"<hr>\n<h3 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h3><h4 id=\"异步处理\"><a href=\"#异步处理\" class=\"headerlink\" title=\"异步处理\"></a>异步处理</h4><p>消息队列的一的特点之一就是异步处理，这就决定了对于实时返回的信息就没办法使用消息队列。经常使用的消息队列比如发送邮箱验证、短信验证。因为一般的逻辑是串行方式，消息队列采用的是并行的模式。</p>\n<blockquote>\n<p><strong>串行方式</strong>：串行方式基本上是在编程中最常见的方式了，也就是完全按照流程做事。举个例子，我早上起床后，先刷牙（5分钟），然后再吃早饭（20分钟），我使用的时间是20+5分钟</p>\n</blockquote>\n<p><img src=\"/img/消息队列1.png\" alt=\"Alt text\"></p>\n<blockquote>\n<p><strong>并行方式</strong>：并行方式也可以是算是异步处理，这样处理的效率会更快。举个例子，我晚上下班回家，我一边泡脚(5分钟)，泡脚的同时，我还顺便吃了晚饭（20分钟），这个过程我花了20分钟，因为泡脚和吃饭是同时进行的。</p>\n</blockquote>\n<p><img src=\"/img/消息队列2.png\" alt=\"Alt text\"></p>\n<p>消息队列实现方式：</p>\n<p><img src=\"/img/消息队列4.png\" alt=\"Alt text\"></p>\n<h4 id=\"应用解耦\"><a href=\"#应用解耦\" class=\"headerlink\" title=\"应用解耦\"></a>应用解耦</h4><p>用户在下单之后，账单系统把账单信息发给库存系统，库存系统进行发货。但是如果库存系统某次访问不了，可能会导致订单失败。</p>\n<p><img src=\"/img/消息队列5.png\" alt=\"Alt text\"></p>\n<p>消息队列形式：</p>\n<p><img src=\"/img/消息队列6.png\" alt=\"Alt text\"></p>\n<h4 id=\"流量削峰\"><a href=\"#流量削峰\" class=\"headerlink\" title=\"流量削峰\"></a>流量削峰</h4><p>很多网站的访问瓶颈大多数都是出现在数据库上面，如果某个接口出现访问量太大，必然会增加压力。或者某个接口调用第三方API，很容易出现数据丢失的状况，这种情景可以使用消息队列。</p>\n<p><img src=\"/img/消息队列7.png\" alt=\"Alt text\"></p>\n<h3 id=\"阿里云消息队列和消息服务\"><a href=\"#阿里云消息队列和消息服务\" class=\"headerlink\" title=\"阿里云消息队列和消息服务\"></a>阿里云消息队列和消息服务</h3><h4 id=\"消息服务和消息队列的对比\"><a href=\"#消息服务和消息队列的对比\" class=\"headerlink\" title=\"消息服务和消息队列的对比\"></a>消息服务和消息队列的对比</h4><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">对比项目</th>\n<th style=\"text-align:center\">消息服务(MNS,原MQS)</th>\n<th style=\"text-align:center\">消息队列(ONS)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">queue模型</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">官方SDK</td>\n<td style=\"text-align:center\">Java,C++,Python,C#,PHP,Node.js(非官方),Golang(非官方)</td>\n<td style=\"text-align:center\">Java,C/C++,C#,PHP(http),Python(http)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">支持JMS</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">No</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">协议支持</td>\n<td style=\"text-align:center\">HTTP</td>\n<td style=\"text-align:center\">TCP,HTTP,MQTT</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">延时消息</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">定时消息</td>\n<td style=\"text-align:center\">No</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">事务消息</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">消息Batch操作</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">No</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">保证消息至少消费一次</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">支持RAM访问控制</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">消息优先级</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">No</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">消息推拉模式</td>\n<td style=\"text-align:center\">Pull，Push</td>\n<td style=\"text-align:center\">Pull，Push</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">消息轨迹追踪</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">服务端消息过滤</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">qps性能</td>\n<td style=\"text-align:center\">默认5000</td>\n<td style=\"text-align:center\">默认5000</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数据可靠性</td>\n<td style=\"text-align:center\">99.99999999%</td>\n<td style=\"text-align:center\">99.99%</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数据堆积</td>\n<td style=\"text-align:center\">不限</td>\n<td style=\"text-align:center\">不限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">服务可用性</td>\n<td style=\"text-align:center\">99.9%</td>\n<td style=\"text-align:center\">99.9%</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"API对比\"><a href=\"#API对比\" class=\"headerlink\" title=\"API对比\"></a>API对比</h4><p><a href=\"https://help.aliyun.com/document_detail/27473.html?spm=5176.doc27437.6.226.7LkW7O\" target=\"_blank\" rel=\"external\">消息服务API地址</a></p>\n<p><a href=\"https://help.aliyun.com/document_detail/29572.html\" target=\"_blank\" rel=\"external\">消息队列http API地址</a></p>\n<blockquote>\n<p><strong>消息服务的接口相对齐全一些，支持的类型也相对齐全，topic和queue两种形式。不过开发起来比较费劲，因为涉及到<a href=\"https://help.aliyun.com/document_detail/27487.html?spm=5176.doc27473.6.241.4ffAlt\" target=\"_blank\" rel=\"external\">签名</a>的过程，在接收的时候，为了保证消息的安全性，需要进行验签，验签通过或才能进行逻辑处理。</strong></p>\n<p><strong>消息队列的http接口比较简单，但是消息的重复率较高，达到了20%，官网提供的demo比较简单，只有发送，消费和删除，需要进程循环接收消息，比较消耗资源open API接口齐全，但是暂时没有支持PHP的SDK，综合考虑下选择了消息服务。</strong></p>\n</blockquote>\n","excerpt":"","more":"<hr>\n<h3 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h3><h4 id=\"异步处理\"><a href=\"#异步处理\" class=\"headerlink\" title=\"异步处理\"></a>异步处理</h4><p>消息队列的一的特点之一就是异步处理，这就决定了对于实时返回的信息就没办法使用消息队列。经常使用的消息队列比如发送邮箱验证、短信验证。因为一般的逻辑是串行方式，消息队列采用的是并行的模式。</p>\n<blockquote>\n<p><strong>串行方式</strong>：串行方式基本上是在编程中最常见的方式了，也就是完全按照流程做事。举个例子，我早上起床后，先刷牙（5分钟），然后再吃早饭（20分钟），我使用的时间是20+5分钟</p>\n</blockquote>\n<p><img src=\"/img/消息队列1.png\" alt=\"Alt text\"></p>\n<blockquote>\n<p><strong>并行方式</strong>：并行方式也可以是算是异步处理，这样处理的效率会更快。举个例子，我晚上下班回家，我一边泡脚(5分钟)，泡脚的同时，我还顺便吃了晚饭（20分钟），这个过程我花了20分钟，因为泡脚和吃饭是同时进行的。</p>\n</blockquote>\n<p><img src=\"/img/消息队列2.png\" alt=\"Alt text\"></p>\n<p>消息队列实现方式：</p>\n<p><img src=\"/img/消息队列4.png\" alt=\"Alt text\"></p>\n<h4 id=\"应用解耦\"><a href=\"#应用解耦\" class=\"headerlink\" title=\"应用解耦\"></a>应用解耦</h4><p>用户在下单之后，账单系统把账单信息发给库存系统，库存系统进行发货。但是如果库存系统某次访问不了，可能会导致订单失败。</p>\n<p><img src=\"/img/消息队列5.png\" alt=\"Alt text\"></p>\n<p>消息队列形式：</p>\n<p><img src=\"/img/消息队列6.png\" alt=\"Alt text\"></p>\n<h4 id=\"流量削峰\"><a href=\"#流量削峰\" class=\"headerlink\" title=\"流量削峰\"></a>流量削峰</h4><p>很多网站的访问瓶颈大多数都是出现在数据库上面，如果某个接口出现访问量太大，必然会增加压力。或者某个接口调用第三方API，很容易出现数据丢失的状况，这种情景可以使用消息队列。</p>\n<p><img src=\"/img/消息队列7.png\" alt=\"Alt text\"></p>\n<h3 id=\"阿里云消息队列和消息服务\"><a href=\"#阿里云消息队列和消息服务\" class=\"headerlink\" title=\"阿里云消息队列和消息服务\"></a>阿里云消息队列和消息服务</h3><h4 id=\"消息服务和消息队列的对比\"><a href=\"#消息服务和消息队列的对比\" class=\"headerlink\" title=\"消息服务和消息队列的对比\"></a>消息服务和消息队列的对比</h4><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">对比项目</th>\n<th style=\"text-align:center\">消息服务(MNS,原MQS)</th>\n<th style=\"text-align:center\">消息队列(ONS)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">queue模型</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">官方SDK</td>\n<td style=\"text-align:center\">Java,C++,Python,C#,PHP,Node.js(非官方),Golang(非官方)</td>\n<td style=\"text-align:center\">Java,C/C++,C#,PHP(http),Python(http)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">支持JMS</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">No</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">协议支持</td>\n<td style=\"text-align:center\">HTTP</td>\n<td style=\"text-align:center\">TCP,HTTP,MQTT</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">延时消息</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">定时消息</td>\n<td style=\"text-align:center\">No</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">事务消息</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">消息Batch操作</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">No</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">保证消息至少消费一次</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">支持RAM访问控制</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">消息优先级</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">No</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">消息推拉模式</td>\n<td style=\"text-align:center\">Pull，Push</td>\n<td style=\"text-align:center\">Pull，Push</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">消息轨迹追踪</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">服务端消息过滤</td>\n<td style=\"text-align:center\">Yes</td>\n<td style=\"text-align:center\">Yes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">qps性能</td>\n<td style=\"text-align:center\">默认5000</td>\n<td style=\"text-align:center\">默认5000</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数据可靠性</td>\n<td style=\"text-align:center\">99.99999999%</td>\n<td style=\"text-align:center\">99.99%</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">数据堆积</td>\n<td style=\"text-align:center\">不限</td>\n<td style=\"text-align:center\">不限</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">服务可用性</td>\n<td style=\"text-align:center\">99.9%</td>\n<td style=\"text-align:center\">99.9%</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"API对比\"><a href=\"#API对比\" class=\"headerlink\" title=\"API对比\"></a>API对比</h4><p><a href=\"https://help.aliyun.com/document_detail/27473.html?spm=5176.doc27437.6.226.7LkW7O\">消息服务API地址</a></p>\n<p><a href=\"https://help.aliyun.com/document_detail/29572.html\">消息队列http API地址</a></p>\n<blockquote>\n<p><strong>消息服务的接口相对齐全一些，支持的类型也相对齐全，topic和queue两种形式。不过开发起来比较费劲，因为涉及到<a href=\"https://help.aliyun.com/document_detail/27487.html?spm=5176.doc27473.6.241.4ffAlt\">签名</a>的过程，在接收的时候，为了保证消息的安全性，需要进行验签，验签通过或才能进行逻辑处理。</strong></p>\n<p><strong>消息队列的http接口比较简单，但是消息的重复率较高，达到了20%，官网提供的demo比较简单，只有发送，消费和删除，需要进程循环接收消息，比较消耗资源open API接口齐全，但是暂时没有支持PHP的SDK，综合考虑下选择了消息服务。</strong></p>\n</blockquote>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cj3fgv31b00080oqmjqr6yatz","category_id":"cj3fgv31700050oqm7kne9sqw","_id":"cj3fgv31l000e0oqm33t6qq3k"},{"post_id":"cj3fgv30v00000oqmgk0gsklu","category_id":"cj3fgv31700050oqm7kne9sqw","_id":"cj3fgv31n000i0oqmfpwnv9v5"},{"post_id":"cj3fgv31000020oqmqjp9r1tz","category_id":"cj3fgv31j000b0oqmr64uv9za","_id":"cj3fgv31s000m0oqmgcsa1o2j"},{"post_id":"cj3fgv31800060oqmaul2w1vl","category_id":"cj3fgv31m000h0oqmv12djnlw","_id":"cj3fgv31w000s0oqmhco6ffpq"},{"post_id":"cj3fgv31u000p0oqmzqmtna49","category_id":"cj3fgv31m000h0oqmv12djnlw","_id":"cj3fgv31y000x0oqmkc459b4r"},{"post_id":"cj3fgv31i000a0oqmvhphaucm","category_id":"cj3fgv31m000h0oqmv12djnlw","_id":"cj3fgv32000110oqmevsq8qfl"},{"post_id":"cj3fgv31k000d0oqm6ahbuyxr","category_id":"cj3fgv31m000h0oqmv12djnlw","_id":"cj3fgv32200150oqmg3ky7s3y"},{"post_id":"cj3fgv31n000k0oqm74e9vpoo","category_id":"cj3fgv31z000z0oqmii5oqznx","_id":"cj3fgv326001b0oqm6u6m1bak"},{"post_id":"cj3fgv32100140oqmqsnpfcxo","category_id":"cj3fgv31j000b0oqmr64uv9za","_id":"cj3fgv32b001f0oqmb5dfxypx"},{"post_id":"cj3fgv31q000l0oqm1s1b2fxz","category_id":"cj3fgv31z000z0oqmii5oqznx","_id":"cj3fgv32d001i0oqmin5scqbr"},{"post_id":"cj3fgv31v000r0oqm5qli8l7c","category_id":"cj3fgv31z000z0oqmii5oqznx","_id":"cj3fgv32g001n0oqmzhckbg22"},{"post_id":"cj3fgv32b001h0oqmvhdnp8g3","category_id":"cj3fgv31j000b0oqmr64uv9za","_id":"cj3fgv32h001p0oqmdjvwiv9d"},{"post_id":"cj3fgv32f001l0oqms2up1f03","category_id":"cj3fgv31j000b0oqmr64uv9za","_id":"cj3fgv32k001u0oqmx8hldpy6"},{"post_id":"cj3fgv32h001r0oqmnh6ufx8y","category_id":"cj3fgv31700050oqm7kne9sqw","_id":"cj3fgv32o001z0oqm6gspw894"},{"post_id":"cj3fgv32l001v0oqmtptulq6q","category_id":"cj3fgv31m000h0oqmv12djnlw","_id":"cj3fgv32s00220oqmgdufysx1"},{"post_id":"cj3fgv32m001x0oqmi7v7dvaj","category_id":"cj3fgv31m000h0oqmv12djnlw","_id":"cj3fgv32v00270oqmgtrtlap6"},{"post_id":"cj3fgv32g001o0oqml5boi2jq","category_id":"cj3fgv32j001t0oqmcy5j57gq","_id":"cj3fgv32y002a0oqmjf28l14u"},{"post_id":"cj3fgv32t00240oqmqz949olt","category_id":"cj3fgv31m000h0oqmv12djnlw","_id":"cj3fgv331002d0oqm3asymij9"},{"post_id":"cj3fgv32w00280oqmdhioj96g","category_id":"cj3fgv31j000b0oqmr64uv9za","_id":"cj3fgv332002g0oqmab0eh7dh"},{"post_id":"cj3fgv32y002b0oqm8ku7na8c","category_id":"cj3fgv31m000h0oqmv12djnlw","_id":"cj3fgv335002k0oqmcu8zstc8"},{"post_id":"cj3fgv32o00200oqmdm9sx62a","category_id":"cj3fgv32v00260oqm46klvb9a","_id":"cj3fgv336002n0oqm1ggy2dsi"},{"post_id":"cj3fgv336002o0oqmgpm9lglu","category_id":"cj3fgv31j000b0oqmr64uv9za","_id":"cj3fgv339002t0oqm411cvm7q"},{"post_id":"cj3fgv331002f0oqmujkj3ke2","category_id":"cj3fgv335002j0oqmaq21vdou","_id":"cj3fgv33a002w0oqmhpyjer03"},{"post_id":"cj3fgv333002h0oqmpl8yepsh","category_id":"cj3fgv338002q0oqmg2erqaaa","_id":"cj3fgv33a002y0oqm0mqslg3q"},{"post_id":"cj3fgv335002l0oqmkxc2hk8z","category_id":"cj3fgv338002q0oqmg2erqaaa","_id":"cj3fgv33b00310oqms43deoau"}],"PostTag":[{"post_id":"cj3fgv30v00000oqmgk0gsklu","tag_id":"cj3fgv31400040oqmmx1cwhur","_id":"cj3fgv31j000c0oqmrdoaue0o"},{"post_id":"cj3fgv31000020oqmqjp9r1tz","tag_id":"cj3fgv31h00090oqmxwxbna8w","_id":"cj3fgv31n000j0oqm0syv0bdt"},{"post_id":"cj3fgv31b00080oqmjqr6yatz","tag_id":"cj3fgv31m000g0oqmz0q297kl","_id":"cj3fgv31v000q0oqmynxvdcst"},{"post_id":"cj3fgv31i000a0oqmvhphaucm","tag_id":"cj3fgv31s000n0oqmnh80qsl6","_id":"cj3fgv31y000w0oqm7ax4owtk"},{"post_id":"cj3fgv31k000d0oqm6ahbuyxr","tag_id":"cj3fgv31s000n0oqmnh80qsl6","_id":"cj3fgv32100130oqmij46zawb"},{"post_id":"cj3fgv31l000f0oqmov2987hl","tag_id":"cj3fgv32000100oqmypx4wsl8","_id":"cj3fgv32500190oqm2hn6b92i"},{"post_id":"cj3fgv31n000k0oqm74e9vpoo","tag_id":"cj3fgv32300170oqm9kxaq6xb","_id":"cj3fgv32b001g0oqmi713xbqv"},{"post_id":"cj3fgv31q000l0oqm1s1b2fxz","tag_id":"cj3fgv329001e0oqm5gl0ou2c","_id":"cj3fgv32f001m0oqmqlbe3l5m"},{"post_id":"cj3fgv31u000p0oqmzqmtna49","tag_id":"cj3fgv32e001k0oqm18hmrotg","_id":"cj3fgv32j001s0oqm8oeyej8y"},{"post_id":"cj3fgv31v000r0oqm5qli8l7c","tag_id":"cj3fgv32300170oqm9kxaq6xb","_id":"cj3fgv32n001y0oqm9m8eu3wc"},{"post_id":"cj3fgv32m001x0oqmi7v7dvaj","tag_id":"cj3fgv31s000n0oqmnh80qsl6","_id":"cj3fgv32r00210oqmvq3yau46"},{"post_id":"cj3fgv31y000y0oqm9qolpajx","tag_id":"cj3fgv32m001w0oqmw02mlhm2","_id":"cj3fgv32v00250oqmy7s6hwjt"},{"post_id":"cj3fgv32t00240oqmqz949olt","tag_id":"cj3fgv31s000n0oqmnh80qsl6","_id":"cj3fgv32y00290oqmgug4upzf"},{"post_id":"cj3fgv32000120oqmgh2dslsc","tag_id":"cj3fgv32s00230oqmnb67t8dn","_id":"cj3fgv331002e0oqm7bjbd86w"},{"post_id":"cj3fgv32100140oqmqsnpfcxo","tag_id":"cj3fgv330002c0oqmem890hwa","_id":"cj3fgv336002m0oqmw4ojo0kn"},{"post_id":"cj3fgv325001a0oqm7wbaff0b","tag_id":"cj3fgv32m001w0oqmw02mlhm2","_id":"cj3fgv338002r0oqmp36sapbe"},{"post_id":"cj3fgv32f001l0oqms2up1f03","tag_id":"cj3fgv32s00230oqmnb67t8dn","_id":"cj3fgv339002u0oqmvp3w9aov"},{"post_id":"cj3fgv32g001o0oqml5boi2jq","tag_id":"cj3fgv338002s0oqmjuedn9by","_id":"cj3fgv33a002z0oqmcvcl4prw"},{"post_id":"cj3fgv32h001r0oqmnh6ufx8y","tag_id":"cj3fgv33a002x0oqm9vfxrshx","_id":"cj3fgv33b00320oqmxrine1n2"},{"post_id":"cj3fgv32l001v0oqmtptulq6q","tag_id":"cj3fgv33a00300oqmyvr0weat","_id":"cj3fgv33b00340oqmq39rzshr"},{"post_id":"cj3fgv32o00200oqmdm9sx62a","tag_id":"cj3fgv33b00330oqmp4uwbabk","_id":"cj3fgv33d00360oqm4h5h14bp"},{"post_id":"cj3fgv32y002b0oqm8ku7na8c","tag_id":"cj3fgv33d00350oqmnladejd9","_id":"cj3fgv33e00380oqmj10azdsm"},{"post_id":"cj3fgv331002f0oqmujkj3ke2","tag_id":"cj3fgv33e00370oqmzueavisu","_id":"cj3fgv33f003a0oqmsbg4iinv"},{"post_id":"cj3fgv333002h0oqmpl8yepsh","tag_id":"cj3fgv33f00390oqm6ugu1gqx","_id":"cj3fgv33f003c0oqmifutg37i"},{"post_id":"cj3fgv335002l0oqmkxc2hk8z","tag_id":"cj3fgv33f00390oqm6ugu1gqx","_id":"cj3fgv33g003e0oqmdysbskxv"},{"post_id":"cj3fgv336002o0oqmgpm9lglu","tag_id":"cj3fgv33f003d0oqm0g66w4y3","_id":"cj3fgv33g003f0oqmnylrryup"}],"Tag":[{"name":"Git Push","_id":"cj3fgv31400040oqmmx1cwhur"},{"name":"正则表达式","_id":"cj3fgv31h00090oqmxwxbna8w"},{"name":"git branch","_id":"cj3fgv31m000g0oqmz0q297kl"},{"name":"Linux","_id":"cj3fgv31s000n0oqmnh80qsl6"},{"name":"MySQL","_id":"cj3fgv32000100oqmypx4wsl8"},{"name":"Nodejs","_id":"cj3fgv32300170oqm9kxaq6xb"},{"name":"NodeJs","_id":"cj3fgv329001e0oqm5gl0ou2c"},{"name":"Nginx","_id":"cj3fgv32e001k0oqm18hmrotg"},{"name":"PHP7","_id":"cj3fgv32m001w0oqmw02mlhm2"},{"name":"PHP","_id":"cj3fgv32s00230oqmnb67t8dn"},{"name":"curl json","_id":"cj3fgv330002c0oqmem890hwa"},{"name":"Life Picture","_id":"cj3fgv338002s0oqmjuedn9by"},{"name":"git ssh https","_id":"cj3fgv33a002x0oqm9vfxrshx"},{"name":"php linux nginx","_id":"cj3fgv33a00300oqmyvr0weat"},{"name":"Bash Linux","_id":"cj3fgv33b00330oqmp4uwbabk"},{"name":"sphinx","_id":"cj3fgv33d00350oqmnladejd9"},{"name":"自我反思","_id":"cj3fgv33e00370oqmzueavisu"},{"name":"随笔","_id":"cj3fgv33f00390oqm6ugu1gqx"},{"name":"消息队列 消息服务 阿里云","_id":"cj3fgv33f003d0oqm0g66w4y3"}]}}